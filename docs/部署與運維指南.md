# éƒ¨ç½²èˆ‡é‹ç¶­æŒ‡å—

## ğŸš€ éƒ¨ç½²ç’°å¢ƒ

### ä¸»è¦éƒ¨ç½²å¹³å°
- **Render** (ä¸»è¦): è‡ªå‹•éƒ¨ç½²ï¼Œæ”¯æ´ç’°å¢ƒè®Šæ•¸
- **Vercel** (å‚™é¸): Serverless éƒ¨ç½²
- **Heroku** (æ”¯æ´): å‚³çµ± PaaS éƒ¨ç½²

### ç•¶å‰éƒ¨ç½²ä¿¡æ¯
- **å¹³å°**: Render.com
- **éƒ¨ç½²æ–¹å¼**: Git è‡ªå‹•éƒ¨ç½²
- **æœå‹™ ID**: `srv-d21f9u15pdvs73frvns0`
- **å·¥ä½œç©ºé–“**: `tea-d1otdn7fte5s73bnf3k0`

## âš™ï¸ ç’°å¢ƒè®Šæ•¸é…ç½®

### å¿…è¦ç’°å¢ƒè®Šæ•¸
```env
# OpenAI é…ç½®
OPENAI_API_KEY=your_openai_api_key

# Firebase é…ç½®  
FIREBASE_PROJECT_ID=your_firebase_project_id
FIREBASE_PRIVATE_KEY="-----BEGIN PRIVATE KEY-----\n...\n-----END PRIVATE KEY-----\n"
FIREBASE_CLIENT_EMAIL=your_service_account_email

# LINE Bot é…ç½®
LINE_CHANNEL_ACCESS_TOKEN=your_line_channel_access_token
LINE_CHANNEL_SECRET=your_line_channel_secret

# ç®¡ç†å¾Œå°é…ç½®
ADMIN_KEY=course-admin-2024
BASIC_AUTH_USER=grandot
BASIC_AUTH_PASS=your_admin_password

# å ´æ™¯é…ç½®
SCENARIO_TYPE=course_management

# æ‡‰ç”¨é…ç½®
NODE_ENV=production
PORT=3000
```

### ç’°å¢ƒè®Šæ•¸å®‰å…¨æ³¨æ„äº‹é …
- âœ… ä½¿ç”¨ Render çš„ç’°å¢ƒè®Šæ•¸åŠŸèƒ½ï¼Œä¸è¦å°‡æ•æ„Ÿä¿¡æ¯å¯«å…¥ä»£ç¢¼
- âœ… Firebase ç§é‘°éœ€è¦ä¿æŒæ›è¡Œæ ¼å¼
- âœ… å®šæœŸè¼ªæ› API Keys
- âŒ çµ•ä¸å°‡ `.env` æª”æ¡ˆæäº¤åˆ° git

## ğŸ“Š ç›£æ§èˆ‡æ—¥èªŒ

### Render CLI è¨­ç½®
```bash
# å®‰è£ Render CLI
brew install render

# ç™»éŒ„ Renderï¼ˆå·²é…ç½®ï¼‰
render auth login

# æŸ¥çœ‹æœå‹™ç‹€æ…‹
render services list

# æŸ¥çœ‹æ—¥èªŒ
render logs -s srv-d21f9u15pdvs73frvns0
```

### æ—¥èªŒæŸ¥è©¢è…³æœ¬
```bash
# åŸºæœ¬æŸ¥è©¢ï¼ˆæœ€è¿‘50æ¢ï¼‰
./scripts/get-app-logs.sh 50

# æœç´¢ç‰¹å®šé—œéµè©
./scripts/get-app-logs.sh 30 "ç”¨æˆ¶è¼¸å…¥å…§å®¹"

# æŸ¥æ‰¾éŒ¯èª¤æ—¥èªŒ
./scripts/get-app-logs.sh 100 "ERROR"

# æŸ¥æ‰¾è­¦å‘Š
./scripts/get-app-logs.sh 50 "WARN"
```

### å¸¸è¦‹æ—¥èªŒæŸ¥è©¢å ´æ™¯
```bash
# èªç¾©è§£æå•é¡Œ
./scripts/get-app-logs.sh 50 "SemanticService"

# æ™‚é–“è™•ç†å•é¡Œ  
./scripts/get-app-logs.sh 30 "TimeService"

# èª²ç¨‹æ“ä½œå•é¡Œ
./scripts/get-app-logs.sh 40 "CourseManagement"

# APIèª¿ç”¨å•é¡Œ
./scripts/get-app-logs.sh 50 "POST"

# OpenAI ç›¸é—œå•é¡Œ
./scripts/get-app-logs.sh 30 "OpenAI"

# Firebase é€£æ¥å•é¡Œ
./scripts/get-app-logs.sh 30 "Firebase"
```

## ğŸ› æ•…éšœæ’é™¤

### èª¿è©¦æµç¨‹
1. **ç”¨æˆ¶å ±å‘Šæ¨¡æ¿**
   ```
   æˆ‘å‰›è¼¸å…¥"XXX"ä½†è¿”å›çµæœä¸å°ï¼ŒæŸ¥renderæ—¥èªŒåˆ†æå•é¡Œ
   ```

2. **æ¨™æº–èª¿è©¦æ­¥é©Ÿ**
   ```bash
   # 1. ç«‹å³æŸ¥è©¢æ‡‰ç”¨ç¨‹åºæ—¥èªŒ
   ./scripts/get-app-logs.sh 50
   
   # 2. æœç´¢ç”¨æˆ¶è¼¸å…¥ç›¸é—œæ—¥èªŒ
   ./scripts/get-app-logs.sh 30 "ç”¨æˆ¶è¼¸å…¥å…§å®¹"
   
   # 3. åˆ†æéŒ¯èª¤æ¨¡å¼
   ./scripts/get-app-logs.sh 100 "ERROR"
   ```

3. **èª¿è©¦å¾ŒçºŒæµç¨‹**
   - åˆ†ææ—¥èªŒæ‰¾å‡ºå•é¡Œæ ¹æº
   - å®šä½ç›¸é—œä»£ç¢¼æ–‡ä»¶  
   - ä¿®å¾©ä»£ç¢¼é‚è¼¯
   - æ›´æ–° CHANGELOG.md
   - æ¨é€åˆ° gitï¼ˆå¿…é ˆå…ˆæ›´æ–° CHANGELOG.mdï¼‰

### å¸¸è¦‹å•é¡Œè§£æ±º

#### 1. OpenAI API éŒ¯èª¤
```bash
# æª¢æŸ¥ API Key ç‹€æ…‹
curl -H "Authorization: Bearer $OPENAI_API_KEY" \
     https://api.openai.com/v1/models

# å¸¸è¦‹éŒ¯èª¤é¡å‹
# - 401: API Key ç„¡æ•ˆæˆ–éæœŸ
# - 429: è«‹æ±‚é »ç‡è¶…é™
# - 500: OpenAI æœå‹™éŒ¯èª¤
```

**è§£æ±ºæ–¹æ³•**:
- é©—è­‰ API Key æ˜¯å¦æ­£ç¢º
- æª¢æŸ¥ OpenAI å¸³æˆ¶é¤˜é¡
- ç¢ºèªè«‹æ±‚é »ç‡åœ¨é™åˆ¶å…§

#### 2. Firebase é€£æ¥å•é¡Œ
```bash
# æª¢æŸ¥æœå‹™å¸³è™Ÿé‡‘é‘°æ ¼å¼
echo $FIREBASE_PRIVATE_KEY | head -c 100

# é©—è­‰é …ç›® ID
echo $FIREBASE_PROJECT_ID
```

**è§£æ±ºæ–¹æ³•**:
- ç¢ºèª Firebase é …ç›® ID æ­£ç¢º
- æª¢æŸ¥æœå‹™å¸³è™Ÿé‡‘é‘°æ ¼å¼ï¼ˆä¿æŒæ›è¡Œï¼‰
- é©—è­‰æœå‹™å¸³è™Ÿæ¬Šé™

#### 3. LINE API éŒ¯èª¤  
```bash
# æª¢æŸ¥ Channel Access Token
curl -H "Authorization: Bearer $LINE_CHANNEL_ACCESS_TOKEN" \
     https://api.line.me/v2/bot/info

# é©—è­‰ Webhook URL
curl -X POST https://api.line.me/v2/bot/channel/webhook/test \
     -H "Authorization: Bearer $LINE_CHANNEL_ACCESS_TOKEN"
```

**è§£æ±ºæ–¹æ³•**:
- ç¢ºèª Channel Access Token æœ‰æ•ˆ
- æª¢æŸ¥ Webhook URL è¨­ç½®
- é©—è­‰ LINE Bot è¨­å®š

#### 4. éƒ¨ç½²å¤±æ•—
**å¸¸è¦‹åŸå› **:
- ç’°å¢ƒè®Šæ•¸ç¼ºå¤±æˆ–æ ¼å¼éŒ¯èª¤
- ä¾è³´åŒ…å®‰è£å¤±æ•—
- ç«¯å£é…ç½®å•é¡Œ

**è§£æ±ºæ­¥é©Ÿ**:
```bash
# 1. æª¢æŸ¥ Render éƒ¨ç½²æ—¥èªŒ
render logs -s srv-d21f9u15pdvs73frvns0 --tail

# 2. é©—è­‰ package.json
npm install  # æœ¬åœ°æ¸¬è©¦

# 3. æª¢æŸ¥ç’°å¢ƒè®Šæ•¸
# åœ¨ Render Dashboard ä¸­é€ä¸€ç¢ºèª
```

#### 5. è¨˜æ†¶é«”æˆ–æ€§èƒ½å•é¡Œ
```bash
# æŸ¥çœ‹ç³»çµ±è³‡æºä½¿ç”¨
./scripts/get-app-logs.sh 50 "memory"
./scripts/get-app-logs.sh 50 "timeout"

# æª¢æŸ¥å¤§é‡è«‹æ±‚
./scripts/get-app-logs.sh 100 | grep -E "(POST|GET)" | wc -l
```

**å„ªåŒ–æ–¹æ³•**:
- æª¢æŸ¥æ˜¯å¦æœ‰è¨˜æ†¶é«”æ´©æ¼
- å„ªåŒ–æ•¸æ“šåº«æŸ¥è©¢
- å¢åŠ  Render æœå‹™è³‡æº

## ğŸ“ˆ æ€§èƒ½ç›£æ§

### é—œéµæŒ‡æ¨™ç›£æ§
```bash
# API éŸ¿æ‡‰æ™‚é–“
./scripts/get-app-logs.sh 100 | grep "Response time"

# éŒ¯èª¤ç‡çµ±è¨ˆ
./scripts/get-app-logs.sh 200 | grep "ERROR" | wc -l

# OpenAI Token ä½¿ç”¨é‡
./scripts/get-app-logs.sh 100 | grep "token_usage"

# ç”¨æˆ¶æ´»èºåº¦
./scripts/get-app-logs.sh 200 | grep "user_id" | sort | uniq -c
```

### æˆæœ¬æ§åˆ¶ç›£æ§
```javascript
// Token ä½¿ç”¨çµ±è¨ˆæŸ¥è©¢
{
  user_id: "LINE User ID",
  model: "gpt-3.5-turbo",
  total_tokens: 2280,
  total_cost_twd: 0.11,              // æ–°å°å¹£æˆæœ¬
  user_message: "åŸå§‹è¨Šæ¯",
  timestamp: "ISO æ™‚é–“"
}
```

```bash
# æŸ¥çœ‹ä»Šæ—¥æˆæœ¬
./scripts/get-app-logs.sh 500 | grep "total_cost_twd" | \
awk '{sum+=$NF} END {print "ä»Šæ—¥ç¸½æˆæœ¬: $" sum " TWD"}'

# æŸ¥çœ‹ç”¨æˆ¶ä½¿ç”¨æ’è¡Œ
./scripts/get-app-logs.sh 1000 | grep "user_id" | \
sort | uniq -c | sort -nr | head -10
```

## ğŸ”’ å®‰å…¨ç®¡ç†

### ç®¡ç†å¾Œå°å®‰å…¨
- **å¤šå±¤é˜²è­·**: Basic Auth + Admin Key
- **è¨ªå•æ§åˆ¶**: åƒ…é™æˆæ¬Šäººå“¡
- **æ“ä½œæ—¥èªŒ**: è¨˜éŒ„æ‰€æœ‰ç®¡ç†æ“ä½œ

### æ•¸æ“šå‚™ä»½
```bash
# Firebase æ•¸æ“šåŒ¯å‡ºï¼ˆéœ€è¦åœ¨ Firebase Console æ“ä½œï¼‰
# 1. é€²å…¥ Firebase Console
# 2. é¸æ“‡ Firestore Database
# 3. é¸æ“‡ "åŒ¯å‡ºè³‡æ–™"
# 4. è¨­å®šåŒ¯å‡ºè¨­å®šä¸¦åŸ·è¡Œ

# ç’°å¢ƒè®Šæ•¸å‚™ä»½ï¼ˆå®‰å…¨å­˜å„²ï¼‰
# å®šæœŸå‚™ä»½ Render ç’°å¢ƒè®Šæ•¸è¨­å®š
```

### ç½é›£å¾©åŸè¨ˆåŠƒ
1. **æ•¸æ“šå‚™ä»½**: æ¯é€±è‡ªå‹•å‚™ä»½ Firestore æ•¸æ“š
2. **ä»£ç¢¼å‚™ä»½**: Git å€‰åº«ä½œç‚ºä¸»è¦å‚™ä»½
3. **é…ç½®å‚™ä»½**: ç’°å¢ƒè®Šæ•¸å’Œéƒ¨ç½²è¨­å®šæ–‡æª”åŒ–
4. **å¿«é€Ÿå¾©åŸ**: æº–å‚™å¥½çš„éƒ¨ç½²è…³æœ¬å’Œç’°å¢ƒè¨­å®š

## ğŸ“± å¤šç’°å¢ƒç®¡ç†

### é–‹ç™¼ç’°å¢ƒ
```bash
# æœ¬åœ°é–‹ç™¼
npm run dev
# ä½¿ç”¨ .env.local é…ç½®
```

### æ¸¬è©¦ç’°å¢ƒï¼ˆå¯é¸ï¼‰
```bash
# è¨­ç½®æ¸¬è©¦ç’°å¢ƒè®Šæ•¸
SCENARIO_TYPE=course_management_test
NODE_ENV=staging
```

### ç”Ÿç”¢ç’°å¢ƒ
```bash
# Render ç”Ÿç”¢ç’°å¢ƒ
SCENARIO_TYPE=course_management
NODE_ENV=production
```

## ğŸ”„ CI/CD æµç¨‹ï¼ˆç°¡åŒ–ç‰ˆï¼‰

### ç•¶å‰éƒ¨ç½²æµç¨‹
```
ä»£ç¢¼æ¨é€ â†’ GitHub â†’ Render è‡ªå‹•æ‹‰å– â†’ æ§‹å»º â†’ éƒ¨ç½² â†’ å¥åº·æª¢æŸ¥
```

### éƒ¨ç½²æª¢æŸ¥æ¸…å–®
- [ ] æ›´æ–° CHANGELOG.md
- [ ] æ¸¬è©¦ä¸»è¦åŠŸèƒ½è·¯å¾‘
- [ ] ç¢ºèªç’°å¢ƒè®Šæ•¸é…ç½®
- [ ] æª¢æŸ¥ä¾è³´åŒ…ç‰ˆæœ¬
- [ ] é©—è­‰ API ç«¯é»æ­£å¸¸
- [ ] ç›£æ§éƒ¨ç½²å¾Œæ—¥èªŒ

### å›æ»¾ç¨‹åº
```bash
# 1. åœ¨ Render Dashboard ä¸­é¸æ“‡å›æ»¾
# 2. æˆ–è€…æ¨é€å›æ»¾æäº¤
git revert <commit-hash>
git push origin main

# 3. ç¢ºèªæœå‹™ç‹€æ…‹
render services list
```

## ğŸ“ ç·Šæ€¥è¯çµ¡

### æœå‹™ä¸­æ–·è™•ç†
1. **ç«‹å³æª¢æŸ¥**: Render æœå‹™ç‹€æ…‹
2. **æŸ¥çœ‹æ—¥èªŒ**: æœ€è¿‘çš„éŒ¯èª¤ä¿¡æ¯
3. **é€šçŸ¥ç”¨æˆ¶**: å¿…è¦æ™‚é€šé LINE å®˜æ–¹å¸³è™Ÿ
4. **è¨˜éŒ„äº‹ä»¶**: åœ¨ CHANGELOG.md ä¸­è¨˜éŒ„

### è¯çµ¡ä¿¡æ¯
- **Render æ”¯æ´**: render.com/support
- **OpenAI ç‹€æ…‹**: status.openai.com
- **Firebase ç‹€æ…‹**: status.firebase.google.com