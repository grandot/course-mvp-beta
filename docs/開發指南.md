# é–‹ç™¼æŒ‡å—

## ğŸš€ é–‹ç™¼æµç¨‹

### MVP éšæ®µé–‹ç™¼æµç¨‹
```
åŠŸèƒ½é–‹ç™¼ â†’ æœ¬åœ°é©—è­‰ â†’ ç›´æ¥éƒ¨ç½² â†’ ç”Ÿç”¢æ¸¬è©¦ â†’ ç”¨æˆ¶åé¥‹ â†’ å¿«é€Ÿè¿­ä»£
```

### å¿«é€ŸåŸå‹å„ªå…ˆåŸå‰‡
**ç›®æ¨™ï¼šå¿«é€Ÿé©—è­‰æ ¸å¿ƒåŠŸèƒ½ï¼Œå„ªå…ˆç”¨æˆ¶é«”é©—**

- âœ… **å°ˆæ³¨æ ¸å¿ƒåŠŸèƒ½**ï¼šèª²ç¨‹ç®¡ç†ã€è‡ªç„¶èªè¨€è™•ç†ã€LINE Bot é›†æˆ
- âœ… **ç›´æ¥éƒ¨ç½²é©—è­‰**ï¼šRender ç”Ÿç”¢ç’°å¢ƒç›´æ¥æ¸¬è©¦
- âŒ **æš«ä¸å¯¦æ–½**ï¼šCI/CD pipelineã€æ¸¬è©¦ç’°å¢ƒã€è‡ªå‹•åŒ–æ¸¬è©¦
- âŒ **æš«ä¸å¯¦æ–½**ï¼šå–®å…ƒæ¸¬è©¦ã€é›†æˆæ¸¬è©¦ã€ç«¯åˆ°ç«¯æ¸¬è©¦

## ğŸ”§ ç·¨ç¢¼è¦ç¯„

### å¿…é ˆéµå¾ªçš„è¦å‰‡
```javascript
// âœ… æ­£ç¢ºï¼šé€šé SemanticService è™•ç†èªç¾©
const result = await SemanticService.analyzeMessage(text, context);

// âŒ éŒ¯èª¤ï¼šç›´æ¥èª¿ç”¨ OpenAI
const result = await openaiService.analyze(text);

// âœ… æ­£ç¢ºï¼šé€šé TimeService è™•ç†æ™‚é–“
const currentTime = TimeService.getCurrentUserTime();

// âŒ éŒ¯èª¤ï¼šç›´æ¥ä½¿ç”¨ Date
const currentTime = new Date();

// âœ… æ­£ç¢ºï¼šé€šé DataService æ“ä½œæ•¸æ“š
const courses = await DataService.queryCourses(criteria);

// âŒ éŒ¯èª¤ï¼šç›´æ¥èª¿ç”¨ Firebase
const courses = await firebaseService.getCourses(criteria);
```

### ä»£ç¢¼é¢¨æ ¼è¦æ±‚
- **æ¨¡çµ„ç³»çµ±**: ä½¿ç”¨ ES æ¨¡çµ„ï¼ˆimport/exportï¼‰
- **ç•°æ­¥è™•ç†**: å„ªå…ˆä½¿ç”¨ async/await è€Œé promises
- **å‘½åæ…£ä¾‹**: éµå¾ªç¾æœ‰é§å³°å‘½åæ³•
- **è¨»é‡‹åŸå‰‡**: é¿å…å†—é•·è¨»é‡‹ï¼Œä»£ç¢¼æ‡‰è‡ªæˆ‘èªªæ˜
- **éŒ¯èª¤è™•ç†**: çµ±ä¸€ä½¿ç”¨ try-catch çµæ§‹

### ç¦æ­¢çš„è·¨å±¤èª¿ç”¨
```javascript
// âŒ ç¦æ­¢ï¼šController ç›´æ¥èª¿ç”¨å…§éƒ¨æœå‹™
// lineController.js
const result = await openaiService.complete(prompt);

// âœ… æ­£ç¢ºï¼šé€šé SemanticService
const result = await SemanticService.analyzeMessage(text);

// âŒ ç¦æ­¢ï¼šService ç›´æ¥æ“ä½œ Firebase
// courseService.js  
const doc = await firestore.collection('courses').add(data);

// âœ… æ­£ç¢ºï¼šé€šé DataService
const result = await DataService.saveCourse(courseData);
```

## ğŸ“š æ ¸å¿ƒæœå‹™ API

### SemanticService API
```javascript
// ä¸»è¦åˆ†ææ–¹æ³•
await SemanticService.analyzeMessage(text, context)
// è¿”å›: { intent, entities, confidence, context }

// å¯¦é«”æå–
await SemanticService.extractCourseEntities(text)
// è¿”å›: { course_name, timeInfo, location, teacher }

// èª²ç¨‹åç¨±æå–
await SemanticService.extractCourse(text)
// è¿”å›: string | null

// æ™‚é–“ä¿¡æ¯æå–
await SemanticService.extractTime(text)
// è¿”å›: { timeString, parsedTime } | null
```

### TimeService API
```javascript
// ç²å–ç”¨æˆ¶ç•¶å‰æ™‚é–“
TimeService.getCurrentUserTime()
// è¿”å›: Date

// è§£ææ™‚é–“å­—ç¬¦ä¸²
TimeService.parseTimeString(str, referenceTime)
// è¿”å›: { success, parsedTime, confidence }

// æ ¼å¼åŒ–é¡¯ç¤º
TimeService.formatForDisplay(time, format)
// è¿”å›: string (æ ¼å¼: MM/DD HH:MM AM/PM)

// é©—è­‰æ™‚é–“æ ¼å¼
TimeService.validateTimeFormat(timeString)
// è¿”å›: boolean
```

### DataService API
```javascript
// ä¿å­˜èª²ç¨‹
await DataService.saveCourse(courseData)
// è¿”å›: { success, courseId, message }

// æŸ¥è©¢èª²ç¨‹
await DataService.queryCourses(criteria)
// è¿”å›: Course[]

// æ›´æ–°èª²ç¨‹
await DataService.updateCourse(courseId, updateData)
// è¿”å›: { success, message }

// åˆªé™¤èª²ç¨‹
await DataService.deleteCourse(courseId)
// è¿”å›: { success, message }

// æª¢æŸ¥æ™‚é–“è¡çª
await DataService.checkTimeConflicts(userId, date, time, excludeId)
// è¿”å›: { hasConflict, conflictingCourses }
```

### TaskService API
```javascript
// åŸ·è¡Œæ„åœ–ä»»å‹™
await TaskService.executeIntent(intent, entities, userId)
// è¿”å›: { success, message, data }

// æ”¯æŒçš„æ„åœ–é¡å‹
const supportedIntents = [
  'record_course',    // æ–°å¢èª²ç¨‹
  'modify_course',    // ä¿®æ”¹èª²ç¨‹
  'cancel_course',    // å–æ¶ˆèª²ç¨‹
  'query_courses',    // æŸ¥è©¢èª²ç¨‹
  'clear_courses'     // æ¸…ç©ºèª²ç¨‹
];
```

## ğŸ“Š ç”¨æˆ¶è¼¸å…¥è™•ç†æµç¨‹è©³è§£

### è™•ç†æ­¥é©Ÿè©³ç´°èªªæ˜

**Step 0: ç´”æ™‚é–“æª¢æ¸¬æ””æˆª**
```javascript
// æ””æˆªç„¡æ„ç¾©çš„ç´”æ™‚é–“è¼¸å…¥ï¼Œé¿å…ç³»çµ±è³‡æºæµªè²»
const pureTimePatterns = [
  /^(æ˜å¤©|ä»Šå¤©|å¾Œå¤©)\s*(ä¸Šåˆ|ä¸‹åˆ|æ™šä¸Š)?\s*\d{1,2}é»åŠ?$/,
  /^\d{1,2}:\d{2}$/,
  /^\d{1,2}é»\d{0,2}åˆ†?$/
];

detectPureTimeInput("æ˜å¤©ä¸‹åˆå››é»") â†’ ç›´æ¥æ‹’çµ•
detectPureTimeInput("æ˜å¤©ä¸‹åˆå››é»è·†æ‹³é“") â†’ é€šéæª¢æ¸¬ï¼Œç¹¼çºŒè™•ç†
```

**Step 1: è¦å‰‡å¼•æ“æ™ºèƒ½æ‰“åˆ†**
```javascript
// IntentRuleEngine åŸºæ–¼é…ç½®é€²è¡Œæ„åœ–è­˜åˆ¥
IntentRuleEngine.analyzeIntent("å–æ¶ˆæ•¸å­¸èª²")
â†’ { intent: 'cancel_course', confidence: 0.8 }

IntentRuleEngine.analyzeIntent("æˆ‘æƒ³å­¸é»ä»€éº¼")  
â†’ { intent: 'unknown', confidence: 0.0 }
```

**Step 2: çµ±ä¸€å¯¦é«”æå–**
```javascript
// OpenAIå„ªå…ˆçš„å¯¦é«”æå–ï¼Œæ­£å‰‡è¡¨é”å¼fallback
SemanticService.extractCourseEntities("æ˜å¤©ä¸‹åˆå››é»åŠè·†æ‹³é“")
â†’ { 
  course_name: "è·†æ‹³é“", 
  timeInfo: {
    date: "2025-07-31",
    time: "16:30",
    confidence: 0.9
  }, 
  location: null 
}
```

**Step 3: é—œéµä¿¡å¿ƒåº¦æ¸¬è©¦**
```javascript
// æ™ºèƒ½åˆ¤æ–·ï¼šé«˜ä¿¡å¿ƒåº¦è·³éAIï¼Œä½ä¿¡å¿ƒåº¦èª¿ç”¨AI
if (ruleResult.confidence >= 0.8 && intent !== 'unknown') {
  return è¦å‰‡å¼•æ“çµæœ;  // 60-70% æ¡ˆä¾‹ï¼Œæ¯«ç§’ç´šéŸ¿æ‡‰
} else {
  return await OpenAI.analyzeIntent();  // 30-40% æ¡ˆä¾‹ï¼Œæ·±åº¦ç†è§£
}
```

### æ•ˆèƒ½çµ±è¨ˆ

| è™•ç†å±¤ç´š | æ¡ˆä¾‹æ¯”ä¾‹ | éŸ¿æ‡‰æ™‚é–“ | æº–ç¢ºç‡ | æˆæœ¬ |
|---------|---------|----------|--------|------|
| **ç´”æ™‚é–“æ””æˆª** | ~5% | <1ms | 100% | å…è²» |
| **è¦å‰‡å¼•æ“** | ~60-70% | <10ms | 100% | å…è²» |
| **OpenAIè™•ç†** | ~30-40% | 200-500ms | 95%+ | ä»˜è²» |

## ğŸ¯ é…ç½®é©…å‹•é–‹ç™¼

### æ„åœ–è¦å‰‡é…ç½® (`intent-rules.yaml`)
```yaml
# æ„åœ–é…ç½®çµæ§‹
intent_name:
  keywords: ['é—œéµè©1', 'é—œéµè©2']    # å¿…è¦é—œéµè©
  priority: 10                       # å„ªå…ˆç´šï¼ˆæ•¸å­—è¶Šé«˜è¶Šå„ªå…ˆï¼‰
  exclusions: ['æ’é™¤è©1', 'æ’é™¤è©2']  # æ’é™¤é—œéµè©
  requires_context: false            # æ˜¯å¦éœ€è¦ä¸Šä¸‹æ–‡
```

### å ´æ™¯é…ç½®é–‹ç™¼
```yaml
# é…ç½®æ–‡ä»¶çµæ§‹
scenario_name: "å ´æ™¯åç¨±"
entity_type: "æ•¸æ“šåº«é›†åˆåç¨±"
entity_name: "é¡¯ç¤ºåç¨±"
required_fields: ["å¿…è¦æ¬„ä½1", "å¿…è¦æ¬„ä½2"]

# è¨Šæ¯æ¨¡æ¿é…ç½®
messages:
  create_success: "âœ… {entity_name}ã€Œ{course_name}ã€å·²æˆåŠŸæ–°å¢ï¼"
  create_error: "âŒ æ–°å¢{entity_name}å¤±æ•—ï¼š{error_message}"
  
# æ¥­å‹™è¦å‰‡é…ç½®
business_rules:
  create:
    allow_duplicate_names: false
    auto_generate_missing_fields: true
```

### è¨Šæ¯æ¨¡æ¿è¨­è¨ˆ
```javascript
// æ¨¡æ¿è®Šæ•¸ä½¿ç”¨
const template = "âœ… {entity_name}ã€Œ{course_name}ã€å·²æˆåŠŸæ–°å¢ï¼\nğŸ•’ æ™‚é–“ï¼š{schedule_time}";
const variables = {
  entity_name: "èª²ç¨‹",
  course_name: "æ•¸å­¸èª²",
  schedule_time: "07/31 4:30 PM"
};

// æ¸²æŸ“çµæœ
"âœ… èª²ç¨‹ã€Œæ•¸å­¸èª²ã€å·²æˆåŠŸæ–°å¢ï¼\nğŸ•’ æ™‚é–“ï¼š07/31 4:30 PM"
```

## ğŸ› èª¿è©¦å’Œæ¸¬è©¦

### æœ¬åœ°é–‹ç™¼èª¿è©¦
```bash
# å•Ÿå‹•é–‹ç™¼æ¨¡å¼
npm run dev

# æŸ¥çœ‹æ—¥èªŒ
npm run logs

# åŸ·è¡Œæ¸¬è©¦
npm test

# é¡å‹æª¢æŸ¥
npm run type-check
```

### ç”Ÿç”¢ç’°å¢ƒèª¿è©¦
```bash
# æŸ¥çœ‹æœ€è¿‘æ—¥èªŒ
./scripts/get-app-logs.sh 50

# æœç´¢ç‰¹å®šéŒ¯èª¤
./scripts/get-app-logs.sh 100 "ERROR"

# æŒ‰æœå‹™æŸ¥è©¢
./scripts/get-app-logs.sh 30 "SemanticService"
./scripts/get-app-logs.sh 30 "TimeService"
./scripts/get-app-logs.sh 30 "TaskService"

# æŒ‰åŠŸèƒ½æŸ¥è©¢
./scripts/get-app-logs.sh 50 "èª²ç¨‹"
./scripts/get-app-logs.sh 30 "æ™‚é–“è§£æ"
```

### å¸¸è¦‹å•é¡Œæ’æŸ¥
```bash
# OpenAI ç›¸é—œå•é¡Œ
./scripts/get-app-logs.sh 50 "OpenAI" 

# Firebase é€£æ¥å•é¡Œ
./scripts/get-app-logs.sh 30 "Firebase"

# LINE API å•é¡Œ
./scripts/get-app-logs.sh 30 "LINE"

# æ™‚é–“è§£æå•é¡Œ
./scripts/get-app-logs.sh 50 "parseTime"
```

## ğŸ“ æ–‡æª”å’Œè¨»é‡‹è¦ç¯„

### ä»£ç¢¼è¨»é‡‹åŸå‰‡
```javascript
// âœ… å¥½çš„è¨»é‡‹ï¼šè§£é‡‹ç‚ºä»€éº¼
// ä½¿ç”¨è¦å‰‡å¼•æ“è™•ç†é«˜ä¿¡å¿ƒåº¦æ„åœ–ï¼Œé¿å…ä¸å¿…è¦çš„ AI èª¿ç”¨
if (confidence >= 0.8) {
  return ruleResult;
}

// âŒ ä¸å¥½çš„è¨»é‡‹ï¼šé‡è¤‡ä»£ç¢¼å…§å®¹
// å¦‚æœä¿¡å¿ƒåº¦å¤§æ–¼ç­‰æ–¼ 0.8
if (confidence >= 0.8) {
  return ruleResult;
}

// âœ… å¥½çš„è¨»é‡‹ï¼šé‡è¦çš„æ¥­å‹™é‚è¼¯
// èª²ç¨‹æ™‚é–“è¡çªæª¢æŸ¥ï¼šåŒä¸€ç”¨æˆ¶åœ¨åŒä¸€æ™‚é–“åªèƒ½æœ‰ä¸€å ‚èª²
const hasConflict = await checkTimeConflicts(userId, dateTime);
```

### API æ–‡æª”æ ¼å¼
```javascript
/**
 * åˆ†æç”¨æˆ¶è¨Šæ¯ä¸¦æå–æ„åœ–å’Œå¯¦é«”
 * @param {string} text - ç”¨æˆ¶è¼¸å…¥æ–‡æœ¬
 * @param {Object} context - å°è©±ä¸Šä¸‹æ–‡
 * @param {string} context.userId - ç”¨æˆ¶ ID
 * @param {Array} context.history - å°è©±æ­·å²
 * @returns {Promise<Object>} åˆ†æçµæœ
 * @returns {string} returns.intent - è­˜åˆ¥çš„æ„åœ–
 * @returns {Object} returns.entities - æå–çš„å¯¦é«”
 * @returns {number} returns.confidence - ä¿¡å¿ƒåº¦ (0-1)
 */
async function analyzeMessage(text, context) {
  // å¯¦ç¾é‚è¼¯
}
```

## ğŸš€ éƒ¨ç½²å‰æª¢æŸ¥æ¸…å–®

### ä»£ç¢¼å“è³ªæª¢æŸ¥
- [ ] æ‰€æœ‰ä¿®æ”¹éµå¾ªæ¶æ§‹ç´„æŸ
- [ ] æ²’æœ‰è·¨å±¤ç›´æ¥èª¿ç”¨
- [ ] æ›´æ–°äº† CHANGELOG.md
- [ ] æ¸¬è©¦äº†ä¸»è¦åŠŸèƒ½è·¯å¾‘
- [ ] æª¢æŸ¥äº†éŒ¯èª¤è™•ç†

### æ€§èƒ½æª¢æŸ¥
- [ ] ç¢ºèªè¦å‰‡å¼•æ“å„ªå…ˆç´šè¨­ç½®æ­£ç¢º
- [ ] æª¢æŸ¥ OpenAI èª¿ç”¨æ˜¯å¦å¿…è¦
- [ ] é©—è­‰ç·©å­˜æ©Ÿåˆ¶æ­£å¸¸å·¥ä½œ
- [ ] ç¢ºèªæ•¸æ“šåº«æŸ¥è©¢å„ªåŒ–

### å®‰å…¨æª¢æŸ¥
- [ ] ç’°å¢ƒè®Šæ•¸é…ç½®æ­£ç¢º
- [ ] API Keys æ²’æœ‰æ´©éœ²
- [ ] ç”¨æˆ¶è¼¸å…¥é©—è­‰å®Œæ•´
- [ ] éŒ¯èª¤ä¿¡æ¯ä¸åŒ…å«æ•æ„Ÿæ•¸æ“š