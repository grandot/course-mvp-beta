# 技術債記錄

本文件記錄系統中待解決的技術問題和改進事項。

## 1. 高優先級技術債

### 1.1 LINE Bot 圖片下載 404 錯誤
**發現日期**: 2025-08-05  
**問題描述**: LINE Bot 接收到用戶上傳的圖片後，嘗試下載圖片內容時返回 404 錯誤  
**影響範圍**: 圖片上傳功能完全無法使用  
**已排查項目**:
- ✅ LINE Channel Access Token 格式和內容正確
- ✅ Bot API 連接正常（可獲取 Bot 資訊）
- ✅ Bot 權限設定正確（媒體檔案接收已允許）
- ✅ HTTP 請求頭正確（已移除不必要的 Content-Type）
- ✅ 使用新拍攝照片測試（排除過期問題）

**詳細錯誤日誌**:
```
❌ 圖片內容下載失敗 - 詳細錯誤資訊:
   Status: 404
   Status Text: Not Found
   Response Data: {"message":"Not found"}
```

**可能原因**:
1. LINE API 版本或端點變更
2. Bot 類型限制（需要特殊配置）
3. 區域限制或帳號類型限制
4. Message ID 格式或傳遞問題

**暫時解決方案**: 向用戶顯示友善錯誤訊息，說明圖片功能暫時無法使用

**建議後續調查方向**:
1. 聯繫 LINE 開發者支援確認 API 使用方式
2. 檢查是否需要升級 Bot 帳號類型
3. 測試其他 LINE Bot SDK 是否有相同問題
4. 檢查 Webhook 事件中的 Message ID 格式

---

## 2. 中優先級技術債

### 2.1 對話狀態持久化
**問題描述**: 對話狀態目前只存在記憶體中，服務重啟會遺失  
**影響範圍**: 用戶體驗連續性  
**建議方案**: 使用 Redis 或 Firebase 實現持久化

### 2.2 錯誤恢復機制
**問題描述**: Google Calendar 和 Firebase 同步失敗時的回滾機制需要加強  
**影響範圍**: 資料一致性  
**建議方案**: 實現事務性操作或補償性交易模式

---

## 3. 低優先級技術債

### 3.1 測試覆蓋率
**問題描述**: 單元測試和整合測試覆蓋率不足  
**影響範圍**: 程式碼品質和維護性  
**建議方案**: 逐步補充關鍵路徑的測試案例

### 3.2 日誌聚合
**問題描述**: 日誌分散在不同服務，難以追蹤問題  
**影響範圍**: 除錯效率  
**建議方案**: 整合日誌收集服務（如 Sentry 或 LogDNA）

---

## 更新記錄
- 2025-08-05: 初始化文件，記錄 LINE Bot 圖片下載問題