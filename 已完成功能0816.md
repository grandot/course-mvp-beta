# 已完成功能（截至 08/16）

## 新增課程（單次）
- 能做什麼:
  - 解析時間/日期、建立單次課程，寫入 Google Calendar + Firebase。
  - 自動建立/修復學生日曆（缺 calendarId 會自癒建立）。
  - 檢查過去時間與行程衝突，衝突時回報清單。
- 不能做什麼:
  - 無法建立過去時間的課程。
  - 不支援設定課程時長（固定 60 分鐘）。
  - 缺關鍵資訊（學生/課名/時間）時不會盲猜，會請你補充。
- 需要提供:
  - 學生姓名、課程名稱、上課時間（必要）；具體日期或時間參考（如「明天」）。
- 回覆內容:
  - 成功回覆包含學生/課名/日期/時間；失敗會說明原因（過去時間、衝突、資料不足）。

## 建立重複課程（每日/每週/每月）
- 能做什麼:
  - 支援 daily/weekly/monthly（每月固定日 BYMONTHDAY）。
  - 每週可一次設定多個星期（如「每週一三五」）。
  - 自動產生 Google Calendar 重複規則並寫入 Firebase。
- 不能做什麼:
  - 不支援「每月第 N 個週 X」等進階規則（僅 BYMONTHDAY）。
  - 目前不支援直接「修改」整個重複系列（請用取消後重建）。
- 需要提供:
  - 學生、課名、時間 + 重複關鍵詞（每天/每週/每月）與週幾或月日。
- 查詢展示:
  - 週期課在查詢時會展開為日期清單（週期內的實例）。

## 查詢課表
- 能做什麼:
  - 查「今天/明天/昨天/本週/下週/上週」或指定日期；可查單一學生或所有學生。
  - 已取消課不顯示；結果按日期/時間排序，會合併單次與展開的重複課。
  - 可用課名關鍵字縮小結果（容錯：移除尾字「課」做雙向包含比對）。
- 不能做什麼:
  - 不支援任意自定義區間（使用預設範圍）；跨月之月重複僅簡化處理。
- 回覆內容:
  - 以「日期 → 時間 → 課名」格式列出；無課時提供操作指引。

## 設定提醒
- 能做什麼:
  - 針對既有課程設定提醒，支援「提前 N 分鐘/小時」；儲存於 Firebase。
  - 自動計算提醒觸發時間，過期則拒絕設定。
- 不能做什麼:
  - 無法對已經過去的課設定提醒。
  - 實際送達依後端排程與權限（此專案側僅完成記錄與時間計算）。
- 需要提供:
  - 學生、課名（必要）＋日期或時間參考；可選提醒提前分鐘數與備註。

## 記錄課程內容（文字/照片）
- 能做什麼:
  - 記錄文字內容與照片（支援 LINE 直接傳入圖片），圖片上傳至 Firebase Storage。
  - 會嘗試關聯對應的課程並更新課程的內容標記。
- 不能做什麼:
  - 預設需有對應課程（嚴格模式）；未關聯課程時可設定為「獨立內容」僅記錄（需調整環境變數）。
  - LINE 圖片下載有 1 小時限制，超過將無法抓取（會有引導訊息）。
- 需要提供:
  - 內容文字或圖片至少一種；建議提供學生/課名/日期或時間參考以便關聯。

## 修改課程（單次）
- 能做什麼:
  - 修改單次課的時間、日期、課名；先更新 Google Calendar，再同步 Firebase。
  - 檢查過去時間與時段衝突（同一日曆），衝突則拒絕並列出衝突清單。
- 不能做什麼:
  - 不支援直接修改重複課程系列（請取消後重建）。
  - 不支援更換「學生」。
- 需要提供:
  - 可用最近一次新增課的上下文；否則需提供學生+課名+日期以精準定位。

## 取消課程
- 能做什麼:
  - 支援單次/明天起全部/刪除整個重複系列，遇到重複課會給 Quick Reply 讓你選範圍。
  - Google Calendar：單次預設標記為取消；重複系列可整組刪除。Firebase 會同步標記/刪除。
  - 名稱比對容錯：移除尾字「課」做比對，避免「跆拳道」≠「跆拳道課」。
- 不能做什麼:
  - 缺少學生或課名時不會猜測，會請你補充；找不到課會明確提示。

## 撤銷操作（2 分鐘內）
- 能做什麼:
  - 在 2 分鐘內可撤銷最近一次成功的操作（新增課程 / 記錄內容 / 設定提醒）。
  - 會移除 Firebase 紀錄、刪除或標記對應的 Google Calendar 事件。
- 不能做什麼:
  - 超過時間窗口不可撤銷；非上述操作類型一律不保證可撤銷。

## 對話與上下文
- 能做什麼:
  - 記憶最近提到的學生/課名/日期/時間（限量），在安全情境下輔助填補缺漏。
  - 期待輸入機制：缺欄位時會進入補充流程（例如先要學生、後要時間）。
  - 查詢會話鎖：查課表時可鎖定學生與時間範圍，短時間內的後續問題沿用。
- 不能做什麼:
  - 嚴格遵守「查詢類意圖不自動補課名」，避免把寬查詢誤縮小。

## 時間與語意解析
- 能做什麼:
  - 高覆蓋度中文時間解析：上午/下午/晚上、中文數字、24 小時制、「點半」等。
  - 週期語意：支援「每週一三五」「每天」「每月 15 號」等；多日週期可展開查詢。
  - 已修復「半」污染課名的問題（只在時間片段含「半」才視為 :30）。
- 不能做什麼:
  - 不支援複雜月規（例如「每月第一個週一」）。

## LINE/介面整合
- 能做什麼:
  - Quick Reply：常用操作入口（新增課程/查詢課表/記錄內容/設定提醒/取消…）。
  - 圖片訊息：自動下載並記錄為課堂照片（LINE 一小時存取限制）。
  - 友善回覆模板：成功/失敗/需補資訊都有對應提示與建議。

## 與外部服務整合
- Google Calendar：建立/更新/刪除（或標記取消）事件、重複規則（daily/weekly/monthly）。
- Firebase（Firestore/Storage）：課程、內容記錄、提醒、圖片上傳與公開網址。

---

如需更動或新增功能，請先告訴我「想達成的結果」與「關鍵限制」，我會回覆最小可行方案與驗收方式。
