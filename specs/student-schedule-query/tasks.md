# 計劃：學生課表查詢功能

## 任務清單

### 階段一：語意解析擴展
- [ ] 1. 擴展語意解析能力
  - [ ] 1.1 在 `SemanticService` 中新增課表查詢相關的語意模式識別
  - [ ] 1.2 新增 `querySchedule` intent 類型到語意解析邏輯
  - [ ] 1.3 強化時間範圍解析（今天、明天、本週、下週、特定日期）
  - [ ] 1.4 新增學生姓名實體識別（支援模糊匹配）
  - [ ] 1.5 測試各種查詢語句的語意解析準確度

### 階段二：資料層擴展
- [ ] 2. 擴展 EntityService 查詢能力  
  - [ ] 2.1 在 `EntityService` 中新增 `queryStudentSchedule` 方法
  - [ ] 2.2 實作基於學生姓名的課程篩選邏輯
  - [ ] 2.3 實作基於時間範圍的課程篩選邏輯
  - [ ] 2.4 新增課程排序功能（按時間順序）
  - [ ] 2.5 處理查詢無結果的情況

### 階段三：控制層實作
- [ ] 3. 實作快車道控制邏輯
  - [ ] 3.1 在 `TaskService.executeIntent` 中新增 `querySchedule` case
  - [ ] 3.2 實作查詢參數驗證邏輯
  - [ ] 3.3 實作學生姓名模糊匹配邏輯
  - [ ] 3.4 實作時間範圍解析與轉換
  - [ ] 3.5 整合 EntityService 查詢方法
  - [ ] 3.6 實作查詢結果格式化

### 階段四：回應生成
- [ ] 4. 實作智能回應生成
  - [ ] 4.1 設計多種查詢結果展示格式
  - [ ] 4.2 實作無結果時的友善提示
  - [ ] 4.3 實作多筆結果的摘要展示
  - [ ] 4.4 新增時間衝突提醒功能
  - [ ] 4.5 實作相關建議功能（推薦其他時段課程）

### 階段五：錯誤處理與邊界情況
- [ ] 5. 完善錯誤處理機制
  - [ ] 5.1 處理學生姓名不存在的情況
  - [ ] 5.2 處理日期格式錯誤的情況  
  - [ ] 5.3 處理 Firestore 查詢失敗的情況
  - [ ] 5.4 新增查詢超時處理
  - [ ] 5.5 實作 fallback 回應機制

### 階段六：測試與驗證
- [ ] 6. 建立完整測試機制
  - [ ] 6.1 撰寫單元測試（語意解析部分）
  - [ ] 6.2 撰寫整合測試（完整查詢流程）
  - [ ] 6.3 測試各種查詢語句變化
  - [ ] 6.4 測試邊界情況處理
  - [ ] 6.5 進行效能測試與優化

### 階段七：文檔與部署
- [ ] 7. 完成功能文檔
  - [ ] 7.1 更新 API 文檔說明新增的查詢功能
  - [ ] 7.2 撰寫使用範例與支援的查詢格式
  - [ ] 7.3 更新系統架構文檔
  - [ ] 7.4 準備功能演示腳本
  - [ ] 7.5 進行最終部署前檢查

## 預估時程
- **階段一至三**：核心功能實作（2-3 天）
- **階段四至五**：用戶體驗優化（1-2 天）  
- **階段六至七**：測試與文檔（1 天）
- **總計**：約 4-6 天完成

## 技術風險與應對
1. **語意解析準確度風險**：建立測試資料集，持續調整語意模式
2. **查詢效能風險**：實作適當的 Firestore 索引，考慮查詢結果快取
3. **用戶體驗風險**：設計友善的錯誤提示，提供查詢建議

## 成功標準
- [ ] 支援至少 5 種不同的查詢語句格式
- [ ] 查詢回應時間控制在 2 秒內
- [ ] 語意解析準確度達到 90% 以上
- [ ] 所有邊界情況都有適當的錯誤處理
- [ ] 通過完整的測試案例驗證