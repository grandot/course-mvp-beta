# ğŸ“˜ã€Šèªæ„æ§åˆ¶å™¨æ±ºç­–æ”¹ç‰ˆæ–¹æ¡ˆæ›¸ã€‹v2.0 - è­‰æ“šé©…å‹•å„ªåŒ–ç‰ˆ

### é©ç”¨å°è±¡ï¼š

çµ¦è² è²¬ IntentOS Course æ¨¡çµ„é–‹ç™¼çš„å·¥ç¨‹å¸«ï¼ˆClaudeï¼‰

---

## ğŸ§­ ä¸€ã€èƒŒæ™¯èˆ‡å•é¡Œèªªæ˜

ç›®å‰èªæ„ä»»å‹™ç³»çµ±çš„è§£æé‚è¼¯æ˜¯ï¼š

```
Regex å„ªå…ˆ â†’ è‹¥ç„¡å‘½ä¸­å†äº¤ç”± AI è£œå…¨ slot
```

ä½†å¯¦éš›åŸ·è¡Œçµæœé€ æˆä»¥ä¸‹å•é¡Œï¼š

* ä½¿ç”¨è€…èªå¥å¦‚ã€Œä¸Šæ¬¡Rumiçš„èª²ä¸Šå¾—æ€éº¼æ¨£ã€å¸¸è¢«èª¤åˆ¤ç‚ºã€Œæ–°å¢èª²ç¨‹ã€ã€‚
* AI è¢«å‹•è£œå…¨ï¼Œæ²’æœ‰ä¸»å°æ„åœ–çš„åˆ¤æ–·åŠ›ã€‚
* ç”¨æˆ¶å•ã€Œæˆ‘è¨˜å¾—7/31ä¸æ˜¯å·²ç¶“è¨˜éŒ„éäº†å—ã€ï¼Œç³»çµ±å»åˆç•¶ä½œæ˜¯ä¿®æ”¹èª²ç¨‹ï¼Œé€ æˆåš´é‡èª¤åˆ¤ã€‚
* æ•´é«”äº’å‹•é«”é©—éå¸¸æ­»æ¿ï¼Œç¼ºä¹èªæ„éˆæ´»æ€§ï¼Œç„¡æ³•æ„Ÿå—åˆ°èªè¨€é©…å‹•ä»»å‹™çš„æ•ˆæœã€‚

---

## ğŸ¯ äºŒã€æ”¹ç‰ˆç›®æ¨™

1. å»ºç«‹ä¸€å€‹èªæ„æ§åˆ¶å™¨ï¼ˆSemantic Decision Controllerï¼‰ï¼Œè² è²¬æ•´åˆ AI èˆ‡ Regex çš„åˆ¤æ–·çµæœã€‚
2. ç”±æ§åˆ¶å™¨è² è²¬**è£æ±ºæœ€çµ‚æ„åœ–èˆ‡æ¬„ä½**ï¼Œè€Œéåªé é †åºæ±ºå®šã€‚
3. å»ºç«‹ AI å°è‡ªèº«çµæœçš„ã€Œä¿¡å¿ƒåˆ†æ•¸ã€åˆ¤æ–·æ©Ÿåˆ¶ï¼Œæå‡ AI æ±ºç­–å¯ä¿¡åº¦ã€‚
4. å°‡æ­¤æ§åˆ¶å™¨é‚è¼¯éƒ¨ç½²åœ¨ä¸»å¾Œç«¯ API ä¸­ï¼Œèˆ‡ Claude Code CLI ç„¡é—œï¼ŒçœŸæ­£ä¸Šç·šé‹è¡Œã€‚

---

## ğŸ§  ä¸‰ã€æ ¸å¿ƒé‚è¼¯æ¦‚å¿µ

### ï¼ˆ1ï¼‰èªæ„è¼¸å…¥ â†’ é›™é‡åˆ†æ

ä½¿ç”¨è€…æ¯æ¬¡è¼¸å…¥ï¼ŒæœƒåŒæ™‚é€å¾€å…©å€‹è§£æå™¨ï¼š

* `OpenAI èªæ„æ¨¡å‹`ï¼šç”¢å‡ºæ„åœ–ã€æ¬„ä½ã€ä¿¡å¿ƒåˆ†æ•¸
* `Regex æ¨¡çµ„`ï¼šæ ¹æ“šå›ºå®šæ¨¡å¼ç”¢å‡ºæ„åœ–ã€æ¬„ä½ã€æ˜¯å¦å‘½ä¸­

---

### ï¼ˆ2ï¼‰ä¸­æ§æ±ºç­–é‚è¼¯ï¼ˆèªæ„æ§åˆ¶å™¨ï¼‰- è­‰æ“šé©…å‹•æ©Ÿåˆ¶

è² è²¬æ ¹æ“šå…©çµ„åˆ†æçµæœçš„**è­‰æ“šè³ªé‡**ï¼Œåˆ¤æ–·æ‡‰æ¡ç”¨å“ªä¸€ç¨®ã€‚ä¸å†ä¾è³´ç°¡å–®åˆ†æ•¸æ¯”è¼ƒï¼Œè€Œæ˜¯åˆ†ææ¨ç†é‚è¼¯ã€‚

**æ±ºç­–è¦å‰‡å¦‚ä¸‹ï¼š**

| å„ªå…ˆç´š | æ±ºç­–æ¢ä»¶ | æ¡ç”¨ä¾†æº | åˆ¤æ–·ä¾æ“š |
|--------|----------|----------|----------|
| P1 | èªæ°£èˆ‡æ„åœ–è¡çª | AI | ç–‘å•èªæ°£ + Regexåˆ¤æ–·æ–°å¢ = é‚è¼¯çŸ›ç›¾ |
| P2 | æ™‚é–“ç·šç´¢å­˜åœ¨ | AI | å«"ä¸Šæ¬¡/æ˜¨å¤©"ç­‰æ™‚åºè©ï¼ŒRegexç„¡æ³•ç†è§£ |
| P3 | AIæ¨ç†éˆå®Œæ•´ | AI | æ¨ç†æ­¥é©Ÿâ‰¥3ä¸”confidence>0.8 |
| P4 | Regexå¼·åŒ¹é… | Regex | pattern_strength>0.9ä¸”ç„¡æ­§ç¾©è© |
| P5 | é»˜èªä¿å®ˆç­–ç•¥ | AI | é¿å…Regexç¡¬è¦å‰‡èª¤åˆ¤ |

**é—œéµå‰µæ–°**ï¼šæ§åˆ¶å™¨åˆ†æ**ç‚ºä»€éº¼**é€™æ¨£åˆ¤æ–·ï¼Œè€Œéåªçœ‹**åˆ†æ•¸é«˜ä½**ã€‚

### è£œå¼·æ©Ÿåˆ¶

#### ï¼ˆ4ï¼‰é è¨­å¤±æ•—è™•ç†ï¼ˆFallback æ©Ÿåˆ¶ï¼‰

åœ¨ä»¥ä¸‹æƒ…æ³è§¸ç™¼ fallbackï¼š
- ç„¡æ³•åˆ¤æ–·æ„åœ–ï¼ˆå…©æ–¹çš†æ¨¡ç³Šï¼‰
- AI å›å‚³æ ¼å¼éŒ¯èª¤
- Regex æ²’æœ‰ match ä¸” AI ä¿¡å¿ƒä¸è¶³ (<0.6)

Fallback è¼¸å‡ºæ ¼å¼ï¼š
```json
{
  "final_intent": "unknown",
  "source": "fallback", 
  "reason": "AIèˆ‡Regexå‡ç„¡æ³•æä¾›è¶³å¤ è­‰æ“š",
  "suggestion": "è«‹æ˜ç¢ºèªªæ˜æ‚¨æƒ³æŸ¥è©¢å“ªä¸€å ‚èª²çš„è¨˜éŒ„ï¼Ÿæˆ–è€…æä¾›æ›´å¤šèª²ç¨‹ç´°ç¯€ï¼Ÿ",
  "confidence": 0.0
}
```

#### ï¼ˆ5ï¼‰å¯è§€å¯Ÿæ€§ï¼ˆDebug Traceï¼‰

å…§éƒ¨æ¸¬è©¦æ¨¡å¼æ”¯æ´ `debug: true`ï¼Œå›å‚³å®Œæ•´æ±ºç­–è·¯å¾‘ï¼š
```json
{
  "final_intent": "query_course",
  "source": "ai", 
  "reason": "å«æ™‚é–“ç·šç´¢èˆ‡ç–‘å•èªæ°£ï¼ŒRegexç„¡æ³•è§£è®€",
  "used_rule": "P2",
  "debug_info": {
    "ai_analysis": { /* å®Œæ•´AIåˆ†æçµæœ */ },
    "regex_analysis": { /* å®Œæ•´Regexåˆ†æçµæœ */ },
    "decision_path": ["P1æª¢æŸ¥-æœªå‘½ä¸­", "P2æª¢æŸ¥-å‘½ä¸­", "æ±ºç­–å®Œæˆ"],
    "execution_time": "120ms"
  }
}
```

---

### ï¼ˆ3ï¼‰è­‰æ“šé©…å‹•åˆ†ææ©Ÿåˆ¶

#### AI åˆ†æçµæœçµæ§‹
```typescript
{
  "intent": "query_course",
  "entities": { "course_name": "ç§‘å­¸å¯¦é©—", "time": "ä¸Šé€±" },
  
  // æ ¸å¿ƒå„ªåŒ–ï¼šå¤šç¶­åº¦è­‰æ“š
  "evidence": {
    "temporal_clues": ["ä¸Šæ¬¡"],           // æ™‚é–“ç·šç´¢
    "mood_indicators": ["æ€éº¼æ¨£"],        // èªæ°£æŒ‡æ¨™  
    "action_verbs": ["ä¸Šå¾—"],             // å‹•ä½œè©
    "question_markers": ["æ€éº¼æ¨£"]        // ç–‘å•æ¨™è¨˜
  },
  
  // æ¨ç†éˆï¼ˆè§£æ±ºã€Œç‚ºä»€éº¼ã€çš„å•é¡Œï¼‰
  "reasoning_chain": {
    "step1": "è­˜åˆ¥åˆ°æ™‚é–“è©'ä¸Šæ¬¡'ï¼Œè¡¨ç¤ºå›é¡§éå»",
    "step2": "è­˜åˆ¥åˆ°ç–‘å•èªæ°£'æ€éº¼æ¨£'ï¼Œè¡¨ç¤ºè©¢å•ç‹€æ…‹", 
    "step3": "çµåˆèªå¢ƒï¼Œåˆ¤å®šç‚ºæŸ¥è©¢æ„åœ–",
    "confidence_source": "åŸºæ–¼æ­¥é©Ÿ1-3çš„é‚è¼¯éˆ"
  },
  
  "confidence": {
    "overall": 0.92,
    "intent_certainty": 0.95,           // å°æ„åœ–çš„æŠŠæ¡
    "context_understanding": 0.88       // å°èªå¢ƒçš„ç†è§£
  }
}
```

#### Regex åˆ†æçµæœçµæ§‹
```typescript
{
  "intent": "add_course", 
  "entities": { "course_name": "ç§‘å­¸å¯¦é©—" },
  
  // æ–°å¢ï¼šåŒ¹é…è­‰æ“š
  "match_details": {
    "triggered_patterns": ["èª²ç¨‹.*å¯¦é©—"],
    "keyword_matches": ["èª²", "å¯¦é©—"],
    "ambiguous_terms": ["èª²"],           // å¯èƒ½æœ‰æ­§ç¾©çš„è©
    "pattern_strength": 0.6
  },
  
  // é™åˆ¶æ€§åˆ†æ
  "limitations": {
    "context_blind": true,              // å¿½ç•¥äº†ä¸Šä¸‹æ–‡
    "temporal_blind": true,             // å¿½ç•¥äº†æ™‚é–“ç·šç´¢
    "mood_blind": true                  // å¿½ç•¥äº†èªæ°£
  }
}
```

---

## ğŸ—ï¸ å››ã€æ¶æ§‹åœ–ï¼ˆè­‰æ“šé©…å‹•ç‰ˆï¼‰

```plaintext
ä½¿ç”¨è€…èªå¥ + å°è©±æ­·å²
   â†“
ã€ OpenAI è­‰æ“šåˆ†æ ã€‘â”€â”€â”  ç”Ÿæˆï¼ševidence + reasoning_chain + confidence
                        â”œâ”€â†’ èªæ„æ§åˆ¶å™¨ â”€â”€â†’ è­‰æ“šé‚è¼¯åˆ†æ â”€â”€â†’ æœ€çµ‚æ±ºç­–
ã€ Regex æ¨¡å¼åˆ†æ ã€‘â”€â”€â”€â”˜  ç”Ÿæˆï¼šmatch_details + limitations + pattern_strength
                        â†“
                   æ±ºç­–ä¾æ“šï¼š
                   P1: èªæ°£è¡çªæª¢æ¸¬
                   P2: æ™‚é–“ç·šç´¢æ¬Šé‡  
                   P3: æ¨ç†éˆè³ªé‡
                   P4: å¼·åŒ¹é…å„ªå‹¢
                   P5: ä¿å®ˆAIç­–ç•¥
```

---

## ğŸ› ï¸ äº”ã€é–‹ç™¼ä»»å‹™æ‹†è§£

### âœ… A. semanticService.analyzeByOpenAI (å¢å¼·ç‰ˆ)

å„ªåŒ– OpenAI åˆ†æï¼Œæ”¯æ´è­‰æ“šé©…å‹•ï¼š

```typescript
interface AIAnalysisParams {
  userText: string;
  conversationHistory?: Message[];
}

// è¿”å›çµæ§‹
interface AIAnalysisResult {
  intent: string;
  entities: Record<string, any>;
  evidence: {
    temporal_clues: string[];
    mood_indicators: string[];
    action_verbs: string[];
    question_markers: string[];
  };
  reasoning_chain: Record<string, string>;
  confidence: {
    overall: number;
    intent_certainty: number;
    context_understanding: number;
  };
}
```

**æ–°ç‰ˆ Prompt æ¨¡æ¿**ï¼š
```
åˆ†æç”¨æˆ¶èªå¥ï¼Œæä¾›è­‰æ“šå’Œæ¨ç†éç¨‹ï¼š
è¼¸å…¥ï¼š"${userText}"
${conversationHistory ? `å°è©±æ­·å²ï¼š${history}` : ''}

è¿”å›JSONæ ¼å¼ï¼ŒåŒ…å«evidenceã€reasoning_chainã€confidenceç­‰å­—æ®µã€‚
ç‰¹åˆ¥æ³¨æ„ï¼š
- "ä¸Šæ¬¡/æ˜¨å¤©/ä¹‹å‰" + ç–‘å• = æŸ¥è©¢éå»
- "ä¸æ˜¯...å—" = ç¢ºèªæ€§ç–‘å•  
- ç´”ç²¹æè¿° = æ–°å¢è¨˜éŒ„
```

### âœ… B. semanticService.analyzeByRegex (å¢å¼·ç‰ˆ)

å¢åŠ åŒ¹é…è³ªé‡åˆ†æï¼š

```typescript
interface RegexAnalysisResult {
  intent: string;
  entities: Record<string, any>;
  match_details: {
    triggered_patterns: string[];
    keyword_matches: string[];
    ambiguous_terms: string[];
    pattern_strength: number;
  };
  limitations: {
    context_blind: boolean;
    temporal_blind: boolean;
    mood_blind: boolean;
  };
}
```

### âœ… C. semanticController.decideByEvidence (æ ¸å¿ƒé‚è¼¯)

```typescript
class SemanticController {
  async route(userText: string, conversationHistory?: Message[]) {
    const [aiResult, regexResult] = await Promise.all([
      this.semanticService.analyzeByOpenAI(userText, conversationHistory),
      this.semanticService.analyzeByRegex(userText)
    ]);

    return this.decideByEvidence(aiResult, regexResult, userText);
  }

  private decideByEvidence(ai: AIAnalysisResult, regex: RegexAnalysisResult, text: string, debug = false) {
    const decisionPath: string[] = [];
    
    // Fallback æª¢æ¸¬
    const aiInvalid = !ai || ai.confidence.overall < 0.6;
    const regexInvalid = !regex.match_details || regex.match_details.pattern_strength < 0.5;
    
    if (aiInvalid && regexInvalid) {
      return {
        final_intent: 'unknown',
        source: 'fallback',
        reason: 'AIèˆ‡Regexå‡ç„¡æ³•æä¾›è¶³å¤ è­‰æ“š',
        suggestion: 'è«‹æ˜ç¢ºèªªæ˜æ‚¨æƒ³æŸ¥è©¢å“ªä¸€å ‚èª²çš„è¨˜éŒ„ï¼Ÿæˆ–è€…æä¾›æ›´å¤šèª²ç¨‹ç´°ç¯€ï¼Ÿ',
        confidence: 0.0,
        ...(debug && { debug_info: { ai, regex, decision_path: ['é€²å…¥Fallback'] } })
      };
    }

    // P1: èªæ°£è¡çªæª¢æ¸¬
    decisionPath.push('P1æª¢æŸ¥-èªæ°£è¡çª');
    if (ai.evidence.question_markers.length > 0 && regex.intent.includes('add_')) {
      decisionPath.push('P1å‘½ä¸­-ç–‘å•èªæ°£èˆ‡æ–°å¢è¡çª');
      return this.buildResult('ai', ai.intent, 'P1', 'ç–‘å•èªæ°£èˆ‡æ–°å¢æ„åœ–è¡çª', ai, regex, decisionPath, debug);
    }
    decisionPath.push('P1æœªå‘½ä¸­');

    // P2: æ™‚é–“ç·šç´¢æ¬Šé‡
    decisionPath.push('P2æª¢æŸ¥-æ™‚é–“ç·šç´¢');
    if (ai.evidence.temporal_clues.length > 0 && regex.limitations.temporal_blind) {
      decisionPath.push('P2å‘½ä¸­-å«æ™‚é–“ç·šç´¢');
      return this.buildResult('ai', ai.intent, 'P2', 'å«æ™‚é–“ç·šç´¢ï¼ŒRegexç„¡æ³•ç†è§£', ai, regex, decisionPath, debug);
    }
    decisionPath.push('P2æœªå‘½ä¸­');

    // P3: AIæ¨ç†éˆå®Œæ•´
    decisionPath.push('P3æª¢æŸ¥-æ¨ç†éˆè³ªé‡');
    const reasoningSteps = Object.keys(ai.reasoning_chain).length - 1;
    if (reasoningSteps >= 3 && ai.confidence.overall > 0.8) {
      decisionPath.push('P3å‘½ä¸­-æ¨ç†éˆå®Œæ•´');
      return this.buildResult('ai', ai.intent, 'P3', 'AIæ¨ç†éˆå®Œæ•´', ai, regex, decisionPath, debug);
    }
    decisionPath.push('P3æœªå‘½ä¸­');

    // P4: Regexå¼·åŒ¹é…
    decisionPath.push('P4æª¢æŸ¥-Regexå¼·åŒ¹é…');
    if (regex.match_details.pattern_strength > 0.9 && 
        ai.confidence.overall < 0.7 &&
        regex.match_details.ambiguous_terms.length === 0) {
      decisionPath.push('P4å‘½ä¸­-Regexå¼·åŒ¹é…');
      return this.buildResult('regex', regex.intent, 'P4', 'Regexå¼·åŒ¹é…ä¸”ç„¡æ­§ç¾©', ai, regex, decisionPath, debug);
    }
    decisionPath.push('P4æœªå‘½ä¸­');

    // P5: é»˜èªAI
    decisionPath.push('P5é»˜èª-AIä¿å®ˆç­–ç•¥');
    return this.buildResult('ai', ai.intent, 'P5', 'é»˜èªAIé¿å…èª¤åˆ¤', ai, regex, decisionPath, debug);
  }

  private buildResult(source: string, intent: string, rule: string, reason: string, 
                     ai: AIAnalysisResult, regex: RegexAnalysisResult, 
                     decisionPath: string[], debug: boolean) {
    const result = {
      final_intent: intent,
      source,
      reason,
      used_rule: rule,
      confidence: source === 'ai' ? ai.confidence.overall : regex.match_details.pattern_strength
    };

    if (debug) {
      result.debug_info = {
        ai_analysis: ai,
        regex_analysis: regex,
        decision_path: decisionPath,
        execution_time: `${Date.now()}ms` // å¯¦éš›æ‡‰ç”¨ä¸­éœ€è¦æ­£ç¢ºè¨ˆæ™‚
      };
    }

    return result;
  }
}
```

---

## ğŸ”Œ å…­ã€æ•´åˆä½ç½®èˆ‡å‘¼å«è·¯å¾‘

æ§åˆ¶å™¨æ‡‰éƒ¨ç½²æ–¼ `/services/semanticController.ts`
ç”± `/webhook/line` å‘¼å«ä¸»æµç¨‹æ™‚ä½¿ç”¨ï¼š

```ts
const semanticResult = await semanticController.route(userInput);
```

---

## ğŸ“ˆ ä¸ƒã€æˆæ•ˆé æœŸ

### æ ¸å¿ƒå•é¡Œè§£æ±ºæ•ˆæœ

| ç”¨æˆ¶è¼¸å…¥æ¡ˆä¾‹ | åŸæ–¹æ¡ˆçµæœ | v2.0çµæœ | æ”¹å–„åŸå›  |
|-------------|------------|----------|----------|
| "ä¸Šæ¬¡Rumiçš„èª²æ€éº¼æ¨£" | âŒ æ–°å¢èª²ç¨‹ | âœ… æŸ¥è©¢èª²ç¨‹ | P2: æ™‚é–“ç·šç´¢ + P1: ç–‘å•èªæ°£ |
| "7/31æˆ‘ä¸æ˜¯è¨˜éŒ„äº†å—" | âŒ ä¿®æ”¹èª²ç¨‹ | âœ… æŸ¥è©¢è¨˜éŒ„ | P1: ç¢ºèªæ€§ç–‘å•èªæ°£è¡çªæª¢æ¸¬ |
| "ä»Šå¤©æ•¸å­¸èª²å¾ˆç²¾å½©" | âœ… æ–°å¢èª²ç¨‹ | âœ… æ–°å¢èª²ç¨‹ | P3: AIæ¨ç†éˆåˆ¤æ–·é™³è¿°èªæ°£ |
| "å¹«æˆ‘æŸ¥çœ‹èª²ç¨‹è¨˜éŒ„" | âœ… æŸ¥è©¢èª²ç¨‹ | âœ… æŸ¥è©¢èª²ç¨‹ | P4: Regexå¼·åŒ¹é…ç„¡æ­§ç¾© |
| "å—¯...é‚£å€‹...èª²ç¨‹" | âŒ éš¨æ©Ÿåˆ¤æ–· | âœ… unknown + è«‹æ¾„æ¸… | Fallbackæ©Ÿåˆ¶å„ªé›…é™ç´š |

### æ•´é«”æŒ‡æ¨™æ”¹å–„

| æŒ‡æ¨™ | æ”¹ç‰ˆå‰ | v2.0é æœŸ | é—œéµæ”¹å–„ |
|------|--------|----------|----------|
| èª¤åˆ¤ç‡ï¼ˆæŸ¥è©¢vsæ–°å¢ï¼‰ | ~30% | <10% | è­‰æ“šé©…å‹•æ±ºç­–é‚è¼¯ |
| èªæ„ç†è§£è‡ªç„¶åº¦ | ä½ï¼ˆæ­»æ¿ï¼‰ | é«˜ï¼ˆæ™ºèƒ½ï¼‰ | AIæ¨ç†éˆ+èªæ°£åˆ†æ |
| èª¿è©¦æ•ˆç‡ | ä½ï¼ˆé»‘ç›’ï¼‰ | é«˜ï¼ˆé€æ˜ï¼‰ | Debug traceå®Œæ•´æ±ºç­–è·¯å¾‘ |
| é–‹ç™¼æ™‚é–“æµªè²» | é«˜ï¼ˆèª¿é †åºï¼‰ | 0ï¼ˆé‚è¼¯ç©©å®šï¼‰ | ä¸å†ä¾è³´èª¿åƒ |
| ç³»çµ±å¯é æ€§ | ä½ï¼ˆå´©æ½°å¼å¤±æ•—ï¼‰ | é«˜ï¼ˆå„ªé›…é™ç´šï¼‰ | Fallbackæ©Ÿåˆ¶è™•ç†é‚Šç•Œæƒ…æ³ |
| ç”¨æˆ¶é«”é©—ä¸€è‡´æ€§ | å·®ï¼ˆéš¨æ©ŸçŒœæ¸¬ï¼‰ | å„ªï¼ˆæ˜ç¢ºæ¾„æ¸…ï¼‰ | unknownæ™‚è«‹æ±‚æ›´å¤šä¿¡æ¯ |
| éŸ¿æ‡‰é€Ÿåº¦ | ä¸ç©©å®š | ç©©å®š | ä¸¦è¡Œåˆ†æ+æ™ºèƒ½æ±ºç­– |

---

## âœ… å…«ã€äº¤ä»˜è¦æ±‚ï¼ˆv2.0 è­‰æ“šé©…å‹•ç‰ˆï¼‰

### å¿…é ˆå¯¦ç¾çš„æ ¸å¿ƒåŠŸèƒ½

1. **å¢å¼·ç‰ˆ OpenAI èªæ„åˆ†æ**
   - æ”¯æ´ evidence å¤šç¶­åº¦åˆ†æï¼ˆæ™‚é–“ã€èªæ°£ã€å‹•ä½œã€ç–‘å•ï¼‰
   - æä¾› reasoning_chain æ¨ç†éç¨‹
   - è¿”å›å¤šå±¤æ¬¡ confidence åˆ†æ•¸

2. **å¢å¼·ç‰ˆ Regex æ¨¡å¼åˆ†æ**  
   - è¨ˆç®— pattern_strength åŒ¹é…å¼·åº¦
   - è­˜åˆ¥ ambiguous_terms æ­§ç¾©è©
   - æ¨™è¨» limitations åˆ†æç›²å€

3. **èªæ„æ§åˆ¶å™¨æ ¸å¿ƒé‚è¼¯**
   - å¯¦ç¾ P1-P5 å„ªå…ˆç´šæ±ºç­–è¦å‰‡
   - è­‰æ“šè¡çªæª¢æ¸¬èˆ‡ä»²è£
   - æ¯å€‹æ±ºç­–é™„å¸¶ reason è§£é‡‹

4. **Fallback æ©Ÿåˆ¶** â­
   - AI/Regex é›™é‡å¤±æ•ˆæ™‚å„ªé›…é™ç´š
   - è¿”å› unknown + å…·é«”æ¾„æ¸…å»ºè­°
   - é¿å…ç³»çµ±å´©æ½°å¼çŒœæ¸¬

5. **Debug å¯è§€å¯Ÿæ€§** â­  
   - æ”¯æ´ debug:true æ¨¡å¼
   - å®Œæ•´æ±ºç­–è·¯å¾‘è¿½è¹¤
   - æ€§èƒ½æŒ‡æ¨™çµ±è¨ˆ

6. **æ•´åˆèˆ‡æ¸¬è©¦**
   - webhook æµç¨‹èª¿æ•´ä½¿ç”¨æ–°æ§åˆ¶å™¨
   - é‡å°æ–‡æª”ä¸­çš„å•é¡Œæ¡ˆä¾‹é€²è¡Œæ¸¬è©¦
   - ç¢ºä¿æ±ºç­–å¯è§£é‡‹æ€§

### ğŸ¯ é—œéµæˆåŠŸæŒ‡æ¨™

**æ ¸å¿ƒåŠŸèƒ½é©—è­‰**ï¼š
- âœ… "ä¸Šæ¬¡Rumiçš„èª²æ€éº¼æ¨£" â†’ æ­£ç¢ºè­˜åˆ¥ç‚ºæŸ¥è©¢
- âœ… "7/31æˆ‘ä¸æ˜¯è¨˜éŒ„äº†å—" â†’ æ­£ç¢ºè­˜åˆ¥ç‚ºæŸ¥è©¢ç¢ºèª  
- âœ… æ¯å€‹æ±ºç­–éƒ½æœ‰æ¸…æ™°çš„ reason è§£é‡‹
- âœ… ä¸å†éœ€è¦æ‰‹å‹•èª¿æ•´ Regex/AI åŸ·è¡Œé †åº

**Fallback æ©Ÿåˆ¶é©—è­‰**ï¼š
- âœ… "å—¯...é‚£å€‹...èª²ç¨‹" â†’ è¿”å› unknown + æ¾„æ¸…å»ºè­°
- âœ… AI æ ¼å¼éŒ¯èª¤æ™‚ä¸å´©æ½°ï¼Œå„ªé›…é™ç´š
- âœ… é›™æ–¹ä¿¡å¿ƒä¸è¶³æ™‚è«‹æ±‚æ›´å¤šä¿¡æ¯

**Debug å¯è§€å¯Ÿæ€§é©—è­‰**ï¼š
- âœ… debug:true æ™‚è¿”å›å®Œæ•´æ±ºç­–è·¯å¾‘
- âœ… å¯æ¸…æ¥šçœ‹åˆ°å“ªå€‹è¦å‰‡å‘½ä¸­(P1-P5)
- âœ… åŸ·è¡Œæ™‚é–“å’Œæ€§èƒ½æŒ‡æ¨™å¯è§€æ¸¬

### ğŸ“ æ–‡ä»¶çµæ§‹å»ºè­°

```
/services/
  â”œâ”€â”€ semanticController.ts    # ä¸»æ§åˆ¶å™¨
  â”œâ”€â”€ semanticService.ts       # AIåˆ†ææœå‹™  
  â””â”€â”€ regexService.ts          # Regexåˆ†ææœå‹™

/types/
  â””â”€â”€ semantic.ts              # é¡å‹å®šç¾©
```

---

**ç¬¬ä¸€æ€§åŸå‰‡æª¢é©—**ï¼šé€™å€‹æ–¹æ¡ˆè§£æ±ºçš„ä¸æ˜¯ã€Œèª¿åƒå•é¡Œã€ï¼Œè€Œæ˜¯ã€Œæ±ºç­–æ¶æ§‹å•é¡Œã€ã€‚å¾æ ¹æœ¬ä¸Šè®“ç³»çµ±å…·å‚™é‚è¼¯æ¨ç†èƒ½åŠ›ï¼Œè€Œéä¾è³´é †åºå’Œé–¾å€¼ã€‚
