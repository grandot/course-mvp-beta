2025-08-10 14:52:45  [34m[1m==>(B[m [1mCloning from https://github.com/grandot/course-mvp-beta(B[m
2025-08-10 14:52:51  [34m[1m==>(B[m [1mChecking out commit f7bdf426fa9293a47d0b0ed9ecc70838a94250a5 in branch main(B[m
2025-08-10 14:52:53  [34m[1m==>(B[m [1mDownloading cache...(B[m
2025-08-10 14:53:05  [34m[1m==>(B[m [1mTransferred 91MB in 8s. Extraction took 3s.(B[m
2025-08-10 14:53:09  [34m[1m==>(B[m [1mRequesting Node.js version >=20.0.0(B[m
2025-08-10 14:53:10  [34m[1m==>(B[m [1mUsing Node.js version 24.5.0 via /opt/render/project/src/package.json(B[m
2025-08-10 14:53:10  [34m[1m==>(B[m [1mDocs on specifying a Node.js version: https://render.com/docs/node-version(B[m
2025-08-10 14:53:10  [34m[1m==>(B[m [1mRunning build command 'yarn'...(B[m
2025-08-10 14:53:10  yarn install v1.22.22
2025-08-10 14:53:10  info No lockfile found.
2025-08-10 14:53:10  warning package-lock.json found. Your project contains lock files generated by tools other than Yarn. It is advised not to mix package managers in order to avoid resolution inconsistencies caused by unsynchronized lock files. To clear this warning, remove package-lock.json.
2025-08-10 14:53:10  [1/5] Validating package.json...
2025-08-10 14:53:10  [2/5] Resolving packages...
2025-08-10 14:53:15  warning googleapis > google-auth-library > gaxios > node-fetch > fetch-blob > node-domexception@1.0.0: Use your platform's native DOMException instead
2025-08-10 14:53:15  warning eslint@8.57.1: This version is no longer supported. Please see https://eslint.org/version-support for other options.
2025-08-10 14:53:15  warning eslint > @humanwhocodes/config-array@0.13.0: Use @eslint/config-array instead
2025-08-10 14:53:16  warning eslint > @humanwhocodes/config-array > @humanwhocodes/object-schema@2.0.3: Use @eslint/object-schema instead
2025-08-10 14:53:16  warning eslint > file-entry-cache > flat-cache > rimraf@3.0.2: Rimraf versions prior to v4 are no longer supported
2025-08-10 14:53:16  warning eslint > file-entry-cache > flat-cache > rimraf > glob@7.2.3: Glob versions prior to v9 are no longer supported
2025-08-10 14:53:16  warning eslint > file-entry-cache > flat-cache > rimraf > glob > inflight@1.0.6: This module is not supported, and leaks memory. Do not use it. Check out lru-cache if you want a good and tested way to coalesce async requests by a key value, which is much more comprehensive and powerful.
2025-08-10 14:53:17  [3/5] Fetching packages...
2025-08-10 14:53:25  [4/5] Linking dependencies...
2025-08-10 14:53:28  [5/5] Building fresh packages...
2025-08-10 14:53:28  success Saved lockfile.
2025-08-10 14:53:28  Done in 18.17s.
2025-08-10 14:53:31  [34;1m==>[0;22m [1mUploading build...[22m
2025-08-10 14:53:43  [34;1m==>[0;22m [1mUploaded in 4.8s. Compression took 7.2s[22m
2025-08-10 14:53:43  [32;1m==>[0;22m [1mBuild successful 🎉[22m
2025-08-10 14:53:46  [0;34m[1m==> [0m[1mDeploying...[0m
2025-08-10 14:54:06  [32m[1m==>(B[m [1mRunning 'yarn start'(B[m
2025-08-10 14:54:07  yarn run v1.22.22
2025-08-10 14:54:07  $ node src/index.js
2025-08-10 14:54:07  [dotenv@17.2.1] injecting env (0) from .env -- tip: ⚙️  write to custom object with { processEnv: myObject }
2025-08-10 14:54:07  🚀 應用程式啟動中...
2025-08-10 14:54:07  📍 環境: development
2025-08-10 14:54:07  🤖 LINE Service: Real (生產)
2025-08-10 14:54:07  🚀 課程管理機器人服務已啟動
2025-08-10 14:54:07  📡 服務端口: 3000
2025-08-10 14:54:07  🔗 Webhook: http://localhost:3000/webhook
2025-08-10 14:54:07  ❤️ 健康檢查: http://localhost:3000/health
2025-08-10 14:54:07  ---
2025-08-10 14:54:07  ✅ 所有環境變數已設定完成
2025-08-10 14:54:17  [0;32m[1m==> [0m[1mYour service is live 🎉[0m
2025-08-10 14:54:18  [0;32m[1m==> [0m[1m[0m
2025-08-10 14:54:18  [0;32m[1m==> [0m[1m///////////////////////////////////////////////////////////[0m
2025-08-10 14:54:18  [0;32m[1m==> [0m[1m[0m
2025-08-10 14:54:18  [0;32m[1m==> [0m[1mAvailable at your primary URL https://course-mvp-beta.onrender.com[0m
2025-08-10 14:54:18  [0;32m[1m==> [0m[1m[0m
2025-08-10 14:54:19  [0;32m[1m==> [0m[1m///////////////////////////////////////////////////////////[0m
2025-08-10 14:55:55  🧪 Mock LINE Service 初始化（測試模式）
2025-08-10 14:55:55  ⚠️ 警告：USE_MOCK_LINE_SERVICE 未設定，建議明確指定
2025-08-10 14:55:55  ❌ Webhook 簽名驗證失敗
2025-08-10 14:55:55  ❌ Webhook 簽名驗證失敗
2025-08-10 14:55:55  ❌ Webhook 簽名驗證失敗
2025-08-10 14:55:55  ❌ Webhook 簽名驗證失敗
2025-08-10 14:55:55  ❌ Webhook 簽名驗證失敗
2025-08-10 14:55:55  ❌ Webhook 簽名驗證失敗
2025-08-10 14:55:55  ❌ Webhook 簽名驗證失敗
2025-08-10 14:57:26  📨 收到 1 個事件
2025-08-10 14:57:26  📋 事件類型: message
2025-08-10 14:57:26  🔍 完整事件 JSON: {
2025-08-10 14:57:26    "type": "message",
2025-08-10 14:57:26    "message": {
2025-08-10 14:57:26      "type": "text",
2025-08-10 14:57:26      "text": "小明明天下午2點要上數學課"
2025-08-10 14:57:26    },
2025-08-10 14:57:26    "source": {
2025-08-10 14:57:26      "userId": "U_test_user_qa",
2025-08-10 14:57:26      "type": "user"
2025-08-10 14:57:26    },
2025-08-10 14:57:26    "replyToken": "test-reply-token-1754837846561",
2025-08-10 14:57:26    "timestamp": 1754837846561
2025-08-10 14:57:26  }
2025-08-10 14:57:26  🧹 檢測到 QA 重置上下文請求，清理用戶上下文: U_test_user_qa
2025-08-10 14:57:26  ✅ Redis 連接成功
2025-08-10 14:57:27  {"ts":"2025-08-10T14:57:27.070Z","lvl":"info","direction":"inbound","channel":"line","traceId":"line_1754837847070_p6t37h","userId":"U_test_user_qa","textIn":"小明明天下午2點要上數學課"}
2025-08-10 14:57:27  🔍 用戶ID類型: string
2025-08-10 14:57:27  🔍 是否測試用戶: true
2025-08-10 14:57:27  🚀 生產用戶，使用真實 LINE Service
2025-08-10 14:57:27  🎯 開始解析意圖: 小明明天下午2點要上數學課 (用戶: U_test_user_qa)
2025-08-10 14:57:27  ✅ 意圖規則載入成功，共 24 個意圖
2025-08-10 14:57:27  ✅ 規則匹配成功: add_course
2025-08-10 14:57:27  {"ts":"2025-08-10T14:57:27.220Z","lvl":"info","stage":"nlp","traceId":"line_1754837847070_p6t37h","userId":"U_test_user_qa","intent":"add_course"}
2025-08-10 14:57:27  🔍 開始提取 slots - 意圖: add_course (用戶: U_test_user_qa)
2025-08-10 14:57:27  🕒 開始高級時間解析: 小明明天下午2點要上數學課
2025-08-10 14:57:27  ✅ 時間解析成功: {
2025-08-10 14:57:27    input: '小明明天下午2點要上數學課',
2025-08-10 14:57:27    output: '14:00',
2025-08-10 14:57:27    details: { hour: 14, minute: 0, matchType: 'arabic_period', periodInfo: '下午' }
2025-08-10 14:57:27  }
2025-08-10 14:57:27  🧠 使用對話上下文增強 slots 提取
2025-08-10 14:57:27  📊 規則提取置信度: 1.00
2025-08-10 14:57:27  🤖 啟用 AI 輔助提取...
2025-08-10 14:57:27  ✅ OpenAI 服務初始化完成
2025-08-10 14:57:28  ✅ 最終 slots: {
2025-08-10 14:57:28    studentName: '小明',
2025-08-10 14:57:28    courseName: '數學課',
2025-08-10 14:57:28    scheduleTime: '14:00',
2025-08-10 14:57:28    recurring: false,
2025-08-10 14:57:28    timeReference: 'tomorrow'
2025-08-10 14:57:28  ✅ 最終 slots: {
2025-08-10 14:57:28    studentName: '小明',
2025-08-10 14:57:28    courseName: '數學課',
2025-08-10 14:57:28    scheduleTime: '14:00',
2025-08-10 14:57:28    recurring: false,
2025-08-10 14:57:28    timeReference: 'tomorrow'
2025-08-10 14:57:28  }
2025-08-10 14:57:28  {"ts":"2025-08-10T14:57:28.710Z","lvl":"info","stage":"slots","traceId":"line_1754837847070_p6t37h","userId":"U_test_user_qa","intent":"add_course","slotsSummary":["studentName","courseName","scheduleTime","recurring","timeReference"]}
2025-08-10 14:57:28  🎯 執行任務: add_course
2025-08-10 14:57:28  🎯 開始處理新增課程任務
2025-08-10 14:57:28  📋 接收參數: {
2025-08-10 14:57:28    studentName: '小明',
2025-08-10 14:57:28    courseName: '數學課',
2025-08-10 14:57:28    scheduleTime: '14:00',
2025-08-10 14:57:28    recurring: false,
2025-08-10 14:57:28    timeReference: 'tomorrow'
2025-08-10 14:57:28  }
2025-08-10 14:57:28  ✅ Firebase 服務初始化完成
2025-08-10 14:57:29  👤 學生日曆: b9bf786ee6f0002a0cbe843b8e27184082718a0ab1875873280de3be93e4a481@group.calendar.google.com
2025-08-10 14:57:29  🧪 使用 Mock Calendar 服務
2025-08-10 14:57:29  ✅ Google Calendar 服務初始化完成
2025-08-10 14:57:29  ✅ 已創建課程事件: mock-event-1754837849990
2025-08-10 14:57:29  📅 Google Calendar 事件已創建: mock-event-1754837849990
2025-08-10 14:57:30  ✅ 課程資料已儲存: YViVLR6t1PPgVwnlMg1Y
2025-08-10 14:57:30  💾 Firebase 課程資料已儲存: YViVLR6t1PPgVwnlMg1Y
2025-08-10 14:57:30  📊 任務執行結果: {
2025-08-10 14:57:30    success: true,
2025-08-10 14:57:30    code: 'ADD_COURSE_OK',
2025-08-10 14:57:30    message: '✅ 課程已安排成功！\n\n👦 學生：小明\n📚 課程：數學課\n📅 日期：2025-08-11\n🕐 時間：下午2:00',
2025-08-10 14:57:30    data: {
2025-08-10 14:57:30      courseId: 'YViVLR6t1PPgVwnlMg1Y',
2025-08-10 14:57:30      eventId: 'mock-event-1754837849990'
2025-08-10 14:57:30    },
2025-08-10 14:57:30    quickReply: [ { label: '✅ 確認', text: '確認' }, { label: '❌ 取消操作', text: '取消操作' } ]
2025-08-10 14:57:30  }
2025-08-10 14:57:30  {"ts":"2025-08-10T14:57:30.483Z","lvl":"info","stage":"task","traceId":"line_1754837847070_p6t37h","userId":"U_test_user_qa","intent":"add_course","success":true,"code":"ADD_COURSE_OK","latencyMs":1773}
2025-08-10 14:57:30  🔍 檢查 replyToken: test-reply-token-1754837846561
2025-08-10 14:57:30  🧪 檢測到測試 token，跳過真實 LINE API 調用
2025-08-10 14:57:30  📤 [測試模式] 實際業務回覆: ✅ 課程已安排成功！
2025-08-10 14:57:30  
2025-08-10 14:57:30  👦 學生：小明
2025-08-10 14:57:30  📚 課程：數學課
2025-08-10 14:57:30  📅 日期：2025-08-11
2025-08-10 14:57:30  🕐 時間：下午2:00
2025-08-10 14:57:30  {"ts":"2025-08-10T14:57:30.764Z","lvl":"info","direction":"outbound","channel":"line","traceId":"line_1754837847070_p6t37h","userId":"U_test_user_qa","textOut":"✅ 課程已安排成功！\n\n👦 學生：小明\n📚 課程：數學課\n📅 日期：2025-08-11\n🕐 時間：下午2:00","quickReply":true}
2025-08-10 14:57:43  📨 收到 1 個事件
2025-08-10 14:57:43  📋 事件類型: message
2025-08-10 14:57:43  🔍 完整事件 JSON: {
2025-08-10 14:57:43    "type": "message",
2025-08-10 14:57:43    "message": {
2025-08-10 14:57:43      "type": "text",
2025-08-10 14:57:43      "text": "我想要什麼時候上課來著"
2025-08-10 14:57:43    },
2025-08-10 14:57:43    "source": {
2025-08-10 14:57:43      "userId": "U_test_user_qa",
2025-08-10 14:57:43      "type": "user"
2025-08-10 14:57:43    },
2025-08-10 14:57:43    "replyToken": "test-reply-token-1754837863388",
2025-08-10 14:57:43    "timestamp": 1754837863388
2025-08-10 14:57:43  }
2025-08-10 14:57:43  🧹 檢測到 QA 重置上下文請求，清理用戶上下文: U_test_user_qa
2025-08-10 14:57:43  {"ts":"2025-08-10T14:57:43.577Z","lvl":"info","direction":"inbound","channel":"line","traceId":"line_1754837863577_e303cw","userId":"U_test_user_qa","textIn":"我想要什麼時候上課來著"}
2025-08-10 14:57:43  🔍 用戶ID類型: string
2025-08-10 14:57:43  🔍 是否測試用戶: true
2025-08-10 14:57:43  🚀 生產用戶，使用真實 LINE Service
2025-08-10 14:57:43  🎯 開始解析意圖: 我想要什麼時候上課來著 (用戶: U_test_user_qa)
2025-08-10 14:57:43  ✅ 規則匹配成功: add_course
2025-08-10 14:57:43  {"ts":"2025-08-10T14:57:43.721Z","lvl":"info","stage":"nlp","traceId":"line_1754837863577_e303cw","userId":"U_test_user_qa","intent":"add_course"}
2025-08-10 14:57:43  🔍 開始提取 slots - 意圖: add_course (用戶: U_test_user_qa)
2025-08-10 14:57:43  🕒 開始高級時間解析: 我想要什麼時候上課來著
2025-08-10 14:57:43  ❌ 時間解析失敗: 我想要什麼時候上課來著
2025-08-10 14:57:44  📊 規則提取置信度: 0.50
2025-08-10 14:57:44  🤖 啟用 AI 輔助提取...
2025-08-10 14:57:45  ✅ 最終 slots: { courseName: '課來著', recurring: false }
2025-08-10 14:57:45  {"ts":"2025-08-10T14:57:45.352Z","lvl":"info","stage":"slots","traceId":"line_1754837863577_e303cw","userId":"U_test_user_qa","intent":"add_course","slotsSummary":["courseName","recurring"]}
2025-08-10 14:57:45  🎯 執行任務: add_course
2025-08-10 14:57:45  🎯 開始處理新增課程任務
2025-08-10 14:57:45  📋 接收參數: { courseName: '課來著', recurring: false }
2025-08-10 14:57:45  📊 任務執行結果: {
2025-08-10 14:57:45    success: false,
2025-08-10 14:57:45    code: 'MISSING_FIELDS',
2025-08-10 14:57:45    message: '❓ 請提供以下資訊：學生姓名、上課時間、課程日期\n\n範例：「小明每週三下午3點數學課」',
2025-08-10 14:57:45    expectingInput: true,
2025-08-10 14:57:45    missingFields: [ '學生姓名', '上課時間', '課程日期' ]
2025-08-10 14:57:45  }
2025-08-10 14:57:45  {"ts":"2025-08-10T14:57:45.497Z","lvl":"info","stage":"task","traceId":"line_1754837863577_e303cw","userId":"U_test_user_qa","intent":"add_course","success":false,"code":"MISSING_FIELDS","latencyMs":144}
2025-08-10 14:57:45  🔍 檢查 replyToken: test-reply-token-1754837863388
2025-08-10 14:57:45  🧪 檢測到測試 token，跳過真實 LINE API 調用
2025-08-10 14:57:45  📤 [測試模式] 實際業務回覆: ❓ 請提供以下資訊：學生姓名、上課時間、課程日期
2025-08-10 14:57:45  
2025-08-10 14:57:45  範例：「小明每週三下午3點數學課」
2025-08-10 14:57:45  {"ts":"2025-08-10T14:57:45.780Z","lvl":"info","direction":"outbound","channel":"line","traceId":"line_1754837863577_e303cw","userId":"U_test_user_qa","textOut":"❓ 請提供以下資訊：學生姓名、上課時間、課程日期\n\n範例：「小明每週三下午3點數學課」","quickReply":false}
2025-08-10 14:58:16  📨 收到 1 個事件
2025-08-10 14:58:16  📋 事件類型: message
2025-08-10 14:58:16  🔍 完整事件 JSON: {
2025-08-10 14:58:16    "type": "message",
2025-08-10 14:58:16    "message": {
2025-08-10 14:58:16      "type": "text",
2025-08-10 14:58:16      "text": "我想了解一下課程安排的情況"
2025-08-10 14:58:16    },
2025-08-10 14:58:16  📨 收到 1 個事件
2025-08-10 14:58:16  📋 事件類型: message
2025-08-10 14:58:16  🔍 完整事件 JSON: {
2025-08-10 14:58:16    "type": "message",
2025-08-10 14:58:16    "message": {
2025-08-10 14:58:16      "type": "text",
2025-08-10 14:58:16      "text": "我想了解一下課程安排的情況"
2025-08-10 14:58:16    },
2025-08-10 14:58:16    "source": {
2025-08-10 14:58:16      "userId": "U_test_user_qa",
2025-08-10 14:58:16      "type": "user"
2025-08-10 14:58:16    },
2025-08-10 14:58:16    "replyToken": "test-reply-token-1754837896625",
2025-08-10 14:58:16    "timestamp": 1754837896625
2025-08-10 14:58:16  }
2025-08-10 14:58:16  🧹 檢測到 QA 重置上下文請求，清理用戶上下文: U_test_user_qa
2025-08-10 14:58:16  {"ts":"2025-08-10T14:58:16.796Z","lvl":"info","direction":"inbound","channel":"line","traceId":"line_1754837896796_nj3tei","userId":"U_test_user_qa","textIn":"我想了解一下課程安排的情況"}
2025-08-10 14:58:16  🔍 用戶ID類型: string
2025-08-10 14:58:16  🔍 是否測試用戶: true
2025-08-10 14:58:16  🚀 生產用戶，使用真實 LINE Service
2025-08-10 14:58:16  🎯 開始解析意圖: 我想了解一下課程安排的情況 (用戶: U_test_user_qa)
2025-08-10 14:58:16  ✅ 規則匹配成功: query_schedule
2025-08-10 14:58:16  {"ts":"2025-08-10T14:58:16.938Z","lvl":"info","stage":"nlp","traceId":"line_1754837896796_nj3tei","userId":"U_test_user_qa","intent":"query_schedule"}
2025-08-10 14:58:17  🔍 開始提取 slots - 意圖: query_schedule (用戶: U_test_user_qa)
2025-08-10 14:58:17  🧠 使用對話上下文增強 slots 提取
2025-08-10 14:58:17  📊 規則提取置信度: 0.00
2025-08-10 14:58:17  🔄 規則提取信心度低，AI 輔助增強...
2025-08-10 14:58:18  ✅ 文檔已添加到 error_cases: GcrZTAown0ygySEAfVWT
2025-08-10 14:58:18  📊 低置信度案例已記錄: GcrZTAown0ygySEAfVWT
2025-08-10 14:58:18  ✅ 最終 slots: { studentName: '我', content: '課程安排的情況' }
2025-08-10 14:58:18  {"ts":"2025-08-10T14:58:18.323Z","lvl":"info","stage":"slots","traceId":"line_1754837896796_nj3tei","userId":"U_test_user_qa","intent":"query_schedule","slotsSummary":["studentName","content"]}
2025-08-10 14:58:18  🎯 執行任務: query_schedule
2025-08-10 14:58:18  🎯 開始處理查詢課表任務
2025-08-10 14:58:18  📋 接收參數: { studentName: '我', content: '課程安排的情況' }
2025-08-10 14:58:18  📅 查詢時間範圍: { startDate: '2025-08-10', endDate: '2025-08-16', description: '本週' }
2025-08-10 14:58:18  📚 查詢到 0 筆課程資料
2025-08-10 14:58:18  ❌ 查詢課表任務失敗: TypeError: firebaseService.getRecurringCoursesByStudent is not a function
2025-08-10 14:58:18      at handle_query_schedule_task (/opt/render/project/src/src/tasks/handle_query_schedule_task.js:304:47)
2025-08-10 14:58:18      at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
2025-08-10 14:58:18      at async executeTask (/opt/render/project/src/src/tasks/index.js:121:16)
2025-08-10 14:58:18      at async handleTextMessage (/opt/render/project/src/src/bot/webhook.js:92:20)
2025-08-10 14:58:18      at async handleWebhook (/opt/render/project/src/src/bot/webhook.js:438:13)
2025-08-10 14:58:18      at async /opt/render/project/src/src/index.js:34:5
2025-08-10 14:58:18  📊 任務執行結果: {
2025-08-10 14:58:18    success: false,
2025-08-10 14:58:18    code: 'QUERY_FAILED',
2025-08-10 14:58:18    message: '❌ 查詢課表失敗，請檢查學生姓名並稍後再試。'
2025-08-10 14:58:18  }
2025-08-10 14:58:18  {"ts":"2025-08-10T14:58:18.488Z","lvl":"info","stage":"task","traceId":"line_1754837896796_nj3tei","userId":"U_test_user_qa","intent":"query_schedule","success":false,"code":"QUERY_FAILED","latencyMs":164}
2025-08-10 14:58:18  🔍 檢查 replyToken: test-reply-token-1754837896625
2025-08-10 14:58:18  🧪 檢測到測試 token，跳過真實 LINE API 調用
2025-08-10 14:58:18  📤 [測試模式] 實際業務回覆: ❌ 查詢課表失敗，請檢查學生姓名並稍後再試。
2025-08-10 14:58:18  {"ts":"2025-08-10T14:58:18.769Z","lvl":"info","direction":"outbound","channel":"line","traceId":"line_1754837896796_nj3tei","userId":"U_test_user_qa","textOut":"❌ 查詢課表失敗，請檢查學生姓名並稍後再試。","quickReply":false}
2025-08-10 14:58:31  📨 收到 1 個事件
2025-08-10 14:58:31  📋 事件類型: message
2025-08-10 14:58:31  🔍 完整事件 JSON: {
2025-08-10 14:58:31    "type": "message",
2025-08-10 14:58:31    "message": {
2025-08-10 14:58:31      "type": "text",
2025-08-10 14:58:31      "text": "幫我安排小明數學課，然後查一下他今天有什麼課"
2025-08-10 14:58:31    },
2025-08-10 14:58:31    "source": {
2025-08-10 14:58:31      "userId": "U_test_user_qa",
2025-08-10 14:58:31      "type": "user"
2025-08-10 14:58:31    },
2025-08-10 14:58:31    "replyToken": "test-reply-token-1754837911520",
2025-08-10 14:58:31    "timestamp": 1754837911520
2025-08-10 14:58:31  }
2025-08-10 14:58:31  🧹 檢測到 QA 重置上下文請求，清理用戶上下文: U_test_user_qa
2025-08-10 14:58:31  {"ts":"2025-08-10T14:58:31.801Z","lvl":"info","direction":"inbound","channel":"line","traceId":"line_1754837911801_zxeby5","userId":"U_test_user_qa","textIn":"幫我安排小明數學課，然後查一下他今天有什麼課"}
2025-08-10 14:58:31  🔍 用戶ID類型: string
2025-08-10 14:58:31  🔍 是否測試用戶: true
2025-08-10 14:58:31  🚀 生產用戶，使用真實 LINE Service
2025-08-10 14:58:31  🎯 開始解析意圖: 幫我安排小明數學課，然後查一下他今天有什麼課 (用戶: U_test_user_qa)
2025-08-10 14:58:31  ✅ 規則匹配成功: query_schedule
2025-08-10 14:58:31  {"ts":"2025-08-10T14:58:31.942Z","lvl":"info","stage":"nlp","traceId":"line_1754837911801_zxeby5","userId":"U_test_user_qa","intent":"query_schedule"}
2025-08-10 14:58:32  🔍 開始提取 slots - 意圖: query_schedule (用戶: U_test_user_qa)
2025-08-10 14:58:32  🧠 使用對話上下文增強 slots 提取
2025-08-10 14:58:32  📊 規則提取置信度: 0.50
2025-08-10 14:58:32  🤖 啟用 AI 輔助提取...
2025-08-10 14:58:33  ✅ 最終 slots: { studentName: '小明', timeReference: 'today', courseName: '數學課' }
2025-08-10 14:58:33  {"ts":"2025-08-10T14:58:33.167Z","lvl":"info","stage":"slots","traceId":"line_1754837911801_zxeby5","userId":"U_test_user_qa","intent":"query_schedule","slotsSummary":["studentName","timeReference","courseName"]}
2025-08-10 14:58:33  🎯 執行任務: query_schedule
2025-08-10 14:58:33  🎯 開始處理查詢課表任務
2025-08-10 14:58:33  📋 接收參數: { studentName: '小明', timeReference: 'today', courseName: '數學課' }
2025-08-10 14:58:33  📅 查詢時間範圍: { startDate: '2025-08-10', endDate: '2025-08-10', description: '今天' }
2025-08-10 14:58:33  📚 查詢到 158 筆課程資料
2025-08-10 14:58:33  ❌ 查詢課表任務失敗: TypeError: firebaseService.getRecurringCoursesByStudent is not a function
2025-08-10 14:58:33      at handle_query_schedule_task (/opt/render/project/src/src/tasks/handle_query_schedule_task.js:304:47)
2025-08-10 14:58:33      at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
2025-08-10 14:58:33      at async executeTask (/opt/render/project/src/src/tasks/index.js:121:16)
2025-08-10 14:58:33      at async handleTextMessage (/opt/render/project/src/src/bot/webhook.js:92:20)
2025-08-10 14:58:33      at async handleWebhook (/opt/render/project/src/src/bot/webhook.js:438:13)
2025-08-10 14:58:33      at async /opt/render/project/src/src/index.js:34:5
2025-08-10 14:58:33  📊 任務執行結果: {
2025-08-10 14:58:33    success: false,
2025-08-10 14:58:33    code: 'QUERY_FAILED',
2025-08-10 14:58:33    message: '❌ 查詢課表失敗，請檢查學生姓名並稍後再試。'
2025-08-10 14:58:33  }
2025-08-10 14:58:33  {"ts":"2025-08-10T14:58:33.364Z","lvl":"info","stage":"task","traceId":"line_1754837911801_zxeby5","userId":"U_test_user_qa","intent":"query_schedule","success":false,"code":"QUERY_FAILED","latencyMs":197}
2025-08-10 14:58:33  ✅ 最終 slots: { studentName: '小明', timeReference: 'today', courseName: '數學課' }
2025-08-10 14:58:33  {"ts":"2025-08-10T14:58:33.167Z","lvl":"info","stage":"slots","traceId":"line_1754837911801_zxeby5","userId":"U_test_user_qa","intent":"query_schedule","slotsSummary":["studentName","timeReference","courseName"]}
2025-08-10 14:58:33  🎯 執行任務: query_schedule
2025-08-10 14:58:33  🎯 開始處理查詢課表任務
2025-08-10 14:58:33  📋 接收參數: { studentName: '小明', timeReference: 'today', courseName: '數學課' }
2025-08-10 14:58:33  📅 查詢時間範圍: { startDate: '2025-08-10', endDate: '2025-08-10', description: '今天' }
2025-08-10 14:58:33  📚 查詢到 158 筆課程資料
2025-08-10 14:58:33  ❌ 查詢課表任務失敗: TypeError: firebaseService.getRecurringCoursesByStudent is not a function
2025-08-10 14:58:33      at handle_query_schedule_task (/opt/render/project/src/src/tasks/handle_query_schedule_task.js:304:47)
2025-08-10 14:58:33      at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
2025-08-10 14:58:33      at async executeTask (/opt/render/project/src/src/tasks/index.js:121:16)
2025-08-10 14:58:33      at async handleTextMessage (/opt/render/project/src/src/bot/webhook.js:92:20)
2025-08-10 14:58:33      at async handleWebhook (/opt/render/project/src/src/bot/webhook.js:438:13)
2025-08-10 14:58:33      at async /opt/render/project/src/src/index.js:34:5
2025-08-10 14:58:33  📊 任務執行結果: {
2025-08-10 14:58:33    success: false,
2025-08-10 14:58:33    code: 'QUERY_FAILED',
2025-08-10 14:58:33    message: '❌ 查詢課表失敗，請檢查學生姓名並稍後再試。'
2025-08-10 14:58:33  }
2025-08-10 14:58:33  {"ts":"2025-08-10T14:58:33.364Z","lvl":"info","stage":"task","traceId":"line_1754837911801_zxeby5","userId":"U_test_user_qa","intent":"query_schedule","success":false,"code":"QUERY_FAILED","latencyMs":197}
2025-08-10 14:58:33  🔍 檢查 replyToken: test-reply-token-1754837911520
2025-08-10 14:58:33  🧪 檢測到測試 token，跳過真實 LINE API 調用
2025-08-10 14:58:33  📤 [測試模式] 實際業務回覆: ❌ 查詢課表失敗，請檢查學生姓名並稍後再試。
2025-08-10 14:58:33  {"ts":"2025-08-10T14:58:33.645Z","lvl":"info","direction":"outbound","channel":"line","traceId":"line_1754837911801_zxeby5","userId":"U_test_user_qa","textOut":"❌ 查詢課表失敗，請檢查學生姓名並稍後再試。","quickReply":false}
2025-08-10 14:58:46  📨 收到 1 個事件
2025-08-10 14:58:46  📋 事件類型: message
2025-08-10 14:58:46  🔍 完整事件 JSON: {
2025-08-10 14:58:46    "type": "message",
2025-08-10 14:58:46    "message": {
2025-08-10 14:58:46      "type": "text",
2025-08-10 14:58:46      "text": "（觸發系統錯誤的占位輸入）"
2025-08-10 14:58:46    },
2025-08-10 14:58:46    "source": {
2025-08-10 14:58:46      "userId": "U_test_user_qa",
2025-08-10 14:58:46      "type": "user"
2025-08-10 14:58:46    },
2025-08-10 14:58:46    "replyToken": "test-reply-token-1754837926454",
2025-08-10 14:58:46    "timestamp": 1754837926454
2025-08-10 14:58:46  }
2025-08-10 14:58:46  🧹 檢測到 QA 重置上下文請求，清理用戶上下文: U_test_user_qa
2025-08-10 14:58:46  {"ts":"2025-08-10T14:58:46.735Z","lvl":"info","direction":"inbound","channel":"line","traceId":"line_1754837926735_1yr4t7","userId":"U_test_user_qa","textIn":"（觸發系統錯誤的占位輸入）"}
2025-08-10 14:58:46  🔍 用戶ID類型: string
2025-08-10 14:58:46  🔍 是否測試用戶: true
2025-08-10 14:58:46  🚀 生產用戶，使用真實 LINE Service
2025-08-10 14:58:46  🎯 開始解析意圖: （觸發系統錯誤的占位輸入） (用戶: U_test_user_qa)
2025-08-10 14:58:46  📋 對話上下文狀態: { currentFlow: null, expectingInput: [], lastActionsCount: 0 }
2025-08-10 14:58:46  ⚠️ 沒有可糾正的操作，降級處理
2025-08-10 14:58:46  ✅ 上下文感知識別成功: unknown
2025-08-10 14:58:46  {"ts":"2025-08-10T14:58:46.946Z","lvl":"info","stage":"nlp","traceId":"line_1754837926735_1yr4t7","userId":"U_test_user_qa","intent":"unknown"}
2025-08-10 14:58:47  🎯 執行任務: unknown
2025-08-10 14:58:47  ❓ 處理無法識別的意圖
2025-08-10 14:58:47  📊 任務執行結果: {
2025-08-10 14:58:47    success: true,
2025-08-10 14:58:47    code: 'UNKNOWN_HELP',
2025-08-10 14:58:47    message: '😊 不太理解您的意思，試試這些功能：\n' +
2025-08-10 14:58:47      '\n' +
2025-08-10 14:58:47      '• 新增課程：「小明明天上午10點英文課」\n' +
2025-08-10 14:58:47      '• 查詢課程：「查詢小明的課表」  \n' +
2025-08-10 14:58:47      '• 記錄內容：「記錄昨天數學課的內容」\n' +
2025-08-10 14:58:47      '• 設定提醒：「設定提醒」\n' +
2025-08-10 14:58:47      '\n' +
2025-08-10 14:58:47      '💡 您也可以直接告訴我想要做什麼，我會盡力幫助您！'
2025-08-10 14:58:47  }
2025-08-10 14:58:47  🔍 檢查 replyToken: test-reply-token-1754837926454
2025-08-10 14:58:47  🧪 檢測到測試 token，跳過真實 LINE API 調用
2025-08-10 14:58:47  📤 [測試模式] 實際業務回覆: 😊 不太理解您的意思，試試這些功能：
2025-08-10 14:58:47  
2025-08-10 14:58:47  • 新增課程：「小明明天上午10點英文課」
2025-08-10 14:58:47  • 查詢課程：「查詢小明的課表」  
2025-08-10 14:58:47  • 記錄內容：「記錄昨天數學課的內容」
2025-08-10 14:58:47  • 設定提醒：「設定提醒」
2025-08-10 14:58:47  
2025-08-10 14:58:47  💡 您也可以直接告訴我想要做什麼，我會盡力幫助您！
2025-08-10 14:59:00  📨 收到 1 個事件
2025-08-10 14:59:00  📋 事件類型: message
2025-08-10 14:59:00  🔍 完整事件 JSON: {
2025-08-10 14:59:00    "type": "message",
2025-08-10 14:59:00    "message": {
2025-08-10 14:59:00      "type": "text",
2025-08-10 14:59:00      "text": "小明明天25點上課"
2025-08-10 14:59:00    },
2025-08-10 14:59:00    "source": {
2025-08-10 14:59:00      "userId": "U_test_user_qa",
2025-08-10 14:59:00      "type": "user"
2025-08-10 14:59:00    },
2025-08-10 14:59:00    "replyToken": "test-reply-token-1754837940312",
2025-08-10 14:59:00    "timestamp": 1754837940312
2025-08-10 14:59:00  }
2025-08-10 14:59:00  🧹 檢測到 QA 重置上下文請求，清理用戶上下文: U_test_user_qa
2025-08-10 14:59:00  {"ts":"2025-08-10T14:59:00.615Z","lvl":"info","direction":"inbound","channel":"line","traceId":"line_1754837940615_m5z2lt","userId":"U_test_user_qa","textIn":"小明明天25點上課"}
2025-08-10 14:59:00  🔍 用戶ID類型: string
2025-08-10 14:59:00  🔍 是否測試用戶: true
2025-08-10 14:59:00  🚀 生產用戶，使用真實 LINE Service
2025-08-10 14:59:00  🎯 開始解析意圖: 小明明天25點上課 (用戶: U_test_user_qa)
2025-08-10 14:59:00  ✅ 規則匹配成功: add_course
2025-08-10 14:59:00  {"ts":"2025-08-10T14:59:00.756Z","lvl":"info","stage":"nlp","traceId":"line_1754837940615_m5z2lt","userId":"U_test_user_qa","intent":"add_course"}
2025-08-10 14:59:00  🔍 開始提取 slots - 意圖: add_course (用戶: U_test_user_qa)
2025-08-10 14:59:00  🕒 開始高級時間解析: 小明明天25點上課
2025-08-10 14:59:00  ❌ 時間解析失敗: 小明明天25點上課
2025-08-10 14:59:01  📊 規則提取置信度: 0.50
2025-08-10 14:59:01  📊 規則提取置信度: 0.50
2025-08-10 14:59:01  🤖 啟用 AI 輔助提取...
2025-08-10 14:59:02  ✅ 最終 slots: {
2025-08-10 14:59:02    studentName: '小明',
2025-08-10 14:59:02    scheduleTime: '25:00',
2025-08-10 14:59:02    recurring: false,
2025-08-10 14:59:02    timeReference: 'tomorrow',
2025-08-10 14:59:02    invalidTime: true
2025-08-10 14:59:02  }
2025-08-10 14:59:02  {"ts":"2025-08-10T14:59:02.699Z","lvl":"info","stage":"slots","traceId":"line_1754837940615_m5z2lt","userId":"U_test_user_qa","intent":"add_course","slotsSummary":["studentName","scheduleTime","recurring","timeReference","invalidTime"]}
2025-08-10 14:59:02  🎯 執行任務: add_course
2025-08-10 14:59:02  🎯 開始處理新增課程任務
2025-08-10 14:59:02  📋 接收參數: {
2025-08-10 14:59:02    studentName: '小明',
2025-08-10 14:59:02    scheduleTime: '25:00',
2025-08-10 14:59:02    recurring: false,
2025-08-10 14:59:02    timeReference: 'tomorrow',
2025-08-10 14:59:02    invalidTime: true
2025-08-10 14:59:02  }
2025-08-10 14:59:02  📊 任務執行結果: {
2025-08-10 14:59:02    success: false,
2025-08-10 14:59:02    code: 'INVALID_TIME',
2025-08-10 14:59:02    message: '❌ 時間格式不正確，請重新輸入正確的時間（例如：下午2點 或 14:00）',
2025-08-10 14:59:02    expectingInput: true,
2025-08-10 14:59:02    missingFields: [ '上課時間' ]
2025-08-10 14:59:02  }
2025-08-10 14:59:02  {"ts":"2025-08-10T14:59:02.839Z","lvl":"info","stage":"task","traceId":"line_1754837940615_m5z2lt","userId":"U_test_user_qa","intent":"add_course","success":false,"code":"INVALID_TIME","latencyMs":140}
2025-08-10 14:59:03  🔍 檢查 replyToken: test-reply-token-1754837940312
2025-08-10 14:59:03  🧪 檢測到測試 token，跳過真實 LINE API 調用
2025-08-10 14:59:03  📤 [測試模式] 實際業務回覆: ❌ 時間格式不正確，請重新輸入正確的時間（例如：下午2點 或 14:00）
2025-08-10 14:59:03  {"ts":"2025-08-10T14:59:03.120Z","lvl":"info","direction":"outbound","channel":"line","traceId":"line_1754837940615_m5z2lt","userId":"U_test_user_qa","textOut":"❌ 時間格式不正確，請重新輸入正確的時間（例如：下午2點 或 14:00）","quickReply":false}
2025-08-10 14:59:04  📨 收到 1 個事件
2025-08-10 14:59:04  📋 事件類型: message
2025-08-10 14:59:04  🔍 完整事件 JSON: {
2025-08-10 14:59:04    "type": "message",
2025-08-10 14:59:04    "message": {
2025-08-10 14:59:04      "type": "text",
2025-08-10 14:59:04      "text": "下午2點"
2025-08-10 14:59:04    },
2025-08-10 14:59:04    "source": {
2025-08-10 14:59:04      "userId": "U_test_user_qa",
2025-08-10 14:59:04      "type": "user"
2025-08-10 14:59:04    },
2025-08-10 14:59:04    "replyToken": "test-reply-token-1754837944372",
2025-08-10 14:59:04    "timestamp": 1754837944372
2025-08-10 14:59:04  }
2025-08-10 14:59:04  🧹 檢測到 QA 重置上下文請求，清理用戶上下文: U_test_user_qa
2025-08-10 14:59:04  {"ts":"2025-08-10T14:59:04.526Z","lvl":"info","direction":"inbound","channel":"line","traceId":"line_1754837944525_4xi08f","userId":"U_test_user_qa","textIn":"下午2點"}
2025-08-10 14:59:04  🔍 用戶ID類型: string
2025-08-10 14:59:04  🔍 是否測試用戶: true
2025-08-10 14:59:04  🚀 生產用戶，使用真實 LINE Service
2025-08-10 14:59:04  🎯 開始解析意圖: 下午2點 (用戶: U_test_user_qa)
2025-08-10 14:59:04  🤖 啟用 AI 備援識別...
2025-08-10 14:59:05  ❓ 無法識別意圖
2025-08-10 14:59:05  {"ts":"2025-08-10T14:59:05.210Z","lvl":"info","stage":"nlp","traceId":"line_1754837944525_4xi08f","userId":"U_test_user_qa","intent":"unknown"}
2025-08-10 14:59:05  🎯 執行任務: unknown
2025-08-10 14:59:05  ❓ 處理無法識別的意圖
2025-08-10 14:59:05  📊 任務執行結果: {
2025-08-10 14:59:05    success: true,
2025-08-10 14:59:05    code: 'UNKNOWN_HELP',
2025-08-10 14:59:05    message: '😊 不太理解您的意思，試試這些功能：\n' +
2025-08-10 14:59:05      '\n' +
2025-08-10 14:59:05      '• 新增課程：「小明明天上午10點英文課」\n' +
2025-08-10 14:59:05      '• 查詢課程：「查詢小明的課表」  \n' +
2025-08-10 14:59:05      '• 記錄內容：「記錄昨天數學課的內容」\n' +
2025-08-10 14:59:05      '• 設定提醒：「設定提醒」\n' +
2025-08-10 14:59:05      '\n' +
2025-08-10 14:59:05      '💡 您也可以直接告訴我想要做什麼，我會盡力幫助您！'
2025-08-10 14:59:05  }
2025-08-10 14:59:05  🔍 檢查 replyToken: test-reply-token-1754837944372
2025-08-10 14:59:05  🧪 檢測到測試 token，跳過真實 LINE API 調用
2025-08-10 14:59:05  📤 [測試模式] 實際業務回覆: 😊 不太理解您的意思，試試這些功能：
2025-08-10 14:59:05  
2025-08-10 14:59:05  • 新增課程：「小明明天上午10點英文課」
2025-08-10 14:59:05  • 查詢課程：「查詢小明的課表」  
2025-08-10 14:59:05  • 記錄內容：「記錄昨天數學課的內容」
2025-08-10 14:59:05  • 設定提醒：「設定提醒」
2025-08-10 14:59:05  
2025-08-10 14:59:05  💡 您也可以直接告訴我想要做什麼，我會盡力幫助您！
2025-08-10 14:59:15  [0;32m[1m==> [0m[1mDetected service running on port 3000[0m
2025-08-10 14:59:15  [0;32m[1m==> [0m[1mDocs on specifying a port: https://render.com/docs/web-services#port-binding[0m
2025-08-10 14:59:18  📨 收到 1 個事件
2025-08-10 14:59:18  📋 事件類型: message
2025-08-10 14:59:18  🔍 完整事件 JSON: {
2025-08-10 14:59:18    "type": "message",
2025-08-10 14:59:18    "message": {
2025-08-10 14:59:18      "type": "text",
2025-08-10 14:59:18      "text": "小明今天有什麼課？"
2025-08-10 14:59:18    },
2025-08-10 14:59:18    "source": {
2025-08-10 14:59:18      "userId": "U_test_user_qa",
2025-08-10 14:59:18      "type": "user"
2025-08-10 14:59:18    },
2025-08-10 14:59:18    "replyToken": "test-reply-token-1754837958376",
2025-08-10 14:59:18    "timestamp": 1754837958376
2025-08-10 14:59:18  }
2025-08-10 14:59:18  🧹 檢測到 QA 重置上下文請求，清理用戶上下文: U_test_user_qa
2025-08-10 14:59:18  {"ts":"2025-08-10T14:59:18.571Z","lvl":"info","direction":"inbound","channel":"line","traceId":"line_1754837958571_dgh45l","userId":"U_test_user_qa","textIn":"小明今天有什麼課？"}
2025-08-10 14:59:18  🔍 用戶ID類型: string
2025-08-10 14:59:18  🔍 是否測試用戶: true
2025-08-10 14:59:18  📨 收到 1 個事件
2025-08-10 14:59:18  📋 事件類型: message
2025-08-10 14:59:18  🔍 完整事件 JSON: {
2025-08-10 14:59:18    "type": "message",
2025-08-10 14:59:18    "message": {
2025-08-10 14:59:18      "type": "text",
2025-08-10 14:59:18      "text": "小明今天有什麼課？"
2025-08-10 14:59:18    },
2025-08-10 14:59:18    "source": {
2025-08-10 14:59:18      "userId": "U_test_user_qa",
2025-08-10 14:59:18      "type": "user"
2025-08-10 14:59:18    },
2025-08-10 14:59:18    "replyToken": "test-reply-token-1754837958376",
2025-08-10 14:59:18    "timestamp": 1754837958376
2025-08-10 14:59:18  }
2025-08-10 14:59:18  🧹 檢測到 QA 重置上下文請求，清理用戶上下文: U_test_user_qa
2025-08-10 14:59:18  {"ts":"2025-08-10T14:59:18.571Z","lvl":"info","direction":"inbound","channel":"line","traceId":"line_1754837958571_dgh45l","userId":"U_test_user_qa","textIn":"小明今天有什麼課？"}
2025-08-10 14:59:18  🔍 用戶ID類型: string
2025-08-10 14:59:18  🔍 是否測試用戶: true
2025-08-10 14:59:18  🚀 生產用戶，使用真實 LINE Service
2025-08-10 14:59:18  🎯 開始解析意圖: 小明今天有什麼課？ (用戶: U_test_user_qa)
2025-08-10 14:59:18  ✅ 規則匹配成功: query_schedule
2025-08-10 14:59:18  {"ts":"2025-08-10T14:59:18.718Z","lvl":"info","stage":"nlp","traceId":"line_1754837958571_dgh45l","userId":"U_test_user_qa","intent":"query_schedule"}
2025-08-10 14:59:18  🔍 開始提取 slots - 意圖: query_schedule (用戶: U_test_user_qa)
2025-08-10 14:59:18  🧠 使用對話上下文增強 slots 提取
2025-08-10 14:59:18  📊 規則提取置信度: 1.00
2025-08-10 14:59:18  🤖 啟用 AI 輔助提取...
2025-08-10 14:59:20  ✅ 最終 slots: { studentName: '小明', timeReference: 'today', content: '課程' }
2025-08-10 14:59:20  {"ts":"2025-08-10T14:59:20.104Z","lvl":"info","stage":"slots","traceId":"line_1754837958571_dgh45l","userId":"U_test_user_qa","intent":"query_schedule","slotsSummary":["studentName","timeReference","content"]}
2025-08-10 14:59:20  🎯 執行任務: query_schedule
2025-08-10 14:59:20  🎯 開始處理查詢課表任務
2025-08-10 14:59:20  📋 接收參數: { studentName: '小明', timeReference: 'today', content: '課程' }
2025-08-10 14:59:20  📅 查詢時間範圍: { startDate: '2025-08-10', endDate: '2025-08-10', description: '今天' }
2025-08-10 14:59:20  📚 查詢到 158 筆課程資料
2025-08-10 14:59:20  ❌ 查詢課表任務失敗: TypeError: firebaseService.getRecurringCoursesByStudent is not a function
2025-08-10 14:59:20      at handle_query_schedule_task (/opt/render/project/src/src/tasks/handle_query_schedule_task.js:304:47)
2025-08-10 14:59:20      at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
2025-08-10 14:59:20      at async executeTask (/opt/render/project/src/src/tasks/index.js:121:16)
2025-08-10 14:59:20      at async handleTextMessage (/opt/render/project/src/src/bot/webhook.js:92:20)
2025-08-10 14:59:20      at async handleWebhook (/opt/render/project/src/src/bot/webhook.js:438:13)
2025-08-10 14:59:20      at async /opt/render/project/src/src/index.js:34:5
2025-08-10 14:59:20  📊 任務執行結果: {
2025-08-10 14:59:20    success: false,
2025-08-10 14:59:20    code: 'QUERY_FAILED',
2025-08-10 14:59:20    message: '❌ 查詢課表失敗，請檢查學生姓名並稍後再試。'
2025-08-10 14:59:20  }
2025-08-10 14:59:20  {"ts":"2025-08-10T14:59:20.277Z","lvl":"info","stage":"task","traceId":"line_1754837958571_dgh45l","userId":"U_test_user_qa","intent":"query_schedule","success":false,"code":"QUERY_FAILED","latencyMs":173}
2025-08-10 14:59:20  🔍 檢查 replyToken: test-reply-token-1754837958376
2025-08-10 14:59:20  🧪 檢測到測試 token，跳過真實 LINE API 調用
2025-08-10 14:59:20  📤 [測試模式] 實際業務回覆: ❌ 查詢課表失敗，請檢查學生姓名並稍後再試。
2025-08-10 14:59:20  {"ts":"2025-08-10T14:59:20.557Z","lvl":"info","direction":"outbound","channel":"line","traceId":"line_1754837958571_dgh45l","userId":"U_test_user_qa","textOut":"❌ 查詢課表失敗，請檢查學生姓名並稍後再試。","quickReply":false}
2025-08-10 14:59:33  📨 收到 1 個事件
2025-08-10 14:59:33  📋 事件類型: message
2025-08-10 14:59:33  🔍 完整事件 JSON: {
2025-08-10 14:59:33    "type": "message",
2025-08-10 14:59:33    "message": {
2025-08-10 14:59:33      "type": "text",
2025-08-10 14:59:33      "text": "查詢Lumi明天的課表"
2025-08-10 14:59:33    },
2025-08-10 14:59:33    "source": {
2025-08-10 14:59:33      "userId": "U_test_user_qa",
2025-08-10 14:59:33      "type": "user"
2025-08-10 14:59:33    },
2025-08-10 14:59:33    "replyToken": "test-reply-token-1754837973003",
2025-08-10 14:59:33    "timestamp": 1754837973003
2025-08-10 14:59:33  }
2025-08-10 14:59:33  🧹 檢測到 QA 重置上下文請求，清理用戶上下文: U_test_user_qa
2025-08-10 14:59:33  {"ts":"2025-08-10T14:59:33.193Z","lvl":"info","direction":"inbound","channel":"line","traceId":"line_1754837973193_bszju7","userId":"U_test_user_qa","textIn":"查詢Lumi明天的課表"}
2025-08-10 14:59:33  🔍 用戶ID類型: string
2025-08-10 14:59:33  🔍 是否測試用戶: true
2025-08-10 14:59:33  🚀 生產用戶，使用真實 LINE Service
2025-08-10 14:59:33  🎯 開始解析意圖: 查詢Lumi明天的課表 (用戶: U_test_user_qa)
2025-08-10 14:59:33  ✅ 規則匹配成功: query_schedule
2025-08-10 14:59:33  {"ts":"2025-08-10T14:59:33.336Z","lvl":"info","stage":"nlp","traceId":"line_1754837973193_bszju7","userId":"U_test_user_qa","intent":"query_schedule"}
2025-08-10 14:59:33  🔍 開始提取 slots - 意圖: query_schedule (用戶: U_test_user_qa)
2025-08-10 14:59:33  🧠 使用對話上下文增強 slots 提取
2025-08-10 14:59:33  📊 規則提取置信度: 1.00
2025-08-10 14:59:33  🤖 啟用 AI 輔助提取...
2025-08-10 14:59:35  ✅ 最終 slots: { studentName: 'Lumi', timeReference: 'tomorrow' }
2025-08-10 14:59:35  {"ts":"2025-08-10T14:59:35.254Z","lvl":"info","stage":"slots","traceId":"line_1754837973193_bszju7","userId":"U_test_user_qa","intent":"query_schedule","slotsSummary":["studentName","timeReference"]}
2025-08-10 14:59:35  🎯 執行任務: query_schedule
2025-08-10 14:59:35  🎯 開始處理查詢課表任務
2025-08-10 14:59:35  📋 接收參數: { studentName: 'Lumi', timeReference: 'tomorrow' }
2025-08-10 14:59:35  📅 查詢時間範圍: { startDate: '2025-08-11', endDate: '2025-08-11', description: '明天' }
2025-08-10 14:59:35  📚 查詢到 156 筆課程資料
2025-08-10 14:59:35  📊 任務執行結果: {
2025-08-10 14:59:35    success: false,
2025-08-10 14:59:35    code: 'QUERY_FAILED',
2025-08-10 14:59:35    message: '❌ 查詢課表失敗，請檢查學生姓名並稍後再試。'
2025-08-10 14:59:35  }
2025-08-10 14:59:35  ❌ 查詢課表任務失敗: TypeError: firebaseService.getRecurringCoursesByStudent is not a function
2025-08-10 14:59:35  {"ts":"2025-08-10T14:59:35.421Z","lvl":"info","stage":"task","traceId":"line_1754837973193_bszju7","userId":"U_test_user_qa","intent":"query_schedule","success":false,"code":"QUERY_FAILED","latencyMs":167}
2025-08-10 14:59:35      at handle_query_schedule_task (/opt/render/project/src/src/tasks/handle_query_schedule_task.js:304:47)
2025-08-10 14:59:35      at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
2025-08-10 14:59:35      at async executeTask (/opt/render/project/src/src/tasks/index.js:121:16)
2025-08-10 14:59:35      at async handleTextMessage (/opt/render/project/src/src/bot/webhook.js:92:20)
2025-08-10 14:59:35      at async handleWebhook (/opt/render/project/src/src/bot/webhook.js:438:13)
2025-08-10 14:59:35      at async /opt/render/project/src/src/index.js:34:5
2025-08-10 14:59:35  🔍 檢查 replyToken: test-reply-token-1754837973003
2025-08-10 14:59:35  🧪 檢測到測試 token，跳過真實 LINE API 調用
2025-08-10 14:59:35  ✅ 最終 slots: { studentName: 'Lumi', timeReference: 'tomorrow' }
2025-08-10 14:59:35  {"ts":"2025-08-10T14:59:35.254Z","lvl":"info","stage":"slots","traceId":"line_1754837973193_bszju7","userId":"U_test_user_qa","intent":"query_schedule","slotsSummary":["studentName","timeReference"]}
2025-08-10 14:59:35  🎯 執行任務: query_schedule
2025-08-10 14:59:35  🎯 開始處理查詢課表任務
2025-08-10 14:59:35  📋 接收參數: { studentName: 'Lumi', timeReference: 'tomorrow' }
2025-08-10 14:59:35  📅 查詢時間範圍: { startDate: '2025-08-11', endDate: '2025-08-11', description: '明天' }
2025-08-10 14:59:35  📚 查詢到 156 筆課程資料
2025-08-10 14:59:35  📊 任務執行結果: {
2025-08-10 14:59:35    success: false,
2025-08-10 14:59:35    code: 'QUERY_FAILED',
2025-08-10 14:59:35    message: '❌ 查詢課表失敗，請檢查學生姓名並稍後再試。'
2025-08-10 14:59:35  }
2025-08-10 14:59:35  ❌ 查詢課表任務失敗: TypeError: firebaseService.getRecurringCoursesByStudent is not a function
2025-08-10 14:59:35  {"ts":"2025-08-10T14:59:35.421Z","lvl":"info","stage":"task","traceId":"line_1754837973193_bszju7","userId":"U_test_user_qa","intent":"query_schedule","success":false,"code":"QUERY_FAILED","latencyMs":167}
2025-08-10 14:59:35      at handle_query_schedule_task (/opt/render/project/src/src/tasks/handle_query_schedule_task.js:304:47)
2025-08-10 14:59:35      at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
2025-08-10 14:59:35      at async executeTask (/opt/render/project/src/src/tasks/index.js:121:16)
2025-08-10 14:59:35      at async handleTextMessage (/opt/render/project/src/src/bot/webhook.js:92:20)
2025-08-10 14:59:35      at async handleWebhook (/opt/render/project/src/src/bot/webhook.js:438:13)
2025-08-10 14:59:35      at async /opt/render/project/src/src/index.js:34:5
2025-08-10 14:59:35  🔍 檢查 replyToken: test-reply-token-1754837973003
2025-08-10 14:59:35  🧪 檢測到測試 token，跳過真實 LINE API 調用
2025-08-10 14:59:35  📤 [測試模式] 實際業務回覆: ❌ 查詢課表失敗，請檢查學生姓名並稍後再試。
2025-08-10 14:59:35  {"ts":"2025-08-10T14:59:35.701Z","lvl":"info","direction":"outbound","channel":"line","traceId":"line_1754837973193_bszju7","userId":"U_test_user_qa","textOut":"❌ 查詢課表失敗，請檢查學生姓名並稍後再試。","quickReply":false}
2025-08-10 14:59:48  📨 收到 1 個事件
2025-08-10 14:59:48  📋 事件類型: message
2025-08-10 14:59:48  🔍 完整事件 JSON: {
2025-08-10 14:59:48    "type": "message",
2025-08-10 14:59:48    "message": {
2025-08-10 14:59:48      "type": "text",
2025-08-10 14:59:48      "text": "看一下小光這週的安排"
2025-08-10 14:59:48    },
2025-08-10 14:59:48    "source": {
2025-08-10 14:59:48      "userId": "U_test_user_qa",
2025-08-10 14:59:48      "type": "user"
2025-08-10 14:59:48    },
2025-08-10 14:59:48    "replyToken": "test-reply-token-1754837988606",
2025-08-10 14:59:48    "timestamp": 1754837988606
2025-08-10 14:59:48  }
2025-08-10 14:59:48  🧹 檢測到 QA 重置上下文請求，清理用戶上下文: U_test_user_qa
2025-08-10 14:59:48  {"ts":"2025-08-10T14:59:48.775Z","lvl":"info","direction":"inbound","channel":"line","traceId":"line_1754837988775_3smznw","userId":"U_test_user_qa","textIn":"看一下小光這週的安排"}
2025-08-10 14:59:48  🔍 用戶ID類型: string
2025-08-10 14:59:48  🔍 是否測試用戶: true
2025-08-10 14:59:48  🚀 生產用戶，使用真實 LINE Service
2025-08-10 14:59:48  🎯 開始解析意圖: 看一下小光這週的安排 (用戶: U_test_user_qa)
2025-08-10 14:59:48  ✅ 規則匹配成功: query_schedule
2025-08-10 14:59:48  {"ts":"2025-08-10T14:59:48.920Z","lvl":"info","stage":"nlp","traceId":"line_1754837988775_3smznw","userId":"U_test_user_qa","intent":"query_schedule"}
2025-08-10 14:59:49  🔍 開始提取 slots - 意圖: query_schedule (用戶: U_test_user_qa)
2025-08-10 14:59:49  🧠 使用對話上下文增強 slots 提取
2025-08-10 14:59:49  📊 規則提取置信度: 0.50
2025-08-10 14:59:49  🤖 啟用 AI 輔助提取...
2025-08-10 14:59:50  ✅ 最終 slots: { studentName: '小光', timeReference: 'this_week' }
2025-08-10 14:59:50  {"ts":"2025-08-10T14:59:50.145Z","lvl":"info","stage":"slots","traceId":"line_1754837988775_3smznw","userId":"U_test_user_qa","intent":"query_schedule","slotsSummary":["studentName","timeReference"]}
2025-08-10 14:59:50  🎯 執行任務: query_schedule
2025-08-10 14:59:50  🎯 開始處理查詢課表任務
2025-08-10 14:59:50  📋 接收參數: { studentName: '小光', timeReference: 'this_week' }
2025-08-10 14:59:50  📅 查詢時間範圍: { startDate: '2025-08-10', endDate: '2025-08-16', description: '本週' }
2025-08-10 14:59:50  📚 查詢到 231 筆課程資料
2025-08-10 14:59:50  ❌ 查詢課表任務失敗: TypeError: firebaseService.getRecurringCoursesByStudent is not a function
2025-08-10 14:59:50      at handle_query_schedule_task (/opt/render/project/src/src/tasks/handle_query_schedule_task.js:304:47)
2025-08-10 14:59:50      at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
2025-08-10 14:59:50      at async executeTask (/opt/render/project/src/src/tasks/index.js:121:16)
2025-08-10 14:59:50      at async handleTextMessage (/opt/render/project/src/src/bot/webhook.js:92:20)
2025-08-10 14:59:50      at async handleWebhook (/opt/render/project/src/src/bot/webhook.js:438:13)
2025-08-10 14:59:50      at async /opt/render/project/src/src/index.js:34:5
2025-08-10 14:59:50  📊 任務執行結果: {
2025-08-10 14:59:50    success: false,
2025-08-10 14:59:50    code: 'QUERY_FAILED',
2025-08-10 14:59:50    message: '❌ 查詢課表失敗，請檢查學生姓名並稍後再試。'
2025-08-10 14:59:50  }
2025-08-10 14:59:50  {"ts":"2025-08-10T14:59:50.334Z","lvl":"info","stage":"task","traceId":"line_1754837988775_3smznw","userId":"U_test_user_qa","intent":"query_schedule","success":false,"code":"QUERY_FAILED","latencyMs":189}
2025-08-10 14:59:50  🔍 檢查 replyToken: test-reply-token-1754837988606
2025-08-10 14:59:50  🧪 檢測到測試 token，跳過真實 LINE API 調用
2025-08-10 14:59:50  📤 [測試模式] 實際業務回覆: ❌ 查詢課表失敗，請檢查學生姓名並稍後再試。
2025-08-10 14:59:50  {"ts":"2025-08-10T14:59:50.616Z","lvl":"info","direction":"outbound","channel":"line","traceId":"line_1754837988775_3smznw","userId":"U_test_user_qa","textOut":"❌ 查詢課表失敗，請檢查學生姓名並稍後再試。","quickReply":false}
2025-08-10 15:00:03  📨 收到 1 個事件
2025-08-10 15:00:03  📋 事件類型: message
2025-08-10 15:00:03  🔍 完整事件 JSON: {
2025-08-10 15:00:03    "type": "message",
2025-08-10 15:00:03    "message": {
2025-08-10 15:00:03      "type": "text",
2025-08-10 15:00:03      "text": "小王今天有什麼課？"
2025-08-10 15:00:03    },
2025-08-10 15:00:03    "source": {
2025-08-10 15:00:03      "userId": "U_test_user_qa",
2025-08-10 15:00:03      "type": "user"
2025-08-10 15:00:03    },
2025-08-10 15:00:03    "replyToken": "test-reply-token-1754838003318",
2025-08-10 15:00:03    "timestamp": 1754838003318
2025-08-10 15:00:03  }
2025-08-10 15:00:03  🧹 檢測到 QA 重置上下文請求，清理用戶上下文: U_test_user_qa
2025-08-10 15:00:03  {"ts":"2025-08-10T15:00:03.503Z","lvl":"info","direction":"inbound","channel":"line","traceId":"line_1754838003503_s2m3uq","userId":"U_test_user_qa","textIn":"小王今天有什麼課？"}
2025-08-10 15:00:03  🔍 用戶ID類型: string
2025-08-10 15:00:03  🔍 是否測試用戶: true
2025-08-10 15:00:03  🚀 生產用戶，使用真實 LINE Service
2025-08-10 15:00:03  🎯 開始解析意圖: 小王今天有什麼課？ (用戶: U_test_user_qa)
2025-08-10 15:00:03  ✅ 規則匹配成功: query_schedule
2025-08-10 15:00:03  {"ts":"2025-08-10T15:00:03.644Z","lvl":"info","stage":"nlp","traceId":"line_1754838003503_s2m3uq","userId":"U_test_user_qa","intent":"query_schedule"}
2025-08-10 15:00:03  🔍 開始提取 slots - 意圖: query_schedule (用戶: U_test_user_qa)
2025-08-10 15:00:03  🧠 使用對話上下文增強 slots 提取
2025-08-10 15:00:03  📨 收到 1 個事件
2025-08-10 15:00:03  📋 事件類型: message
2025-08-10 15:00:03  🔍 完整事件 JSON: {
2025-08-10 15:00:03    "type": "message",
2025-08-10 15:00:03    "message": {
2025-08-10 15:00:03      "type": "text",
2025-08-10 15:00:03      "text": "小王今天有什麼課？"
2025-08-10 15:00:03    },
2025-08-10 15:00:03    "source": {
2025-08-10 15:00:03      "userId": "U_test_user_qa",
2025-08-10 15:00:03      "type": "user"
2025-08-10 15:00:03    },
2025-08-10 15:00:03    "replyToken": "test-reply-token-1754838003318",
2025-08-10 15:00:03    "timestamp": 1754838003318
2025-08-10 15:00:03  }
2025-08-10 15:00:03  🧹 檢測到 QA 重置上下文請求，清理用戶上下文: U_test_user_qa
2025-08-10 15:00:03  {"ts":"2025-08-10T15:00:03.503Z","lvl":"info","direction":"inbound","channel":"line","traceId":"line_1754838003503_s2m3uq","userId":"U_test_user_qa","textIn":"小王今天有什麼課？"}
2025-08-10 15:00:03  🔍 用戶ID類型: string
2025-08-10 15:00:03  🔍 是否測試用戶: true
2025-08-10 15:00:03  🚀 生產用戶，使用真實 LINE Service
2025-08-10 15:00:03  🎯 開始解析意圖: 小王今天有什麼課？ (用戶: U_test_user_qa)
2025-08-10 15:00:03  ✅ 規則匹配成功: query_schedule
2025-08-10 15:00:03  {"ts":"2025-08-10T15:00:03.644Z","lvl":"info","stage":"nlp","traceId":"line_1754838003503_s2m3uq","userId":"U_test_user_qa","intent":"query_schedule"}
2025-08-10 15:00:03  🔍 開始提取 slots - 意圖: query_schedule (用戶: U_test_user_qa)
2025-08-10 15:00:03  🧠 使用對話上下文增強 slots 提取
2025-08-10 15:00:03  📊 規則提取置信度: 1.00
2025-08-10 15:00:03  🤖 啟用 AI 輔助提取...
2025-08-10 15:00:05  ✅ 最終 slots: { studentName: '小王', timeReference: 'today' }
2025-08-10 15:00:05  {"ts":"2025-08-10T15:00:05.289Z","lvl":"info","stage":"slots","traceId":"line_1754838003503_s2m3uq","userId":"U_test_user_qa","intent":"query_schedule","slotsSummary":["studentName","timeReference"]}
2025-08-10 15:00:05  🎯 執行任務: query_schedule
2025-08-10 15:00:05  🎯 開始處理查詢課表任務
2025-08-10 15:00:05  📋 接收參數: { studentName: '小王', timeReference: 'today' }
2025-08-10 15:00:05  📅 查詢時間範圍: { startDate: '2025-08-10', endDate: '2025-08-10', description: '今天' }
2025-08-10 15:00:05  📚 查詢到 0 筆課程資料
2025-08-10 15:00:05  ❌ 查詢課表任務失敗: TypeError: firebaseService.getRecurringCoursesByStudent is not a function
2025-08-10 15:00:05      at handle_query_schedule_task (/opt/render/project/src/src/tasks/handle_query_schedule_task.js:304:47)
2025-08-10 15:00:05      at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
2025-08-10 15:00:05      at async executeTask (/opt/render/project/src/src/tasks/index.js:121:16)
2025-08-10 15:00:05  📊 任務執行結果: {
2025-08-10 15:00:05      at async handleTextMessage (/opt/render/project/src/src/bot/webhook.js:92:20)
2025-08-10 15:00:05      at async handleWebhook (/opt/render/project/src/src/bot/webhook.js:438:13)
2025-08-10 15:00:05      at async /opt/render/project/src/src/index.js:34:5
2025-08-10 15:00:05    success: false,
2025-08-10 15:00:05    code: 'QUERY_FAILED',
2025-08-10 15:00:05    message: '❌ 查詢課表失敗，請檢查學生姓名並稍後再試。'
2025-08-10 15:00:05  }
2025-08-10 15:00:05  {"ts":"2025-08-10T15:00:05.360Z","lvl":"info","stage":"task","traceId":"line_1754838003503_s2m3uq","userId":"U_test_user_qa","intent":"query_schedule","success":false,"code":"QUERY_FAILED","latencyMs":71}
2025-08-10 15:00:05  🔍 檢查 replyToken: test-reply-token-1754838003318
2025-08-10 15:00:05  🧪 檢測到測試 token，跳過真實 LINE API 調用
2025-08-10 15:00:05  📤 [測試模式] 實際業務回覆: ❌ 查詢課表失敗，請檢查學生姓名並稍後再試。
2025-08-10 15:00:05  {"ts":"2025-08-10T15:00:05.641Z","lvl":"info","direction":"outbound","channel":"line","traceId":"line_1754838003503_s2m3uq","userId":"U_test_user_qa","textOut":"❌ 查詢課表失敗，請檢查學生姓名並稍後再試。","quickReply":false}
2025-08-10 15:00:19  📨 收到 1 個事件
2025-08-10 15:00:19  📋 事件類型: message
2025-08-10 15:00:19  🔍 完整事件 JSON: {
2025-08-10 15:00:19    "type": "message",
2025-08-10 15:00:19    "message": {
2025-08-10 15:00:19      "type": "text",
2025-08-10 15:00:19      "text": "小明的數學課什麼時候上？"
2025-08-10 15:00:19    },
2025-08-10 15:00:19    "source": {
2025-08-10 15:00:19      "userId": "U_test_user_qa",
2025-08-10 15:00:19      "type": "user"
2025-08-10 15:00:19    },
2025-08-10 15:00:19    "replyToken": "test-reply-token-1754838019431",
2025-08-10 15:00:19    "timestamp": 1754838019431
2025-08-10 15:00:19  }
2025-08-10 15:00:19  🧹 檢測到 QA 重置上下文請求，清理用戶上下文: U_test_user_qa
2025-08-10 15:00:19  {"ts":"2025-08-10T15:00:19.616Z","lvl":"info","direction":"inbound","channel":"line","traceId":"line_1754838019616_5mcg7z","userId":"U_test_user_qa","textIn":"小明的數學課什麼時候上？"}
2025-08-10 15:00:19  🔍 用戶ID類型: string
2025-08-10 15:00:19  🔍 是否測試用戶: true
2025-08-10 15:00:19  🚀 生產用戶，使用真實 LINE Service
2025-08-10 15:00:19  🎯 開始解析意圖: 小明的數學課什麼時候上？ (用戶: U_test_user_qa)
2025-08-10 15:00:19  🤖 啟用 AI 備援識別...
2025-08-10 15:00:20  🤖 AI 識別意圖: query_schedule 信心度: 1
2025-08-10 15:00:20  {"ts":"2025-08-10T15:00:20.443Z","lvl":"info","stage":"nlp","traceId":"line_1754838019616_5mcg7z","userId":"U_test_user_qa","intent":"query_schedule"}
2025-08-10 15:00:20  🔍 開始提取 slots - 意圖: query_schedule (用戶: U_test_user_qa)
2025-08-10 15:00:20  🧠 使用對話上下文增強 slots 提取
2025-08-10 15:00:20  📊 規則提取置信度: 0.50
2025-08-10 15:00:20  🤖 啟用 AI 輔助提取...
2025-08-10 15:00:21  🔧 自動修正提取結果: [ '移除無效課程名稱（問句殘片）: 課什麼時候上' ]
2025-08-10 15:00:21  ✅ 最終 slots: { studentName: '小明' }
2025-08-10 15:00:21  {"ts":"2025-08-10T15:00:21.961Z","lvl":"info","stage":"slots","traceId":"line_1754838019616_5mcg7z","userId":"U_test_user_qa","intent":"query_schedule","slotsSummary":["studentName"]}
2025-08-10 15:00:21  🎯 執行任務: query_schedule
2025-08-10 15:00:21  🎯 開始處理查詢課表任務
2025-08-10 15:00:21  📋 接收參數: { studentName: '小明' }
2025-08-10 15:00:21  📅 查詢時間範圍: { startDate: '2025-08-10', endDate: '2025-08-16', description: '本週' }
2025-08-10 15:00:22  📚 查詢到 316 筆課程資料
2025-08-10 15:00:22  ❌ 查詢課表任務失敗: TypeError: firebaseService.getRecurringCoursesByStudent is not a function
2025-08-10 15:00:22  📊 任務執行結果: {
2025-08-10 15:00:22    success: false,
2025-08-10 15:00:22    code: 'QUERY_FAILED',
2025-08-10 15:00:22    message: '❌ 查詢課表失敗，請檢查學生姓名並稍後再試。'
2025-08-10 15:00:22  }
2025-08-10 15:00:22  {"ts":"2025-08-10T15:00:22.325Z","lvl":"info","stage":"task","traceId":"line_1754838019616_5mcg7z","userId":"U_test_user_qa","intent":"query_schedule","success":false,"code":"QUERY_FAILED","latencyMs":364}
2025-08-10 15:00:22      at handle_query_schedule_task (/opt/render/project/src/src/tasks/handle_query_schedule_task.js:304:47)
2025-08-10 15:00:22      at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
2025-08-10 15:00:22      at async executeTask (/opt/render/project/src/src/tasks/index.js:121:16)
2025-08-10 15:00:22      at async handleTextMessage (/opt/render/project/src/src/bot/webhook.js:92:20)
2025-08-10 15:00:22      at async handleWebhook (/opt/render/project/src/src/bot/webhook.js:438:13)
2025-08-10 15:00:22      at async /opt/render/project/src/src/index.js:34:5
2025-08-10 15:00:22  📚 查詢到 316 筆課程資料
2025-08-10 15:00:22  ❌ 查詢課表任務失敗: TypeError: firebaseService.getRecurringCoursesByStudent is not a function
2025-08-10 15:00:22  📊 任務執行結果: {
2025-08-10 15:00:22    success: false,
2025-08-10 15:00:22    code: 'QUERY_FAILED',
2025-08-10 15:00:22    message: '❌ 查詢課表失敗，請檢查學生姓名並稍後再試。'
2025-08-10 15:00:22  }
2025-08-10 15:00:22  {"ts":"2025-08-10T15:00:22.325Z","lvl":"info","stage":"task","traceId":"line_1754838019616_5mcg7z","userId":"U_test_user_qa","intent":"query_schedule","success":false,"code":"QUERY_FAILED","latencyMs":364}
2025-08-10 15:00:22      at handle_query_schedule_task (/opt/render/project/src/src/tasks/handle_query_schedule_task.js:304:47)
2025-08-10 15:00:22      at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
2025-08-10 15:00:22      at async executeTask (/opt/render/project/src/src/tasks/index.js:121:16)
2025-08-10 15:00:22      at async handleTextMessage (/opt/render/project/src/src/bot/webhook.js:92:20)
2025-08-10 15:00:22      at async handleWebhook (/opt/render/project/src/src/bot/webhook.js:438:13)
2025-08-10 15:00:22      at async /opt/render/project/src/src/index.js:34:5
2025-08-10 15:00:22  🔍 檢查 replyToken: test-reply-token-1754838019431
2025-08-10 15:00:22  🧪 檢測到測試 token，跳過真實 LINE API 調用
2025-08-10 15:00:22  📤 [測試模式] 實際業務回覆: ❌ 查詢課表失敗，請檢查學生姓名並稍後再試。
2025-08-10 15:00:22  {"ts":"2025-08-10T15:00:22.606Z","lvl":"info","direction":"outbound","channel":"line","traceId":"line_1754838019616_5mcg7z","userId":"U_test_user_qa","textOut":"❌ 查詢課表失敗，請檢查學生姓名並稍後再試。","quickReply":false}
2025-08-10 15:00:35  📨 收到 1 個事件
2025-08-10 15:00:35  📋 事件類型: message
2025-08-10 15:00:35  🔍 完整事件 JSON: {
2025-08-10 15:00:35    "type": "message",
2025-08-10 15:00:35    "message": {
2025-08-10 15:00:35      "type": "text",
2025-08-10 15:00:35      "text": "小明的晨練課每天幾點？"
2025-08-10 15:00:35    },
2025-08-10 15:00:35    "source": {
2025-08-10 15:00:35      "userId": "U_test_user_qa",
2025-08-10 15:00:35      "type": "user"
2025-08-10 15:00:35    },
2025-08-10 15:00:35    "replyToken": "test-reply-token-1754838035378",
2025-08-10 15:00:35    "timestamp": 1754838035378
2025-08-10 15:00:35  }
2025-08-10 15:00:35  🧹 檢測到 QA 重置上下文請求，清理用戶上下文: U_test_user_qa
2025-08-10 15:00:35  {"ts":"2025-08-10T15:00:35.580Z","lvl":"info","direction":"inbound","channel":"line","traceId":"line_1754838035580_qiva53","userId":"U_test_user_qa","textIn":"小明的晨練課每天幾點？"}
2025-08-10 15:00:35  🔍 用戶ID類型: string
2025-08-10 15:00:35  🔍 是否測試用戶: true
2025-08-10 15:00:35  🚀 生產用戶，使用真實 LINE Service
2025-08-10 15:00:35  🎯 開始解析意圖: 小明的晨練課每天幾點？ (用戶: U_test_user_qa)
2025-08-10 15:00:35  🤖 啟用 AI 備援識別...
2025-08-10 15:00:36  🤖 AI 識別意圖: query_schedule 信心度: 1
2025-08-10 15:00:36  {"ts":"2025-08-10T15:00:36.340Z","lvl":"info","stage":"nlp","traceId":"line_1754838035580_qiva53","userId":"U_test_user_qa","intent":"query_schedule"}
2025-08-10 15:00:36  🔍 開始提取 slots - 意圖: query_schedule (用戶: U_test_user_qa)
2025-08-10 15:00:36  🧠 使用對話上下文增強 slots 提取
2025-08-10 15:00:36  📊 規則提取置信度: 0.50
2025-08-10 15:00:36  🤖 啟用 AI 輔助提取...
2025-08-10 15:00:38  ✅ 最終 slots: { studentName: '小明', courseName: '晨練課', scheduleTime: '每天幾點' }
2025-08-10 15:00:38  {"ts":"2025-08-10T15:00:38.421Z","lvl":"info","stage":"slots","traceId":"line_1754838035580_qiva53","userId":"U_test_user_qa","intent":"query_schedule","slotsSummary":["studentName","courseName","scheduleTime"]}
2025-08-10 15:00:38  🎯 執行任務: query_schedule
2025-08-10 15:00:38  🎯 開始處理查詢課表任務
2025-08-10 15:00:38  📋 接收參數: { studentName: '小明', courseName: '晨練課', scheduleTime: '每天幾點' }
2025-08-10 15:00:38  📅 查詢時間範圍: { startDate: '2025-08-10', endDate: '2025-08-16', description: '本週' }
2025-08-10 15:00:38  📚 查詢到 316 筆課程資料
2025-08-10 15:00:38  ❌ 查詢課表任務失敗: TypeError: firebaseService.getRecurringCoursesByStudent is not a function
2025-08-10 15:00:38      at handle_query_schedule_task (/opt/render/project/src/src/tasks/handle_query_schedule_task.js:304:47)
2025-08-10 15:00:38      at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
2025-08-10 15:00:38      at async executeTask (/opt/render/project/src/src/tasks/index.js:121:16)
2025-08-10 15:00:38      at async handleTextMessage (/opt/render/project/src/src/bot/webhook.js:92:20)
2025-08-10 15:00:38      at async handleWebhook (/opt/render/project/src/src/bot/webhook.js:438:13)
2025-08-10 15:00:38      at async /opt/render/project/src/src/index.js:34:5
2025-08-10 15:00:38  📊 任務執行結果: {
2025-08-10 15:00:38    success: false,
2025-08-10 15:00:38    code: 'QUERY_FAILED',
2025-08-10 15:00:38    message: '❌ 查詢課表失敗，請檢查學生姓名並稍後再試。'
2025-08-10 15:00:38  }
2025-08-10 15:00:38  {"ts":"2025-08-10T15:00:38.774Z","lvl":"info","stage":"task","traceId":"line_1754838035580_qiva53","userId":"U_test_user_qa","intent":"query_schedule","success":false,"code":"QUERY_FAILED","latencyMs":353}
2025-08-10 15:00:39  🔍 檢查 replyToken: test-reply-token-1754838035378
2025-08-10 15:00:39  🧪 檢測到測試 token，跳過真實 LINE API 調用
2025-08-10 15:00:39  📤 [測試模式] 實際業務回覆: ❌ 查詢課表失敗，請檢查學生姓名並稍後再試。
2025-08-10 15:00:39  {"ts":"2025-08-10T15:00:39.055Z","lvl":"info","direction":"outbound","channel":"line","traceId":"line_1754838035580_qiva53","userId":"U_test_user_qa","textOut":"❌ 查詢課表失敗，請檢查學生姓名並稍後再試。","quickReply":false}
2025-08-10 15:00:56  📨 收到 1 個事件
2025-08-10 15:00:56  📋 事件類型: message
2025-08-10 15:00:56  🔍 完整事件 JSON: {
2025-08-10 15:00:56    "type": "message",
2025-08-10 15:00:56    "message": {
2025-08-10 15:00:56      "type": "text",
2025-08-10 15:00:56      "text": "查詢Lumi的重複課程"
2025-08-10 15:00:56    },
2025-08-10 15:00:56    "source": {
2025-08-10 15:00:56      "userId": "U_test_user_qa",
2025-08-10 15:00:56      "type": "user"
2025-08-10 15:00:56    },
2025-08-10 15:00:56    "replyToken": "test-reply-token-1754838056040",
2025-08-10 15:00:56    "timestamp": 1754838056040
2025-08-10 15:00:56  }
2025-08-10 15:00:56  🧹 檢測到 QA 重置上下文請求，清理用戶上下文: U_test_user_qa
2025-08-10 15:00:56  {"ts":"2025-08-10T15:00:56.218Z","lvl":"info","direction":"inbound","channel":"line","traceId":"line_1754838056218_qak2k3","userId":"U_test_user_qa","textIn":"查詢Lumi的重複課程"}
2025-08-10 15:00:56  🔍 用戶ID類型: string
2025-08-10 15:00:56  🔍 是否測試用戶: true
2025-08-10 15:00:56  🚀 生產用戶，使用真實 LINE Service
2025-08-10 15:00:56  🎯 開始解析意圖: 查詢Lumi的重複課程 (用戶: U_test_user_qa)
2025-08-10 15:00:56  ✅ 規則匹配成功: query_schedule
2025-08-10 15:00:56  {"ts":"2025-08-10T15:00:56.358Z","lvl":"info","stage":"nlp","traceId":"line_1754838056218_qak2k3","userId":"U_test_user_qa","intent":"query_schedule"}
2025-08-10 15:00:56  🔍 開始提取 slots - 意圖: query_schedule (用戶: U_test_user_qa)
2025-08-10 15:00:56  🧠 使用對話上下文增強 slots 提取
2025-08-10 15:00:56  📊 規則提取置信度: 0.50
2025-08-10 15:00:56  🤖 啟用 AI 輔助提取...
2025-08-10 15:00:58  ✅ 最終 slots: { studentName: 'Lumi', courseName: '重複課' }
2025-08-10 15:00:58  {"ts":"2025-08-10T15:00:58.094Z","lvl":"info","stage":"slots","traceId":"line_1754838056218_qak2k3","userId":"U_test_user_qa","intent":"query_schedule","slotsSummary":["studentName","courseName"]}
2025-08-10 15:00:58  🎯 執行任務: query_schedule
2025-08-10 15:00:58  ✅ 最終 slots: { studentName: 'Lumi', courseName: '重複課' }
2025-08-10 15:00:58  {"ts":"2025-08-10T15:00:58.094Z","lvl":"info","stage":"slots","traceId":"line_1754838056218_qak2k3","userId":"U_test_user_qa","intent":"query_schedule","slotsSummary":["studentName","courseName"]}
2025-08-10 15:00:58  🎯 執行任務: query_schedule
2025-08-10 15:00:58  🎯 開始處理查詢課表任務
2025-08-10 15:00:58  📋 接收參數: { studentName: 'Lumi', courseName: '重複課' }
2025-08-10 15:00:58  📅 查詢時間範圍: { startDate: '2025-08-10', endDate: '2025-08-16', description: '本週' }
2025-08-10 15:00:58  📚 查詢到 312 筆課程資料
2025-08-10 15:00:58  ❌ 查詢課表任務失敗: TypeError: firebaseService.getRecurringCoursesByStudent is not a function
2025-08-10 15:00:58      at handle_query_schedule_task (/opt/render/project/src/src/tasks/handle_query_schedule_task.js:304:47)
2025-08-10 15:00:58      at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
2025-08-10 15:00:58      at async executeTask (/opt/render/project/src/src/tasks/index.js:121:16)
2025-08-10 15:00:58      at async handleTextMessage (/opt/render/project/src/src/bot/webhook.js:92:20)
2025-08-10 15:00:58      at async handleWebhook (/opt/render/project/src/src/bot/webhook.js:438:13)
2025-08-10 15:00:58      at async /opt/render/project/src/src/index.js:34:5
2025-08-10 15:00:58  📊 任務執行結果: {
2025-08-10 15:00:58    success: false,
2025-08-10 15:00:58    code: 'QUERY_FAILED',
2025-08-10 15:00:58    message: '❌ 查詢課表失敗，請檢查學生姓名並稍後再試。'
2025-08-10 15:00:58  }
2025-08-10 15:00:58  {"ts":"2025-08-10T15:00:58.257Z","lvl":"info","stage":"task","traceId":"line_1754838056218_qak2k3","userId":"U_test_user_qa","intent":"query_schedule","success":false,"code":"QUERY_FAILED","latencyMs":163}
2025-08-10 15:00:58  🔍 檢查 replyToken: test-reply-token-1754838056040
2025-08-10 15:00:58  🧪 檢測到測試 token，跳過真實 LINE API 調用
2025-08-10 15:00:58  📤 [測試模式] 實際業務回覆: ❌ 查詢課表失敗，請檢查學生姓名並稍後再試。
2025-08-10 15:00:58  {"ts":"2025-08-10T15:00:58.541Z","lvl":"info","direction":"outbound","channel":"line","traceId":"line_1754838056218_qak2k3","userId":"U_test_user_qa","textOut":"❌ 查詢課表失敗，請檢查學生姓名並稍後再試。","quickReply":false}
2025-08-10 15:01:11  📨 收到 1 個事件
2025-08-10 15:01:11  📋 事件類型: message
2025-08-10 15:01:11  🔍 完整事件 JSON: {
2025-08-10 15:01:11    "type": "message",
2025-08-10 15:01:11    "message": {
2025-08-10 15:01:11      "type": "text",
2025-08-10 15:01:11      "text": "今天小明的數學課學了分數加減法"
2025-08-10 15:01:11    },
2025-08-10 15:01:11    "source": {
2025-08-10 15:01:11      "userId": "U_test_user_qa",
2025-08-10 15:01:11      "type": "user"
2025-08-10 15:01:11    },
2025-08-10 15:01:11    "replyToken": "test-reply-token-1754838071315",
2025-08-10 15:01:11    "timestamp": 1754838071315
2025-08-10 15:01:11  }
2025-08-10 15:01:11  🧹 檢測到 QA 重置上下文請求，清理用戶上下文: U_test_user_qa
2025-08-10 15:01:11  {"ts":"2025-08-10T15:01:11.601Z","lvl":"info","direction":"inbound","channel":"line","traceId":"line_1754838071601_147xpt","userId":"U_test_user_qa","textIn":"今天小明的數學課學了分數加減法"}
2025-08-10 15:01:11  🔍 用戶ID類型: string
2025-08-10 15:01:11  🔍 是否測試用戶: true
2025-08-10 15:01:11  🚀 生產用戶，使用真實 LINE Service
2025-08-10 15:01:11  🎯 開始解析意圖: 今天小明的數學課學了分數加減法 (用戶: U_test_user_qa)
2025-08-10 15:01:11  📝 內容記錄優先規則命中 → record_content
2025-08-10 15:01:11  {"ts":"2025-08-10T15:01:11.741Z","lvl":"info","stage":"nlp","traceId":"line_1754838071601_147xpt","userId":"U_test_user_qa","intent":"record_content"}
2025-08-10 15:01:11  🔍 開始提取 slots - 意圖: record_content (用戶: U_test_user_qa)
2025-08-10 15:01:12  🧠 使用對話上下文增強 slots 提取
2025-08-10 15:01:12  📊 規則提取置信度: 1.00
2025-08-10 15:01:12  🤖 啟用 AI 輔助提取...
2025-08-10 15:01:13  ✅ 最終 slots: {
2025-08-10 15:01:13    studentName: '小明',
2025-08-10 15:01:13    courseName: '數學課',
2025-08-10 15:01:13    timeReference: 'today',
2025-08-10 15:01:13    content: '分數加減法'
2025-08-10 15:01:13  }
2025-08-10 15:01:13  {"ts":"2025-08-10T15:01:13.329Z","lvl":"info","stage":"slots","traceId":"line_1754838071601_147xpt","userId":"U_test_user_qa","intent":"record_content","slotsSummary":["studentName","courseName","timeReference","content"]}
2025-08-10 15:01:13  🎯 執行任務: record_content
2025-08-10 15:01:13  📝 開始處理記錄課程內容任務: {
2025-08-10 15:01:13    studentName: '小明',
2025-08-10 15:01:13    courseName: '數學課',
2025-08-10 15:01:13    timeReference: 'today',
2025-08-10 15:01:13    content: '分數加減法'
2025-08-10 15:01:13  }
2025-08-10 15:01:13  🔍 查找課程: 小明 - 數學課 - 2025-08-10
2025-08-10 15:01:13  ✅ 找到匹配的單次課程: 0HR56QmxvJyJ6QSsvkVe
2025-08-10 15:01:13  ✅ 文檔已添加到 course_contents: 8yuX6Id3sS0OuC6Y5VkJ
2025-08-10 15:01:13  ✅ 課程內容記錄已儲存: 8yuX6Id3sS0OuC6Y5VkJ
2025-08-10 15:01:13  ✅ 文檔已更新 (courses/0HR56QmxvJyJ6QSsvkVe)
2025-08-10 15:01:13  📊 任務執行結果: {
2025-08-10 15:01:13    success: true,
2025-08-10 15:01:13    code: 'RECORD_CONTENT_OK',
2025-08-10 15:01:13    message: '✅ 課程內容已成功記錄！\n📚 課程：小明 - 數學課\n📅 日期：2025-08-10\n💬 內容：分數加減法',
2025-08-10 15:01:13    data: {
2025-08-10 15:01:13      recordId: '8yuX6Id3sS0OuC6Y5VkJ',
2025-08-10 15:01:13      courseId: '0HR56QmxvJyJ6QSsvkVe',
2025-08-10 15:01:13      targetDate: '2025-08-10'
2025-08-10 15:01:13    }
2025-08-10 15:01:13  }
2025-08-10 15:01:13  {"ts":"2025-08-10T15:01:13.868Z","lvl":"info","stage":"task","traceId":"line_1754838071601_147xpt","userId":"U_test_user_qa","intent":"record_content","success":true,"code":"RECORD_CONTENT_OK","latencyMs":539}
2025-08-10 15:01:14  🔍 檢查 replyToken: test-reply-token-1754838071315
2025-08-10 15:01:14  🧪 檢測到測試 token，跳過真實 LINE API 調用
2025-08-10 15:01:14  📤 [測試模式] 實際業務回覆: ✅ 課程內容已成功記錄！
2025-08-10 15:01:14  📚 課程：小明 - 數學課
2025-08-10 15:01:14  📅 日期：2025-08-10
2025-08-10 15:01:14  💬 內容：分數加減法
2025-08-10 15:01:14  {"ts":"2025-08-10T15:01:14.149Z","lvl":"info","direction":"outbound","channel":"line","traceId":"line_1754838071601_147xpt","userId":"U_test_user_qa","textOut":"✅ 課程內容已成功記錄！\n📚 課程：小明 - 數學課\n📅 日期：2025-08-10\n💬 內容：分數加減法","quickReply":true}
2025-08-10 15:01:26  📨 收到 1 個事件
2025-08-10 15:01:26  📋 事件類型: message
2025-08-10 15:01:26  🔍 完整事件 JSON: {
2025-08-10 15:01:26    "type": "message",
2025-08-10 15:01:26    "message": {
2025-08-10 15:01:26      "type": "text",
2025-08-10 15:01:26      "text": "補記一下昨天Lumi鋼琴課的內容，練習了小星星"
2025-08-10 15:01:26    },
2025-08-10 15:01:26    "source": {
2025-08-10 15:01:26      "userId": "U_test_user_qa",
2025-08-10 15:01:26      "type": "user"
2025-08-10 15:01:26    },
2025-08-10 15:01:26  📨 收到 1 個事件
2025-08-10 15:01:26  📋 事件類型: message
2025-08-10 15:01:26  🔍 完整事件 JSON: {
2025-08-10 15:01:26    "type": "message",
2025-08-10 15:01:26    "message": {
2025-08-10 15:01:26      "type": "text",
2025-08-10 15:01:26      "text": "補記一下昨天Lumi鋼琴課的內容，練習了小星星"
2025-08-10 15:01:26    },
2025-08-10 15:01:26    "source": {
2025-08-10 15:01:26      "userId": "U_test_user_qa",
2025-08-10 15:01:26      "type": "user"
2025-08-10 15:01:26    },
2025-08-10 15:01:26    "replyToken": "test-reply-token-1754838086879",
2025-08-10 15:01:26    "timestamp": 1754838086879
2025-08-10 15:01:26  }
2025-08-10 15:01:26  🧹 檢測到 QA 重置上下文請求，清理用戶上下文: U_test_user_qa
2025-08-10 15:01:27  {"ts":"2025-08-10T15:01:27.050Z","lvl":"info","direction":"inbound","channel":"line","traceId":"line_1754838087050_boksn3","userId":"U_test_user_qa","textIn":"補記一下昨天Lumi鋼琴課的內容，練習了小星星"}
2025-08-10 15:01:27  🔍 用戶ID類型: string
2025-08-10 15:01:27  🔍 是否測試用戶: true
2025-08-10 15:01:27  🚀 生產用戶，使用真實 LINE Service
2025-08-10 15:01:27  🎯 開始解析意圖: 補記一下昨天Lumi鋼琴課的內容，練習了小星星 (用戶: U_test_user_qa)
2025-08-10 15:01:27  📝 內容記錄優先規則命中 → record_content
2025-08-10 15:01:27  {"ts":"2025-08-10T15:01:27.191Z","lvl":"info","stage":"nlp","traceId":"line_1754838087050_boksn3","userId":"U_test_user_qa","intent":"record_content"}
2025-08-10 15:01:27  🔍 開始提取 slots - 意圖: record_content (用戶: U_test_user_qa)
2025-08-10 15:01:27  📊 規則提取置信度: 0.33
2025-08-10 15:01:27  🔄 規則提取信心度低，AI 輔助增強...
2025-08-10 15:01:29  ✅ 最終 slots: { courseName: '鋼琴課', timeReference: 'yesterday', content: '練習了小星星' }
2025-08-10 15:01:29  {"ts":"2025-08-10T15:01:29.135Z","lvl":"info","stage":"slots","traceId":"line_1754838087050_boksn3","userId":"U_test_user_qa","intent":"record_content","slotsSummary":["courseName","timeReference","content"]}
2025-08-10 15:01:29  🎯 執行任務: record_content
2025-08-10 15:01:29  📝 開始處理記錄課程內容任務: { courseName: '鋼琴課', timeReference: 'yesterday', content: '練習了小星星' }
2025-08-10 15:01:29  ✅ 文檔已添加到 course_contents: E0elgzriWKAvzLXtC8o9
2025-08-10 15:01:29  ✅ 課程內容記錄已儲存: E0elgzriWKAvzLXtC8o9
2025-08-10 15:01:29  📊 任務執行結果: {
2025-08-10 15:01:29    success: true,
2025-08-10 15:01:29    code: 'RECORD_CONTENT_OK',
2025-08-10 15:01:29    message: '✅ 課程內容已成功記錄！\n📝 記錄為獨立內容\n📚 課程：鋼琴課\n📅 日期：2025-08-09\n💬 內容：練習了小星星',
2025-08-10 15:01:29    data: {
2025-08-10 15:01:29      recordId: 'E0elgzriWKAvzLXtC8o9',
2025-08-10 15:01:29      courseId: null,
2025-08-10 15:01:29      targetDate: '2025-08-09'
2025-08-10 15:01:29    }
2025-08-10 15:01:29  }
2025-08-10 15:01:29  {"ts":"2025-08-10T15:01:29.229Z","lvl":"info","stage":"task","traceId":"line_1754838087050_boksn3","userId":"U_test_user_qa","intent":"record_content","success":true,"code":"RECORD_CONTENT_OK","latencyMs":93}
2025-08-10 15:01:29  🔍 檢查 replyToken: test-reply-token-1754838086879
2025-08-10 15:01:29  🧪 檢測到測試 token，跳過真實 LINE API 調用
2025-08-10 15:01:29  📤 [測試模式] 實際業務回覆: ✅ 課程內容已成功記錄！
2025-08-10 15:01:29  📝 記錄為獨立內容
2025-08-10 15:01:29  📚 課程：鋼琴課
2025-08-10 15:01:29  📅 日期：2025-08-09
2025-08-10 15:01:29  💬 內容：練習了小星星
2025-08-10 15:01:29  {"ts":"2025-08-10T15:01:29.510Z","lvl":"info","direction":"outbound","channel":"line","traceId":"line_1754838087050_boksn3","userId":"U_test_user_qa","textOut":"✅ 課程內容已成功記錄！\n📝 記錄為獨立內容\n📚 課程：鋼琴課\n📅 日期：2025-08-09\n💬 內容：練習了小星星","quickReply":true}
2025-08-10 15:01:42  📨 收到 1 個事件
2025-08-10 15:01:42  📋 事件類型: message
2025-08-10 15:01:42  🔍 完整事件 JSON: {
2025-08-10 15:01:42    "type": "message",
2025-08-10 15:01:42    "message": {
2025-08-10 15:01:42      "type": "text",
2025-08-10 15:01:42      "text": "小明昨天數學課學了什麼？"
2025-08-10 15:01:42    },
2025-08-10 15:01:42    "source": {
2025-08-10 15:01:42      "userId": "U_test_user_qa",
2025-08-10 15:01:42      "type": "user"
2025-08-10 15:01:42    },
2025-08-10 15:01:42    "replyToken": "test-reply-token-1754838102174",
2025-08-10 15:01:42    "timestamp": 1754838102174
2025-08-10 15:01:42  }
2025-08-10 15:01:42  🧹 檢測到 QA 重置上下文請求，清理用戶上下文: U_test_user_qa
2025-08-10 15:01:42  {"ts":"2025-08-10T15:01:42.379Z","lvl":"info","direction":"inbound","channel":"line","traceId":"line_1754838102379_qcswau","userId":"U_test_user_qa","textIn":"小明昨天數學課學了什麼？"}
2025-08-10 15:01:42  🔍 用戶ID類型: string
2025-08-10 15:01:42  🔍 是否測試用戶: true
2025-08-10 15:01:42  🚀 生產用戶，使用真實 LINE Service
2025-08-10 15:01:42  🎯 開始解析意圖: 小明昨天數學課學了什麼？ (用戶: U_test_user_qa)
2025-08-10 15:01:42  📝 內容記錄優先規則命中 → record_content
2025-08-10 15:01:42  {"ts":"2025-08-10T15:01:42.519Z","lvl":"info","stage":"nlp","traceId":"line_1754838102379_qcswau","userId":"U_test_user_qa","intent":"record_content"}
2025-08-10 15:01:42  🔍 開始提取 slots - 意圖: record_content (用戶: U_test_user_qa)
2025-08-10 15:01:42  📊 規則提取置信度: 0.67
2025-08-10 15:01:42  🤖 啟用 AI 輔助提取...
2025-08-10 15:01:43  ✅ 最終 slots: {
2025-08-10 15:01:43    studentName: '小明',
2025-08-10 15:01:43    courseName: '數學課',
2025-08-10 15:01:43    timeReference: 'yesterday',
2025-08-10 15:01:43    content: '什麼？'
2025-08-10 15:01:43  }
2025-08-10 15:01:43  {"ts":"2025-08-10T15:01:43.810Z","lvl":"info","stage":"slots","traceId":"line_1754838102379_qcswau","userId":"U_test_user_qa","intent":"record_content","slotsSummary":["studentName","courseName","timeReference","content"]}
2025-08-10 15:01:43  🎯 執行任務: record_content
2025-08-10 15:01:43  📝 開始處理記錄課程內容任務: {
2025-08-10 15:01:43    studentName: '小明',
2025-08-10 15:01:43    courseName: '數學課',
2025-08-10 15:01:43    timeReference: 'yesterday',
2025-08-10 15:01:43    content: '什麼？'
2025-08-10 15:01:43  }
2025-08-10 15:01:43  🔍 查找課程: 小明 - 數學課 - 2025-08-09
2025-08-10 15:01:43  ❓ 未找到完全匹配的課程
2025-08-10 15:01:44  ✅ 文檔已添加到 course_contents: 90dLksJ6l2itaUcQzWh4
2025-08-10 15:01:44  ✅ 課程內容記錄已儲存: 90dLksJ6l2itaUcQzWh4
2025-08-10 15:01:44  📊 任務執行結果: {
2025-08-10 15:01:44    success: true,
2025-08-10 15:01:44    code: 'RECORD_CONTENT_OK',
2025-08-10 15:01:44    message: '✅ 課程內容已成功記錄！\n📝 記錄為獨立內容\n👨‍🎓 學生：小明\n📚 課程：數學課\n📅 日期：2025-08-09\n💬 內容：什麼？',
2025-08-10 15:01:44    data: {
2025-08-10 15:01:44  ✅ 文檔已添加到 course_contents: 90dLksJ6l2itaUcQzWh4
2025-08-10 15:01:44  ✅ 課程內容記錄已儲存: 90dLksJ6l2itaUcQzWh4
2025-08-10 15:01:44  📊 任務執行結果: {
2025-08-10 15:01:44    success: true,
2025-08-10 15:01:44    code: 'RECORD_CONTENT_OK',
2025-08-10 15:01:44    message: '✅ 課程內容已成功記錄！\n📝 記錄為獨立內容\n👨‍🎓 學生：小明\n📚 課程：數學課\n📅 日期：2025-08-09\n💬 內容：什麼？',
2025-08-10 15:01:44    data: {
2025-08-10 15:01:44      recordId: '90dLksJ6l2itaUcQzWh4',
2025-08-10 15:01:44      courseId: null,
2025-08-10 15:01:44      targetDate: '2025-08-09'
2025-08-10 15:01:44    }
2025-08-10 15:01:44  }
2025-08-10 15:01:44  {"ts":"2025-08-10T15:01:44.049Z","lvl":"info","stage":"task","traceId":"line_1754838102379_qcswau","userId":"U_test_user_qa","intent":"record_content","success":true,"code":"RECORD_CONTENT_OK","latencyMs":239}
2025-08-10 15:01:44  🔍 檢查 replyToken: test-reply-token-1754838102174
2025-08-10 15:01:44  🧪 檢測到測試 token，跳過真實 LINE API 調用
2025-08-10 15:01:44  📤 [測試模式] 實際業務回覆: ✅ 課程內容已成功記錄！
2025-08-10 15:01:44  📝 記錄為獨立內容
2025-08-10 15:01:44  👨‍🎓 學生：小明
2025-08-10 15:01:44  📚 課程：數學課
2025-08-10 15:01:44  📅 日期：2025-08-09
2025-08-10 15:01:44  💬 內容：什麼？
2025-08-10 15:01:44  {"ts":"2025-08-10T15:01:44.330Z","lvl":"info","direction":"outbound","channel":"line","traceId":"line_1754838102379_qcswau","userId":"U_test_user_qa","textOut":"✅ 課程內容已成功記錄！\n📝 記錄為獨立內容\n👨‍🎓 學生：小明\n📚 課程：數學課\n📅 日期：2025-08-09\n💬 內容：什麼？","quickReply":true}
2025-08-10 15:01:51  📨 收到 1 個事件
2025-08-10 15:01:51  📋 事件類型: message
2025-08-10 15:01:51  🔍 完整事件 JSON: {
2025-08-10 15:01:51    "type": "message",
2025-08-10 15:01:51    "message": {
2025-08-10 15:01:51      "type": "text",
2025-08-10 15:01:51      "text": "記錄小明今天化學課的內容"
2025-08-10 15:01:51    },
2025-08-10 15:01:51    "source": {
2025-08-10 15:01:51      "userId": "U_test_user_qa",
2025-08-10 15:01:51      "type": "user"
2025-08-10 15:01:51    },
2025-08-10 15:01:51    "replyToken": "test-reply-token-1754838111445",
2025-08-10 15:01:51    "timestamp": 1754838111445
2025-08-10 15:01:51  }
2025-08-10 15:01:51  🧹 檢測到 QA 重置上下文請求，清理用戶上下文: U_test_user_qa
2025-08-10 15:01:51  {"ts":"2025-08-10T15:01:51.617Z","lvl":"info","direction":"inbound","channel":"line","traceId":"line_1754838111617_rq7501","userId":"U_test_user_qa","textIn":"記錄小明今天化學課的內容"}
2025-08-10 15:01:51  🔍 用戶ID類型: string
2025-08-10 15:01:51  🔍 是否測試用戶: true
2025-08-10 15:01:51  🚀 生產用戶，使用真實 LINE Service
2025-08-10 15:01:51  🎯 開始解析意圖: 記錄小明今天化學課的內容 (用戶: U_test_user_qa)
2025-08-10 15:01:51  📝 內容記錄優先規則命中 → record_content
2025-08-10 15:01:51  {"ts":"2025-08-10T15:01:51.758Z","lvl":"info","stage":"nlp","traceId":"line_1754838111617_rq7501","userId":"U_test_user_qa","intent":"record_content"}
2025-08-10 15:01:51  🔍 開始提取 slots - 意圖: record_content (用戶: U_test_user_qa)
2025-08-10 15:01:52  📊 規則提取置信度: 0.67
2025-08-10 15:01:52  🤖 啟用 AI 輔助提取...
2025-08-10 15:01:53  ✅ 最終 slots: {
2025-08-10 15:01:53    studentName: '小明',
2025-08-10 15:01:53    courseName: '化學課',
2025-08-10 15:01:53    timeReference: 'today',
2025-08-10 15:01:53    content: '小明今天化學課的內容'
2025-08-10 15:01:53  }
2025-08-10 15:01:53  {"ts":"2025-08-10T15:01:53.391Z","lvl":"info","stage":"slots","traceId":"line_1754838111617_rq7501","userId":"U_test_user_qa","intent":"record_content","slotsSummary":["studentName","courseName","timeReference","content"]}
2025-08-10 15:01:53  🎯 執行任務: record_content
2025-08-10 15:01:53  📝 開始處理記錄課程內容任務: {
2025-08-10 15:01:53    studentName: '小明',
2025-08-10 15:01:53    courseName: '化學課',
2025-08-10 15:01:53    timeReference: 'today',
2025-08-10 15:01:53    content: '小明今天化學課的內容'
2025-08-10 15:01:53  }
2025-08-10 15:01:53  🔍 查找課程: 小明 - 化學課 - 2025-08-10
2025-08-10 15:01:53  ❓ 未找到完全匹配的課程
2025-08-10 15:01:53  ✅ 文檔已添加到 course_contents: V19gSbOV0SN4NGSvMVCV
2025-08-10 15:01:53  ✅ 課程內容記錄已儲存: V19gSbOV0SN4NGSvMVCV
2025-08-10 15:01:53  📊 任務執行結果: {
2025-08-10 15:01:53    success: true,
2025-08-10 15:01:53    code: 'RECORD_CONTENT_OK',
2025-08-10 15:01:53    message: '✅ 課程內容已成功記錄！\n' +
2025-08-10 15:01:53      '📝 記錄為獨立內容\n' +
2025-08-10 15:01:53      '👨‍🎓 學生：小明\n' +
2025-08-10 15:01:53      '📚 課程：化學課\n' +
2025-08-10 15:01:53      '📅 日期：2025-08-10\n' +
2025-08-10 15:01:53      '💬 內容：小明今天化學課的內容',
2025-08-10 15:01:53    data: {
2025-08-10 15:01:53      recordId: 'V19gSbOV0SN4NGSvMVCV',
2025-08-10 15:01:53      courseId: null,
2025-08-10 15:01:53      targetDate: '2025-08-10'
2025-08-10 15:01:53    }
2025-08-10 15:01:53  }
2025-08-10 15:01:53  {"ts":"2025-08-10T15:01:53.685Z","lvl":"info","stage":"task","traceId":"line_1754838111617_rq7501","userId":"U_test_user_qa","intent":"record_content","success":true,"code":"RECORD_CONTENT_OK","latencyMs":294}
2025-08-10 15:01:53  🔍 檢查 replyToken: test-reply-token-1754838111445
2025-08-10 15:01:53  🧪 檢測到測試 token，跳過真實 LINE API 調用
2025-08-10 15:01:53  📤 [測試模式] 實際業務回覆: ✅ 課程內容已成功記錄！
2025-08-10 15:01:53  📝 記錄為獨立內容
2025-08-10 15:01:53  👨‍🎓 學生：小明
2025-08-10 15:01:53  📚 課程：化學課
2025-08-10 15:01:53  📅 日期：2025-08-10
2025-08-10 15:01:53  💬 內容：小明今天化學課的內容
2025-08-10 15:01:53  {"ts":"2025-08-10T15:01:53.966Z","lvl":"info","direction":"outbound","channel":"line","traceId":"line_1754838111617_rq7501","userId":"U_test_user_qa","textOut":"✅ 課程內容已成功記錄！\n📝 記錄為獨立內容\n👨‍🎓 學生：小明\n📚 課程：化學課\n📅 日期：2025-08-10\n💬 內容：小明今天化學課的內容","quickReply":true}
2025-08-10 15:02:06  📨 收到 1 個事件
2025-08-10 15:02:06  📋 事件類型: message
2025-08-10 15:02:06  🔍 完整事件 JSON: {
2025-08-10 15:02:06    "type": "message",
2025-08-10 15:02:06    "message": {
2025-08-10 15:02:06      "type": "text",
2025-08-10 15:02:06      "text": "提醒我小明的數學課"
2025-08-10 15:02:06    },
2025-08-10 15:02:06    "source": {
2025-08-10 15:02:06  📨 收到 1 個事件
2025-08-10 15:02:06  📋 事件類型: message
2025-08-10 15:02:06  🔍 完整事件 JSON: {
2025-08-10 15:02:06    "type": "message",
2025-08-10 15:02:06    "message": {
2025-08-10 15:02:06      "type": "text",
2025-08-10 15:02:06      "text": "提醒我小明的數學課"
2025-08-10 15:02:06    },
2025-08-10 15:02:06    "source": {
2025-08-10 15:02:06      "userId": "U_test_user_qa",
2025-08-10 15:02:06      "type": "user"
2025-08-10 15:02:06    },
2025-08-10 15:02:06    "replyToken": "test-reply-token-1754838126622",
2025-08-10 15:02:06    "timestamp": 1754838126622
2025-08-10 15:02:06  }
2025-08-10 15:02:06  🧹 檢測到 QA 重置上下文請求，清理用戶上下文: U_test_user_qa
2025-08-10 15:02:06  {"ts":"2025-08-10T15:02:06.809Z","lvl":"info","direction":"inbound","channel":"line","traceId":"line_1754838126809_gn1clj","userId":"U_test_user_qa","textIn":"提醒我小明的數學課"}
2025-08-10 15:02:06  🔍 用戶ID類型: string
2025-08-10 15:02:06  🔍 是否測試用戶: true
2025-08-10 15:02:06  🚀 生產用戶，使用真實 LINE Service
2025-08-10 15:02:06  🎯 開始解析意圖: 提醒我小明的數學課 (用戶: U_test_user_qa)
2025-08-10 15:02:06  ✅ 規則匹配成功: set_reminder
2025-08-10 15:02:06  {"ts":"2025-08-10T15:02:06.950Z","lvl":"info","stage":"nlp","traceId":"line_1754838126809_gn1clj","userId":"U_test_user_qa","intent":"set_reminder"}
2025-08-10 15:02:07  🔍 開始提取 slots - 意圖: set_reminder (用戶: U_test_user_qa)
2025-08-10 15:02:07  🧠 使用對話上下文增強 slots 提取
2025-08-10 15:02:07  📊 規則提取置信度: 0.67
2025-08-10 15:02:07  🤖 啟用 AI 輔助提取...
2025-08-10 15:02:09  ✅ 最終 slots: { studentName: '小明', courseName: '數學課' }
2025-08-10 15:02:09  {"ts":"2025-08-10T15:02:09.270Z","lvl":"info","stage":"slots","traceId":"line_1754838126809_gn1clj","userId":"U_test_user_qa","intent":"set_reminder","slotsSummary":["studentName","courseName"]}
2025-08-10 15:02:09  🎯 執行任務: set_reminder
2025-08-10 15:02:09  🔔 開始處理設定提醒任務: { studentName: '小明', courseName: '數學課' }
2025-08-10 15:02:09  📚 找到課程: 小明 的 數學課 (2025-08-11 14:00)
2025-08-10 15:02:09  📅 課程時間: 2025/8/11 下午2:00:00
2025-08-10 15:02:09  ⏰ 提醒時間: 2025/8/11 下午1:30:00
2025-08-10 15:02:09  ✅ 提醒記錄已創建: e3Mi5H7FEiaAEalyW3uN
2025-08-10 15:02:09  ✅ 提醒設定成功: e3Mi5H7FEiaAEalyW3uN
2025-08-10 15:02:09  📊 任務執行結果: {
2025-08-10 15:02:09    success: true,
2025-08-10 15:02:09    code: 'REMINDER_SET_OK',
2025-08-10 15:02:09    message: '✅ 提醒設定完成！\n' +
2025-08-10 15:02:09      '📚 課程：小明 的 數學課\n' +
2025-08-10 15:02:09      '📅 上課時間：8/11 下午02:00\n' +
2025-08-10 15:02:09      '⏰ 提醒時間：8/11 下午01:30 (提前 30 分鐘)'
2025-08-10 15:02:09  }
2025-08-10 15:02:09  {"ts":"2025-08-10T15:02:09.669Z","lvl":"info","stage":"task","traceId":"line_1754838126809_gn1clj","userId":"U_test_user_qa","intent":"set_reminder","success":true,"code":"REMINDER_SET_OK","latencyMs":398}
2025-08-10 15:02:09  🔍 檢查 replyToken: test-reply-token-1754838126622
2025-08-10 15:02:09  🧪 檢測到測試 token，跳過真實 LINE API 調用
2025-08-10 15:02:09  📤 [測試模式] 實際業務回覆: ✅ 提醒設定完成！
2025-08-10 15:02:09  📚 課程：小明 的 數學課
2025-08-10 15:02:09  📅 上課時間：8/11 下午02:00
2025-08-10 15:02:09  ⏰ 提醒時間：8/11 下午01:30 (提前 30 分鐘)
2025-08-10 15:02:09  {"ts":"2025-08-10T15:02:09.950Z","lvl":"info","direction":"outbound","channel":"line","traceId":"line_1754838126809_gn1clj","userId":"U_test_user_qa","textOut":"✅ 提醒設定完成！\n📚 課程：小明 的 數學課\n📅 上課時間：8/11 下午02:00\n⏰ 提醒時間：8/11 下午01:30 (提前 30 分鐘)","quickReply":true}
2025-08-10 15:02:22  📨 收到 1 個事件
2025-08-10 15:02:22  📋 事件類型: message
2025-08-10 15:02:22  🔍 完整事件 JSON: {
2025-08-10 15:02:22    "type": "message",
2025-08-10 15:02:22    "message": {
2025-08-10 15:02:22      "type": "text",
2025-08-10 15:02:22      "text": "Lumi鋼琴課前1小時提醒我"
2025-08-10 15:02:22    },
2025-08-10 15:02:22    "source": {
2025-08-10 15:02:22      "userId": "U_test_user_qa",
2025-08-10 15:02:22      "type": "user"
2025-08-10 15:02:22    },
2025-08-10 15:02:22    "replyToken": "test-reply-token-1754838142796",
2025-08-10 15:02:22    "timestamp": 1754838142796
2025-08-10 15:02:22  }
2025-08-10 15:02:22  🧹 檢測到 QA 重置上下文請求，清理用戶上下文: U_test_user_qa
2025-08-10 15:02:23  {"ts":"2025-08-10T15:02:23.012Z","lvl":"info","direction":"inbound","channel":"line","traceId":"line_1754838143012_1qylna","userId":"U_test_user_qa","textIn":"Lumi鋼琴課前1小時提醒我"}
2025-08-10 15:02:23  🔍 用戶ID類型: string
2025-08-10 15:02:23  🔍 是否測試用戶: true
2025-08-10 15:02:23  🚀 生產用戶，使用真實 LINE Service
2025-08-10 15:02:23  🎯 開始解析意圖: Lumi鋼琴課前1小時提醒我 (用戶: U_test_user_qa)
2025-08-10 15:02:23  ✅ 規則匹配成功: set_reminder
2025-08-10 15:02:23  {"ts":"2025-08-10T15:02:23.153Z","lvl":"info","stage":"nlp","traceId":"line_1754838143012_1qylna","userId":"U_test_user_qa","intent":"set_reminder"}
2025-08-10 15:02:23  🔍 開始提取 slots - 意圖: set_reminder (用戶: U_test_user_qa)
2025-08-10 15:02:23  📊 規則提取置信度: 0.67
2025-08-10 15:02:23  🤖 啟用 AI 輔助提取...
2025-08-10 15:02:24  ✅ 最終 slots: { courseName: '鋼琴課', timeReference: '前', reminderTime: 60 }
2025-08-10 15:02:24  {"ts":"2025-08-10T15:02:24.904Z","lvl":"info","stage":"slots","traceId":"line_1754838143012_1qylna","userId":"U_test_user_qa","intent":"set_reminder","slotsSummary":["courseName","timeReference","reminderTime"]}
2025-08-10 15:02:24  🎯 執行任務: set_reminder
2025-08-10 15:02:24  🔔 開始處理設定提醒任務: { courseName: '鋼琴課', timeReference: '前', reminderTime: 60 }
2025-08-10 15:02:24  📊 任務執行結果: {
2025-08-10 15:02:24    success: false,
2025-08-10 15:02:24    code: 'MISSING_STUDENT',
2025-08-10 15:02:24    message: '❌ 請提供學生姓名，例如：「提醒我小明的數學課」'
2025-08-10 15:02:24  }
2025-08-10 15:02:24  {"ts":"2025-08-10T15:02:24.904Z","lvl":"info","stage":"task","traceId":"line_1754838143012_1qylna","userId":"U_test_user_qa","intent":"set_reminder","success":false,"code":"MISSING_STUDENT","latencyMs":0}
2025-08-10 15:02:25  🔍 檢查 replyToken: test-reply-token-1754838142796
2025-08-10 15:02:25  🧪 檢測到測試 token，跳過真實 LINE API 調用
2025-08-10 15:02:25  📤 [測試模式] 實際業務回覆: ❌ 請提供學生姓名，例如：「提醒我小明的數學課」
2025-08-10 15:02:25  {"ts":"2025-08-10T15:02:25.184Z","lvl":"info","direction":"outbound","channel":"line","traceId":"line_1754838143012_1qylna","userId":"U_test_user_qa","textOut":"❌ 請提供學生姓名，例如：「提醒我小明的數學課」","quickReply":false}
2025-08-10 15:02:37  📨 收到 1 個事件
2025-08-10 15:02:37  📋 事件類型: message
2025-08-10 15:02:37  🔍 完整事件 JSON: {
2025-08-10 15:02:37    "type": "message",
2025-08-10 15:02:37    "message": {
2025-08-10 15:02:37      "type": "text",
2025-08-10 15:02:37      "text": "提醒我小明的物理課"
2025-08-10 15:02:37    },
2025-08-10 15:02:37  📨 收到 1 個事件
2025-08-10 15:02:37  📋 事件類型: message
2025-08-10 15:02:37  🔍 完整事件 JSON: {
2025-08-10 15:02:37    "type": "message",
2025-08-10 15:02:37    "message": {
2025-08-10 15:02:37      "type": "text",
2025-08-10 15:02:37      "text": "提醒我小明的物理課"
2025-08-10 15:02:37    },
2025-08-10 15:02:37    "source": {
2025-08-10 15:02:37      "userId": "U_test_user_qa",
2025-08-10 15:02:37      "type": "user"
2025-08-10 15:02:37    },
2025-08-10 15:02:37    "replyToken": "test-reply-token-1754838157850",
2025-08-10 15:02:37    "timestamp": 1754838157850
2025-08-10 15:02:37  }
2025-08-10 15:02:37  🧹 檢測到 QA 重置上下文請求，清理用戶上下文: U_test_user_qa
2025-08-10 15:02:38  {"ts":"2025-08-10T15:02:38.133Z","lvl":"info","direction":"inbound","channel":"line","traceId":"line_1754838158133_b0iq00","userId":"U_test_user_qa","textIn":"提醒我小明的物理課"}
2025-08-10 15:02:38  🔍 用戶ID類型: string
2025-08-10 15:02:38  🔍 是否測試用戶: true
2025-08-10 15:02:38  🚀 生產用戶，使用真實 LINE Service
2025-08-10 15:02:38  🎯 開始解析意圖: 提醒我小明的物理課 (用戶: U_test_user_qa)
2025-08-10 15:02:38  ✅ 規則匹配成功: set_reminder
2025-08-10 15:02:38  {"ts":"2025-08-10T15:02:38.273Z","lvl":"info","stage":"nlp","traceId":"line_1754838158133_b0iq00","userId":"U_test_user_qa","intent":"set_reminder"}
2025-08-10 15:02:38  🔍 開始提取 slots - 意圖: set_reminder (用戶: U_test_user_qa)
2025-08-10 15:02:38  🧠 使用對話上下文增強 slots 提取
2025-08-10 15:02:38  📊 規則提取置信度: 0.67
2025-08-10 15:02:38  🤖 啟用 AI 輔助提取...
2025-08-10 15:02:39  ✅ 最終 slots: { studentName: '小明', courseName: '物理課' }
2025-08-10 15:02:39  {"ts":"2025-08-10T15:02:39.841Z","lvl":"info","stage":"slots","traceId":"line_1754838158133_b0iq00","userId":"U_test_user_qa","intent":"set_reminder","slotsSummary":["studentName","courseName"]}
2025-08-10 15:02:39  🎯 執行任務: set_reminder
2025-08-10 15:02:39  🔔 開始處理設定提醒任務: { studentName: '小明', courseName: '物理課' }
2025-08-10 15:02:39  ❓ 找不到對應課程: 學生=小明, 課程=物理課, 日期=null
2025-08-10 15:02:39  📊 任務執行結果: {
2025-08-10 15:02:39    success: false,
2025-08-10 15:02:39    code: 'NOT_FOUND',
2025-08-10 15:02:39    message: '❌ 找不到 小明 的 物理課，請確認課程是否已安排'
2025-08-10 15:02:39  }
2025-08-10 15:02:39  {"ts":"2025-08-10T15:02:39.931Z","lvl":"info","stage":"task","traceId":"line_1754838158133_b0iq00","userId":"U_test_user_qa","intent":"set_reminder","success":false,"code":"NOT_FOUND","latencyMs":90}
2025-08-10 15:02:40  🔍 檢查 replyToken: test-reply-token-1754838157850
2025-08-10 15:02:40  🧪 檢測到測試 token，跳過真實 LINE API 調用
2025-08-10 15:02:40  📤 [測試模式] 實際業務回覆: ❌ 找不到 小明 的 物理課，請確認課程是否已安排
2025-08-10 15:02:40  {"ts":"2025-08-10T15:02:40.219Z","lvl":"info","direction":"outbound","channel":"line","traceId":"line_1754838158133_b0iq00","userId":"U_test_user_qa","textOut":"❌ 找不到 小明 的 物理課，請確認課程是否已安排","quickReply":false}
2025-08-10 15:02:53  📨 收到 1 個事件
2025-08-10 15:02:53  📋 事件類型: message
2025-08-10 15:02:53  🔍 完整事件 JSON: {
2025-08-10 15:02:53    "type": "message",
2025-08-10 15:02:53    "message": {
2025-08-10 15:02:53      "type": "text",
2025-08-10 15:02:53      "text": "小明的數學課改到下午4點"
2025-08-10 15:02:53    },
2025-08-10 15:02:53    "source": {
2025-08-10 15:02:53      "userId": "U_test_user_qa",
2025-08-10 15:02:53      "type": "user"
2025-08-10 15:02:53    },
2025-08-10 15:02:53    "replyToken": "test-reply-token-1754838173280",
2025-08-10 15:02:53    "timestamp": 1754838173280
2025-08-10 15:02:53  }
2025-08-10 15:02:53  🧹 檢測到 QA 重置上下文請求，清理用戶上下文: U_test_user_qa
2025-08-10 15:02:53  {"ts":"2025-08-10T15:02:53.455Z","lvl":"info","direction":"inbound","channel":"line","traceId":"line_1754838173455_vtvysv","userId":"U_test_user_qa","textIn":"小明的數學課改到下午4點"}
2025-08-10 15:02:53  🔍 用戶ID類型: string
2025-08-10 15:02:53  🔍 是否測試用戶: true
2025-08-10 15:02:53  🚀 生產用戶，使用真實 LINE Service
2025-08-10 15:02:53  🎯 開始解析意圖: 小明的數學課改到下午4點 (用戶: U_test_user_qa)
2025-08-10 15:02:53  ✅ 規則匹配成功: modify_course
2025-08-10 15:02:53  {"ts":"2025-08-10T15:02:53.596Z","lvl":"info","stage":"nlp","traceId":"line_1754838173455_vtvysv","userId":"U_test_user_qa","intent":"modify_course"}
2025-08-10 15:02:53  🔍 開始提取 slots - 意圖: modify_course (用戶: U_test_user_qa)
2025-08-10 15:02:53  ❓ 未知意圖，無法提取 slots: modify_course
2025-08-10 15:02:53  🧠 使用對話上下文增強 slots 提取
2025-08-10 15:02:53  📊 規則提取置信度: 0.00
2025-08-10 15:02:53  🔄 規則提取信心度低，AI 輔助增強...
2025-08-10 15:02:55  ✅ 最終 slots: { studentName: '小明', courseName: '數學課', scheduleTime: '下午4點' }
2025-08-10 15:02:55  {"ts":"2025-08-10T15:02:55.036Z","lvl":"info","stage":"slots","traceId":"line_1754838173455_vtvysv","userId":"U_test_user_qa","intent":"modify_course","slotsSummary":["studentName","courseName","scheduleTime"]}
2025-08-10 15:02:55  🎯 執行任務: modify_course
2025-08-10 15:02:55  ✏️ 執行修改操作任務: {
2025-08-10 15:02:55    slots: { studentName: '小明', courseName: '數學課', scheduleTime: '下午4點' },
2025-08-10 15:02:55    userId: 'U_test_user_qa'
2025-08-10 15:02:55  }
2025-08-10 15:02:55  📊 任務執行結果: { success: false, message: '❓ 沒有可供修改的最近操作。' }
2025-08-10 15:02:55  {"ts":"2025-08-10T15:02:55.109Z","lvl":"info","stage":"task","traceId":"line_1754838173455_vtvysv","userId":"U_test_user_qa","intent":"modify_course","success":false,"code":null,"latencyMs":73}
2025-08-10 15:02:55  🔍 檢查 replyToken: test-reply-token-1754838173280
2025-08-10 15:02:55  🧪 檢測到測試 token，跳過真實 LINE API 調用
2025-08-10 15:02:55  📤 [測試模式] 實際業務回覆: ❓ 沒有可供修改的最近操作。
2025-08-10 15:02:55  {"ts":"2025-08-10T15:02:55.393Z","lvl":"info","direction":"outbound","channel":"line","traceId":"line_1754838173455_vtvysv","userId":"U_test_user_qa","textOut":"❓ 沒有可供修改的最近操作。","quickReply":false}
2025-08-10 15:03:12  📨 收到 1 個事件
2025-08-10 15:03:12  📋 事件類型: message
2025-08-10 15:03:12  🔍 完整事件 JSON: {
2025-08-10 15:03:12    "type": "message",
2025-08-10 15:03:12    "message": {
2025-08-10 15:03:12      "type": "text",
2025-08-10 15:03:12      "text": "小明每天的晨練課改到早上7點"
2025-08-10 15:03:12    },
2025-08-10 15:03:12    "source": {
2025-08-10 15:03:12      "userId": "U_test_user_qa",
2025-08-10 15:03:12      "type": "user"
2025-08-10 15:03:12    },
2025-08-10 15:03:12    "replyToken": "test-reply-token-1754838192345",
2025-08-10 15:03:12    "timestamp": 1754838192345
2025-08-10 15:03:12  }
2025-08-10 15:03:12  🧹 檢測到 QA 重置上下文請求，清理用戶上下文: U_test_user_qa
2025-08-10 15:03:12  {"ts":"2025-08-10T15:03:12.518Z","lvl":"info","direction":"inbound","channel":"line","traceId":"line_1754838192518_keptch","userId":"U_test_user_qa","textIn":"小明每天的晨練課改到早上7點"}
2025-08-10 15:03:12  📨 收到 1 個事件
2025-08-10 15:03:12  📋 事件類型: message
2025-08-10 15:03:12  🔍 完整事件 JSON: {
2025-08-10 15:03:12    "type": "message",
2025-08-10 15:03:12    "message": {
2025-08-10 15:03:12      "type": "text",
2025-08-10 15:03:12      "text": "小明每天的晨練課改到早上7點"
2025-08-10 15:03:12    },
2025-08-10 15:03:12    "source": {
2025-08-10 15:03:12      "userId": "U_test_user_qa",
2025-08-10 15:03:12      "type": "user"
2025-08-10 15:03:12    },
2025-08-10 15:03:12    "replyToken": "test-reply-token-1754838192345",
2025-08-10 15:03:12    "timestamp": 1754838192345
2025-08-10 15:03:12  }
2025-08-10 15:03:12  🧹 檢測到 QA 重置上下文請求，清理用戶上下文: U_test_user_qa
2025-08-10 15:03:12  {"ts":"2025-08-10T15:03:12.518Z","lvl":"info","direction":"inbound","channel":"line","traceId":"line_1754838192518_keptch","userId":"U_test_user_qa","textIn":"小明每天的晨練課改到早上7點"}
2025-08-10 15:03:12  🔍 用戶ID類型: string
2025-08-10 15:03:12  🔍 是否測試用戶: true
2025-08-10 15:03:12  🚀 生產用戶，使用真實 LINE Service
2025-08-10 15:03:12  🎯 開始解析意圖: 小明每天的晨練課改到早上7點 (用戶: U_test_user_qa)
2025-08-10 15:03:12  ✅ 規則匹配成功: create_recurring_course
2025-08-10 15:03:12  {"ts":"2025-08-10T15:03:12.658Z","lvl":"info","stage":"nlp","traceId":"line_1754838192518_keptch","userId":"U_test_user_qa","intent":"create_recurring_course"}
2025-08-10 15:03:12  🔍 開始提取 slots - 意圖: create_recurring_course (用戶: U_test_user_qa)
2025-08-10 15:03:12  🕒 開始高級時間解析: 小明每天的晨練課改到早上7點
2025-08-10 15:03:12  ✅ 時間解析成功: {
2025-08-10 15:03:12    input: '小明每天的晨練課改到早上7點',
2025-08-10 15:03:12    output: '07:00',
2025-08-10 15:03:12    details: { hour: 7, minute: 0, matchType: 'arabic_period', periodInfo: '早上' }
2025-08-10 15:03:12  }
2025-08-10 15:03:12  🧠 使用對話上下文增強 slots 提取
2025-08-10 15:03:12  📊 規則提取置信度: 0.67
2025-08-10 15:03:12  🤖 啟用 AI 輔助提取...
2025-08-10 15:03:15  ✅ 最終 slots: {
2025-08-10 15:03:15    studentName: '小明',
2025-08-10 15:03:15    courseName: '晨練課',
2025-08-10 15:03:15    scheduleTime: '07:00',
2025-08-10 15:03:15    recurring: false
2025-08-10 15:03:15  }
2025-08-10 15:03:15  {"ts":"2025-08-10T15:03:15.935Z","lvl":"info","stage":"slots","traceId":"line_1754838192518_keptch","userId":"U_test_user_qa","intent":"create_recurring_course","slotsSummary":["studentName","courseName","scheduleTime","recurring"]}
2025-08-10 15:03:15  🎯 執行任務: create_recurring_course
2025-08-10 15:03:15  🎯 開始處理新增課程任務
2025-08-10 15:03:15  📋 接收參數: {
2025-08-10 15:03:15    studentName: '小明',
2025-08-10 15:03:15    courseName: '晨練課',
2025-08-10 15:03:15    scheduleTime: '07:00',
2025-08-10 15:03:15    recurring: false
2025-08-10 15:03:15  }
2025-08-10 15:03:16  📊 任務執行結果: {
2025-08-10 15:03:16    success: false,
2025-08-10 15:03:16    code: 'MISSING_FIELDS',
2025-08-10 15:03:16    message: '❓ 請提供以下資訊：課程日期\n\n範例：「小明每週三下午3點數學課」',
2025-08-10 15:03:16    expectingInput: true,
2025-08-10 15:03:16    missingFields: [ '課程日期' ]
2025-08-10 15:03:16  }
2025-08-10 15:03:16  {"ts":"2025-08-10T15:03:16.076Z","lvl":"info","stage":"task","traceId":"line_1754838192518_keptch","userId":"U_test_user_qa","intent":"create_recurring_course","success":false,"code":"MISSING_FIELDS","latencyMs":140}
2025-08-10 15:03:16  🔍 檢查 replyToken: test-reply-token-1754838192345
2025-08-10 15:03:16  🧪 檢測到測試 token，跳過真實 LINE API 調用
2025-08-10 15:03:16  📤 [測試模式] 實際業務回覆: ❓ 請提供以下資訊：課程日期
2025-08-10 15:03:16  
2025-08-10 15:03:16  範例：「小明每週三下午3點數學課」
2025-08-10 15:03:16  {"ts":"2025-08-10T15:03:16.358Z","lvl":"info","direction":"outbound","channel":"line","traceId":"line_1754838192518_keptch","userId":"U_test_user_qa","textOut":"❓ 請提供以下資訊：課程日期\n\n範例：「小明每週三下午3點數學課」","quickReply":false}
2025-08-10 15:03:28  📨 收到 1 個事件
2025-08-10 15:03:28  📋 事件類型: message
2025-08-10 15:03:28  🔍 完整事件 JSON: {
2025-08-10 15:03:28    "type": "message",
2025-08-10 15:03:28    "message": {
2025-08-10 15:03:28      "type": "text",
2025-08-10 15:03:28      "text": "Lumi的鋼琴課改成每天下午3點"
2025-08-10 15:03:28    },
2025-08-10 15:03:28    "source": {
2025-08-10 15:03:28      "userId": "U_test_user_qa",
2025-08-10 15:03:28      "type": "user"
2025-08-10 15:03:28    },
2025-08-10 15:03:28    "replyToken": "test-reply-token-1754838208786",
2025-08-10 15:03:28    "timestamp": 1754838208786
2025-08-10 15:03:28  }
2025-08-10 15:03:28  🧹 檢測到 QA 重置上下文請求，清理用戶上下文: U_test_user_qa
2025-08-10 15:03:28  {"ts":"2025-08-10T15:03:28.970Z","lvl":"info","direction":"inbound","channel":"line","traceId":"line_1754838208970_oznran","userId":"U_test_user_qa","textIn":"Lumi的鋼琴課改成每天下午3點"}
2025-08-10 15:03:28  🔍 用戶ID類型: string
2025-08-10 15:03:28  🔍 是否測試用戶: true
2025-08-10 15:03:28  🚀 生產用戶，使用真實 LINE Service
2025-08-10 15:03:28  🎯 開始解析意圖: Lumi的鋼琴課改成每天下午3點 (用戶: U_test_user_qa)
2025-08-10 15:03:29  ✅ 規則匹配成功: create_recurring_course
2025-08-10 15:03:29  {"ts":"2025-08-10T15:03:29.110Z","lvl":"info","stage":"nlp","traceId":"line_1754838208970_oznran","userId":"U_test_user_qa","intent":"create_recurring_course"}
2025-08-10 15:03:29  🔍 開始提取 slots - 意圖: create_recurring_course (用戶: U_test_user_qa)
2025-08-10 15:03:29  🕒 開始高級時間解析: Lumi的鋼琴課改成每天下午3點
2025-08-10 15:03:29  ✅ 時間解析成功: {
2025-08-10 15:03:29    input: 'Lumi的鋼琴課改成每天下午3點',
2025-08-10 15:03:29    output: '15:00',
2025-08-10 15:03:29    details: { hour: 15, minute: 0, matchType: 'arabic_period', periodInfo: '下午' }
2025-08-10 15:03:29  }
2025-08-10 15:03:29  🧠 使用對話上下文增強 slots 提取
2025-08-10 15:03:29  📊 規則提取置信度: 0.67
2025-08-10 15:03:29  🤖 啟用 AI 輔助提取...
2025-08-10 15:03:30  ✅ 最終 slots: {
2025-08-10 15:03:30    studentName: 'Lumi',
2025-08-10 15:03:30    courseName: '鋼琴課',
2025-08-10 15:03:30    scheduleTime: '15:00',
2025-08-10 15:03:30    recurring: true
2025-08-10 15:03:30  ✅ 最終 slots: {
2025-08-10 15:03:30    studentName: 'Lumi',
2025-08-10 15:03:30    courseName: '鋼琴課',
2025-08-10 15:03:30    scheduleTime: '15:00',
2025-08-10 15:03:30    recurring: true
2025-08-10 15:03:30  }
2025-08-10 15:03:30  {"ts":"2025-08-10T15:03:30.340Z","lvl":"info","stage":"slots","traceId":"line_1754838208970_oznran","userId":"U_test_user_qa","intent":"create_recurring_course","slotsSummary":["studentName","courseName","scheduleTime","recurring"]}
2025-08-10 15:03:30  🎯 執行任務: create_recurring_course
2025-08-10 15:03:30  🎯 開始處理新增課程任務
2025-08-10 15:03:30  📋 接收參數: {
2025-08-10 15:03:30    studentName: 'Lumi',
2025-08-10 15:03:30    courseName: '鋼琴課',
2025-08-10 15:03:30    scheduleTime: '15:00',
2025-08-10 15:03:30    recurring: true
2025-08-10 15:03:30  }
2025-08-10 15:03:30  👤 學生日曆: 4a0f9e74ce6d657504bec55784c18348676fc1f35aa59f71a6cd2b9b5b2f2f4b@group.calendar.google.com
2025-08-10 15:03:30  ✅ 已創建課程事件: mock-event-1754838210417
2025-08-10 15:03:30  📅 Google Calendar 事件已創建: mock-event-1754838210417
2025-08-10 15:03:30  ✅ 課程資料已儲存: MdbHWYArIRoimqBxqpIN
2025-08-10 15:03:30  💾 Firebase 課程資料已儲存: MdbHWYArIRoimqBxqpIN
2025-08-10 15:03:30  📊 任務執行結果: {
2025-08-10 15:03:30    success: true,
2025-08-10 15:03:30    code: 'ADD_COURSE_OK',
2025-08-10 15:03:30    message: '✅ 課程已安排成功！\n' +
2025-08-10 15:03:30      '\n' +
2025-08-10 15:03:30      '👦 學生：Lumi\n' +
2025-08-10 15:03:30      '📚 課程：鋼琴課\n' +
2025-08-10 15:03:30      '🔄 重複：每undefined 下午3:00\n' +
2025-08-10 15:03:30      '📅 下次上課：2025-08-11',
2025-08-10 15:03:30    data: {
2025-08-10 15:03:30      courseId: 'MdbHWYArIRoimqBxqpIN',
2025-08-10 15:03:30      eventId: 'mock-event-1754838210417'
2025-08-10 15:03:30    },
2025-08-10 15:03:30    quickReply: [ { label: '✅ 確認', text: '確認' }, { label: '❌ 取消操作', text: '取消操作' } ]
2025-08-10 15:03:30  }
2025-08-10 15:03:30  {"ts":"2025-08-10T15:03:30.756Z","lvl":"info","stage":"task","traceId":"line_1754838208970_oznran","userId":"U_test_user_qa","intent":"create_recurring_course","success":true,"code":"ADD_COURSE_OK","latencyMs":416}
2025-08-10 15:03:31  🔍 檢查 replyToken: test-reply-token-1754838208786
2025-08-10 15:03:31  🧪 檢測到測試 token，跳過真實 LINE API 調用
2025-08-10 15:03:31  📤 [測試模式] 實際業務回覆: ✅ 課程已安排成功！
2025-08-10 15:03:31  
2025-08-10 15:03:31  👦 學生：Lumi
2025-08-10 15:03:31  📚 課程：鋼琴課
2025-08-10 15:03:31  🔄 重複：每undefined 下午3:00
2025-08-10 15:03:31  📅 下次上課：2025-08-11
2025-08-10 15:03:31  {"ts":"2025-08-10T15:03:31.036Z","lvl":"info","direction":"outbound","channel":"line","traceId":"line_1754838208970_oznran","userId":"U_test_user_qa","textOut":"✅ 課程已安排成功！\n\n👦 學生：Lumi\n📚 課程：鋼琴課\n🔄 重複：每undefined 下午3:00\n📅 下次上課：2025-08-11","quickReply":true}
2025-08-10 15:03:43  📨 收到 1 個事件
2025-08-10 15:03:43  📋 事件類型: message
2025-08-10 15:03:43  🔍 完整事件 JSON: {
2025-08-10 15:03:43    "type": "message",
2025-08-10 15:03:43    "message": {
2025-08-10 15:03:43      "type": "text",
2025-08-10 15:03:43      "text": "取消小明明天的數學課"
2025-08-10 15:03:43    },
2025-08-10 15:03:43    "source": {
2025-08-10 15:03:43      "userId": "U_test_user_qa",
2025-08-10 15:03:43      "type": "user"
2025-08-10 15:03:43    },
2025-08-10 15:03:43    "replyToken": "test-reply-token-1754838223724",
2025-08-10 15:03:43    "timestamp": 1754838223724
2025-08-10 15:03:43  }
2025-08-10 15:03:43  🧹 檢測到 QA 重置上下文請求，清理用戶上下文: U_test_user_qa
2025-08-10 15:03:43  {"ts":"2025-08-10T15:03:43.901Z","lvl":"info","direction":"inbound","channel":"line","traceId":"line_1754838223901_x97og3","userId":"U_test_user_qa","textIn":"取消小明明天的數學課"}
2025-08-10 15:03:43  🔍 用戶ID類型: string
2025-08-10 15:03:43  🔍 是否測試用戶: true
2025-08-10 15:03:43  🚀 生產用戶，使用真實 LINE Service
2025-08-10 15:03:43  🎯 開始解析意圖: 取消小明明天的數學課 (用戶: U_test_user_qa)
2025-08-10 15:03:44  ✅ 規則匹配成功: cancel_course
2025-08-10 15:03:44  {"ts":"2025-08-10T15:03:44.045Z","lvl":"info","stage":"nlp","traceId":"line_1754838223901_x97og3","userId":"U_test_user_qa","intent":"cancel_course"}
2025-08-10 15:03:44  🔍 開始提取 slots - 意圖: cancel_course (用戶: U_test_user_qa)
2025-08-10 15:03:44  🧠 使用對話上下文增強 slots 提取
2025-08-10 15:03:44  📊 規則提取置信度: 1.00
2025-08-10 15:03:44  ✅ 最終 slots: {
2025-08-10 15:03:44    studentName: '小明',
2025-08-10 15:03:44    courseName: '數學課',
2025-08-10 15:03:44    specificDate: '2025-08-10',
2025-08-10 15:03:44    timeReference: 'tomorrow',
2025-08-10 15:03:44    scope: 'single'
2025-08-10 15:03:44  }
2025-08-10 15:03:44  {"ts":"2025-08-10T15:03:44.330Z","lvl":"info","stage":"slots","traceId":"line_1754838223901_x97og3","userId":"U_test_user_qa","intent":"cancel_course","slotsSummary":["studentName","courseName","specificDate","timeReference","scope"]}
2025-08-10 15:03:44  🎯 執行任務: cancel_course
2025-08-10 15:03:44  🗑️ 開始處理取消課程任務: {
2025-08-10 15:03:44    studentName: '小明',
2025-08-10 15:03:44    courseName: '數學課',
2025-08-10 15:03:44    specificDate: '2025-08-10',
2025-08-10 15:03:44    timeReference: 'tomorrow',
2025-08-10 15:03:44    scope: 'single'
2025-08-10 15:03:44  }
2025-08-10 15:03:44  ✅ 事件已刪除: mock-event-1754739732185
2025-08-10 15:03:44  ❌ Google Calendar 刪除失敗: undefined
2025-08-10 15:03:44  ✅ 課程已標記為取消: 0HR56QmxvJyJ6QSsvkVe
2025-08-10 15:03:44  ✅ 課程取消成功: 小明 的 數學課 (2025-08-10)
2025-08-10 15:03:44  📊 取消結果統計: 成功=1, 失敗=0
2025-08-10 15:03:44  📊 任務執行結果: {
2025-08-10 15:03:44    success: true,
2025-08-10 15:03:44    code: 'COURSE_CANCEL_OK',
2025-08-10 15:03:44    message: '✅ 已取消 小明 的 數學課\n📅 原定時間：2025-08-10 14:00\n\n💡 提示：已取消的課程仍保留在記錄中，可隨時查看歷史資料'
2025-08-10 15:03:44  }
2025-08-10 15:03:44  {"ts":"2025-08-10T15:03:44.658Z","lvl":"info","stage":"task","traceId":"line_1754838223901_x97og3","userId":"U_test_user_qa","intent":"cancel_course","success":true,"code":"COURSE_CANCEL_OK","latencyMs":328}
2025-08-10 15:03:44  🔍 檢查 replyToken: test-reply-token-1754838223724
2025-08-10 15:03:44  🧪 檢測到測試 token，跳過真實 LINE API 調用
2025-08-10 15:03:44  ✅ 規則匹配成功: cancel_course
2025-08-10 15:03:44  {"ts":"2025-08-10T15:03:44.045Z","lvl":"info","stage":"nlp","traceId":"line_1754838223901_x97og3","userId":"U_test_user_qa","intent":"cancel_course"}
2025-08-10 15:03:44  🔍 開始提取 slots - 意圖: cancel_course (用戶: U_test_user_qa)
2025-08-10 15:03:44  🧠 使用對話上下文增強 slots 提取
2025-08-10 15:03:44  📊 規則提取置信度: 1.00
2025-08-10 15:03:44  ✅ 最終 slots: {
2025-08-10 15:03:44    studentName: '小明',
2025-08-10 15:03:44    courseName: '數學課',
2025-08-10 15:03:44    specificDate: '2025-08-10',
2025-08-10 15:03:44    timeReference: 'tomorrow',
2025-08-10 15:03:44    scope: 'single'
2025-08-10 15:03:44  }
2025-08-10 15:03:44  {"ts":"2025-08-10T15:03:44.330Z","lvl":"info","stage":"slots","traceId":"line_1754838223901_x97og3","userId":"U_test_user_qa","intent":"cancel_course","slotsSummary":["studentName","courseName","specificDate","timeReference","scope"]}
2025-08-10 15:03:44  🎯 執行任務: cancel_course
2025-08-10 15:03:44  🗑️ 開始處理取消課程任務: {
2025-08-10 15:03:44    studentName: '小明',
2025-08-10 15:03:44    courseName: '數學課',
2025-08-10 15:03:44    specificDate: '2025-08-10',
2025-08-10 15:03:44    timeReference: 'tomorrow',
2025-08-10 15:03:44    scope: 'single'
2025-08-10 15:03:44  }
2025-08-10 15:03:44  ✅ 事件已刪除: mock-event-1754739732185
2025-08-10 15:03:44  ❌ Google Calendar 刪除失敗: undefined
2025-08-10 15:03:44  ✅ 課程已標記為取消: 0HR56QmxvJyJ6QSsvkVe
2025-08-10 15:03:44  ✅ 課程取消成功: 小明 的 數學課 (2025-08-10)
2025-08-10 15:03:44  📊 取消結果統計: 成功=1, 失敗=0
2025-08-10 15:03:44  📊 任務執行結果: {
2025-08-10 15:03:44    success: true,
2025-08-10 15:03:44    code: 'COURSE_CANCEL_OK',
2025-08-10 15:03:44    message: '✅ 已取消 小明 的 數學課\n📅 原定時間：2025-08-10 14:00\n\n💡 提示：已取消的課程仍保留在記錄中，可隨時查看歷史資料'
2025-08-10 15:03:44  }
2025-08-10 15:03:44  {"ts":"2025-08-10T15:03:44.658Z","lvl":"info","stage":"task","traceId":"line_1754838223901_x97og3","userId":"U_test_user_qa","intent":"cancel_course","success":true,"code":"COURSE_CANCEL_OK","latencyMs":328}
2025-08-10 15:03:44  🔍 檢查 replyToken: test-reply-token-1754838223724
2025-08-10 15:03:44  🧪 檢測到測試 token，跳過真實 LINE API 調用
2025-08-10 15:03:44  📤 [測試模式] 實際業務回覆: ✅ 已取消 小明 的 數學課
2025-08-10 15:03:44  📅 原定時間：2025-08-10 14:00
2025-08-10 15:03:44  
2025-08-10 15:03:44  💡 提示：已取消的課程仍保留在記錄中，可隨時查看歷史資料
2025-08-10 15:03:44  {"ts":"2025-08-10T15:03:44.939Z","lvl":"info","direction":"outbound","channel":"line","traceId":"line_1754838223901_x97og3","userId":"U_test_user_qa","textOut":"✅ 已取消 小明 的 數學課\n📅 原定時間：2025-08-10 14:00\n\n💡 提示：已取消的課程仍保留在記錄中，可隨時查看歷史資料","quickReply":true}
2025-08-10 15:03:57  📨 收到 1 個事件
2025-08-10 15:03:57  📋 事件類型: message
2025-08-10 15:03:57  🔍 完整事件 JSON: {
2025-08-10 15:03:57    "type": "message",
2025-08-10 15:03:57    "message": {
2025-08-10 15:03:57      "type": "text",
2025-08-10 15:03:57      "text": "取消小明的晨練課"
2025-08-10 15:03:57    },
2025-08-10 15:03:57    "source": {
2025-08-10 15:03:57      "userId": "U_test_user_qa",
2025-08-10 15:03:57      "type": "user"
2025-08-10 15:03:57    },
2025-08-10 15:03:57    "replyToken": "test-reply-token-1754838237651",
2025-08-10 15:03:57    "timestamp": 1754838237651
2025-08-10 15:03:57  }
2025-08-10 15:03:57  🧹 檢測到 QA 重置上下文請求，清理用戶上下文: U_test_user_qa
2025-08-10 15:03:57  {"ts":"2025-08-10T15:03:57.855Z","lvl":"info","direction":"inbound","channel":"line","traceId":"line_1754838237855_bf5c4w","userId":"U_test_user_qa","textIn":"取消小明的晨練課"}
2025-08-10 15:03:57  🔍 用戶ID類型: string
2025-08-10 15:03:57  🔍 是否測試用戶: true
2025-08-10 15:03:57  🚀 生產用戶，使用真實 LINE Service
2025-08-10 15:03:57  🎯 開始解析意圖: 取消小明的晨練課 (用戶: U_test_user_qa)
2025-08-10 15:03:57  ✅ 規則匹配成功: cancel_course
2025-08-10 15:03:57  {"ts":"2025-08-10T15:03:57.996Z","lvl":"info","stage":"nlp","traceId":"line_1754838237855_bf5c4w","userId":"U_test_user_qa","intent":"cancel_course"}
2025-08-10 15:03:58  🔍 開始提取 slots - 意圖: cancel_course (用戶: U_test_user_qa)
2025-08-10 15:03:58  🧠 使用對話上下文增強 slots 提取
2025-08-10 15:03:58  📊 規則提取置信度: 1.00
2025-08-10 15:03:58  🤖 啟用 AI 輔助提取...
2025-08-10 15:03:59  ✅ 最終 slots: { studentName: '小明', courseName: '晨練課' }
2025-08-10 15:03:59  {"ts":"2025-08-10T15:03:59.588Z","lvl":"info","stage":"slots","traceId":"line_1754838237855_bf5c4w","userId":"U_test_user_qa","intent":"cancel_course","slotsSummary":["studentName","courseName"]}
2025-08-10 15:03:59  🎯 執行任務: cancel_course
2025-08-10 15:03:59  🗑️ 開始處理取消課程任務: { studentName: '小明', courseName: '晨練課' }
2025-08-10 15:03:59  📚 查詢到 316 筆課程資料
2025-08-10 15:03:59  📊 任務執行結果: {
2025-08-10 15:03:59    success: false,
2025-08-10 15:03:59    code: 'RECURRING_CANCEL_OPTIONS',
2025-08-10 15:03:59    message: '請問是要取消哪個範圍？\n\n🔘 只取消今天\n🔘 取消明天起所有課程\n🔘 刪除整個重複課程',
2025-08-10 15:03:59    quickReply: [
2025-08-10 15:03:59      { label: '只取消今天', text: '只取消今天' },
2025-08-10 15:03:59      { label: '取消之後全部', text: '取消之後全部' },
2025-08-10 15:03:59      { label: '刪除整個重複', text: '刪除整個重複' }
2025-08-10 15:03:59    ]
2025-08-10 15:03:59  }
2025-08-10 15:03:59  {"ts":"2025-08-10T15:03:59.935Z","lvl":"info","stage":"task","traceId":"line_1754838237855_bf5c4w","userId":"U_test_user_qa","intent":"cancel_course","success":false,"code":"RECURRING_CANCEL_OPTIONS","latencyMs":347}
2025-08-10 15:04:00  🔍 檢查 replyToken: test-reply-token-1754838237651
2025-08-10 15:04:00  🧪 檢測到測試 token，跳過真實 LINE API 調用
2025-08-10 15:04:00  📤 [測試模式] 實際業務回覆: 請問是要取消哪個範圍？
2025-08-10 15:04:00  
2025-08-10 15:04:00  🔘 只取消今天
2025-08-10 15:04:00  🔘 取消明天起所有課程
2025-08-10 15:04:00  🔘 刪除整個重複課程
2025-08-10 15:04:00  {"ts":"2025-08-10T15:04:00.231Z","lvl":"info","direction":"outbound","channel":"line","traceId":"line_1754838237855_bf5c4w","userId":"U_test_user_qa","textOut":"請問是要取消哪個範圍？\n\n🔘 只取消今天\n🔘 取消明天起所有課程\n🔘 刪除整個重複課程","quickReply":false}
2025-08-10 15:04:12  📨 收到 1 個事件
2025-08-10 15:04:12  📋 事件類型: message
2025-08-10 15:04:12  🔍 完整事件 JSON: {
2025-08-10 15:04:12    "type": "message",
2025-08-10 15:04:12    "message": {
2025-08-10 15:04:12      "type": "text",
2025-08-10 15:04:12      "text": "取消小明下週的晨練課"
2025-08-10 15:04:12    },
2025-08-10 15:04:12    "source": {
2025-08-10 15:04:12      "userId": "U_test_user_qa",
2025-08-10 15:04:12  📨 收到 1 個事件
2025-08-10 15:04:12  📋 事件類型: message
2025-08-10 15:04:12  🔍 完整事件 JSON: {
2025-08-10 15:04:12    "type": "message",
2025-08-10 15:04:12    "message": {
2025-08-10 15:04:12      "type": "text",
2025-08-10 15:04:12      "text": "取消小明下週的晨練課"
2025-08-10 15:04:12    },
2025-08-10 15:04:12    "source": {
2025-08-10 15:04:12      "userId": "U_test_user_qa",
2025-08-10 15:04:12      "type": "user"
2025-08-10 15:04:12    },
2025-08-10 15:04:12    "replyToken": "test-reply-token-1754838252813",
2025-08-10 15:04:12    "timestamp": 1754838252813
2025-08-10 15:04:12  }
2025-08-10 15:04:12  🧹 檢測到 QA 重置上下文請求，清理用戶上下文: U_test_user_qa
2025-08-10 15:04:13  {"ts":"2025-08-10T15:04:13.048Z","lvl":"info","direction":"inbound","channel":"line","traceId":"line_1754838253048_dq43gg","userId":"U_test_user_qa","textIn":"取消小明下週的晨練課"}
2025-08-10 15:04:13  🔍 用戶ID類型: string
2025-08-10 15:04:13  🔍 是否測試用戶: true
2025-08-10 15:04:13  🚀 生產用戶，使用真實 LINE Service
2025-08-10 15:04:13  🎯 開始解析意圖: 取消小明下週的晨練課 (用戶: U_test_user_qa)
2025-08-10 15:04:13  ✅ 規則匹配成功: cancel_course
2025-08-10 15:04:13  {"ts":"2025-08-10T15:04:13.190Z","lvl":"info","stage":"nlp","traceId":"line_1754838253048_dq43gg","userId":"U_test_user_qa","intent":"cancel_course"}
2025-08-10 15:04:13  🔍 開始提取 slots - 意圖: cancel_course (用戶: U_test_user_qa)
2025-08-10 15:04:13  📊 規則提取置信度: 0.50
2025-08-10 15:04:13  🤖 啟用 AI 輔助提取...
2025-08-10 15:04:14  ✅ 最終 slots: { studentName: '小明', courseName: '晨練課', timeReference: 'next_week' }
2025-08-10 15:04:14  {"ts":"2025-08-10T15:04:14.806Z","lvl":"info","stage":"slots","traceId":"line_1754838253048_dq43gg","userId":"U_test_user_qa","intent":"cancel_course","slotsSummary":["studentName","courseName","timeReference"]}
2025-08-10 15:04:14  🎯 執行任務: cancel_course
2025-08-10 15:04:14  🗑️ 開始處理取消課程任務: { studentName: '小明', courseName: '晨練課', timeReference: 'next_week' }
2025-08-10 15:04:14  📚 查詢到 316 筆課程資料
2025-08-10 15:04:14  📊 任務執行結果: {
2025-08-10 15:04:14    success: false,
2025-08-10 15:04:14    code: 'RECURRING_CANCEL_OPTIONS',
2025-08-10 15:04:14    message: '請問是要取消哪個範圍？\n\n🔘 只取消今天\n🔘 取消明天起所有課程\n🔘 刪除整個重複課程',
2025-08-10 15:04:14    quickReply: [
2025-08-10 15:04:14      { label: '只取消今天', text: '只取消今天' },
2025-08-10 15:04:14      { label: '取消之後全部', text: '取消之後全部' },
2025-08-10 15:04:14      { label: '刪除整個重複', text: '刪除整個重複' }
2025-08-10 15:04:14    ]
2025-08-10 15:04:14  }
2025-08-10 15:04:14  {"ts":"2025-08-10T15:04:14.961Z","lvl":"info","stage":"task","traceId":"line_1754838253048_dq43gg","userId":"U_test_user_qa","intent":"cancel_course","success":false,"code":"RECURRING_CANCEL_OPTIONS","latencyMs":155}
2025-08-10 15:04:15  🔍 檢查 replyToken: test-reply-token-1754838252813
2025-08-10 15:04:15  🧪 檢測到測試 token，跳過真實 LINE API 調用
2025-08-10 15:04:15  📤 [測試模式] 實際業務回覆: 請問是要取消哪個範圍？
2025-08-10 15:04:15  
2025-08-10 15:04:15  🔘 只取消今天
2025-08-10 15:04:15  🔘 取消明天起所有課程
2025-08-10 15:04:15  🔘 刪除整個重複課程
2025-08-10 15:04:15  {"ts":"2025-08-10T15:04:15.242Z","lvl":"info","direction":"outbound","channel":"line","traceId":"line_1754838253048_dq43gg","userId":"U_test_user_qa","textOut":"請問是要取消哪個範圍？\n\n🔘 只取消今天\n🔘 取消明天起所有課程\n🔘 刪除整個重複課程","quickReply":false}
2025-08-10 15:04:27  📨 收到 1 個事件
2025-08-10 15:04:27  📋 事件類型: message
2025-08-10 15:04:27  🔍 完整事件 JSON: {
2025-08-10 15:04:27    "type": "message",
2025-08-10 15:04:27    "message": {
2025-08-10 15:04:27      "type": "text",
2025-08-10 15:04:27      "text": "取消小明每天的晨練課"
2025-08-10 15:04:27    },
2025-08-10 15:04:27    "source": {
2025-08-10 15:04:27      "userId": "U_test_user_qa",
2025-08-10 15:04:27      "type": "user"
2025-08-10 15:04:27    },
2025-08-10 15:04:27    "replyToken": "test-reply-token-1754838267635",
2025-08-10 15:04:27    "timestamp": 1754838267635
2025-08-10 15:04:27  }
2025-08-10 15:04:27  🧹 檢測到 QA 重置上下文請求，清理用戶上下文: U_test_user_qa
2025-08-10 15:04:27  {"ts":"2025-08-10T15:04:27.813Z","lvl":"info","direction":"inbound","channel":"line","traceId":"line_1754838267813_s5z6l3","userId":"U_test_user_qa","textIn":"取消小明每天的晨練課"}
2025-08-10 15:04:27  🔍 用戶ID類型: string
2025-08-10 15:04:27  🔍 是否測試用戶: true
2025-08-10 15:04:27  🚀 生產用戶，使用真實 LINE Service
2025-08-10 15:04:27  🎯 開始解析意圖: 取消小明每天的晨練課 (用戶: U_test_user_qa)
2025-08-10 15:04:27  ✅ 規則匹配成功: stop_recurring_course
2025-08-10 15:04:27  {"ts":"2025-08-10T15:04:27.954Z","lvl":"info","stage":"nlp","traceId":"line_1754838267813_s5z6l3","userId":"U_test_user_qa","intent":"stop_recurring_course"}
2025-08-10 15:04:28  🔍 開始提取 slots - 意圖: stop_recurring_course (用戶: U_test_user_qa)
2025-08-10 15:04:28  🧠 使用對話上下文增強 slots 提取
2025-08-10 15:04:28  📊 規則提取置信度: 1.00
2025-08-10 15:04:28  ✅ 最終 slots: { studentName: '小明', courseName: '晨練課', recurrenceType: 'daily' }
2025-08-10 15:04:28  {"ts":"2025-08-10T15:04:28.235Z","lvl":"info","stage":"slots","traceId":"line_1754838267813_s5z6l3","userId":"U_test_user_qa","intent":"stop_recurring_course","slotsSummary":["studentName","courseName","recurrenceType"]}
2025-08-10 15:04:28  🎯 執行任務: stop_recurring_course
2025-08-10 15:04:28  🗑️ 開始處理取消課程任務: { studentName: '小明', courseName: '晨練課', recurrenceType: 'daily' }
2025-08-10 15:04:28  📚 查詢到 316 筆課程資料
2025-08-10 15:04:28  📊 任務執行結果: {
2025-08-10 15:04:28    success: false,
2025-08-10 15:04:28    code: 'RECURRING_CANCEL_OPTIONS',
2025-08-10 15:04:28    message: '請問是要取消哪個範圍？\n\n🔘 只取消今天\n🔘 取消明天起所有課程\n🔘 刪除整個重複課程',
2025-08-10 15:04:28    quickReply: [
2025-08-10 15:04:28      { label: '只取消今天', text: '只取消今天' },
2025-08-10 15:04:28      { label: '取消之後全部', text: '取消之後全部' },
2025-08-10 15:04:28      { label: '刪除整個重複', text: '刪除整個重複' }
2025-08-10 15:04:28    ]
2025-08-10 15:04:28  }
2025-08-10 15:04:28  {"ts":"2025-08-10T15:04:28.389Z","lvl":"info","stage":"task","traceId":"line_1754838267813_s5z6l3","userId":"U_test_user_qa","intent":"stop_recurring_course","success":false,"code":"RECURRING_CANCEL_OPTIONS","latencyMs":154}
2025-08-10 15:04:28  🔍 檢查 replyToken: test-reply-token-1754838267635
2025-08-10 15:04:28  🧪 檢測到測試 token，跳過真實 LINE API 調用
2025-08-10 15:04:28  📤 [測試模式] 實際業務回覆: 請問是要取消哪個範圍？
2025-08-10 15:04:28  
2025-08-10 15:04:28  🔘 只取消今天
2025-08-10 15:04:28  🔘 取消明天起所有課程
2025-08-10 15:04:28  🔘 刪除整個重複課程
2025-08-10 15:04:28  {"ts":"2025-08-10T15:04:28.674Z","lvl":"info","direction":"outbound","channel":"line","traceId":"line_1754838267813_s5z6l3","userId":"U_test_user_qa","textOut":"請問是要取消哪個範圍？\n\n🔘 只取消今天\n🔘 取消明天起所有課程\n🔘 刪除整個重複課程","quickReply":false}
2025-08-10 15:04:28  🔍 開始提取 slots - 意圖: stop_recurring_course (用戶: U_test_user_qa)
2025-08-10 15:04:28  🧠 使用對話上下文增強 slots 提取
2025-08-10 15:04:28  📊 規則提取置信度: 1.00
2025-08-10 15:04:28  ✅ 最終 slots: { studentName: '小明', courseName: '晨練課', recurrenceType: 'daily' }
2025-08-10 15:04:28  {"ts":"2025-08-10T15:04:28.235Z","lvl":"info","stage":"slots","traceId":"line_1754838267813_s5z6l3","userId":"U_test_user_qa","intent":"stop_recurring_course","slotsSummary":["studentName","courseName","recurrenceType"]}
2025-08-10 15:04:28  🎯 執行任務: stop_recurring_course
2025-08-10 15:04:28  🗑️ 開始處理取消課程任務: { studentName: '小明', courseName: '晨練課', recurrenceType: 'daily' }
2025-08-10 15:04:28  📚 查詢到 316 筆課程資料
2025-08-10 15:04:28  📊 任務執行結果: {
2025-08-10 15:04:28    success: false,
2025-08-10 15:04:28    code: 'RECURRING_CANCEL_OPTIONS',
2025-08-10 15:04:28    message: '請問是要取消哪個範圍？\n\n🔘 只取消今天\n🔘 取消明天起所有課程\n🔘 刪除整個重複課程',
2025-08-10 15:04:28    quickReply: [
2025-08-10 15:04:28      { label: '只取消今天', text: '只取消今天' },
2025-08-10 15:04:28      { label: '取消之後全部', text: '取消之後全部' },
2025-08-10 15:04:28      { label: '刪除整個重複', text: '刪除整個重複' }
2025-08-10 15:04:28    ]
2025-08-10 15:04:28  }
2025-08-10 15:04:28  {"ts":"2025-08-10T15:04:28.389Z","lvl":"info","stage":"task","traceId":"line_1754838267813_s5z6l3","userId":"U_test_user_qa","intent":"stop_recurring_course","success":false,"code":"RECURRING_CANCEL_OPTIONS","latencyMs":154}
2025-08-10 15:04:28  🔍 檢查 replyToken: test-reply-token-1754838267635
2025-08-10 15:04:28  🧪 檢測到測試 token，跳過真實 LINE API 調用
2025-08-10 15:04:28  📤 [測試模式] 實際業務回覆: 請問是要取消哪個範圍？
2025-08-10 15:04:28  
2025-08-10 15:04:28  🔘 只取消今天
2025-08-10 15:04:28  🔘 取消明天起所有課程
2025-08-10 15:04:28  🔘 刪除整個重複課程
2025-08-10 15:04:28  {"ts":"2025-08-10T15:04:28.674Z","lvl":"info","direction":"outbound","channel":"line","traceId":"line_1754838267813_s5z6l3","userId":"U_test_user_qa","textOut":"請問是要取消哪個範圍？\n\n🔘 只取消今天\n🔘 取消明天起所有課程\n🔘 刪除整個重複課程","quickReply":false}
2025-08-10 15:04:30  📨 收到 1 個事件
2025-08-10 15:04:30  📋 事件類型: message
2025-08-10 15:04:30  🔍 完整事件 JSON: {
2025-08-10 15:04:30    "type": "message",
2025-08-10 15:04:30    "message": {
2025-08-10 15:04:30      "type": "text",
2025-08-10 15:04:30      "text": "取消Lumi每週三的鋼琴課"
2025-08-10 15:04:30    },
2025-08-10 15:04:30    "source": {
2025-08-10 15:04:30      "userId": "U_test_user_qa",
2025-08-10 15:04:30      "type": "user"
2025-08-10 15:04:30    },
2025-08-10 15:04:30    "replyToken": "test-reply-token-1754838270027",
2025-08-10 15:04:30    "timestamp": 1754838270027
2025-08-10 15:04:30  }
2025-08-10 15:04:30  🧹 檢測到 QA 重置上下文請求，清理用戶上下文: U_test_user_qa
2025-08-10 15:04:30  {"ts":"2025-08-10T15:04:30.168Z","lvl":"info","direction":"inbound","channel":"line","traceId":"line_1754838270168_2pccp9","userId":"U_test_user_qa","textIn":"取消Lumi每週三的鋼琴課"}
2025-08-10 15:04:30  🔍 用戶ID類型: string
2025-08-10 15:04:30  🔍 是否測試用戶: true
2025-08-10 15:04:30  🚀 生產用戶，使用真實 LINE Service
2025-08-10 15:04:30  🎯 開始解析意圖: 取消Lumi每週三的鋼琴課 (用戶: U_test_user_qa)
2025-08-10 15:04:30  ✅ 規則匹配成功: stop_recurring_course
2025-08-10 15:04:30  {"ts":"2025-08-10T15:04:30.311Z","lvl":"info","stage":"nlp","traceId":"line_1754838270168_2pccp9","userId":"U_test_user_qa","intent":"stop_recurring_course"}
2025-08-10 15:04:30  🔍 開始提取 slots - 意圖: stop_recurring_course (用戶: U_test_user_qa)
2025-08-10 15:04:30  🧠 使用對話上下文增強 slots 提取
2025-08-10 15:04:30  📊 規則提取置信度: 1.00
2025-08-10 15:04:30  🤖 啟用 AI 輔助提取...
2025-08-10 15:04:32  ✅ 最終 slots: {
2025-08-10 15:04:32    courseName: '鋼琴課',
2025-08-10 15:04:32    recurrenceType: 'weekly',
2025-08-10 15:04:32    recurring: true,
2025-08-10 15:04:32    dayOfWeek: '週三'
2025-08-10 15:04:32  }
2025-08-10 15:04:32  {"ts":"2025-08-10T15:04:32.165Z","lvl":"info","stage":"slots","traceId":"line_1754838270168_2pccp9","userId":"U_test_user_qa","intent":"stop_recurring_course","slotsSummary":["courseName","recurrenceType","recurring","dayOfWeek"]}
2025-08-10 15:04:32  🎯 執行任務: stop_recurring_course
2025-08-10 15:04:32  🗑️ 開始處理取消課程任務: {
2025-08-10 15:04:32    courseName: '鋼琴課',
2025-08-10 15:04:32    recurrenceType: 'weekly',
2025-08-10 15:04:32    recurring: true,
2025-08-10 15:04:32    dayOfWeek: '週三'
2025-08-10 15:04:32  }
2025-08-10 15:04:32  📊 任務執行結果: {
2025-08-10 15:04:32    success: false,
2025-08-10 15:04:32    code: 'MISSING_STUDENT',
2025-08-10 15:04:32    message: '❌ 請提供學生姓名，例如：「取消小明的數學課」'
2025-08-10 15:04:32  }
2025-08-10 15:04:32  {"ts":"2025-08-10T15:04:32.165Z","lvl":"info","stage":"task","traceId":"line_1754838270168_2pccp9","userId":"U_test_user_qa","intent":"stop_recurring_course","success":false,"code":"MISSING_STUDENT","latencyMs":0}
2025-08-10 15:04:32  🔍 檢查 replyToken: test-reply-token-1754838270027
2025-08-10 15:04:32  🧪 檢測到測試 token，跳過真實 LINE API 調用
2025-08-10 15:04:32  📤 [測試模式] 實際業務回覆: ❌ 請提供學生姓名，例如：「取消小明的數學課」
2025-08-10 15:04:32  {"ts":"2025-08-10T15:04:32.446Z","lvl":"info","direction":"outbound","channel":"line","traceId":"line_1754838270168_2pccp9","userId":"U_test_user_qa","textOut":"❌ 請提供學生姓名，例如：「取消小明的數學課」","quickReply":false}
2025-08-10 15:04:45  📨 收到 1 個事件
2025-08-10 15:04:45  📋 事件類型: message
2025-08-10 15:04:45  🔍 完整事件 JSON: {
2025-08-10 15:04:45    "type": "message",
2025-08-10 15:04:45    "message": {
2025-08-10 15:04:45      "type": "text",
2025-08-10 15:04:45      "text": "（同時多使用者發起課表查詢，應全部成功）"
2025-08-10 15:04:45    },
2025-08-10 15:04:45    "source": {
2025-08-10 15:04:45      "userId": "U_test_user_qa",
2025-08-10 15:04:45      "type": "user"
2025-08-10 15:04:45    },
2025-08-10 15:04:45    "replyToken": "test-reply-token-1754838284948",
2025-08-10 15:04:45    "timestamp": 1754838284948
2025-08-10 15:04:45  }
2025-08-10 15:04:45  🧹 檢測到 QA 重置上下文請求，清理用戶上下文: U_test_user_qa
2025-08-10 15:04:45  {"ts":"2025-08-10T15:04:45.135Z","lvl":"info","direction":"inbound","channel":"line","traceId":"line_1754838285135_7iowc4","userId":"U_test_user_qa","textIn":"（同時多使用者發起課表查詢，應全部成功）"}
2025-08-10 15:04:45  🔍 用戶ID類型: string
2025-08-10 15:04:45  🔍 是否測試用戶: true
2025-08-10 15:04:45  🚀 生產用戶，使用真實 LINE Service
2025-08-10 15:04:45  🎯 開始解析意圖: （同時多使用者發起課表查詢，應全部成功） (用戶: U_test_user_qa)
2025-08-10 15:04:45  🤖 啟用 AI 備援識別...
2025-08-10 15:04:45  📨 收到 1 個事件
2025-08-10 15:04:45  📋 事件類型: message
2025-08-10 15:04:45  🔍 完整事件 JSON: {
2025-08-10 15:04:45    "type": "message",
2025-08-10 15:04:45    "message": {
2025-08-10 15:04:45      "type": "text",
2025-08-10 15:04:45      "text": "（同時多使用者發起課表查詢，應全部成功）"
2025-08-10 15:04:45    },
2025-08-10 15:04:45    "source": {
2025-08-10 15:04:45      "userId": "U_test_user_qa",
2025-08-10 15:04:45      "type": "user"
2025-08-10 15:04:45    },
2025-08-10 15:04:45    "replyToken": "test-reply-token-1754838284948",
2025-08-10 15:04:45    "timestamp": 1754838284948
2025-08-10 15:04:45  }
2025-08-10 15:04:45  🧹 檢測到 QA 重置上下文請求，清理用戶上下文: U_test_user_qa
2025-08-10 15:04:45  {"ts":"2025-08-10T15:04:45.135Z","lvl":"info","direction":"inbound","channel":"line","traceId":"line_1754838285135_7iowc4","userId":"U_test_user_qa","textIn":"（同時多使用者發起課表查詢，應全部成功）"}
2025-08-10 15:04:45  🔍 用戶ID類型: string
2025-08-10 15:04:45  🔍 是否測試用戶: true
2025-08-10 15:04:45  🚀 生產用戶，使用真實 LINE Service
2025-08-10 15:04:45  🎯 開始解析意圖: （同時多使用者發起課表查詢，應全部成功） (用戶: U_test_user_qa)
2025-08-10 15:04:45  🤖 啟用 AI 備援識別...
2025-08-10 15:04:45  🤖 AI 識別意圖: query_schedule 信心度: 1
2025-08-10 15:04:45  {"ts":"2025-08-10T15:04:45.879Z","lvl":"info","stage":"nlp","traceId":"line_1754838285135_7iowc4","userId":"U_test_user_qa","intent":"query_schedule"}
2025-08-10 15:04:46  🔍 開始提取 slots - 意圖: query_schedule (用戶: U_test_user_qa)
2025-08-10 15:04:46  🧠 使用對話上下文增強 slots 提取
2025-08-10 15:04:46  📊 規則提取置信度: 0.00
2025-08-10 15:04:46  🔄 規則提取信心度低，AI 輔助增強...
2025-08-10 15:04:47  ✅ 文檔已添加到 error_cases: Bzp0srBF5xCfElrQCfz5
2025-08-10 15:04:47  📊 低置信度案例已記錄: Bzp0srBF5xCfElrQCfz5
2025-08-10 15:04:47  ✅ 最終 slots: { content: '課表查詢' }
2025-08-10 15:04:47  {"ts":"2025-08-10T15:04:47.305Z","lvl":"info","stage":"slots","traceId":"line_1754838285135_7iowc4","userId":"U_test_user_qa","intent":"query_schedule","slotsSummary":["content"]}
2025-08-10 15:04:47  🎯 執行任務: query_schedule
2025-08-10 15:04:47  🎯 開始處理查詢課表任務
2025-08-10 15:04:47  📋 接收參數: { content: '課表查詢' }
2025-08-10 15:04:47  📅 查詢時間範圍: { startDate: '2025-08-10', endDate: '2025-08-16', description: '本週' }
2025-08-10 15:04:47  📚 查詢到 316 筆課程資料
2025-08-10 15:04:47  ❌ 查詢課表任務失敗: TypeError: firebaseService.getRecurringCoursesByStudent is not a function
2025-08-10 15:04:47      at handle_query_schedule_task (/opt/render/project/src/src/tasks/handle_query_schedule_task.js:322:51)
2025-08-10 15:04:47      at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
2025-08-10 15:04:47      at async executeTask (/opt/render/project/src/src/tasks/index.js:121:16)
2025-08-10 15:04:47      at async handleTextMessage (/opt/render/project/src/src/bot/webhook.js:92:20)
2025-08-10 15:04:47      at async handleWebhook (/opt/render/project/src/src/bot/webhook.js:438:13)
2025-08-10 15:04:47      at async /opt/render/project/src/src/index.js:34:5
2025-08-10 15:04:47  📊 任務執行結果: {
2025-08-10 15:04:47    success: false,
2025-08-10 15:04:47    code: 'QUERY_FAILED',
2025-08-10 15:04:47    message: '❌ 查詢課表失敗，請檢查學生姓名並稍後再試。'
2025-08-10 15:04:47  }
2025-08-10 15:04:47  {"ts":"2025-08-10T15:04:47.735Z","lvl":"info","stage":"task","traceId":"line_1754838285135_7iowc4","userId":"U_test_user_qa","intent":"query_schedule","success":false,"code":"QUERY_FAILED","latencyMs":430}
2025-08-10 15:36:19  [34m[1m==>(B[m [1mCloning from https://github.com/grandot/course-mvp-beta(B[m
2025-08-10 15:36:20  [34m[1m==>(B[m [1mChecking out commit c36eea2f1d167de455caa16e1b3ea1a05ab37eda in branch main(B[m
2025-08-10 15:36:22  [34m[1m==>(B[m [1mDownloading cache...(B[m
2025-08-10 15:36:34  [34m[1m==>(B[m [1mTransferred 91MB in 7s. Extraction took 3s.(B[m
2025-08-10 15:36:37  [34m[1m==>(B[m [1mRequesting Node.js version >=20.0.0(B[m
2025-08-10 15:36:38  [34m[1m==>(B[m [1mUsing Node.js version 24.5.0 via /opt/render/project/src/package.json(B[m
2025-08-10 15:36:38  [34m[1m==>(B[m [1mDocs on specifying a Node.js version: https://render.com/docs/node-version(B[m
2025-08-10 15:36:38  [34m[1m==>(B[m [1mRunning build command 'yarn'...(B[m
2025-08-10 15:36:38  yarn install v1.22.22
2025-08-10 15:36:38  info No lockfile found.
2025-08-10 15:36:38  warning package-lock.json found. Your project contains lock files generated by tools other than Yarn. It is advised not to mix package managers in order to avoid resolution inconsistencies caused by unsynchronized lock files. To clear this warning, remove package-lock.json.
2025-08-10 15:36:38  [1/5] Validating package.json...
2025-08-10 15:36:38  [2/5] Resolving packages...
2025-08-10 15:36:46  warning googleapis > google-auth-library > gaxios > node-fetch > fetch-blob > node-domexception@1.0.0: Use your platform's native DOMException instead
2025-08-10 15:36:47  warning eslint@8.57.1: This version is no longer supported. Please see https://eslint.org/version-support for other options.
2025-08-10 15:36:47  warning eslint > @humanwhocodes/config-array@0.13.0: Use @eslint/config-array instead
2025-08-10 15:36:47  warning eslint > @humanwhocodes/config-array > @humanwhocodes/object-schema@2.0.3: Use @eslint/object-schema instead
2025-08-10 15:36:47  warning eslint > file-entry-cache > flat-cache > rimraf@3.0.2: Rimraf versions prior to v4 are no longer supported
2025-08-10 15:36:47  warning eslint > file-entry-cache > flat-cache > rimraf > glob@7.2.3: Glob versions prior to v9 are no longer supported
2025-08-10 15:36:47  warning eslint > file-entry-cache > flat-cache > rimraf > glob > inflight@1.0.6: This module is not supported, and leaks memory. Do not use it. Check out lru-cache if you want a good and tested way to coalesce async requests by a key value, which is much more comprehensive and powerful.
2025-08-10 15:36:49  [3/5] Fetching packages...
2025-08-10 15:36:57  [4/5] Linking dependencies...
2025-08-10 15:37:01  [5/5] Building fresh packages...
2025-08-10 15:37:01  success Saved lockfile.
2025-08-10 15:37:01  Done in 22.76s.
2025-08-10 15:37:03  [34;1m==>[0;22m [1mUploading build...[22m
2025-08-10 15:37:16  [34;1m==>[0;22m [1mUploaded in 5.2s. Compression took 7.3s[22m
2025-08-10 15:37:16  [32;1m==>[0;22m [1mBuild successful 🎉[22m
2025-08-10 15:37:18  [0;34m[1m==> [0m[1mDeploying...[0m
2025-08-10 15:37:46  [32m[1m==>(B[m [1mRunning 'yarn start'(B[m
2025-08-10 15:37:47  yarn run v1.22.22
2025-08-10 15:37:47  $ node src/index.js
2025-08-10 15:37:47  [dotenv@17.2.1] injecting env (0) from .env -- tip: ⚙️  specify custom .env file path with { path: '/custom/path/.env' }
2025-08-10 15:37:47  🚀 應用程式啟動中...
2025-08-10 15:37:47  📍 環境: development
2025-08-10 15:37:47  🤖 LINE Service: Real (生產)
2025-08-10 15:37:47  🚀 課程管理機器人服務已啟動
2025-08-10 15:37:47  📡 服務端口: 3000
2025-08-10 15:37:47  🔗 Webhook: http://localhost:3000/webhook
2025-08-10 15:37:47  ❤️ 健康檢查: http://localhost:3000/health
2025-08-10 15:37:47  ---
2025-08-10 15:37:47  ✅ 所有環境變數已設定完成
2025-08-10 15:37:49  [0;32m[1m==> [0m[1mYour service is live 🎉[0m
2025-08-10 15:37:49  [0;32m[1m==> [0m[1m[0m
2025-08-10 15:37:49  [0;32m[1m==> [0m[1m///////////////////////////////////////////////////////////[0m
2025-08-10 15:37:49  [0;32m[1m==> [0m[1m[0m
2025-08-10 15:37:50  [0;32m[1m==> [0m[1mAvailable at your primary URL https://course-mvp-beta.onrender.com[0m
2025-08-10 15:37:50  [0;32m[1m==> [0m[1m[0m
2025-08-10 15:37:50  [0;32m[1m==> [0m[1m///////////////////////////////////////////////////////////[0m
2025-08-10 15:39:14  [34m[1m==>(B[m [1mCloning from https://github.com/grandot/course-mvp-beta(B[m
2025-08-10 15:39:14  [34m[1m==>(B[m [1mCloning from https://github.com/grandot/course-mvp-beta(B[m
2025-08-10 15:39:16  [34m[1m==>(B[m [1mChecking out commit ff03bbcfa617edf33eb499579d2fcc43f11df142 in branch main(B[m
2025-08-10 15:39:18  [34m[1m==>(B[m [1mDownloading cache...(B[m
2025-08-10 15:39:29  [34m[1m==>(B[m [1mTransferred 91MB in 7s. Extraction took 3s.(B[m
2025-08-10 15:39:31  🧪 使用 Mock Calendar 服務
2025-08-10 15:39:31  ✅ Google Calendar 服務初始化完成（模式：mock）
2025-08-10 15:39:31  🔗 Google Calendar 連接測試成功
2025-08-10 15:39:34  [34m[1m==>(B[m [1mRequesting Node.js version >=20.0.0(B[m
2025-08-10 15:39:35  [34m[1m==>(B[m [1mUsing Node.js version 24.5.0 via /opt/render/project/src/package.json(B[m
2025-08-10 15:39:35  [34m[1m==>(B[m [1mDocs on specifying a Node.js version: https://render.com/docs/node-version(B[m
2025-08-10 15:39:35  [34m[1m==>(B[m [1mRunning build command 'yarn'...(B[m
2025-08-10 15:39:35  yarn install v1.22.22
2025-08-10 15:39:35  info No lockfile found.
2025-08-10 15:39:35  warning package-lock.json found. Your project contains lock files generated by tools other than Yarn. It is advised not to mix package managers in order to avoid resolution inconsistencies caused by unsynchronized lock files. To clear this warning, remove package-lock.json.
2025-08-10 15:39:35  [1/5] Validating package.json...
2025-08-10 15:39:35  [2/5] Resolving packages...
2025-08-10 15:39:39  warning googleapis > google-auth-library > gaxios > node-fetch > fetch-blob > node-domexception@1.0.0: Use your platform's native DOMException instead
2025-08-10 15:39:40  warning eslint@8.57.1: This version is no longer supported. Please see https://eslint.org/version-support for other options.
2025-08-10 15:39:40  warning eslint > @humanwhocodes/config-array@0.13.0: Use @eslint/config-array instead
2025-08-10 15:39:40  warning eslint > @humanwhocodes/config-array > @humanwhocodes/object-schema@2.0.3: Use @eslint/object-schema instead
2025-08-10 15:39:40  warning eslint > file-entry-cache > flat-cache > rimraf@3.0.2: Rimraf versions prior to v4 are no longer supported
2025-08-10 15:39:40  warning eslint > file-entry-cache > flat-cache > rimraf > glob@7.2.3: Glob versions prior to v9 are no longer supported
2025-08-10 15:39:40  warning eslint > file-entry-cache > flat-cache > rimraf > glob > inflight@1.0.6: This module is not supported, and leaks memory. Do not use it. Check out lru-cache if you want a good and tested way to coalesce async requests by a key value, which is much more comprehensive and powerful.
2025-08-10 15:39:42  [3/5] Fetching packages...
2025-08-10 15:39:49  [4/5] Linking dependencies...
2025-08-10 15:39:53  [5/5] Building fresh packages...
2025-08-10 15:39:53  success Saved lockfile.
2025-08-10 15:39:53  Done in 17.72s.
2025-08-10 15:39:56  [34;1m==>[0;22m [1mUploading build...[22m
2025-08-10 15:40:07  [34;1m==>[0;22m [1mUploaded in 4.3s. Compression took 7.0s[22m
2025-08-10 15:40:07  [32;1m==>[0;22m [1mBuild successful 🎉[22m
2025-08-10 15:40:10  [0;34m[1m==> [0m[1mDeploying...[0m
2025-08-10 15:40:38  [32m[1m==>(B[m [1mRunning 'yarn start'(B[m
2025-08-10 15:40:39  yarn run v1.22.22
2025-08-10 15:40:39  $ node src/index.js
2025-08-10 15:40:39  [dotenv@17.2.1] injecting env (0) from .env -- tip: 📡 version env with Radar: https://dotenvx.com/radar
2025-08-10 15:40:39  🚀 應用程式啟動中...
2025-08-10 15:40:39  📍 環境: development
2025-08-10 15:40:39  🤖 LINE Service: Real (生產)
2025-08-10 15:40:39  🚀 課程管理機器人服務已啟動
2025-08-10 15:40:39  📡 服務端口: 3000
2025-08-10 15:40:39  🔗 Webhook: http://localhost:3000/webhook
2025-08-10 15:40:39  ❤️ 健康檢查: http://localhost:3000/health
2025-08-10 15:40:39  ---
2025-08-10 15:40:39  ✅ 所有環境變數已設定完成
2025-08-10 15:40:46  [0;32m[1m==> [0m[1mYour service is live 🎉[0m
2025-08-10 15:40:46  [0;32m[1m==> [0m[1m[0m
2025-08-10 15:40:46  [0;32m[1m==> [0m[1m///////////////////////////////////////////////////////////[0m
2025-08-10 15:40:46  [0;32m[1m==> [0m[1m[0m
2025-08-10 15:40:47  [0;32m[1m==> [0m[1mAvailable at your primary URL https://course-mvp-beta.onrender.com[0m
2025-08-10 15:40:47  [0;32m[1m==> [0m[1m[0m
2025-08-10 15:40:47  [0;32m[1m==> [0m[1m///////////////////////////////////////////////////////////[0m
2025-08-10 15:40:49  🧪 使用 Mock Calendar 服務
2025-08-10 15:40:49  ✅ Google Calendar 服務初始化完成（模式：mock）
2025-08-10 15:40:49  🔗 Google Calendar 連接測試成功
2025-08-10 15:41:33  🔗 Google Calendar 連接測試成功
2025-08-10 15:43:02  [34m[1m==>(B[m [1mCloning from https://github.com/grandot/course-mvp-beta(B[m
2025-08-10 15:43:03  [34m[1m==>(B[m [1mChecking out commit ff03bbcfa617edf33eb499579d2fcc43f11df142 in branch main(B[m
2025-08-10 15:43:05  [34m[1m==>(B[m [1mDownloading cache...(B[m
2025-08-10 15:43:16  [34m[1m==>(B[m [1mTransferred 91MB in 8s. Extraction took 3s.(B[m
2025-08-10 15:43:21  [34m[1m==>(B[m [1mRequesting Node.js version >=20.0.0(B[m
2025-08-10 15:43:22  [34m[1m==>(B[m [1mUsing Node.js version 24.5.0 via /opt/render/project/src/package.json(B[m
2025-08-10 15:43:22  [34m[1m==>(B[m [1mDocs on specifying a Node.js version: https://render.com/docs/node-version(B[m
2025-08-10 15:43:22  [34m[1m==>(B[m [1mRunning build command 'yarn'...(B[m
2025-08-10 15:43:22  yarn install v1.22.22
2025-08-10 15:43:22  info No lockfile found.
2025-08-10 15:43:22  warning package-lock.json found. Your project contains lock files generated by tools other than Yarn. It is advised not to mix package managers in order to avoid resolution inconsistencies caused by unsynchronized lock files. To clear this warning, remove package-lock.json.
2025-08-10 15:43:22  [1/5] Validating package.json...
2025-08-10 15:43:22  [2/5] Resolving packages...
2025-08-10 15:43:26  warning googleapis > google-auth-library > gaxios > node-fetch > fetch-blob > node-domexception@1.0.0: Use your platform's native DOMException instead
2025-08-10 15:43:27  warning eslint@8.57.1: This version is no longer supported. Please see https://eslint.org/version-support for other options.
2025-08-10 15:43:27  warning eslint > @humanwhocodes/config-array@0.13.0: Use @eslint/config-array instead
2025-08-10 15:43:27  warning eslint > file-entry-cache > flat-cache > rimraf@3.0.2: Rimraf versions prior to v4 are no longer supported
2025-08-10 15:43:27  warning eslint > file-entry-cache > flat-cache > rimraf > glob@7.2.3: Glob versions prior to v9 are no longer supported
2025-08-10 15:43:27  warning eslint > file-entry-cache > flat-cache > rimraf > glob > inflight@1.0.6: This module is not supported, and leaks memory. Do not use it. Check out lru-cache if you want a good and tested way to coalesce async requests by a key value, which is much more comprehensive and powerful.
2025-08-10 15:43:27  warning eslint > @humanwhocodes/config-array > @humanwhocodes/object-schema@2.0.3: Use @eslint/object-schema instead
2025-08-10 15:43:28  [3/5] Fetching packages...
2025-08-10 15:43:37  [4/5] Linking dependencies...
2025-08-10 15:43:40  [5/5] Building fresh packages...
2025-08-10 15:43:40  success Saved lockfile.
2025-08-10 15:43:40  Done in 18.02s.
2025-08-10 15:43:43  [34;1m==>[0;22m [1mUploading build...[22m
2025-08-10 15:43:56  [34;1m==>[0;22m [1mUploaded in 4.4s. Compression took 8.6s[22m
2025-08-10 15:43:56  [32;1m==>[0;22m [1mBuild successful 🎉[22m
2025-08-10 15:43:59  [0;34m[1m==> [0m[1mDeploying...[0m
2025-08-10 15:44:13  [32m[1m==>(B[m [1mRunning 'yarn start'(B[m
2025-08-10 15:44:14  yarn run v1.22.22
2025-08-10 15:44:14  $ node src/index.js
2025-08-10 15:44:14  [dotenv@17.2.1] injecting env (0) from .env -- tip: 📡 version env with Radar: https://dotenvx.com/radar
2025-08-10 15:44:14  🚀 應用程式啟動中...
2025-08-10 15:44:14  📍 環境: development
2025-08-10 15:44:14  🤖 LINE Service: Real (生產)
2025-08-10 15:44:14  🚀 課程管理機器人服務已啟動
2025-08-10 15:44:14  📡 服務端口: 3000
2025-08-10 15:44:14  🔗 Webhook: http://localhost:3000/webhook
2025-08-10 15:44:14  ❤️ 健康檢查: http://localhost:3000/health
2025-08-10 15:44:14  ---
2025-08-10 15:44:14  ✅ 所有環境變數已設定完成
2025-08-10 15:44:20  [0;32m[1m==> [0m[1mYour service is live 🎉[0m
2025-08-10 15:44:20  [0;32m[1m==> [0m[1m[0m
2025-08-10 15:44:20  [0;32m[1m==> [0m[1mYour service is live 🎉[0m
2025-08-10 15:44:20  [0;32m[1m==> [0m[1m[0m
2025-08-10 15:44:21  [0;32m[1m==> [0m[1m///////////////////////////////////////////////////////////[0m
2025-08-10 15:44:21  [0;32m[1m==> [0m[1m[0m
2025-08-10 15:44:21  [0;32m[1m==> [0m[1mAvailable at your primary URL https://course-mvp-beta.onrender.com[0m
2025-08-10 15:44:21  [0;32m[1m==> [0m[1m[0m
2025-08-10 15:44:21  [0;32m[1m==> [0m[1m///////////////////////////////////////////////////////////[0m
2025-08-10 15:45:01  🔐 已使用 OAuth2 模式初始化 Google Calendar
2025-08-10 15:45:01  ✅ Google Calendar 服務初始化完成（模式：oauth2）
2025-08-10 15:45:02  🔗 Google Calendar 連接測試成功
2025-08-10 15:47:47  🧪 Mock LINE Service 初始化（測試模式）
2025-08-10 15:47:47  ⚠️ 警告：USE_MOCK_LINE_SERVICE 未設定，建議明確指定
2025-08-10 15:47:47  ❌ Webhook 簽名驗證失敗
2025-08-10 15:47:47  ❌ Webhook 簽名驗證失敗
2025-08-10 15:47:47  ❌ Webhook 簽名驗證失敗
2025-08-10 15:47:47  ❌ Webhook 簽名驗證失敗
2025-08-10 15:47:47  ❌ Webhook 簽名驗證失敗
2025-08-10 15:47:47  ❌ Webhook 簽名驗證失敗
2025-08-10 15:47:47  ❌ Webhook 簽名驗證失敗
2025-08-10 15:49:16  📨 收到 1 個事件
2025-08-10 15:49:16  📋 事件類型: message
2025-08-10 15:49:16  🔍 完整事件 JSON: {
2025-08-10 15:49:16    "type": "message",
2025-08-10 15:49:16    "message": {
2025-08-10 15:49:16      "type": "text",
2025-08-10 15:49:16      "text": "小明明天下午2點要上數學課"
2025-08-10 15:49:16    },
2025-08-10 15:49:16    "source": {
2025-08-10 15:49:16      "userId": "U_test_user_qa",
2025-08-10 15:49:16      "type": "user"
2025-08-10 15:49:16    },
2025-08-10 15:49:16    "replyToken": "test-reply-token-1754840956548",
2025-08-10 15:49:16    "timestamp": 1754840956548
2025-08-10 15:49:16  }
2025-08-10 15:49:16  🧹 檢測到 QA 重置上下文請求，清理用戶上下文: U_test_user_qa
2025-08-10 15:49:16  ✅ Redis 連接成功
2025-08-10 15:49:17  {"ts":"2025-08-10T15:49:17.025Z","lvl":"info","direction":"inbound","channel":"line","traceId":"line_1754840957025_830p8i","userId":"U_test_user_qa","textIn":"小明明天下午2點要上數學課"}
2025-08-10 15:49:17  🔍 用戶ID類型: string
2025-08-10 15:49:17  🔍 是否測試用戶: true
2025-08-10 15:49:17  🚀 生產用戶，使用真實 LINE Service
2025-08-10 15:49:17  🎯 開始解析意圖: 小明明天下午2點要上數學課 (用戶: U_test_user_qa)
2025-08-10 15:49:17  ✅ 意圖規則載入成功，共 24 個意圖
2025-08-10 15:49:17  ✅ 規則匹配成功: add_course
2025-08-10 15:49:17  {"ts":"2025-08-10T15:49:17.172Z","lvl":"info","stage":"nlp","traceId":"line_1754840957025_830p8i","userId":"U_test_user_qa","intent":"add_course"}
2025-08-10 15:49:17  🔍 開始提取 slots - 意圖: add_course (用戶: U_test_user_qa)
2025-08-10 15:49:17  🕒 開始高級時間解析: 小明明天下午2點要上數學課
2025-08-10 15:49:17  ✅ 時間解析成功: {
2025-08-10 15:49:17    input: '小明明天下午2點要上數學課',
2025-08-10 15:49:17    output: '14:00',
2025-08-10 15:49:17    details: { hour: 14, minute: 0, matchType: 'arabic_period', periodInfo: '下午' }
2025-08-10 15:49:17  }
2025-08-10 15:49:17  🧠 使用對話上下文增強 slots 提取
2025-08-10 15:49:17  📊 規則提取置信度: 1.00
2025-08-10 15:49:17  🤖 啟用 AI 輔助提取...
2025-08-10 15:49:17  ✅ OpenAI 服務初始化完成
2025-08-10 15:49:18  ✅ 最終 slots: {
2025-08-10 15:49:18    studentName: '小明',
2025-08-10 15:49:18    courseName: '數學課',
2025-08-10 15:49:18    scheduleTime: '14:00',
2025-08-10 15:49:18    recurring: false,
2025-08-10 15:49:18    timeReference: 'tomorrow'
2025-08-10 15:49:18  }
2025-08-10 15:49:18  {"ts":"2025-08-10T15:49:18.876Z","lvl":"info","stage":"slots","traceId":"line_1754840957025_830p8i","userId":"U_test_user_qa","intent":"add_course","slotsSummary":["studentName","courseName","scheduleTime","recurring","timeReference"]}
2025-08-10 15:49:18  🎯 執行任務: add_course
2025-08-10 15:49:18  🎯 開始處理新增課程任務
2025-08-10 15:49:18  📋 接收參數: {
2025-08-10 15:49:18    studentName: '小明',
2025-08-10 15:49:18    courseName: '數學課',
2025-08-10 15:49:18    scheduleTime: '14:00',
2025-08-10 15:49:18    recurring: false,
2025-08-10 15:49:18    timeReference: 'tomorrow'
2025-08-10 15:49:18  }
2025-08-10 15:49:19  ✅ Firebase 服務初始化完成
2025-08-10 15:49:20  👤 學生日曆: b9bf786ee6f0002a0cbe843b8e27184082718a0ab1875873280de3be93e4a481@group.calendar.google.com
2025-08-10 15:49:20  ❌ 查詢事件失敗: GaxiosError: Not Found
2025-08-10 15:49:20      at Gaxios._request (/opt/render/project/src/node_modules/googleapis-common/node_modules/gaxios/build/cjs/src/gaxios.js:154:23)
2025-08-10 15:49:20      at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
2025-08-10 15:49:20      at async OAuth2Client.requestAsync (/opt/render/project/src/node_modules/googleapis-common/node_modules/google-auth-library/build/src/auth/oauth2client.js:463:20)
2025-08-10 15:49:20      at async createAPIRequestAsync (/opt/render/project/src/node_modules/googleapis-common/build/src/apirequest.js:308:25)
2025-08-10 15:49:20      at async getEvents (/opt/render/project/src/src/services/googleCalendarService.js:259:22)
2025-08-10 15:49:20      at async Object.checkConflict (/opt/render/project/src/src/services/googleCalendarService.js:286:20)
2025-08-10 15:49:20      at async handle_add_course_task (/opt/render/project/src/src/tasks/handle_add_course_task.js:286:27)
2025-08-10 15:49:20      at async executeTask (/opt/render/project/src/src/tasks/index.js:121:16)
2025-08-10 15:49:20      at async handleTextMessage (/opt/render/project/src/src/bot/webhook.js:92:20)
2025-08-10 15:49:20      at async handleWebhook (/opt/render/project/src/src/bot/webhook.js:438:13) {
2025-08-10 15:49:20    config: {
2025-08-10 15:49:20      url: URL {
2025-08-10 15:49:20        href: 'https://www.googleapis.com/calendar/v3/calendars/b9bf786ee6f0002a0cbe843b8e27184082718a0ab1875873280de3be93e4a481%40group.calendar.google.com/events?timeMin=2025-08-11T00%3A00%3A00%2B08%3A00&timeMax=2025-08-11T23%3A59%3A59%2B08%3A00&singleEvents=true&orderBy=startTime',
2025-08-10 15:49:20        origin: 'https://www.googleapis.com',
2025-08-10 15:49:20        protocol: 'https:',
2025-08-10 15:49:20        username: '',
2025-08-10 15:49:20        password: '',
2025-08-10 15:49:20        host: 'www.googleapis.com',
2025-08-10 15:49:20        hostname: 'www.googleapis.com',
2025-08-10 15:49:20        port: '',
2025-08-10 15:49:20        pathname: '/calendar/v3/calendars/b9bf786ee6f0002a0cbe843b8e27184082718a0ab1875873280de3be93e4a481%40group.calendar.google.com/events',
2025-08-10 15:49:20        search: '?timeMin=2025-08-11T00%3A00%3A00%2B08%3A00&timeMax=2025-08-11T23%3A59%3A59%2B08%3A00&singleEvents=true&orderBy=startTime',
2025-08-10 15:49:20        searchParams: URLSearchParams {
2025-08-10 15:49:20          'timeMin' => '2025-08-11T00:00:00+08:00',
2025-08-10 15:49:20          'timeMax' => '2025-08-11T23:59:59+08:00',
2025-08-10 15:49:20  👤 學生日曆: b9bf786ee6f0002a0cbe843b8e27184082718a0ab1875873280de3be93e4a481@group.calendar.google.com
2025-08-10 15:49:20  ❌ 查詢事件失敗: GaxiosError: Not Found
2025-08-10 15:49:20      at Gaxios._request (/opt/render/project/src/node_modules/googleapis-common/node_modules/gaxios/build/cjs/src/gaxios.js:154:23)
2025-08-10 15:49:20      at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
2025-08-10 15:49:20      at async OAuth2Client.requestAsync (/opt/render/project/src/node_modules/googleapis-common/node_modules/google-auth-library/build/src/auth/oauth2client.js:463:20)
2025-08-10 15:49:20      at async createAPIRequestAsync (/opt/render/project/src/node_modules/googleapis-common/build/src/apirequest.js:308:25)
2025-08-10 15:49:20      at async getEvents (/opt/render/project/src/src/services/googleCalendarService.js:259:22)
2025-08-10 15:49:20      at async Object.checkConflict (/opt/render/project/src/src/services/googleCalendarService.js:286:20)
2025-08-10 15:49:20      at async handle_add_course_task (/opt/render/project/src/src/tasks/handle_add_course_task.js:286:27)
2025-08-10 15:49:20      at async executeTask (/opt/render/project/src/src/tasks/index.js:121:16)
2025-08-10 15:49:20      at async handleTextMessage (/opt/render/project/src/src/bot/webhook.js:92:20)
2025-08-10 15:49:20      at async handleWebhook (/opt/render/project/src/src/bot/webhook.js:438:13) {
2025-08-10 15:49:20    config: {
2025-08-10 15:49:20      url: URL {
2025-08-10 15:49:20        href: 'https://www.googleapis.com/calendar/v3/calendars/b9bf786ee6f0002a0cbe843b8e27184082718a0ab1875873280de3be93e4a481%40group.calendar.google.com/events?timeMin=2025-08-11T00%3A00%3A00%2B08%3A00&timeMax=2025-08-11T23%3A59%3A59%2B08%3A00&singleEvents=true&orderBy=startTime',
2025-08-10 15:49:20        origin: 'https://www.googleapis.com',
2025-08-10 15:49:20        protocol: 'https:',
2025-08-10 15:49:20        username: '',
2025-08-10 15:49:20        password: '',
2025-08-10 15:49:20        host: 'www.googleapis.com',
2025-08-10 15:49:20        hostname: 'www.googleapis.com',
2025-08-10 15:49:20        port: '',
2025-08-10 15:49:20        pathname: '/calendar/v3/calendars/b9bf786ee6f0002a0cbe843b8e27184082718a0ab1875873280de3be93e4a481%40group.calendar.google.com/events',
2025-08-10 15:49:20        search: '?timeMin=2025-08-11T00%3A00%3A00%2B08%3A00&timeMax=2025-08-11T23%3A59%3A59%2B08%3A00&singleEvents=true&orderBy=startTime',
2025-08-10 15:49:20        searchParams: URLSearchParams {
2025-08-10 15:49:20          'timeMin' => '2025-08-11T00:00:00+08:00',
2025-08-10 15:49:20          'timeMax' => '2025-08-11T23:59:59+08:00',
2025-08-10 15:49:20          'singleEvents' => 'true',
2025-08-10 15:49:20          'orderBy' => 'startTime' },
2025-08-10 15:49:20        hash: ''
2025-08-10 15:49:20      },
2025-08-10 15:49:20      method: 'GET',
2025-08-10 15:49:20      apiVersion: '',
2025-08-10 15:49:20      userAgentDirectives: [ [Object] ],
2025-08-10 15:49:20      paramsSerializer: [Function (anonymous)],
2025-08-10 15:49:20      headers: Headers {
2025-08-10 15:49:20        'accept-encoding': 'gzip',
2025-08-10 15:49:20        authorization: '<<REDACTED> - See `errorRedactor` option in `gaxios` for configuration>.',
2025-08-10 15:49:20        'user-agent': 'google-api-nodejs-client/8.0.0 (gzip)',
2025-08-10 15:49:20        'x-goog-api-client': 'gdcl/8.0.0 gl-node/24.5.0'
2025-08-10 15:49:20      },
2025-08-10 15:49:20      params: {
2025-08-10 15:49:20        timeMin: '2025-08-11T00:00:00+08:00',
2025-08-10 15:49:20        timeMax: '2025-08-11T23:59:59+08:00',
2025-08-10 15:49:20        singleEvents: true,
2025-08-10 15:49:20        orderBy: 'startTime'
2025-08-10 15:49:20      },
2025-08-10 15:49:20      validateStatus: [Function (anonymous)],
2025-08-10 15:49:20      retry: true,
2025-08-10 15:49:20      responseType: 'unknown',
2025-08-10 15:49:20      errorRedactor: [Function: defaultErrorRedactor],
2025-08-10 15:49:20      retryConfig: {
2025-08-10 15:49:20        currentRetryAttempt: 0,
2025-08-10 15:49:20        retry: 3,
2025-08-10 15:49:20        httpMethodsToRetry: [Array],
2025-08-10 15:49:20        noResponseRetries: 2,
2025-08-10 15:49:20        retryDelayMultiplier: 2,
2025-08-10 15:49:20        timeOfFirstRequest: 1754840960470,
2025-08-10 15:49:20        totalTimeout: 9007199254740991,
2025-08-10 15:49:20        maxRetryDelay: 9007199254740991,
2025-08-10 15:49:20        statusCodesToRetry: [Array]
2025-08-10 15:49:20      }
2025-08-10 15:49:20    },
2025-08-10 15:49:20    response: Response {
2025-08-10 15:49:20      size: 0,
2025-08-10 15:49:20      data: { error: [Object] },
2025-08-10 15:49:20      config: {
2025-08-10 15:49:20        url: URL {},
2025-08-10 15:49:20        method: 'GET',
2025-08-10 15:49:20        apiVersion: '',
2025-08-10 15:49:20        userAgentDirectives: [Array],
2025-08-10 15:49:20        paramsSerializer: [Function (anonymous)],
2025-08-10 15:49:20        headers: Headers {
2025-08-10 15:49:20          'accept-encoding': 'gzip',
2025-08-10 15:49:20          authorization: '<<REDACTED> - See `errorRedactor` option in `gaxios` for configuration>.',
2025-08-10 15:49:20          'user-agent': 'google-api-nodejs-client/8.0.0 (gzip)',
2025-08-10 15:49:20          'x-goog-api-client': 'gdcl/8.0.0 gl-node/24.5.0'
2025-08-10 15:49:20        },
2025-08-10 15:49:20        params: [Object],
2025-08-10 15:49:20        validateStatus: [Function (anonymous)],
2025-08-10 15:49:20        retry: true,
2025-08-10 15:49:20        responseType: 'unknown',
2025-08-10 15:49:20        errorRedactor: [Function: defaultErrorRedactor]
2025-08-10 15:49:20      },
2025-08-10 15:49:20      Symbol(Body internals): {
2025-08-10 15:49:20        body: [Gunzip],
2025-08-10 15:49:20        stream: [Gunzip],
2025-08-10 15:49:20        boundary: null,
2025-08-10 15:49:20        disturbed: true,
2025-08-10 15:49:20        error: null
2025-08-10 15:49:20      },
2025-08-10 15:49:20      Symbol(Response internals): {
2025-08-10 15:49:20        type: 'default',
2025-08-10 15:49:20        url: 'https://www.googleapis.com/calendar/v3/calendars/b9bf786ee6f0002a0cbe843b8e27184082718a0ab1875873280de3be93e4a481%40group.calendar.google.com/events?timeMin=2025-08-11T00%3A00%3A00%2B08%3A00&timeMax=2025-08-11T23%3A59%3A59%2B08%3A00&singleEvents=true&orderBy=startTime',
2025-08-10 15:49:20        status: 404,
2025-08-10 15:49:20        statusText: 'Not Found',
2025-08-10 15:49:20        headers: [Object],
2025-08-10 15:49:20        counter: 0,
2025-08-10 15:49:20        highWaterMark: 16384
2025-08-10 15:49:20      }
2025-08-10 15:49:20  👤 學生日曆: b9bf786ee6f0002a0cbe843b8e27184082718a0ab1875873280de3be93e4a481@group.calendar.google.com
2025-08-10 15:49:20  ❌ 查詢事件失敗: GaxiosError: Not Found
2025-08-10 15:49:20      at Gaxios._request (/opt/render/project/src/node_modules/googleapis-common/node_modules/gaxios/build/cjs/src/gaxios.js:154:23)
2025-08-10 15:49:20      at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
2025-08-10 15:49:20      at async OAuth2Client.requestAsync (/opt/render/project/src/node_modules/googleapis-common/node_modules/google-auth-library/build/src/auth/oauth2client.js:463:20)
2025-08-10 15:49:20      at async createAPIRequestAsync (/opt/render/project/src/node_modules/googleapis-common/build/src/apirequest.js:308:25)
2025-08-10 15:49:20      at async getEvents (/opt/render/project/src/src/services/googleCalendarService.js:259:22)
2025-08-10 15:49:20      at async Object.checkConflict (/opt/render/project/src/src/services/googleCalendarService.js:286:20)
2025-08-10 15:49:20      at async handle_add_course_task (/opt/render/project/src/src/tasks/handle_add_course_task.js:286:27)
2025-08-10 15:49:20      at async executeTask (/opt/render/project/src/src/tasks/index.js:121:16)
2025-08-10 15:49:20      at async handleTextMessage (/opt/render/project/src/src/bot/webhook.js:92:20)
2025-08-10 15:49:20      at async handleWebhook (/opt/render/project/src/src/bot/webhook.js:438:13) {
2025-08-10 15:49:20    config: {
2025-08-10 15:49:20      url: URL {
2025-08-10 15:49:20        href: 'https://www.googleapis.com/calendar/v3/calendars/b9bf786ee6f0002a0cbe843b8e27184082718a0ab1875873280de3be93e4a481%40group.calendar.google.com/events?timeMin=2025-08-11T00%3A00%3A00%2B08%3A00&timeMax=2025-08-11T23%3A59%3A59%2B08%3A00&singleEvents=true&orderBy=startTime',
2025-08-10 15:49:20        origin: 'https://www.googleapis.com',
2025-08-10 15:49:20        protocol: 'https:',
2025-08-10 15:49:20        username: '',
2025-08-10 15:49:20        password: '',
2025-08-10 15:49:20        host: 'www.googleapis.com',
2025-08-10 15:49:20        hostname: 'www.googleapis.com',
2025-08-10 15:49:20        port: '',
2025-08-10 15:49:20        pathname: '/calendar/v3/calendars/b9bf786ee6f0002a0cbe843b8e27184082718a0ab1875873280de3be93e4a481%40group.calendar.google.com/events',
2025-08-10 15:49:20        search: '?timeMin=2025-08-11T00%3A00%3A00%2B08%3A00&timeMax=2025-08-11T23%3A59%3A59%2B08%3A00&singleEvents=true&orderBy=startTime',
2025-08-10 15:49:20        searchParams: URLSearchParams {
2025-08-10 15:49:20          'timeMin' => '2025-08-11T00:00:00+08:00',
2025-08-10 15:49:20          'timeMax' => '2025-08-11T23:59:59+08:00',
2025-08-10 15:49:20          'singleEvents' => 'true',
2025-08-10 15:49:20          'orderBy' => 'startTime' },
2025-08-10 15:49:20        hash: ''
2025-08-10 15:49:20      },
2025-08-10 15:49:20      method: 'GET',
2025-08-10 15:49:20      apiVersion: '',
2025-08-10 15:49:20      userAgentDirectives: [ [Object] ],
2025-08-10 15:49:20      paramsSerializer: [Function (anonymous)],
2025-08-10 15:49:20      headers: Headers {
2025-08-10 15:49:20        'accept-encoding': 'gzip',
2025-08-10 15:49:20        authorization: '<<REDACTED> - See `errorRedactor` option in `gaxios` for configuration>.',
2025-08-10 15:49:20        'user-agent': 'google-api-nodejs-client/8.0.0 (gzip)',
2025-08-10 15:49:20        'x-goog-api-client': 'gdcl/8.0.0 gl-node/24.5.0'
2025-08-10 15:49:20      },
2025-08-10 15:49:20      params: {
2025-08-10 15:49:20        timeMin: '2025-08-11T00:00:00+08:00',
2025-08-10 15:49:20        timeMax: '2025-08-11T23:59:59+08:00',
2025-08-10 15:49:20        singleEvents: true,
2025-08-10 15:49:20        orderBy: 'startTime'
2025-08-10 15:49:20      },
2025-08-10 15:49:20      validateStatus: [Function (anonymous)],
2025-08-10 15:49:20      retry: true,
2025-08-10 15:49:20      responseType: 'unknown',
2025-08-10 15:49:20      errorRedactor: [Function: defaultErrorRedactor],
2025-08-10 15:49:20      retryConfig: {
2025-08-10 15:49:20        currentRetryAttempt: 0,
2025-08-10 15:49:20        retry: 3,
2025-08-10 15:49:20        httpMethodsToRetry: [Array],
2025-08-10 15:49:20        noResponseRetries: 2,
2025-08-10 15:49:20        retryDelayMultiplier: 2,
2025-08-10 15:49:20        timeOfFirstRequest: 1754840960470,
2025-08-10 15:49:20        totalTimeout: 9007199254740991,
2025-08-10 15:49:20        maxRetryDelay: 9007199254740991,
2025-08-10 15:49:20        statusCodesToRetry: [Array]
2025-08-10 15:49:20      }
2025-08-10 15:49:20    },
2025-08-10 15:49:20    response: Response {
2025-08-10 15:49:20      size: 0,
2025-08-10 15:49:20      data: { error: [Object] },
2025-08-10 15:49:20      config: {
2025-08-10 15:49:20        url: URL {},
2025-08-10 15:49:20        method: 'GET',
2025-08-10 15:49:20        apiVersion: '',
2025-08-10 15:49:20        userAgentDirectives: [Array],
2025-08-10 15:49:20        paramsSerializer: [Function (anonymous)],
2025-08-10 15:49:20        headers: Headers {
2025-08-10 15:49:20          'accept-encoding': 'gzip',
2025-08-10 15:49:20          authorization: '<<REDACTED> - See `errorRedactor` option in `gaxios` for configuration>.',
2025-08-10 15:49:20          'user-agent': 'google-api-nodejs-client/8.0.0 (gzip)',
2025-08-10 15:49:20          'x-goog-api-client': 'gdcl/8.0.0 gl-node/24.5.0'
2025-08-10 15:49:20        },
2025-08-10 15:49:20        params: [Object],
2025-08-10 15:49:20        validateStatus: [Function (anonymous)],
2025-08-10 15:49:20        retry: true,
2025-08-10 15:49:20        responseType: 'unknown',
2025-08-10 15:49:20        errorRedactor: [Function: defaultErrorRedactor]
2025-08-10 15:49:20      },
2025-08-10 15:49:20      Symbol(Body internals): {
2025-08-10 15:49:20        body: [Gunzip],
2025-08-10 15:49:20        stream: [Gunzip],
2025-08-10 15:49:20        boundary: null,
2025-08-10 15:49:20        disturbed: true,
2025-08-10 15:49:20        error: null
2025-08-10 15:49:20      },
2025-08-10 15:49:20      Symbol(Response internals): {
2025-08-10 15:49:20        type: 'default',
2025-08-10 15:49:20        url: 'https://www.googleapis.com/calendar/v3/calendars/b9bf786ee6f0002a0cbe843b8e27184082718a0ab1875873280de3be93e4a481%40group.calendar.google.com/events?timeMin=2025-08-11T00%3A00%3A00%2B08%3A00&timeMax=2025-08-11T23%3A59%3A59%2B08%3A00&singleEvents=true&orderBy=startTime',
2025-08-10 15:49:20        status: 404,
2025-08-10 15:49:20        statusText: 'Not Found',
2025-08-10 15:49:20        headers: [Object],
2025-08-10 15:49:20        counter: 0,
2025-08-10 15:49:20        highWaterMark: 16384
2025-08-10 15:49:20      }
2025-08-10 15:49:20  👤 學生日曆: b9bf786ee6f0002a0cbe843b8e27184082718a0ab1875873280de3be93e4a481@group.calendar.google.com
2025-08-10 15:49:20  ❌ 查詢事件失敗: GaxiosError: Not Found
2025-08-10 15:49:20      at Gaxios._request (/opt/render/project/src/node_modules/googleapis-common/node_modules/gaxios/build/cjs/src/gaxios.js:154:23)
2025-08-10 15:49:20      at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
2025-08-10 15:49:20      at async OAuth2Client.requestAsync (/opt/render/project/src/node_modules/googleapis-common/node_modules/google-auth-library/build/src/auth/oauth2client.js:463:20)
2025-08-10 15:49:20      at async createAPIRequestAsync (/opt/render/project/src/node_modules/googleapis-common/build/src/apirequest.js:308:25)
2025-08-10 15:49:20      at async getEvents (/opt/render/project/src/src/services/googleCalendarService.js:259:22)
2025-08-10 15:49:20      at async Object.checkConflict (/opt/render/project/src/src/services/googleCalendarService.js:286:20)
2025-08-10 15:49:20      at async handle_add_course_task (/opt/render/project/src/src/tasks/handle_add_course_task.js:286:27)
2025-08-10 15:49:20      at async executeTask (/opt/render/project/src/src/tasks/index.js:121:16)
2025-08-10 15:49:20      at async handleTextMessage (/opt/render/project/src/src/bot/webhook.js:92:20)
2025-08-10 15:49:20      at async handleWebhook (/opt/render/project/src/src/bot/webhook.js:438:13) {
2025-08-10 15:49:20    config: {
2025-08-10 15:49:20      url: URL {
2025-08-10 15:49:20        href: 'https://www.googleapis.com/calendar/v3/calendars/b9bf786ee6f0002a0cbe843b8e27184082718a0ab1875873280de3be93e4a481%40group.calendar.google.com/events?timeMin=2025-08-11T00%3A00%3A00%2B08%3A00&timeMax=2025-08-11T23%3A59%3A59%2B08%3A00&singleEvents=true&orderBy=startTime',
2025-08-10 15:49:20        origin: 'https://www.googleapis.com',
2025-08-10 15:49:20        protocol: 'https:',
2025-08-10 15:49:20        username: '',
2025-08-10 15:49:20        password: '',
2025-08-10 15:49:20        host: 'www.googleapis.com',
2025-08-10 15:49:20        hostname: 'www.googleapis.com',
2025-08-10 15:49:20        port: '',
2025-08-10 15:49:20        pathname: '/calendar/v3/calendars/b9bf786ee6f0002a0cbe843b8e27184082718a0ab1875873280de3be93e4a481%40group.calendar.google.com/events',
2025-08-10 15:49:20        search: '?timeMin=2025-08-11T00%3A00%3A00%2B08%3A00&timeMax=2025-08-11T23%3A59%3A59%2B08%3A00&singleEvents=true&orderBy=startTime',
2025-08-10 15:49:20        searchParams: URLSearchParams {
2025-08-10 15:49:20          'timeMin' => '2025-08-11T00:00:00+08:00',
2025-08-10 15:49:20          'timeMax' => '2025-08-11T23:59:59+08:00',
2025-08-10 15:49:20          'singleEvents' => 'true',
2025-08-10 15:49:20          'orderBy' => 'startTime' },
2025-08-10 15:49:20        hash: ''
2025-08-10 15:49:20      },
2025-08-10 15:49:20      method: 'GET',
2025-08-10 15:49:20      apiVersion: '',
2025-08-10 15:49:20      userAgentDirectives: [ [Object] ],
2025-08-10 15:49:20      paramsSerializer: [Function (anonymous)],
2025-08-10 15:49:20      headers: Headers {
2025-08-10 15:49:20        'accept-encoding': 'gzip',
2025-08-10 15:49:20        authorization: '<<REDACTED> - See `errorRedactor` option in `gaxios` for configuration>.',
2025-08-10 15:49:20        'user-agent': 'google-api-nodejs-client/8.0.0 (gzip)',
2025-08-10 15:49:20        'x-goog-api-client': 'gdcl/8.0.0 gl-node/24.5.0'
2025-08-10 15:49:20      },
2025-08-10 15:49:20      params: {
2025-08-10 15:49:20        timeMin: '2025-08-11T00:00:00+08:00',
2025-08-10 15:49:20        timeMax: '2025-08-11T23:59:59+08:00',
2025-08-10 15:49:20        singleEvents: true,
2025-08-10 15:49:20        orderBy: 'startTime'
2025-08-10 15:49:20      },
2025-08-10 15:49:20      validateStatus: [Function (anonymous)],
2025-08-10 15:49:20      retry: true,
2025-08-10 15:49:20      responseType: 'unknown',
2025-08-10 15:49:20      errorRedactor: [Function: defaultErrorRedactor],
2025-08-10 15:49:20      retryConfig: {
2025-08-10 15:49:20        currentRetryAttempt: 0,
2025-08-10 15:49:20        retry: 3,
2025-08-10 15:49:20        httpMethodsToRetry: [Array],
2025-08-10 15:49:20        noResponseRetries: 2,
2025-08-10 15:49:20        retryDelayMultiplier: 2,
2025-08-10 15:49:20        timeOfFirstRequest: 1754840960470,
2025-08-10 15:49:20        totalTimeout: 9007199254740991,
2025-08-10 15:49:20        maxRetryDelay: 9007199254740991,
2025-08-10 15:49:20        statusCodesToRetry: [Array]
2025-08-10 15:49:20      }
2025-08-10 15:49:20    },
2025-08-10 15:49:20    response: Response {
2025-08-10 15:49:20      size: 0,
2025-08-10 15:49:20      data: { error: [Object] },
2025-08-10 15:49:20      config: {
2025-08-10 15:49:20        url: URL {},
2025-08-10 15:49:20        method: 'GET',
2025-08-10 15:49:20        apiVersion: '',
2025-08-10 15:49:20        userAgentDirectives: [Array],
2025-08-10 15:49:20        paramsSerializer: [Function (anonymous)],
2025-08-10 15:49:20        headers: Headers {
2025-08-10 15:49:20          'accept-encoding': 'gzip',
2025-08-10 15:49:20          authorization: '<<REDACTED> - See `errorRedactor` option in `gaxios` for configuration>.',
2025-08-10 15:49:20          'user-agent': 'google-api-nodejs-client/8.0.0 (gzip)',
2025-08-10 15:49:20          'x-goog-api-client': 'gdcl/8.0.0 gl-node/24.5.0'
2025-08-10 15:49:20        },
2025-08-10 15:49:20        params: [Object],
2025-08-10 15:49:20        validateStatus: [Function (anonymous)],
2025-08-10 15:49:20        retry: true,
2025-08-10 15:49:20        responseType: 'unknown',
2025-08-10 15:49:20        errorRedactor: [Function: defaultErrorRedactor]
2025-08-10 15:49:20      },
2025-08-10 15:49:20      Symbol(Body internals): {
2025-08-10 15:49:20        body: [Gunzip],
2025-08-10 15:49:20        stream: [Gunzip],
2025-08-10 15:49:20        boundary: null,
2025-08-10 15:49:20        disturbed: true,
2025-08-10 15:49:20        error: null
2025-08-10 15:49:20      },
2025-08-10 15:49:20      Symbol(Response internals): {
2025-08-10 15:49:20        type: 'default',
2025-08-10 15:49:20        url: 'https://www.googleapis.com/calendar/v3/calendars/b9bf786ee6f0002a0cbe843b8e27184082718a0ab1875873280de3be93e4a481%40group.calendar.google.com/events?timeMin=2025-08-11T00%3A00%3A00%2B08%3A00&timeMax=2025-08-11T23%3A59%3A59%2B08%3A00&singleEvents=true&orderBy=startTime',
2025-08-10 15:49:20        status: 404,
2025-08-10 15:49:20        statusText: 'Not Found',
2025-08-10 15:49:20        headers: [Object],
2025-08-10 15:49:20        counter: 0,
2025-08-10 15:49:20        highWaterMark: 16384
2025-08-10 15:49:20      }
2025-08-10 15:49:20  👤 學生日曆: b9bf786ee6f0002a0cbe843b8e27184082718a0ab1875873280de3be93e4a481@group.calendar.google.com
2025-08-10 15:49:20  ❌ 查詢事件失敗: GaxiosError: Not Found
2025-08-10 15:49:20      at Gaxios._request (/opt/render/project/src/node_modules/googleapis-common/node_modules/gaxios/build/cjs/src/gaxios.js:154:23)
2025-08-10 15:49:20      at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
2025-08-10 15:49:20      at async OAuth2Client.requestAsync (/opt/render/project/src/node_modules/googleapis-common/node_modules/google-auth-library/build/src/auth/oauth2client.js:463:20)
2025-08-10 15:49:20      at async createAPIRequestAsync (/opt/render/project/src/node_modules/googleapis-common/build/src/apirequest.js:308:25)
2025-08-10 15:49:20      at async getEvents (/opt/render/project/src/src/services/googleCalendarService.js:259:22)
2025-08-10 15:49:20      at async Object.checkConflict (/opt/render/project/src/src/services/googleCalendarService.js:286:20)
2025-08-10 15:49:20      at async handle_add_course_task (/opt/render/project/src/src/tasks/handle_add_course_task.js:286:27)
2025-08-10 15:49:20      at async executeTask (/opt/render/project/src/src/tasks/index.js:121:16)
2025-08-10 15:49:20      at async handleTextMessage (/opt/render/project/src/src/bot/webhook.js:92:20)
2025-08-10 15:49:20      at async handleWebhook (/opt/render/project/src/src/bot/webhook.js:438:13) {
2025-08-10 15:49:20    config: {
2025-08-10 15:49:20      url: URL {
2025-08-10 15:49:20        href: 'https://www.googleapis.com/calendar/v3/calendars/b9bf786ee6f0002a0cbe843b8e27184082718a0ab1875873280de3be93e4a481%40group.calendar.google.com/events?timeMin=2025-08-11T00%3A00%3A00%2B08%3A00&timeMax=2025-08-11T23%3A59%3A59%2B08%3A00&singleEvents=true&orderBy=startTime',
2025-08-10 15:49:20        origin: 'https://www.googleapis.com',
2025-08-10 15:49:20        protocol: 'https:',
2025-08-10 15:49:20        username: '',
2025-08-10 15:49:20        password: '',
2025-08-10 15:49:20        host: 'www.googleapis.com',
2025-08-10 15:49:20        hostname: 'www.googleapis.com',
2025-08-10 15:49:20        port: '',
2025-08-10 15:49:20        pathname: '/calendar/v3/calendars/b9bf786ee6f0002a0cbe843b8e27184082718a0ab1875873280de3be93e4a481%40group.calendar.google.com/events',
2025-08-10 15:49:20        search: '?timeMin=2025-08-11T00%3A00%3A00%2B08%3A00&timeMax=2025-08-11T23%3A59%3A59%2B08%3A00&singleEvents=true&orderBy=startTime',
2025-08-10 15:49:20        searchParams: URLSearchParams {
2025-08-10 15:49:20          'timeMin' => '2025-08-11T00:00:00+08:00',
2025-08-10 15:49:20          'timeMax' => '2025-08-11T23:59:59+08:00',
2025-08-10 15:49:20          'singleEvents' => 'true',
2025-08-10 15:49:20          'orderBy' => 'startTime' },
2025-08-10 15:49:20        hash: ''
2025-08-10 15:49:20      },
2025-08-10 15:49:20      method: 'GET',
2025-08-10 15:49:20      apiVersion: '',
2025-08-10 15:49:20      userAgentDirectives: [ [Object] ],
2025-08-10 15:49:20      paramsSerializer: [Function (anonymous)],
2025-08-10 15:49:20      headers: Headers {
2025-08-10 15:49:20        'accept-encoding': 'gzip',
2025-08-10 15:49:20        authorization: '<<REDACTED> - See `errorRedactor` option in `gaxios` for configuration>.',
2025-08-10 15:49:20        'user-agent': 'google-api-nodejs-client/8.0.0 (gzip)',
2025-08-10 15:49:20        'x-goog-api-client': 'gdcl/8.0.0 gl-node/24.5.0'
2025-08-10 15:49:20      },
2025-08-10 15:49:20      params: {
2025-08-10 15:49:20        timeMin: '2025-08-11T00:00:00+08:00',
2025-08-10 15:49:20        timeMax: '2025-08-11T23:59:59+08:00',
2025-08-10 15:49:20        singleEvents: true,
2025-08-10 15:49:20        orderBy: 'startTime'
2025-08-10 15:49:20      },
2025-08-10 15:49:20      validateStatus: [Function (anonymous)],
2025-08-10 15:49:20      retry: true,
2025-08-10 15:49:20      responseType: 'unknown',
2025-08-10 15:49:20      errorRedactor: [Function: defaultErrorRedactor],
2025-08-10 15:49:20      retryConfig: {
2025-08-10 15:49:20        currentRetryAttempt: 0,
2025-08-10 15:49:20        retry: 3,
2025-08-10 15:49:20        httpMethodsToRetry: [Array],
2025-08-10 15:49:20        noResponseRetries: 2,
2025-08-10 15:49:20        retryDelayMultiplier: 2,
2025-08-10 15:49:20        timeOfFirstRequest: 1754840960470,
2025-08-10 15:49:20        totalTimeout: 9007199254740991,
2025-08-10 15:49:20        maxRetryDelay: 9007199254740991,
2025-08-10 15:49:20        statusCodesToRetry: [Array]
2025-08-10 15:49:20      }
2025-08-10 15:49:20    },
2025-08-10 15:49:20    response: Response {
2025-08-10 15:49:20      size: 0,
2025-08-10 15:49:20      data: { error: [Object] },
2025-08-10 15:49:20      config: {
2025-08-10 15:49:20        url: URL {},
2025-08-10 15:49:20        method: 'GET',
2025-08-10 15:49:20        apiVersion: '',
2025-08-10 15:49:20        userAgentDirectives: [Array],
2025-08-10 15:49:20        paramsSerializer: [Function (anonymous)],
2025-08-10 15:49:20        headers: Headers {
2025-08-10 15:49:20          'accept-encoding': 'gzip',
2025-08-10 15:49:20          authorization: '<<REDACTED> - See `errorRedactor` option in `gaxios` for configuration>.',
2025-08-10 15:49:20          'user-agent': 'google-api-nodejs-client/8.0.0 (gzip)',
2025-08-10 15:49:20          'x-goog-api-client': 'gdcl/8.0.0 gl-node/24.5.0'
2025-08-10 15:49:20        },
2025-08-10 15:49:20        params: [Object],
2025-08-10 15:49:20        validateStatus: [Function (anonymous)],
2025-08-10 15:49:20        retry: true,
2025-08-10 15:49:20        responseType: 'unknown',
2025-08-10 15:49:20        errorRedactor: [Function: defaultErrorRedactor]
2025-08-10 15:49:20      },
2025-08-10 15:49:20      Symbol(Body internals): {
2025-08-10 15:49:20        body: [Gunzip],
2025-08-10 15:49:20        stream: [Gunzip],
2025-08-10 15:49:20        boundary: null,
2025-08-10 15:49:20        disturbed: true,
2025-08-10 15:49:20        error: null
2025-08-10 15:49:20      },
2025-08-10 15:49:20      Symbol(Response internals): {
2025-08-10 15:49:20        type: 'default',
2025-08-10 15:49:20        url: 'https://www.googleapis.com/calendar/v3/calendars/b9bf786ee6f0002a0cbe843b8e27184082718a0ab1875873280de3be93e4a481%40group.calendar.google.com/events?timeMin=2025-08-11T00%3A00%3A00%2B08%3A00&timeMax=2025-08-11T23%3A59%3A59%2B08%3A00&singleEvents=true&orderBy=startTime',
2025-08-10 15:49:20        status: 404,
2025-08-10 15:49:20        statusText: 'Not Found',
2025-08-10 15:49:20        headers: [Object],
2025-08-10 15:49:20        counter: 0,
2025-08-10 15:49:20        highWaterMark: 16384
2025-08-10 15:49:20      }
2025-08-10 15:49:20  👤 學生日曆: b9bf786ee6f0002a0cbe843b8e27184082718a0ab1875873280de3be93e4a481@group.calendar.google.com
2025-08-10 15:49:20  ❌ 查詢事件失敗: GaxiosError: Not Found
2025-08-10 15:49:20      at Gaxios._request (/opt/render/project/src/node_modules/googleapis-common/node_modules/gaxios/build/cjs/src/gaxios.js:154:23)
2025-08-10 15:49:20      at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
2025-08-10 15:49:20      at async OAuth2Client.requestAsync (/opt/render/project/src/node_modules/googleapis-common/node_modules/google-auth-library/build/src/auth/oauth2client.js:463:20)
2025-08-10 15:49:20      at async createAPIRequestAsync (/opt/render/project/src/node_modules/googleapis-common/build/src/apirequest.js:308:25)
2025-08-10 15:49:20      at async getEvents (/opt/render/project/src/src/services/googleCalendarService.js:259:22)
2025-08-10 15:49:20      at async Object.checkConflict (/opt/render/project/src/src/services/googleCalendarService.js:286:20)
2025-08-10 15:49:20      at async handle_add_course_task (/opt/render/project/src/src/tasks/handle_add_course_task.js:286:27)
2025-08-10 15:49:20      at async executeTask (/opt/render/project/src/src/tasks/index.js:121:16)
2025-08-10 15:49:20      at async handleTextMessage (/opt/render/project/src/src/bot/webhook.js:92:20)
2025-08-10 15:49:20      at async handleWebhook (/opt/render/project/src/src/bot/webhook.js:438:13) {
2025-08-10 15:49:20    config: {
2025-08-10 15:49:20      url: URL {
2025-08-10 15:49:20        href: 'https://www.googleapis.com/calendar/v3/calendars/b9bf786ee6f0002a0cbe843b8e27184082718a0ab1875873280de3be93e4a481%40group.calendar.google.com/events?timeMin=2025-08-11T00%3A00%3A00%2B08%3A00&timeMax=2025-08-11T23%3A59%3A59%2B08%3A00&singleEvents=true&orderBy=startTime',
2025-08-10 15:49:20        origin: 'https://www.googleapis.com',
2025-08-10 15:49:20        protocol: 'https:',
2025-08-10 15:49:20        username: '',
2025-08-10 15:49:20        password: '',
2025-08-10 15:49:20        host: 'www.googleapis.com',
2025-08-10 15:49:20        hostname: 'www.googleapis.com',
2025-08-10 15:49:20        port: '',
2025-08-10 15:49:20        pathname: '/calendar/v3/calendars/b9bf786ee6f0002a0cbe843b8e27184082718a0ab1875873280de3be93e4a481%40group.calendar.google.com/events',
2025-08-10 15:49:20        search: '?timeMin=2025-08-11T00%3A00%3A00%2B08%3A00&timeMax=2025-08-11T23%3A59%3A59%2B08%3A00&singleEvents=true&orderBy=startTime',
2025-08-10 15:49:20        searchParams: URLSearchParams {
2025-08-10 15:49:20          'timeMin' => '2025-08-11T00:00:00+08:00',
2025-08-10 15:49:20          'timeMax' => '2025-08-11T23:59:59+08:00',
2025-08-10 15:49:20          'singleEvents' => 'true',
2025-08-10 15:49:20          'orderBy' => 'startTime' },
2025-08-10 15:49:20        hash: ''
2025-08-10 15:49:20      },
2025-08-10 15:49:20      method: 'GET',
2025-08-10 15:49:20      apiVersion: '',
2025-08-10 15:49:20      userAgentDirectives: [ [Object] ],
2025-08-10 15:49:20      paramsSerializer: [Function (anonymous)],
2025-08-10 15:49:20      headers: Headers {
2025-08-10 15:49:20        'accept-encoding': 'gzip',
2025-08-10 15:49:20        authorization: '<<REDACTED> - See `errorRedactor` option in `gaxios` for configuration>.',
2025-08-10 15:49:20        'user-agent': 'google-api-nodejs-client/8.0.0 (gzip)',
2025-08-10 15:49:20        'x-goog-api-client': 'gdcl/8.0.0 gl-node/24.5.0'
2025-08-10 15:49:20      },
2025-08-10 15:49:20      params: {
2025-08-10 15:49:20        timeMin: '2025-08-11T00:00:00+08:00',
2025-08-10 15:49:20        timeMax: '2025-08-11T23:59:59+08:00',
2025-08-10 15:49:20        singleEvents: true,
2025-08-10 15:49:20        orderBy: 'startTime'
2025-08-10 15:49:20      },
2025-08-10 15:49:20      validateStatus: [Function (anonymous)],
2025-08-10 15:49:20      retry: true,
2025-08-10 15:49:20      responseType: 'unknown',
2025-08-10 15:49:20      errorRedactor: [Function: defaultErrorRedactor],
2025-08-10 15:49:20      retryConfig: {
2025-08-10 15:49:20        currentRetryAttempt: 0,
2025-08-10 15:49:20        retry: 3,
2025-08-10 15:49:20        httpMethodsToRetry: [Array],
2025-08-10 15:49:20        noResponseRetries: 2,
2025-08-10 15:49:20        retryDelayMultiplier: 2,
2025-08-10 15:49:20        timeOfFirstRequest: 1754840960470,
2025-08-10 15:49:20        totalTimeout: 9007199254740991,
2025-08-10 15:49:20        maxRetryDelay: 9007199254740991,
2025-08-10 15:49:20        statusCodesToRetry: [Array]
2025-08-10 15:49:20      }
2025-08-10 15:49:20    },
2025-08-10 15:49:20    response: Response {
2025-08-10 15:49:20      size: 0,
2025-08-10 15:49:20      data: { error: [Object] },
2025-08-10 15:49:20      config: {
2025-08-10 15:49:20        url: URL {},
2025-08-10 15:49:20        method: 'GET',
2025-08-10 15:49:20        apiVersion: '',
2025-08-10 15:49:20        userAgentDirectives: [Array],
2025-08-10 15:49:20        paramsSerializer: [Function (anonymous)],
2025-08-10 15:49:20        headers: Headers {
2025-08-10 15:49:20          'accept-encoding': 'gzip',
2025-08-10 15:49:20          authorization: '<<REDACTED> - See `errorRedactor` option in `gaxios` for configuration>.',
2025-08-10 15:49:20          'user-agent': 'google-api-nodejs-client/8.0.0 (gzip)',
2025-08-10 15:49:20          'x-goog-api-client': 'gdcl/8.0.0 gl-node/24.5.0'
2025-08-10 15:49:20        },
2025-08-10 15:49:20        params: [Object],
2025-08-10 15:49:20        validateStatus: [Function (anonymous)],
2025-08-10 15:49:20        retry: true,
2025-08-10 15:49:20        responseType: 'unknown',
2025-08-10 15:49:20        errorRedactor: [Function: defaultErrorRedactor]
2025-08-10 15:49:20      },
2025-08-10 15:49:20      Symbol(Body internals): {
2025-08-10 15:49:20        body: [Gunzip],
2025-08-10 15:49:20        stream: [Gunzip],
2025-08-10 15:49:20        boundary: null,
2025-08-10 15:49:20        disturbed: true,
2025-08-10 15:49:20        error: null
2025-08-10 15:49:20      },
2025-08-10 15:49:20      Symbol(Response internals): {
2025-08-10 15:49:20        type: 'default',
2025-08-10 15:49:20        url: 'https://www.googleapis.com/calendar/v3/calendars/b9bf786ee6f0002a0cbe843b8e27184082718a0ab1875873280de3be93e4a481%40group.calendar.google.com/events?timeMin=2025-08-11T00%3A00%3A00%2B08%3A00&timeMax=2025-08-11T23%3A59%3A59%2B08%3A00&singleEvents=true&orderBy=startTime',
2025-08-10 15:49:20        status: 404,
2025-08-10 15:49:20        statusText: 'Not Found',
2025-08-10 15:49:20        headers: [Object],
2025-08-10 15:49:20        counter: 0,
2025-08-10 15:49:20        highWaterMark: 16384
2025-08-10 15:49:20      }
2025-08-10 15:49:20  👤 學生日曆: b9bf786ee6f0002a0cbe843b8e27184082718a0ab1875873280de3be93e4a481@group.calendar.google.com
2025-08-10 15:49:20  ❌ 查詢事件失敗: GaxiosError: Not Found
2025-08-10 15:49:20      at Gaxios._request (/opt/render/project/src/node_modules/googleapis-common/node_modules/gaxios/build/cjs/src/gaxios.js:154:23)
2025-08-10 15:49:20      at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
2025-08-10 15:49:20      at async OAuth2Client.requestAsync (/opt/render/project/src/node_modules/googleapis-common/node_modules/google-auth-library/build/src/auth/oauth2client.js:463:20)
2025-08-10 15:49:20      at async createAPIRequestAsync (/opt/render/project/src/node_modules/googleapis-common/build/src/apirequest.js:308:25)
2025-08-10 15:49:20      at async getEvents (/opt/render/project/src/src/services/googleCalendarService.js:259:22)
2025-08-10 15:49:20      at async Object.checkConflict (/opt/render/project/src/src/services/googleCalendarService.js:286:20)
2025-08-10 15:49:20      at async handle_add_course_task (/opt/render/project/src/src/tasks/handle_add_course_task.js:286:27)
2025-08-10 15:49:20      at async executeTask (/opt/render/project/src/src/tasks/index.js:121:16)
2025-08-10 15:49:20      at async handleTextMessage (/opt/render/project/src/src/bot/webhook.js:92:20)
2025-08-10 15:49:20      at async handleWebhook (/opt/render/project/src/src/bot/webhook.js:438:13) {
2025-08-10 15:49:20    config: {
2025-08-10 15:49:20      url: URL {
2025-08-10 15:49:20        href: 'https://www.googleapis.com/calendar/v3/calendars/b9bf786ee6f0002a0cbe843b8e27184082718a0ab1875873280de3be93e4a481%40group.calendar.google.com/events?timeMin=2025-08-11T00%3A00%3A00%2B08%3A00&timeMax=2025-08-11T23%3A59%3A59%2B08%3A00&singleEvents=true&orderBy=startTime',
2025-08-10 15:49:20        origin: 'https://www.googleapis.com',
2025-08-10 15:49:20        protocol: 'https:',
2025-08-10 15:49:20        username: '',
2025-08-10 15:49:20        password: '',
2025-08-10 15:49:20        host: 'www.googleapis.com',
2025-08-10 15:49:20        hostname: 'www.googleapis.com',
2025-08-10 15:49:20        port: '',
2025-08-10 15:49:20        pathname: '/calendar/v3/calendars/b9bf786ee6f0002a0cbe843b8e27184082718a0ab1875873280de3be93e4a481%40group.calendar.google.com/events',
2025-08-10 15:49:20        search: '?timeMin=2025-08-11T00%3A00%3A00%2B08%3A00&timeMax=2025-08-11T23%3A59%3A59%2B08%3A00&singleEvents=true&orderBy=startTime',
2025-08-10 15:49:20        searchParams: URLSearchParams {
2025-08-10 15:49:20          'timeMin' => '2025-08-11T00:00:00+08:00',
2025-08-10 15:49:20          'timeMax' => '2025-08-11T23:59:59+08:00',
2025-08-10 15:49:20          'singleEvents' => 'true',
2025-08-10 15:49:20          'orderBy' => 'startTime' },
2025-08-10 15:49:20        hash: ''
2025-08-10 15:49:20      },
2025-08-10 15:49:20      method: 'GET',
2025-08-10 15:49:20      apiVersion: '',
2025-08-10 15:49:20      userAgentDirectives: [ [Object] ],
2025-08-10 15:49:20      paramsSerializer: [Function (anonymous)],
2025-08-10 15:49:20      headers: Headers {
2025-08-10 15:49:20        'accept-encoding': 'gzip',
2025-08-10 15:49:20        authorization: '<<REDACTED> - See `errorRedactor` option in `gaxios` for configuration>.',
2025-08-10 15:49:20        'user-agent': 'google-api-nodejs-client/8.0.0 (gzip)',
2025-08-10 15:49:20        'x-goog-api-client': 'gdcl/8.0.0 gl-node/24.5.0'
2025-08-10 15:49:20      },
2025-08-10 15:49:20      params: {
2025-08-10 15:49:20        timeMin: '2025-08-11T00:00:00+08:00',
2025-08-10 15:49:20        timeMax: '2025-08-11T23:59:59+08:00',
2025-08-10 15:49:20        singleEvents: true,
2025-08-10 15:49:20        orderBy: 'startTime'
2025-08-10 15:49:20      },
2025-08-10 15:49:20      validateStatus: [Function (anonymous)],
2025-08-10 15:49:20      retry: true,
2025-08-10 15:49:20      responseType: 'unknown',
2025-08-10 15:49:20      errorRedactor: [Function: defaultErrorRedactor],
2025-08-10 15:49:20      retryConfig: {
2025-08-10 15:49:20        currentRetryAttempt: 0,
2025-08-10 15:49:20        retry: 3,
2025-08-10 15:49:20        httpMethodsToRetry: [Array],
2025-08-10 15:49:20        noResponseRetries: 2,
2025-08-10 15:49:20        retryDelayMultiplier: 2,
2025-08-10 15:49:20        timeOfFirstRequest: 1754840960470,
2025-08-10 15:49:20        totalTimeout: 9007199254740991,
2025-08-10 15:49:20        maxRetryDelay: 9007199254740991,
2025-08-10 15:49:20        statusCodesToRetry: [Array]
2025-08-10 15:49:20      }
2025-08-10 15:49:20    },
2025-08-10 15:49:20    response: Response {
2025-08-10 15:49:20      size: 0,
2025-08-10 15:49:20      data: { error: [Object] },
2025-08-10 15:49:20      config: {
2025-08-10 15:49:20        url: URL {},
2025-08-10 15:49:20        method: 'GET',
2025-08-10 15:49:20        apiVersion: '',
2025-08-10 15:49:20        userAgentDirectives: [Array],
2025-08-10 15:49:20        paramsSerializer: [Function (anonymous)],
2025-08-10 15:49:20        headers: Headers {
2025-08-10 15:49:20          'accept-encoding': 'gzip',
2025-08-10 15:49:20          authorization: '<<REDACTED> - See `errorRedactor` option in `gaxios` for configuration>.',
2025-08-10 15:49:20          'user-agent': 'google-api-nodejs-client/8.0.0 (gzip)',
2025-08-10 15:49:20          'x-goog-api-client': 'gdcl/8.0.0 gl-node/24.5.0'
2025-08-10 15:49:20        },
2025-08-10 15:49:20        params: [Object],
2025-08-10 15:49:20        validateStatus: [Function (anonymous)],
2025-08-10 15:49:20        retry: true,
2025-08-10 15:49:20        responseType: 'unknown',
2025-08-10 15:49:20        errorRedactor: [Function: defaultErrorRedactor]
2025-08-10 15:49:20      },
2025-08-10 15:49:20      Symbol(Body internals): {
2025-08-10 15:49:20        body: [Gunzip],
2025-08-10 15:49:20        stream: [Gunzip],
2025-08-10 15:49:20        boundary: null,
2025-08-10 15:49:20        disturbed: true,
2025-08-10 15:49:20        error: null
2025-08-10 15:49:20      },
2025-08-10 15:49:20      Symbol(Response internals): {
2025-08-10 15:49:20        type: 'default',
2025-08-10 15:49:20        url: 'https://www.googleapis.com/calendar/v3/calendars/b9bf786ee6f0002a0cbe843b8e27184082718a0ab1875873280de3be93e4a481%40group.calendar.google.com/events?timeMin=2025-08-11T00%3A00%3A00%2B08%3A00&timeMax=2025-08-11T23%3A59%3A59%2B08%3A00&singleEvents=true&orderBy=startTime',
2025-08-10 15:49:20        status: 404,
2025-08-10 15:49:20        statusText: 'Not Found',
2025-08-10 15:49:20        headers: [Object],
2025-08-10 15:49:20        counter: 0,
2025-08-10 15:49:20        highWaterMark: 16384
2025-08-10 15:49:20      }
2025-08-10 15:49:20  👤 學生日曆: b9bf786ee6f0002a0cbe843b8e27184082718a0ab1875873280de3be93e4a481@group.calendar.google.com
2025-08-10 15:49:20  ❌ 查詢事件失敗: GaxiosError: Not Found
2025-08-10 15:49:20      at Gaxios._request (/opt/render/project/src/node_modules/googleapis-common/node_modules/gaxios/build/cjs/src/gaxios.js:154:23)
2025-08-10 15:49:20      at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
2025-08-10 15:49:20      at async OAuth2Client.requestAsync (/opt/render/project/src/node_modules/googleapis-common/node_modules/google-auth-library/build/src/auth/oauth2client.js:463:20)
2025-08-10 15:49:20      at async createAPIRequestAsync (/opt/render/project/src/node_modules/googleapis-common/build/src/apirequest.js:308:25)
2025-08-10 15:49:20      at async getEvents (/opt/render/project/src/src/services/googleCalendarService.js:259:22)
2025-08-10 15:49:20      at async Object.checkConflict (/opt/render/project/src/src/services/googleCalendarService.js:286:20)
2025-08-10 15:49:20      at async handle_add_course_task (/opt/render/project/src/src/tasks/handle_add_course_task.js:286:27)
2025-08-10 15:49:20      at async executeTask (/opt/render/project/src/src/tasks/index.js:121:16)
2025-08-10 15:49:20      at async handleTextMessage (/opt/render/project/src/src/bot/webhook.js:92:20)
2025-08-10 15:49:20      at async handleWebhook (/opt/render/project/src/src/bot/webhook.js:438:13) {
2025-08-10 15:49:20    config: {
2025-08-10 15:49:20      url: URL {
2025-08-10 15:49:20        href: 'https://www.googleapis.com/calendar/v3/calendars/b9bf786ee6f0002a0cbe843b8e27184082718a0ab1875873280de3be93e4a481%40group.calendar.google.com/events?timeMin=2025-08-11T00%3A00%3A00%2B08%3A00&timeMax=2025-08-11T23%3A59%3A59%2B08%3A00&singleEvents=true&orderBy=startTime',
2025-08-10 15:49:20        origin: 'https://www.googleapis.com',
2025-08-10 15:49:20        protocol: 'https:',
2025-08-10 15:49:20        username: '',
2025-08-10 15:49:20        password: '',
2025-08-10 15:49:20        host: 'www.googleapis.com',
2025-08-10 15:49:20        hostname: 'www.googleapis.com',
2025-08-10 15:49:20        port: '',
2025-08-10 15:49:20        pathname: '/calendar/v3/calendars/b9bf786ee6f0002a0cbe843b8e27184082718a0ab1875873280de3be93e4a481%40group.calendar.google.com/events',
2025-08-10 15:49:20        search: '?timeMin=2025-08-11T00%3A00%3A00%2B08%3A00&timeMax=2025-08-11T23%3A59%3A59%2B08%3A00&singleEvents=true&orderBy=startTime',
2025-08-10 15:49:20        searchParams: URLSearchParams {
2025-08-10 15:49:20          'timeMin' => '2025-08-11T00:00:00+08:00',
2025-08-10 15:49:20          'timeMax' => '2025-08-11T23:59:59+08:00',
2025-08-10 15:49:20          'singleEvents' => 'true',
2025-08-10 15:49:20          'orderBy' => 'startTime' },
2025-08-10 15:49:20        hash: ''
2025-08-10 15:49:20      },
2025-08-10 15:49:20      method: 'GET',
2025-08-10 15:49:20      apiVersion: '',
2025-08-10 15:49:20      userAgentDirectives: [ [Object] ],
2025-08-10 15:49:20      paramsSerializer: [Function (anonymous)],
2025-08-10 15:49:20      headers: Headers {
2025-08-10 15:49:20        'accept-encoding': 'gzip',
2025-08-10 15:49:20        authorization: '<<REDACTED> - See `errorRedactor` option in `gaxios` for configuration>.',
2025-08-10 15:49:20        'user-agent': 'google-api-nodejs-client/8.0.0 (gzip)',
2025-08-10 15:49:20        'x-goog-api-client': 'gdcl/8.0.0 gl-node/24.5.0'
2025-08-10 15:49:20      },
2025-08-10 15:49:20      params: {
2025-08-10 15:49:20        timeMin: '2025-08-11T00:00:00+08:00',
2025-08-10 15:49:20        timeMax: '2025-08-11T23:59:59+08:00',
2025-08-10 15:49:20        singleEvents: true,
2025-08-10 15:49:20        orderBy: 'startTime'
2025-08-10 15:49:20      },
2025-08-10 15:49:20      validateStatus: [Function (anonymous)],
2025-08-10 15:49:20      retry: true,
2025-08-10 15:49:20      responseType: 'unknown',
2025-08-10 15:49:20      errorRedactor: [Function: defaultErrorRedactor],
2025-08-10 15:49:20      retryConfig: {
2025-08-10 15:49:20        currentRetryAttempt: 0,
2025-08-10 15:49:20        retry: 3,
2025-08-10 15:49:20        httpMethodsToRetry: [Array],
2025-08-10 15:49:20        noResponseRetries: 2,
2025-08-10 15:49:20        retryDelayMultiplier: 2,
2025-08-10 15:49:20        timeOfFirstRequest: 1754840960470,
2025-08-10 15:49:20        totalTimeout: 9007199254740991,
2025-08-10 15:49:20        maxRetryDelay: 9007199254740991,
2025-08-10 15:49:20        statusCodesToRetry: [Array]
2025-08-10 15:49:20      }
2025-08-10 15:49:20    },
2025-08-10 15:49:20    response: Response {
2025-08-10 15:49:20      size: 0,
2025-08-10 15:49:20      data: { error: [Object] },
2025-08-10 15:49:20      config: {
2025-08-10 15:49:20        url: URL {},
2025-08-10 15:49:20        method: 'GET',
2025-08-10 15:49:20        apiVersion: '',
2025-08-10 15:49:20        userAgentDirectives: [Array],
2025-08-10 15:49:20        paramsSerializer: [Function (anonymous)],
2025-08-10 15:49:20        headers: Headers {
2025-08-10 15:49:20          'accept-encoding': 'gzip',
2025-08-10 15:49:20          authorization: '<<REDACTED> - See `errorRedactor` option in `gaxios` for configuration>.',
2025-08-10 15:49:20          'user-agent': 'google-api-nodejs-client/8.0.0 (gzip)',
2025-08-10 15:49:20          'x-goog-api-client': 'gdcl/8.0.0 gl-node/24.5.0'
2025-08-10 15:49:20        },
2025-08-10 15:49:20        params: [Object],
2025-08-10 15:49:20        validateStatus: [Function (anonymous)],
2025-08-10 15:49:20        retry: true,
2025-08-10 15:49:20        responseType: 'unknown',
2025-08-10 15:49:20        errorRedactor: [Function: defaultErrorRedactor]
2025-08-10 15:49:20      },
2025-08-10 15:49:20      Symbol(Body internals): {
2025-08-10 15:49:20        body: [Gunzip],
2025-08-10 15:49:20        stream: [Gunzip],
2025-08-10 15:49:20        boundary: null,
2025-08-10 15:49:20        disturbed: true,
2025-08-10 15:49:20        error: null
2025-08-10 15:49:20      },
2025-08-10 15:49:20      Symbol(Response internals): {
2025-08-10 15:49:20        type: 'default',
2025-08-10 15:49:20        url: 'https://www.googleapis.com/calendar/v3/calendars/b9bf786ee6f0002a0cbe843b8e27184082718a0ab1875873280de3be93e4a481%40group.calendar.google.com/events?timeMin=2025-08-11T00%3A00%3A00%2B08%3A00&timeMax=2025-08-11T23%3A59%3A59%2B08%3A00&singleEvents=true&orderBy=startTime',
2025-08-10 15:49:20        status: 404,
2025-08-10 15:49:20        statusText: 'Not Found',
2025-08-10 15:49:20        headers: [Object],
2025-08-10 15:49:20        counter: 0,
2025-08-10 15:49:20        highWaterMark: 16384
2025-08-10 15:49:20      }
2025-08-10 15:49:20  👤 學生日曆: b9bf786ee6f0002a0cbe843b8e27184082718a0ab1875873280de3be93e4a481@group.calendar.google.com
2025-08-10 15:49:20  ❌ 查詢事件失敗: GaxiosError: Not Found
2025-08-10 15:49:20      at Gaxios._request (/opt/render/project/src/node_modules/googleapis-common/node_modules/gaxios/build/cjs/src/gaxios.js:154:23)
2025-08-10 15:49:20      at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
2025-08-10 15:49:20      at async OAuth2Client.requestAsync (/opt/render/project/src/node_modules/googleapis-common/node_modules/google-auth-library/build/src/auth/oauth2client.js:463:20)
2025-08-10 15:49:20      at async createAPIRequestAsync (/opt/render/project/src/node_modules/googleapis-common/build/src/apirequest.js:308:25)
2025-08-10 15:49:20      at async getEvents (/opt/render/project/src/src/services/googleCalendarService.js:259:22)
2025-08-10 15:49:20      at async Object.checkConflict (/opt/render/project/src/src/services/googleCalendarService.js:286:20)
2025-08-10 15:49:20      at async handle_add_course_task (/opt/render/project/src/src/tasks/handle_add_course_task.js:286:27)
2025-08-10 15:49:20      at async executeTask (/opt/render/project/src/src/tasks/index.js:121:16)
2025-08-10 15:49:20      at async handleTextMessage (/opt/render/project/src/src/bot/webhook.js:92:20)
2025-08-10 15:49:20      at async handleWebhook (/opt/render/project/src/src/bot/webhook.js:438:13) {
2025-08-10 15:49:20    config: {
2025-08-10 15:49:20      url: URL {
2025-08-10 15:49:20        href: 'https://www.googleapis.com/calendar/v3/calendars/b9bf786ee6f0002a0cbe843b8e27184082718a0ab1875873280de3be93e4a481%40group.calendar.google.com/events?timeMin=2025-08-11T00%3A00%3A00%2B08%3A00&timeMax=2025-08-11T23%3A59%3A59%2B08%3A00&singleEvents=true&orderBy=startTime',
2025-08-10 15:49:20        origin: 'https://www.googleapis.com',
2025-08-10 15:49:20        protocol: 'https:',
2025-08-10 15:49:20        username: '',
2025-08-10 15:49:20        password: '',
2025-08-10 15:49:20        host: 'www.googleapis.com',
2025-08-10 15:49:20        hostname: 'www.googleapis.com',
2025-08-10 15:49:20        port: '',
2025-08-10 15:49:20        pathname: '/calendar/v3/calendars/b9bf786ee6f0002a0cbe843b8e27184082718a0ab1875873280de3be93e4a481%40group.calendar.google.com/events',
2025-08-10 15:49:20        search: '?timeMin=2025-08-11T00%3A00%3A00%2B08%3A00&timeMax=2025-08-11T23%3A59%3A59%2B08%3A00&singleEvents=true&orderBy=startTime',
2025-08-10 15:49:20        searchParams: URLSearchParams {
2025-08-10 15:49:20          'timeMin' => '2025-08-11T00:00:00+08:00',
2025-08-10 15:49:20          'timeMax' => '2025-08-11T23:59:59+08:00',
2025-08-10 15:49:20          'singleEvents' => 'true',
2025-08-10 15:49:20          'orderBy' => 'startTime' },
2025-08-10 15:49:20        hash: ''
2025-08-10 15:49:20      },
2025-08-10 15:49:20      method: 'GET',
2025-08-10 15:49:20      apiVersion: '',
2025-08-10 15:49:20      userAgentDirectives: [ [Object] ],
2025-08-10 15:49:20      paramsSerializer: [Function (anonymous)],
2025-08-10 15:49:20      headers: Headers {
2025-08-10 15:49:20        'accept-encoding': 'gzip',
2025-08-10 15:49:20        authorization: '<<REDACTED> - See `errorRedactor` option in `gaxios` for configuration>.',
2025-08-10 15:49:20        'user-agent': 'google-api-nodejs-client/8.0.0 (gzip)',
2025-08-10 15:49:20        'x-goog-api-client': 'gdcl/8.0.0 gl-node/24.5.0'
2025-08-10 15:49:20      },
2025-08-10 15:49:20      params: {
2025-08-10 15:49:20        timeMin: '2025-08-11T00:00:00+08:00',
2025-08-10 15:49:20        timeMax: '2025-08-11T23:59:59+08:00',
2025-08-10 15:49:20        singleEvents: true,
2025-08-10 15:49:20        orderBy: 'startTime'
2025-08-10 15:49:20      },
2025-08-10 15:49:20      validateStatus: [Function (anonymous)],
2025-08-10 15:49:20      retry: true,
2025-08-10 15:49:20      responseType: 'unknown',
2025-08-10 15:49:20      errorRedactor: [Function: defaultErrorRedactor],
2025-08-10 15:49:20      retryConfig: {
2025-08-10 15:49:20        currentRetryAttempt: 0,
2025-08-10 15:49:20        retry: 3,
2025-08-10 15:49:20        httpMethodsToRetry: [Array],
2025-08-10 15:49:20        noResponseRetries: 2,
2025-08-10 15:49:20        retryDelayMultiplier: 2,
2025-08-10 15:49:20        timeOfFirstRequest: 1754840960470,
2025-08-10 15:49:20        totalTimeout: 9007199254740991,
2025-08-10 15:49:20        maxRetryDelay: 9007199254740991,
2025-08-10 15:49:20        statusCodesToRetry: [Array]
2025-08-10 15:49:20      }
2025-08-10 15:49:20    },
2025-08-10 15:49:20    response: Response {
2025-08-10 15:49:20      size: 0,
2025-08-10 15:49:20      data: { error: [Object] },
2025-08-10 15:49:20      config: {
2025-08-10 15:49:20        url: URL {},
2025-08-10 15:49:20        method: 'GET',
2025-08-10 15:49:20        apiVersion: '',
2025-08-10 15:49:20        userAgentDirectives: [Array],
2025-08-10 15:49:20        paramsSerializer: [Function (anonymous)],
2025-08-10 15:49:20        headers: Headers {
2025-08-10 15:49:20          'accept-encoding': 'gzip',
2025-08-10 15:49:20          authorization: '<<REDACTED> - See `errorRedactor` option in `gaxios` for configuration>.',
2025-08-10 15:49:20          'user-agent': 'google-api-nodejs-client/8.0.0 (gzip)',
2025-08-10 15:49:20          'x-goog-api-client': 'gdcl/8.0.0 gl-node/24.5.0'
2025-08-10 15:49:20        },
2025-08-10 15:49:20        params: [Object],
2025-08-10 15:49:20        validateStatus: [Function (anonymous)],
2025-08-10 15:49:20        retry: true,
2025-08-10 15:49:20        responseType: 'unknown',
2025-08-10 15:49:20        errorRedactor: [Function: defaultErrorRedactor]
2025-08-10 15:49:20      },
2025-08-10 15:49:20      Symbol(Body internals): {
2025-08-10 15:49:20        body: [Gunzip],
2025-08-10 15:49:20        stream: [Gunzip],
2025-08-10 15:49:20        boundary: null,
2025-08-10 15:49:20        disturbed: true,
2025-08-10 15:49:20        error: null
2025-08-10 15:49:20      },
2025-08-10 15:49:20      Symbol(Response internals): {
2025-08-10 15:49:20        type: 'default',
2025-08-10 15:49:20        url: 'https://www.googleapis.com/calendar/v3/calendars/b9bf786ee6f0002a0cbe843b8e27184082718a0ab1875873280de3be93e4a481%40group.calendar.google.com/events?timeMin=2025-08-11T00%3A00%3A00%2B08%3A00&timeMax=2025-08-11T23%3A59%3A59%2B08%3A00&singleEvents=true&orderBy=startTime',
2025-08-10 15:49:20        status: 404,
2025-08-10 15:49:20        statusText: 'Not Found',
2025-08-10 15:49:20        headers: [Object],
2025-08-10 15:49:20        counter: 0,
2025-08-10 15:49:20        highWaterMark: 16384
2025-08-10 15:49:20      }
2025-08-10 15:49:20  👤 學生日曆: b9bf786ee6f0002a0cbe843b8e27184082718a0ab1875873280de3be93e4a481@group.calendar.google.com
2025-08-10 15:49:20  ❌ 查詢事件失敗: GaxiosError: Not Found
2025-08-10 15:49:20      at Gaxios._request (/opt/render/project/src/node_modules/googleapis-common/node_modules/gaxios/build/cjs/src/gaxios.js:154:23)
2025-08-10 15:49:20      at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
2025-08-10 15:49:20      at async OAuth2Client.requestAsync (/opt/render/project/src/node_modules/googleapis-common/node_modules/google-auth-library/build/src/auth/oauth2client.js:463:20)
2025-08-10 15:49:20      at async createAPIRequestAsync (/opt/render/project/src/node_modules/googleapis-common/build/src/apirequest.js:308:25)
2025-08-10 15:49:20      at async getEvents (/opt/render/project/src/src/services/googleCalendarService.js:259:22)
2025-08-10 15:49:20      at async Object.checkConflict (/opt/render/project/src/src/services/googleCalendarService.js:286:20)
2025-08-10 15:49:20      at async handle_add_course_task (/opt/render/project/src/src/tasks/handle_add_course_task.js:286:27)
2025-08-10 15:49:20      at async executeTask (/opt/render/project/src/src/tasks/index.js:121:16)
2025-08-10 15:49:20      at async handleTextMessage (/opt/render/project/src/src/bot/webhook.js:92:20)
2025-08-10 15:49:20      at async handleWebhook (/opt/render/project/src/src/bot/webhook.js:438:13) {
2025-08-10 15:49:20    config: {
2025-08-10 15:49:20      url: URL {
2025-08-10 15:49:20        href: 'https://www.googleapis.com/calendar/v3/calendars/b9bf786ee6f0002a0cbe843b8e27184082718a0ab1875873280de3be93e4a481%40group.calendar.google.com/events?timeMin=2025-08-11T00%3A00%3A00%2B08%3A00&timeMax=2025-08-11T23%3A59%3A59%2B08%3A00&singleEvents=true&orderBy=startTime',
2025-08-10 15:49:20        origin: 'https://www.googleapis.com',
2025-08-10 15:49:20        protocol: 'https:',
2025-08-10 15:49:20        username: '',
2025-08-10 15:49:20        password: '',
2025-08-10 15:49:20        host: 'www.googleapis.com',
2025-08-10 15:49:20        hostname: 'www.googleapis.com',
2025-08-10 15:49:20        port: '',
2025-08-10 15:49:20        pathname: '/calendar/v3/calendars/b9bf786ee6f0002a0cbe843b8e27184082718a0ab1875873280de3be93e4a481%40group.calendar.google.com/events',
2025-08-10 15:49:20        search: '?timeMin=2025-08-11T00%3A00%3A00%2B08%3A00&timeMax=2025-08-11T23%3A59%3A59%2B08%3A00&singleEvents=true&orderBy=startTime',
2025-08-10 15:49:20        searchParams: URLSearchParams {
2025-08-10 15:49:20          'timeMin' => '2025-08-11T00:00:00+08:00',
2025-08-10 15:49:20          'timeMax' => '2025-08-11T23:59:59+08:00',
2025-08-10 15:49:20          'singleEvents' => 'true',
2025-08-10 15:49:20          'orderBy' => 'startTime' },
2025-08-10 15:49:20        hash: ''
2025-08-10 15:49:20      },
2025-08-10 15:49:20      method: 'GET',
2025-08-10 15:49:20      apiVersion: '',
2025-08-10 15:49:20      userAgentDirectives: [ [Object] ],
2025-08-10 15:49:20      paramsSerializer: [Function (anonymous)],
2025-08-10 15:49:20      headers: Headers {
2025-08-10 15:49:20        'accept-encoding': 'gzip',
2025-08-10 15:49:20        authorization: '<<REDACTED> - See `errorRedactor` option in `gaxios` for configuration>.',
2025-08-10 15:49:20        'user-agent': 'google-api-nodejs-client/8.0.0 (gzip)',
2025-08-10 15:49:20        'x-goog-api-client': 'gdcl/8.0.0 gl-node/24.5.0'
2025-08-10 15:49:20      },
2025-08-10 15:49:20      params: {
2025-08-10 15:49:20        timeMin: '2025-08-11T00:00:00+08:00',
2025-08-10 15:49:20        timeMax: '2025-08-11T23:59:59+08:00',
2025-08-10 15:49:20        singleEvents: true,
2025-08-10 15:49:20        orderBy: 'startTime'
2025-08-10 15:49:20      },
2025-08-10 15:49:20      validateStatus: [Function (anonymous)],
2025-08-10 15:49:20      retry: true,
2025-08-10 15:49:20      responseType: 'unknown',
2025-08-10 15:49:20      errorRedactor: [Function: defaultErrorRedactor],
2025-08-10 15:49:20      retryConfig: {
2025-08-10 15:49:20        currentRetryAttempt: 0,
2025-08-10 15:49:20        retry: 3,
2025-08-10 15:49:20        httpMethodsToRetry: [Array],
2025-08-10 15:49:20        noResponseRetries: 2,
2025-08-10 15:49:20        retryDelayMultiplier: 2,
2025-08-10 15:49:20        timeOfFirstRequest: 1754840960470,
2025-08-10 15:49:20        totalTimeout: 9007199254740991,
2025-08-10 15:49:20        maxRetryDelay: 9007199254740991,
2025-08-10 15:49:20        statusCodesToRetry: [Array]
2025-08-10 15:49:20      }
2025-08-10 15:49:20    },
2025-08-10 15:49:20    response: Response {
2025-08-10 15:49:20      size: 0,
2025-08-10 15:49:20      data: { error: [Object] },
2025-08-10 15:49:20      config: {
2025-08-10 15:49:20        url: URL {},
2025-08-10 15:49:20        method: 'GET',
2025-08-10 15:49:20        apiVersion: '',
2025-08-10 15:49:20        userAgentDirectives: [Array],
2025-08-10 15:49:20        paramsSerializer: [Function (anonymous)],
2025-08-10 15:49:20        headers: Headers {
2025-08-10 15:49:20          'accept-encoding': 'gzip',
2025-08-10 15:49:20          authorization: '<<REDACTED> - See `errorRedactor` option in `gaxios` for configuration>.',
2025-08-10 15:49:20          'user-agent': 'google-api-nodejs-client/8.0.0 (gzip)',
2025-08-10 15:49:20          'x-goog-api-client': 'gdcl/8.0.0 gl-node/24.5.0'
2025-08-10 15:49:20        },
2025-08-10 15:49:20        params: [Object],
2025-08-10 15:49:20        validateStatus: [Function (anonymous)],
2025-08-10 15:49:20        retry: true,
2025-08-10 15:49:20        responseType: 'unknown',
2025-08-10 15:49:20        errorRedactor: [Function: defaultErrorRedactor]
2025-08-10 15:49:20      },
2025-08-10 15:49:20      Symbol(Body internals): {
2025-08-10 15:49:20        body: [Gunzip],
2025-08-10 15:49:20        stream: [Gunzip],
2025-08-10 15:49:20        boundary: null,
2025-08-10 15:49:20        disturbed: true,
2025-08-10 15:49:20        error: null
2025-08-10 15:49:20      },
2025-08-10 15:49:20      Symbol(Response internals): {
2025-08-10 15:49:20        type: 'default',
2025-08-10 15:49:20        url: 'https://www.googleapis.com/calendar/v3/calendars/b9bf786ee6f0002a0cbe843b8e27184082718a0ab1875873280de3be93e4a481%40group.calendar.google.com/events?timeMin=2025-08-11T00%3A00%3A00%2B08%3A00&timeMax=2025-08-11T23%3A59%3A59%2B08%3A00&singleEvents=true&orderBy=startTime',
2025-08-10 15:49:20        status: 404,
2025-08-10 15:49:20        statusText: 'Not Found',
2025-08-10 15:49:20        headers: [Object],
2025-08-10 15:49:20        counter: 0,
2025-08-10 15:49:20        highWaterMark: 16384
2025-08-10 15:49:20      }
2025-08-10 15:49:20  👤 學生日曆: b9bf786ee6f0002a0cbe843b8e27184082718a0ab1875873280de3be93e4a481@group.calendar.google.com
2025-08-10 15:49:20  ❌ 查詢事件失敗: GaxiosError: Not Found
2025-08-10 15:49:20      at Gaxios._request (/opt/render/project/src/node_modules/googleapis-common/node_modules/gaxios/build/cjs/src/gaxios.js:154:23)
2025-08-10 15:49:20      at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
2025-08-10 15:49:20      at async OAuth2Client.requestAsync (/opt/render/project/src/node_modules/googleapis-common/node_modules/google-auth-library/build/src/auth/oauth2client.js:463:20)
2025-08-10 15:49:20      at async createAPIRequestAsync (/opt/render/project/src/node_modules/googleapis-common/build/src/apirequest.js:308:25)
2025-08-10 15:49:20      at async getEvents (/opt/render/project/src/src/services/googleCalendarService.js:259:22)
2025-08-10 15:49:20      at async Object.checkConflict (/opt/render/project/src/src/services/googleCalendarService.js:286:20)
2025-08-10 15:49:20      at async handle_add_course_task (/opt/render/project/src/src/tasks/handle_add_course_task.js:286:27)
2025-08-10 15:49:20      at async executeTask (/opt/render/project/src/src/tasks/index.js:121:16)
2025-08-10 15:49:20      at async handleTextMessage (/opt/render/project/src/src/bot/webhook.js:92:20)
2025-08-10 15:49:20      at async handleWebhook (/opt/render/project/src/src/bot/webhook.js:438:13) {
2025-08-10 15:49:20    config: {
2025-08-10 15:49:20      url: URL {
2025-08-10 15:49:20        href: 'https://www.googleapis.com/calendar/v3/calendars/b9bf786ee6f0002a0cbe843b8e27184082718a0ab1875873280de3be93e4a481%40group.calendar.google.com/events?timeMin=2025-08-11T00%3A00%3A00%2B08%3A00&timeMax=2025-08-11T23%3A59%3A59%2B08%3A00&singleEvents=true&orderBy=startTime',
2025-08-10 15:49:20        origin: 'https://www.googleapis.com',
2025-08-10 15:49:20        protocol: 'https:',
2025-08-10 15:49:20        username: '',
2025-08-10 15:49:20        password: '',
2025-08-10 15:49:20        host: 'www.googleapis.com',
2025-08-10 15:49:20        hostname: 'www.googleapis.com',
2025-08-10 15:49:20        port: '',
2025-08-10 15:49:20        pathname: '/calendar/v3/calendars/b9bf786ee6f0002a0cbe843b8e27184082718a0ab1875873280de3be93e4a481%40group.calendar.google.com/events',
2025-08-10 15:49:20        search: '?timeMin=2025-08-11T00%3A00%3A00%2B08%3A00&timeMax=2025-08-11T23%3A59%3A59%2B08%3A00&singleEvents=true&orderBy=startTime',
2025-08-10 15:49:20        searchParams: URLSearchParams {
2025-08-10 15:49:20          'timeMin' => '2025-08-11T00:00:00+08:00',
2025-08-10 15:49:20          'timeMax' => '2025-08-11T23:59:59+08:00',
2025-08-10 15:49:20          'singleEvents' => 'true',
2025-08-10 15:49:20          'orderBy' => 'startTime' },
2025-08-10 15:49:20        hash: ''
2025-08-10 15:49:20      },
2025-08-10 15:49:20      method: 'GET',
2025-08-10 15:49:20      apiVersion: '',
2025-08-10 15:49:20      userAgentDirectives: [ [Object] ],
2025-08-10 15:49:20      paramsSerializer: [Function (anonymous)],
2025-08-10 15:49:20      headers: Headers {
2025-08-10 15:49:20        'accept-encoding': 'gzip',
2025-08-10 15:49:20        authorization: '<<REDACTED> - See `errorRedactor` option in `gaxios` for configuration>.',
2025-08-10 15:49:20        'user-agent': 'google-api-nodejs-client/8.0.0 (gzip)',
2025-08-10 15:49:20        'x-goog-api-client': 'gdcl/8.0.0 gl-node/24.5.0'
2025-08-10 15:49:20      },
2025-08-10 15:49:20      params: {
2025-08-10 15:49:20        timeMin: '2025-08-11T00:00:00+08:00',
2025-08-10 15:49:20        timeMax: '2025-08-11T23:59:59+08:00',
2025-08-10 15:49:20        singleEvents: true,
2025-08-10 15:49:20        orderBy: 'startTime'
2025-08-10 15:49:20      },
2025-08-10 15:49:20      validateStatus: [Function (anonymous)],
2025-08-10 15:49:20      retry: true,
2025-08-10 15:49:20      responseType: 'unknown',
2025-08-10 15:49:20      errorRedactor: [Function: defaultErrorRedactor],
2025-08-10 15:49:20      retryConfig: {
2025-08-10 15:49:20        currentRetryAttempt: 0,
2025-08-10 15:49:20        retry: 3,
2025-08-10 15:49:20        httpMethodsToRetry: [Array],
2025-08-10 15:49:20        noResponseRetries: 2,
2025-08-10 15:49:20        retryDelayMultiplier: 2,
2025-08-10 15:49:20        timeOfFirstRequest: 1754840960470,
2025-08-10 15:49:20        totalTimeout: 9007199254740991,
2025-08-10 15:49:20        maxRetryDelay: 9007199254740991,
2025-08-10 15:49:20        statusCodesToRetry: [Array]
2025-08-10 15:49:20      }
2025-08-10 15:49:20    },
2025-08-10 15:49:20    response: Response {
2025-08-10 15:49:20      size: 0,
2025-08-10 15:49:20      data: { error: [Object] },
2025-08-10 15:49:20      config: {
2025-08-10 15:49:20        url: URL {},
2025-08-10 15:49:20        method: 'GET',
2025-08-10 15:49:20        apiVersion: '',
2025-08-10 15:49:20        userAgentDirectives: [Array],
2025-08-10 15:49:20        paramsSerializer: [Function (anonymous)],
2025-08-10 15:49:20        headers: Headers {
2025-08-10 15:49:20          'accept-encoding': 'gzip',
2025-08-10 15:49:20          authorization: '<<REDACTED> - See `errorRedactor` option in `gaxios` for configuration>.',
2025-08-10 15:49:20          'user-agent': 'google-api-nodejs-client/8.0.0 (gzip)',
2025-08-10 15:49:20          'x-goog-api-client': 'gdcl/8.0.0 gl-node/24.5.0'
2025-08-10 15:49:20        },
2025-08-10 15:49:20        params: [Object],
2025-08-10 15:49:20        validateStatus: [Function (anonymous)],
2025-08-10 15:49:20        retry: true,
2025-08-10 15:49:20        responseType: 'unknown',
2025-08-10 15:49:20        errorRedactor: [Function: defaultErrorRedactor]
2025-08-10 15:49:20      },
2025-08-10 15:49:20      Symbol(Body internals): {
2025-08-10 15:49:20        body: [Gunzip],
2025-08-10 15:49:20        stream: [Gunzip],
2025-08-10 15:49:20        boundary: null,
2025-08-10 15:49:20        disturbed: true,
2025-08-10 15:49:20        error: null
2025-08-10 15:49:20      },
2025-08-10 15:49:20      Symbol(Response internals): {
2025-08-10 15:49:20        type: 'default',
2025-08-10 15:49:20        url: 'https://www.googleapis.com/calendar/v3/calendars/b9bf786ee6f0002a0cbe843b8e27184082718a0ab1875873280de3be93e4a481%40group.calendar.google.com/events?timeMin=2025-08-11T00%3A00%3A00%2B08%3A00&timeMax=2025-08-11T23%3A59%3A59%2B08%3A00&singleEvents=true&orderBy=startTime',
2025-08-10 15:49:20        status: 404,
2025-08-10 15:49:20        statusText: 'Not Found',
2025-08-10 15:49:20        headers: [Object],
2025-08-10 15:49:20        counter: 0,
2025-08-10 15:49:20        highWaterMark: 16384
2025-08-10 15:49:20      }
