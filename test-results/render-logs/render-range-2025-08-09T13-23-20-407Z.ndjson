2025-08-09 11:23:20  ✅ 課程資料已儲存: baqqSGDDxTnIKZxOqxJP
2025-08-09 11:23:20  💾 Firebase 課程資料已儲存: baqqSGDDxTnIKZxOqxJP
2025-08-09 11:23:20  📊 任務執行結果: {
2025-08-09 11:23:20    success: true,
2025-08-09 11:23:20    code: 'ADD_COURSE_OK',
2025-08-09 11:23:20    message: '✅ 課程已安排成功！\n\n👦 學生：小明\n📚 課程：游泳課\n🔄 重複：每週二 下午7:00\n📅 下次上課：2025-08-12',
2025-08-09 11:23:20    data: {
2025-08-09 11:23:20      courseId: 'baqqSGDDxTnIKZxOqxJP',
2025-08-09 11:23:20      eventId: 'mock-event-1754738599966'
2025-08-09 11:23:20    },
2025-08-09 11:23:20    quickReply: [
2025-08-09 11:23:20      { label: '✅ 確認', text: '確認' },
2025-08-09 11:23:20      { label: '✏️ 修改', text: '修改' },
2025-08-09 11:23:20      { label: '❌ 取消操作', text: '取消操作' }
2025-08-09 11:23:20    ]
2025-08-09 11:23:20  }
2025-08-09 11:23:20  ✅ 任務結果: {
2025-08-09 11:23:20    success: true,
2025-08-09 11:23:20    code: 'ADD_COURSE_OK',
2025-08-09 11:23:20    message: '✅ 課程已安排成功！\n\n👦 學生：小明\n📚 課程：游泳課\n🔄 重複：每週二 下午7:00\n📅 下次上課：2025-08-12',
2025-08-09 11:23:20    data: {
2025-08-09 11:23:20      courseId: 'baqqSGDDxTnIKZxOqxJP',
2025-08-09 11:23:20      eventId: 'mock-event-1754738599966'
2025-08-09 11:23:20    },
2025-08-09 11:23:20    quickReply: [
2025-08-09 11:23:20      { label: '✅ 確認', text: '確認' },
2025-08-09 11:23:20      { label: '✏️ 修改', text: '修改' },
2025-08-09 11:23:20      { label: '❌ 取消操作', text: '取消操作' }
2025-08-09 11:23:20    ]
2025-08-09 11:23:20  }
2025-08-09 11:23:20  🔍 檢查 replyToken: test-reply-token-1754738596685
2025-08-09 11:23:20  🧪 檢測到測試 token，跳過真實 LINE API 調用
2025-08-09 11:23:20  📤 [測試模式] 實際業務回覆: ✅ 課程已安排成功！
2025-08-09 11:23:20  
2025-08-09 11:23:20  👦 學生：小明
2025-08-09 11:23:20  📚 課程：游泳課
2025-08-09 11:23:20  🔄 重複：每週二 下午7:00
2025-08-09 11:23:20  📅 下次上課：2025-08-12
2025-08-09 11:23:29  📨 收到 1 個事件
2025-08-09 11:23:29  📋 事件類型: message
2025-08-09 11:23:29  🔍 完整事件 JSON: {
2025-08-09 11:23:29    "type": "message",
2025-08-09 11:23:29    "message": {
2025-08-09 11:23:29      "type": "text",
2025-08-09 11:23:29      "text": "Lumi固定每個星期四下午兩點鋼琴課"
2025-08-09 11:23:29    },
2025-08-09 11:23:29    "source": {
2025-08-09 11:23:29      "userId": "U_test_user_qa",
2025-08-09 11:23:29      "type": "user"
2025-08-09 11:23:29    },
2025-08-09 11:23:29    "replyToken": "test-reply-token-1754738609440",
2025-08-09 11:23:29    "timestamp": 1754738609440
2025-08-09 11:23:29  }
2025-08-09 11:23:29  📝 收到文字訊息: Lumi固定每個星期四下午兩點鋼琴課
2025-08-09 11:23:29  👤 用戶ID: U_test_user_qa
2025-08-09 11:23:29  🔍 用戶ID類型: string
2025-08-09 11:23:29  🔍 是否測試用戶: true
2025-08-09 11:23:29  🚀 生產用戶，使用真實 LINE Service
2025-08-09 11:23:29  🔥 選擇的服務類型: Object
2025-08-09 11:23:29  🎯 開始解析意圖: Lumi固定每個星期四下午兩點鋼琴課 (用戶: U_test_user_qa)
2025-08-09 11:23:29  🧠 檢測到期待輸入狀態: [ 'confirmation', 'modification' ]
2025-08-09 11:23:29  📋 待補充資料: {
2025-08-09 11:23:29    lastOperation: {
2025-08-09 11:23:29      intent: 'add_course',
2025-08-09 11:23:29      slots: {
2025-08-09 11:23:29        studentName: '小明',
2025-08-09 11:23:29        courseName: '游泳課',
2025-08-09 11:23:29        scheduleTime: '19:00',
2025-08-09 11:23:29        dayOfWeek: 2,
2025-08-09 11:23:29        recurring: true,
2025-08-09 11:23:29        recurrenceType: 'weekly'
2025-08-09 11:23:29      },
2025-08-09 11:23:29      result: {
2025-08-09 11:23:29        success: true,
2025-08-09 11:23:29        code: 'ADD_COURSE_OK',
2025-08-09 11:23:29        message: '✅ 課程已安排成功！\n\n👦 學生：小明\n📚 課程：游泳課\n🔄 重複：每週二 下午7:00\n📅 下次上課：2025-08-12',
2025-08-09 11:23:29        data: [Object],
2025-08-09 11:23:29        quickReply: [Array]
2025-08-09 11:23:29      }
2025-08-09 11:23:29    },
2025-08-09 11:23:29    timestamp: 1754738600221
2025-08-09 11:23:29  }
2025-08-09 11:23:29  ⚠️ 無待處理的意圖資料
2025-08-09 11:23:29  ⚠️ 無待處理的意圖資料
2025-08-09 11:23:29  ✅ 規則匹配成功: add_course
2025-08-09 11:23:29  🎯 識別意圖: add_course
2025-08-09 11:23:29  🔍 開始提取 slots - 意圖: add_course (用戶: U_test_user_qa)
2025-08-09 11:23:29  🕒 開始高級時間解析: Lumi固定每個星期四下午兩點鋼琴課
2025-08-09 11:23:29  ✅ 時間解析成功: {
2025-08-09 11:23:29    input: 'Lumi固定每個星期四下午兩點鋼琴課',
2025-08-09 11:23:29    output: '14:00',
2025-08-09 11:23:29    details: {
2025-08-09 11:23:29      hour: 14,
2025-08-09 11:23:29      minute: 0,
2025-08-09 11:23:29      matchType: 'chinese_period',
2025-08-09 11:23:29      periodInfo: '下午'
2025-08-09 11:23:29    }
2025-08-09 11:23:29  }
2025-08-09 11:23:30  🧠 使用對話上下文增強 slots 提取
2025-08-09 11:23:30  📊 規則提取置信度: 1.00
2025-08-09 11:23:30  🧠 使用對話上下文增強 slots 提取
2025-08-09 11:23:30  📊 規則提取置信度: 1.00
2025-08-09 11:23:30  🤖 啟用 AI 輔助提取...
2025-08-09 11:23:31  ✅ 最終 slots: {
2025-08-09 11:23:31    studentName: 'Lumi',
2025-08-09 11:23:31    courseName: '鋼琴課',
2025-08-09 11:23:31    scheduleTime: '14:00',
2025-08-09 11:23:31    dayOfWeek: 4,
2025-08-09 11:23:31    recurring: true,
2025-08-09 11:23:31    recurrenceType: 'weekly'
2025-08-09 11:23:31  }
2025-08-09 11:23:31  📋 提取結果: {
2025-08-09 11:23:31    studentName: 'Lumi',
2025-08-09 11:23:31    courseName: '鋼琴課',
2025-08-09 11:23:31    scheduleTime: '14:00',
2025-08-09 11:23:31    dayOfWeek: 4,
2025-08-09 11:23:31    recurring: true,
2025-08-09 11:23:31    recurrenceType: 'weekly'
2025-08-09 11:23:31  }
2025-08-09 11:23:31  🎯 執行任務: add_course
2025-08-09 11:23:31  🎯 開始處理新增課程任務
2025-08-09 11:23:31  📋 接收參數: {
2025-08-09 11:23:31    studentName: 'Lumi',
2025-08-09 11:23:31    courseName: '鋼琴課',
2025-08-09 11:23:31    scheduleTime: '14:00',
2025-08-09 11:23:31    dayOfWeek: 4,
2025-08-09 11:23:31    recurring: true,
2025-08-09 11:23:31    recurrenceType: 'weekly'
2025-08-09 11:23:31  }
2025-08-09 11:23:31  👤 學生日曆: 4a0f9e74ce6d657504bec55784c18348676fc1f35aa59f71a6cd2b9b5b2f2f4b@group.calendar.google.com
2025-08-09 11:23:31  ✅ 已創建課程事件: mock-event-1754738611084
2025-08-09 11:23:31  📅 Google Calendar 事件已創建: mock-event-1754738611084
2025-08-09 11:23:31  ✅ 課程資料已儲存: 5wjlHwNQi0G4KGukhkAo
2025-08-09 11:23:31  💾 Firebase 課程資料已儲存: 5wjlHwNQi0G4KGukhkAo
2025-08-09 11:23:31  📊 任務執行結果: {
2025-08-09 11:23:31    success: true,
2025-08-09 11:23:31    code: 'ADD_COURSE_OK',
2025-08-09 11:23:31    message: '✅ 課程已安排成功！\n\n👦 學生：Lumi\n📚 課程：鋼琴課\n🔄 重複：每週四 下午2:00\n📅 下次上課：2025-08-14',
2025-08-09 11:23:31    data: {
2025-08-09 11:23:31      courseId: '5wjlHwNQi0G4KGukhkAo',
2025-08-09 11:23:31      eventId: 'mock-event-1754738611084'
2025-08-09 11:23:31    },
2025-08-09 11:23:31    quickReply: [
2025-08-09 11:23:31      { label: '✅ 確認', text: '確認' },
2025-08-09 11:23:31      { label: '✏️ 修改', text: '修改' },
2025-08-09 11:23:31      { label: '❌ 取消操作', text: '取消操作' }
2025-08-09 11:23:31    ]
2025-08-09 11:23:31  }
2025-08-09 11:23:31  ✅ 任務結果: {
2025-08-09 11:23:31    success: true,
2025-08-09 11:23:31    code: 'ADD_COURSE_OK',
2025-08-09 11:23:31    message: '✅ 課程已安排成功！\n\n👦 學生：Lumi\n📚 課程：鋼琴課\n🔄 重複：每週四 下午2:00\n📅 下次上課：2025-08-14',
2025-08-09 11:23:31    data: {
2025-08-09 11:23:31      courseId: '5wjlHwNQi0G4KGukhkAo',
2025-08-09 11:23:31      eventId: 'mock-event-1754738611084'
2025-08-09 11:23:31    },
2025-08-09 11:23:31    quickReply: [
2025-08-09 11:23:31      { label: '✅ 確認', text: '確認' },
2025-08-09 11:23:31      { label: '✏️ 修改', text: '修改' },
2025-08-09 11:23:31      { label: '❌ 取消操作', text: '取消操作' }
2025-08-09 11:23:31    ]
2025-08-09 11:23:31  }
2025-08-09 11:23:31  🔍 檢查 replyToken: test-reply-token-1754738609440
2025-08-09 11:23:31  🧪 檢測到測試 token，跳過真實 LINE API 調用
2025-08-09 11:23:31  📤 [測試模式] 實際業務回覆: ✅ 課程已安排成功！
2025-08-09 11:23:31  
2025-08-09 11:23:31  👦 學生：Lumi
2025-08-09 11:23:31  📚 課程：鋼琴課
2025-08-09 11:23:31  🔄 重複：每週四 下午2:00
2025-08-09 11:23:31  📅 下次上課：2025-08-14
2025-08-09 11:23:40  📨 收到 1 個事件
2025-08-09 11:23:40  📋 事件類型: message
2025-08-09 11:23:40  🔍 完整事件 JSON: {
2025-08-09 11:23:40    "type": "message",
2025-08-09 11:23:40    "message": {
2025-08-09 11:23:40      "type": "text",
2025-08-09 11:23:40      "text": "小明每天早上8點英文課"
2025-08-09 11:23:40    },
2025-08-09 11:23:40    "source": {
2025-08-09 11:23:40      "userId": "U_test_user_qa",
2025-08-09 11:23:40      "type": "user"
2025-08-09 11:23:40    },
2025-08-09 11:23:40    "replyToken": "test-reply-token-1754738620584",
2025-08-09 11:23:40    "timestamp": 1754738620584
2025-08-09 11:23:40  }
2025-08-09 11:23:40  📝 收到文字訊息: 小明每天早上8點英文課
2025-08-09 11:23:40  👤 用戶ID: U_test_user_qa
2025-08-09 11:23:40  🔍 用戶ID類型: string
2025-08-09 11:23:40  🔍 是否測試用戶: true
2025-08-09 11:23:40  🚀 生產用戶，使用真實 LINE Service
2025-08-09 11:23:40  🔥 選擇的服務類型: Object
2025-08-09 11:23:40  🎯 開始解析意圖: 小明每天早上8點英文課 (用戶: U_test_user_qa)
2025-08-09 11:23:40  🧠 檢測到期待輸入狀態: [ 'confirmation', 'modification' ]
2025-08-09 11:23:40  📋 待補充資料: {
2025-08-09 11:23:40    lastOperation: {
2025-08-09 11:23:40      intent: 'add_course',
2025-08-09 11:23:40      slots: {
2025-08-09 11:23:40        studentName: 'Lumi',
2025-08-09 11:23:40        courseName: '鋼琴課',
2025-08-09 11:23:40        scheduleTime: '14:00',
2025-08-09 11:23:40  📨 收到 1 個事件
2025-08-09 11:23:40  📋 事件類型: message
2025-08-09 11:23:40  🔍 完整事件 JSON: {
2025-08-09 11:23:40    "type": "message",
2025-08-09 11:23:40    "message": {
2025-08-09 11:23:40      "type": "text",
2025-08-09 11:23:40      "text": "小明每天早上8點英文課"
2025-08-09 11:23:40    },
2025-08-09 11:23:40    "source": {
2025-08-09 11:23:40      "userId": "U_test_user_qa",
2025-08-09 11:23:40      "type": "user"
2025-08-09 11:23:40    },
2025-08-09 11:23:40    "replyToken": "test-reply-token-1754738620584",
2025-08-09 11:23:40    "timestamp": 1754738620584
2025-08-09 11:23:40  }
2025-08-09 11:23:40  📝 收到文字訊息: 小明每天早上8點英文課
2025-08-09 11:23:40  👤 用戶ID: U_test_user_qa
2025-08-09 11:23:40  🔍 用戶ID類型: string
2025-08-09 11:23:40  🔍 是否測試用戶: true
2025-08-09 11:23:40  🚀 生產用戶，使用真實 LINE Service
2025-08-09 11:23:40  🔥 選擇的服務類型: Object
2025-08-09 11:23:40  🎯 開始解析意圖: 小明每天早上8點英文課 (用戶: U_test_user_qa)
2025-08-09 11:23:40  🧠 檢測到期待輸入狀態: [ 'confirmation', 'modification' ]
2025-08-09 11:23:40  📋 待補充資料: {
2025-08-09 11:23:40    lastOperation: {
2025-08-09 11:23:40      intent: 'add_course',
2025-08-09 11:23:40      slots: {
2025-08-09 11:23:40        studentName: 'Lumi',
2025-08-09 11:23:40        courseName: '鋼琴課',
2025-08-09 11:23:40        scheduleTime: '14:00',
2025-08-09 11:23:40        dayOfWeek: 4,
2025-08-09 11:23:40        recurring: true,
2025-08-09 11:23:40        recurrenceType: 'weekly'
2025-08-09 11:23:40      },
2025-08-09 11:23:40      result: {
2025-08-09 11:23:40        success: true,
2025-08-09 11:23:40        code: 'ADD_COURSE_OK',
2025-08-09 11:23:40        message: '✅ 課程已安排成功！\n\n👦 學生：Lumi\n📚 課程：鋼琴課\n🔄 重複：每週四 下午2:00\n📅 下次上課：2025-08-14',
2025-08-09 11:23:40        data: [Object],
2025-08-09 11:23:40        quickReply: [Array]
2025-08-09 11:23:40      }
2025-08-09 11:23:40    },
2025-08-09 11:23:40    timestamp: 1754738611311
2025-08-09 11:23:40  }
2025-08-09 11:23:40  ⚠️ 無待處理的意圖資料
2025-08-09 11:23:40  ⚠️ 無待處理的意圖資料
2025-08-09 11:23:40  ✅ 規則匹配成功: add_course
2025-08-09 11:23:40  🎯 識別意圖: add_course
2025-08-09 11:23:41  🔍 開始提取 slots - 意圖: add_course (用戶: U_test_user_qa)
2025-08-09 11:23:41  🕒 開始高級時間解析: 小明每天早上8點英文課
2025-08-09 11:23:41  ✅ 時間解析成功: {
2025-08-09 11:23:41    input: '小明每天早上8點英文課',
2025-08-09 11:23:41    output: '08:00',
2025-08-09 11:23:41    details: { hour: 8, minute: 0, matchType: 'arabic_period', periodInfo: '早上' }
2025-08-09 11:23:41  }
2025-08-09 11:23:41  📊 規則提取置信度: 0.50
2025-08-09 11:23:41  🤖 啟用 AI 輔助提取...
2025-08-09 11:23:42  ✅ 最終 slots: {
2025-08-09 11:23:42    studentName: '小明',
2025-08-09 11:23:42    courseName: '英文課',
2025-08-09 11:23:42    scheduleTime: '08:00',
2025-08-09 11:23:42    recurring: false
2025-08-09 11:23:42  }
2025-08-09 11:23:42  📋 提取結果: {
2025-08-09 11:23:42    studentName: '小明',
2025-08-09 11:23:42    courseName: '英文課',
2025-08-09 11:23:42    scheduleTime: '08:00',
2025-08-09 11:23:42    recurring: false
2025-08-09 11:23:42  }
2025-08-09 11:23:42  🎯 執行任務: add_course
2025-08-09 11:23:42  🎯 開始處理新增課程任務
2025-08-09 11:23:42  📋 接收參數: {
2025-08-09 11:23:42    studentName: '小明',
2025-08-09 11:23:42    courseName: '英文課',
2025-08-09 11:23:42    scheduleTime: '08:00',
2025-08-09 11:23:42    recurring: false
2025-08-09 11:23:42  }
2025-08-09 11:23:42  📊 任務執行結果: {
2025-08-09 11:23:42    success: false,
2025-08-09 11:23:42    code: 'MISSING_FIELDS',
2025-08-09 11:23:42    message: '❓ 請提供以下資訊：課程日期\n\n範例：「小明每週三下午3點數學課」',
2025-08-09 11:23:42    expectingInput: true,
2025-08-09 11:23:42    missingFields: [ '課程日期' ]
2025-08-09 11:23:42  }
2025-08-09 11:23:42  ✅ 任務結果: {
2025-08-09 11:23:42    success: false,
2025-08-09 11:23:42    code: 'MISSING_FIELDS',
2025-08-09 11:23:42    message: '❓ 請提供以下資訊：課程日期\n\n範例：「小明每週三下午3點數學課」',
2025-08-09 11:23:42    expectingInput: true,
2025-08-09 11:23:42    missingFields: [ '課程日期' ]
2025-08-09 11:23:42  }
2025-08-09 11:23:43  🔍 檢查 replyToken: test-reply-token-1754738620584
2025-08-09 11:23:43  🧪 檢測到測試 token，跳過真實 LINE API 調用
2025-08-09 11:23:43  📤 [測試模式] 實際業務回覆: ❓ 請提供以下資訊：課程日期
2025-08-09 11:23:43  
2025-08-09 11:23:43  範例：「小明每週三下午3點數學課」
2025-08-09 11:23:44  📨 收到 1 個事件
2025-08-09 11:23:44  📋 事件類型: message
2025-08-09 11:23:44  🔍 完整事件 JSON: {
2025-08-09 11:23:44    "type": "message",
2025-08-09 11:23:44  📨 收到 1 個事件
2025-08-09 11:23:44  📋 事件類型: message
2025-08-09 11:23:44  🔍 完整事件 JSON: {
2025-08-09 11:23:44    "type": "message",
2025-08-09 11:23:44    "message": {
2025-08-09 11:23:44      "type": "text",
2025-08-09 11:23:44      "text": "小明每週一早上8點英文課"
2025-08-09 11:23:44    },
2025-08-09 11:23:44    "source": {
2025-08-09 11:23:44      "userId": "U_test_user_qa",
2025-08-09 11:23:44      "type": "user"
2025-08-09 11:23:44    },
2025-08-09 11:23:44    "replyToken": "test-reply-token-1754738624353",
2025-08-09 11:23:44    "timestamp": 1754738624353
2025-08-09 11:23:44  }
2025-08-09 11:23:44  📝 收到文字訊息: 小明每週一早上8點英文課
2025-08-09 11:23:44  👤 用戶ID: U_test_user_qa
2025-08-09 11:23:44  🔍 用戶ID類型: string
2025-08-09 11:23:44  🔍 是否測試用戶: true
2025-08-09 11:23:44  🚀 生產用戶，使用真實 LINE Service
2025-08-09 11:23:44  🔥 選擇的服務類型: Object
2025-08-09 11:23:44  🎯 開始解析意圖: 小明每週一早上8點英文課 (用戶: U_test_user_qa)
2025-08-09 11:23:44  🧠 檢測到期待輸入狀態: [ 'course_date_input' ]
2025-08-09 11:23:44  📋 待補充資料: {
2025-08-09 11:23:44    lastOperation: {
2025-08-09 11:23:44      intent: 'add_course',
2025-08-09 11:23:44      slots: {
2025-08-09 11:23:44        studentName: 'Lumi',
2025-08-09 11:23:44        courseName: '鋼琴課',
2025-08-09 11:23:44        scheduleTime: '14:00',
2025-08-09 11:23:44        dayOfWeek: 4,
2025-08-09 11:23:44        recurring: true,
2025-08-09 11:23:44        recurrenceType: 'weekly'
2025-08-09 11:23:44      },
2025-08-09 11:23:44      result: {
2025-08-09 11:23:44        success: true,
2025-08-09 11:23:44        code: 'ADD_COURSE_OK',
2025-08-09 11:23:44        message: '✅ 課程已安排成功！\n\n👦 學生：Lumi\n📚 課程：鋼琴課\n🔄 重複：每週四 下午2:00\n📅 下次上課：2025-08-14',
2025-08-09 11:23:44        data: [Object],
2025-08-09 11:23:44        quickReply: [Array]
2025-08-09 11:23:44      }
2025-08-09 11:23:44    },
2025-08-09 11:23:44    timestamp: 1754738622750,
2025-08-09 11:23:44    slots: {
2025-08-09 11:23:44      intent: 'add_course',
2025-08-09 11:23:44      existingSlots: {
2025-08-09 11:23:44        studentName: '小明',
2025-08-09 11:23:44        courseName: '英文課',
2025-08-09 11:23:44        scheduleTime: '08:00',
2025-08-09 11:23:44        recurring: false
2025-08-09 11:23:44      },
2025-08-09 11:23:44      missingFields: [ '課程日期' ]
2025-08-09 11:23:44    }
2025-08-09 11:23:44  }
2025-08-09 11:23:44  🔄 嘗試在原意圖中完整解析: add_course
2025-08-09 11:23:44  📋 現有 slots: {
2025-08-09 11:23:44    studentName: '小明',
2025-08-09 11:23:44    courseName: '英文課',
2025-08-09 11:23:44    scheduleTime: '08:00',
2025-08-09 11:23:44    recurring: false
2025-08-09 11:23:44  }
2025-08-09 11:23:44  🔍 開始提取 slots - 意圖: add_course (用戶: U_test_user_qa)
2025-08-09 11:23:44  🕒 開始高級時間解析: 小明每週一早上8點英文課
2025-08-09 11:23:44  ✅ 時間解析成功: {
2025-08-09 11:23:44    input: '小明每週一早上8點英文課',
2025-08-09 11:23:44    output: '08:00',
2025-08-09 11:23:44    details: { hour: 8, minute: 0, matchType: 'arabic_period', periodInfo: '早上' }
2025-08-09 11:23:44  }
2025-08-09 11:23:44  🧠 使用對話上下文增強 slots 提取
2025-08-09 11:23:44  📊 規則提取置信度: 1.00
2025-08-09 11:23:44  🤖 啟用 AI 輔助提取...
2025-08-09 11:23:46  ✅ 最終 slots: {
2025-08-09 11:23:46    studentName: '小明',
2025-08-09 11:23:46    courseName: '英文課',
2025-08-09 11:23:46    scheduleTime: '08:00',
2025-08-09 11:23:46    dayOfWeek: 1,
2025-08-09 11:23:46    recurring: true,
2025-08-09 11:23:46    recurrenceType: 'weekly'
2025-08-09 11:23:46  }
2025-08-09 11:23:46  🔗 合併後的 slots: {
2025-08-09 11:23:46    studentName: '小明',
2025-08-09 11:23:46    courseName: '英文課',
2025-08-09 11:23:46    scheduleTime: '08:00',
2025-08-09 11:23:46    recurring: true,
2025-08-09 11:23:46    dayOfWeek: 1,
2025-08-09 11:23:46    recurrenceType: 'weekly'
2025-08-09 11:23:46  }
2025-08-09 11:23:46  ✅ 資訊完整，可執行原意圖
2025-08-09 11:23:46  ✅ 上下文完整解析成功: add_course
2025-08-09 11:23:46  🎯 識別意圖: add_course
2025-08-09 11:23:46  🔍 開始提取 slots - 意圖: add_course (用戶: U_test_user_qa)
2025-08-09 11:23:46  🕒 開始高級時間解析: 小明每週一早上8點英文課
2025-08-09 11:23:46  ✅ 時間解析成功: {
2025-08-09 11:23:46    input: '小明每週一早上8點英文課',
2025-08-09 11:23:46    output: '08:00',
2025-08-09 11:23:46    details: { hour: 8, minute: 0, matchType: 'arabic_period', periodInfo: '早上' }
2025-08-09 11:23:46  }
2025-08-09 11:23:46  🧠 使用對話上下文增強 slots 提取
2025-08-09 11:23:46  📊 規則提取置信度: 1.00
2025-08-09 11:23:46  🤖 啟用 AI 輔助提取...
2025-08-09 11:23:46  ✅ 最終 slots: {
2025-08-09 11:23:46    studentName: '小明',
2025-08-09 11:23:46    courseName: '英文課',
2025-08-09 11:23:46    scheduleTime: '08:00',
2025-08-09 11:23:46    dayOfWeek: 1,
2025-08-09 11:23:46    recurring: true,
2025-08-09 11:23:46    recurrenceType: 'weekly'
2025-08-09 11:23:46  }
2025-08-09 11:23:46  🔗 合併後的 slots: {
2025-08-09 11:23:46    studentName: '小明',
2025-08-09 11:23:46    courseName: '英文課',
2025-08-09 11:23:46    scheduleTime: '08:00',
2025-08-09 11:23:46    recurring: true,
2025-08-09 11:23:46    dayOfWeek: 1,
2025-08-09 11:23:46    recurrenceType: 'weekly'
2025-08-09 11:23:46  }
2025-08-09 11:23:46  ✅ 資訊完整，可執行原意圖
2025-08-09 11:23:46  ✅ 上下文完整解析成功: add_course
2025-08-09 11:23:46  🎯 識別意圖: add_course
2025-08-09 11:23:46  🔍 開始提取 slots - 意圖: add_course (用戶: U_test_user_qa)
2025-08-09 11:23:46  🕒 開始高級時間解析: 小明每週一早上8點英文課
2025-08-09 11:23:46  ✅ 時間解析成功: {
2025-08-09 11:23:46    input: '小明每週一早上8點英文課',
2025-08-09 11:23:46    output: '08:00',
2025-08-09 11:23:46    details: { hour: 8, minute: 0, matchType: 'arabic_period', periodInfo: '早上' }
2025-08-09 11:23:46  }
2025-08-09 11:23:46  🧠 使用對話上下文增強 slots 提取
2025-08-09 11:23:46  📊 規則提取置信度: 1.00
2025-08-09 11:23:46  🤖 啟用 AI 輔助提取...
2025-08-09 11:23:47  ✅ 最終 slots: {
2025-08-09 11:23:47    studentName: '小明',
2025-08-09 11:23:47    courseName: '英文課',
2025-08-09 11:23:47    scheduleTime: '08:00',
2025-08-09 11:23:47    dayOfWeek: 1,
2025-08-09 11:23:47    recurring: true,
2025-08-09 11:23:47    recurrenceType: 'weekly'
2025-08-09 11:23:47  }
2025-08-09 11:23:47  📋 提取結果: {
2025-08-09 11:23:47    studentName: '小明',
2025-08-09 11:23:47    courseName: '英文課',
2025-08-09 11:23:47    scheduleTime: '08:00',
2025-08-09 11:23:47    dayOfWeek: 1,
2025-08-09 11:23:47    recurring: true,
2025-08-09 11:23:47    recurrenceType: 'weekly'
2025-08-09 11:23:47  }
2025-08-09 11:23:47  🎯 執行任務: add_course
2025-08-09 11:23:47  🎯 開始處理新增課程任務
2025-08-09 11:23:47  📋 接收參數: {
2025-08-09 11:23:47    studentName: '小明',
2025-08-09 11:23:47    courseName: '英文課',
2025-08-09 11:23:47    scheduleTime: '08:00',
2025-08-09 11:23:47    dayOfWeek: 1,
2025-08-09 11:23:47    recurring: true,
2025-08-09 11:23:47    recurrenceType: 'weekly'
2025-08-09 11:23:47  }
2025-08-09 11:23:47  👤 學生日曆: b9bf786ee6f0002a0cbe843b8e27184082718a0ab1875873280de3be93e4a481@group.calendar.google.com
2025-08-09 11:23:47  ✅ 已創建課程事件: mock-event-1754738627616
2025-08-09 11:23:47  📅 Google Calendar 事件已創建: mock-event-1754738627616
2025-08-09 11:23:47  ✅ 課程資料已儲存: cW9l43o86qoxr0YhUlgf
2025-08-09 11:23:47  💾 Firebase 課程資料已儲存: cW9l43o86qoxr0YhUlgf
2025-08-09 11:23:47  📊 任務執行結果: {
2025-08-09 11:23:47    success: true,
2025-08-09 11:23:47    code: 'ADD_COURSE_OK',
2025-08-09 11:23:47    message: '✅ 課程已安排成功！\n\n👦 學生：小明\n📚 課程：英文課\n🔄 重複：每週一 上午8:00\n📅 下次上課：2025-08-11',
2025-08-09 11:23:47    data: {
2025-08-09 11:23:47      courseId: 'cW9l43o86qoxr0YhUlgf',
2025-08-09 11:23:47      eventId: 'mock-event-1754738627616'
2025-08-09 11:23:47    },
2025-08-09 11:23:47    quickReply: [
2025-08-09 11:23:47      { label: '✅ 確認', text: '確認' },
2025-08-09 11:23:47      { label: '✏️ 修改', text: '修改' },
2025-08-09 11:23:47      { label: '❌ 取消操作', text: '取消操作' }
2025-08-09 11:23:47    ]
2025-08-09 11:23:47  }
2025-08-09 11:23:47  ✅ 任務結果: {
2025-08-09 11:23:47    success: true,
2025-08-09 11:23:47    code: 'ADD_COURSE_OK',
2025-08-09 11:23:47    message: '✅ 課程已安排成功！\n\n👦 學生：小明\n📚 課程：英文課\n🔄 重複：每週一 上午8:00\n📅 下次上課：2025-08-11',
2025-08-09 11:23:47    data: {
2025-08-09 11:23:47      courseId: 'cW9l43o86qoxr0YhUlgf',
2025-08-09 11:23:47      eventId: 'mock-event-1754738627616'
2025-08-09 11:23:47    },
2025-08-09 11:23:47    quickReply: [
2025-08-09 11:23:47      { label: '✅ 確認', text: '確認' },
2025-08-09 11:23:47      { label: '✏️ 修改', text: '修改' },
2025-08-09 11:23:47      { label: '❌ 取消操作', text: '取消操作' }
2025-08-09 11:23:47    ]
2025-08-09 11:23:47  }
2025-08-09 11:23:48  🔍 檢查 replyToken: test-reply-token-1754738624353
2025-08-09 11:23:48  🧪 檢測到測試 token，跳過真實 LINE API 調用
2025-08-09 11:23:48  📤 [測試模式] 實際業務回覆: ✅ 課程已安排成功！
2025-08-09 11:23:48  
2025-08-09 11:23:48  👦 學生：小明
2025-08-09 11:23:48  📚 課程：英文課
2025-08-09 11:23:48  🔄 重複：每週一 上午8:00
2025-08-09 11:23:48  📅 下次上課：2025-08-11
2025-08-09 11:23:49  📨 收到 1 個事件
2025-08-09 11:23:49  📋 事件類型: message
2025-08-09 11:23:49  🔍 完整事件 JSON: {
2025-08-09 11:23:49    "type": "message",
2025-08-09 11:23:49  📨 收到 1 個事件
2025-08-09 11:23:49  📋 事件類型: message
2025-08-09 11:23:49  🔍 完整事件 JSON: {
2025-08-09 11:23:49    "type": "message",
2025-08-09 11:23:49    "message": {
2025-08-09 11:23:49      "type": "text",
2025-08-09 11:23:49      "text": "小明每月1號早上8點英文課"
2025-08-09 11:23:49    },
2025-08-09 11:23:49    "source": {
2025-08-09 11:23:49      "userId": "U_test_user_qa",
2025-08-09 11:23:49      "type": "user"
2025-08-09 11:23:49    },
2025-08-09 11:23:49    "replyToken": "test-reply-token-1754738629474",
2025-08-09 11:23:49    "timestamp": 1754738629474
2025-08-09 11:23:49  }
2025-08-09 11:23:49  📝 收到文字訊息: 小明每月1號早上8點英文課
2025-08-09 11:23:49  👤 用戶ID: U_test_user_qa
2025-08-09 11:23:49  🔍 用戶ID類型: string
2025-08-09 11:23:49  🔍 是否測試用戶: true
2025-08-09 11:23:49  🚀 生產用戶，使用真實 LINE Service
2025-08-09 11:23:49  🔥 選擇的服務類型: Object
2025-08-09 11:23:49  🎯 開始解析意圖: 小明每月1號早上8點英文課 (用戶: U_test_user_qa)
2025-08-09 11:23:49  🧠 檢測到期待輸入狀態: [ 'confirmation', 'modification' ]
2025-08-09 11:23:49  📋 待補充資料: {
2025-08-09 11:23:49    lastOperation: {
2025-08-09 11:23:49      intent: 'add_course',
2025-08-09 11:23:49      slots: {
2025-08-09 11:23:49        studentName: '小明',
2025-08-09 11:23:49        courseName: '英文課',
2025-08-09 11:23:49        scheduleTime: '08:00',
2025-08-09 11:23:49        dayOfWeek: 1,
2025-08-09 11:23:49        recurring: true,
2025-08-09 11:23:49        recurrenceType: 'weekly'
2025-08-09 11:23:49      },
2025-08-09 11:23:49      result: {
2025-08-09 11:23:49        success: true,
2025-08-09 11:23:49        code: 'ADD_COURSE_OK',
2025-08-09 11:23:49        message: '✅ 課程已安排成功！\n\n👦 學生：小明\n📚 課程：英文課\n🔄 重複：每週一 上午8:00\n📅 下次上課：2025-08-11',
2025-08-09 11:23:49        data: [Object],
2025-08-09 11:23:49        quickReply: [Array]
2025-08-09 11:23:49      }
2025-08-09 11:23:49    },
2025-08-09 11:23:49    timestamp: 1754738627861
2025-08-09 11:23:49  }
2025-08-09 11:23:49  ⚠️ 無待處理的意圖資料
2025-08-09 11:23:49  ⚠️ 無待處理的意圖資料
2025-08-09 11:23:49  ✅ 規則匹配成功: add_course
2025-08-09 11:23:49  🎯 識別意圖: add_course
2025-08-09 11:23:49  🔍 開始提取 slots - 意圖: add_course (用戶: U_test_user_qa)
2025-08-09 11:23:49  🕒 開始高級時間解析: 小明每月1號早上8點英文課
2025-08-09 11:23:49  ✅ 時間解析成功: {
2025-08-09 11:23:49    input: '小明每月1號早上8點英文課',
2025-08-09 11:23:49    output: '08:00',
2025-08-09 11:23:49    details: { hour: 8, minute: 0, matchType: 'arabic_period', periodInfo: '早上' }
2025-08-09 11:23:49  }
2025-08-09 11:23:49  📊 規則提取置信度: 0.50
2025-08-09 11:23:49  🤖 啟用 AI 輔助提取...
2025-08-09 11:23:50  ✅ 最終 slots: {
2025-08-09 11:23:50    studentName: '小明',
2025-08-09 11:23:50    courseName: '英文課',
2025-08-09 11:23:50    scheduleTime: '08:00',
2025-08-09 11:23:50    recurring: true,
2025-08-09 11:23:50    recurrenceType: 'monthly',
2025-08-09 11:23:50    timeReference: '每月1號'
2025-08-09 11:23:50  }
2025-08-09 11:23:50  📋 提取結果: {
2025-08-09 11:23:50    studentName: '小明',
2025-08-09 11:23:50    courseName: '英文課',
2025-08-09 11:23:50    scheduleTime: '08:00',
2025-08-09 11:23:50    recurring: true,
2025-08-09 11:23:50    recurrenceType: 'monthly',
2025-08-09 11:23:50    timeReference: '每月1號'
2025-08-09 11:23:50  }
2025-08-09 11:23:50  🎯 執行任務: add_course
2025-08-09 11:23:50  🎯 開始處理新增課程任務
2025-08-09 11:23:50  📋 接收參數: {
2025-08-09 11:23:50    studentName: '小明',
2025-08-09 11:23:50    courseName: '英文課',
2025-08-09 11:23:50    scheduleTime: '08:00',
2025-08-09 11:23:50    recurring: true,
2025-08-09 11:23:50    recurrenceType: 'monthly',
2025-08-09 11:23:50    timeReference: '每月1號'
2025-08-09 11:23:50  }
2025-08-09 11:23:50  📊 任務執行結果: {
2025-08-09 11:23:50    success: false,
2025-08-09 11:23:50    code: 'NOT_IMPLEMENTED_MONTHLY',
2025-08-09 11:23:50    message: '⚠️ 目前僅支援「每天」與「每週」的重複課程，每月重複將在後續版本提供。'
2025-08-09 11:23:50  }
2025-08-09 11:23:50  ✅ 任務結果: {
2025-08-09 11:23:50    success: false,
2025-08-09 11:23:50    code: 'NOT_IMPLEMENTED_MONTHLY',
2025-08-09 11:23:50    message: '⚠️ 目前僅支援「每天」與「每週」的重複課程，每月重複將在後續版本提供。'
2025-08-09 11:23:50  }
2025-08-09 11:23:51  🔍 檢查 replyToken: test-reply-token-1754738629474
2025-08-09 11:23:51  🧪 檢測到測試 token，跳過真實 LINE API 調用
2025-08-09 11:23:51  📤 [測試模式] 實際業務回覆: ⚠️ 目前僅支援「每天」與「每週」的重複課程，每月重複將在後續版本提供。
2025-08-09 11:24:01  📨 收到 1 個事件
2025-08-09 11:24:01  📋 事件類型: message
2025-08-09 11:24:01  🔍 完整事件 JSON: {
2025-08-09 11:24:01    "type": "message",
2025-08-09 11:24:01  📨 收到 1 個事件
2025-08-09 11:24:01  📋 事件類型: message
2025-08-09 11:24:01  🔍 完整事件 JSON: {
2025-08-09 11:24:01    "type": "message",
2025-08-09 11:24:01    "message": {
2025-08-09 11:24:01      "type": "text",
2025-08-09 11:24:01      "text": "小明每天早上8點英文課"
2025-08-09 11:24:01    },
2025-08-09 11:24:01    "source": {
2025-08-09 11:24:01      "userId": "U_test_user_qa",
2025-08-09 11:24:01      "type": "user"
2025-08-09 11:24:01    },
2025-08-09 11:24:01    "replyToken": "test-reply-token-1754738641218",
2025-08-09 11:24:01    "timestamp": 1754738641218
2025-08-09 11:24:01  }
2025-08-09 11:24:01  📝 收到文字訊息: 小明每天早上8點英文課
2025-08-09 11:24:01  👤 用戶ID: U_test_user_qa
2025-08-09 11:24:01  🔍 用戶ID類型: string
2025-08-09 11:24:01  🔍 是否測試用戶: true
2025-08-09 11:24:01  🚀 生產用戶，使用真實 LINE Service
2025-08-09 11:24:01  🔥 選擇的服務類型: Object
2025-08-09 11:24:01  🎯 開始解析意圖: 小明每天早上8點英文課 (用戶: U_test_user_qa)
2025-08-09 11:24:01  🧠 檢測到期待輸入狀態: [ 'confirmation', 'modification' ]
2025-08-09 11:24:01  📋 待補充資料: {
2025-08-09 11:24:01    lastOperation: {
2025-08-09 11:24:01      intent: 'add_course',
2025-08-09 11:24:01      slots: {
2025-08-09 11:24:01        studentName: '小明',
2025-08-09 11:24:01        courseName: '英文課',
2025-08-09 11:24:01        scheduleTime: '08:00',
2025-08-09 11:24:01        dayOfWeek: 1,
2025-08-09 11:24:01        recurring: true,
2025-08-09 11:24:01        recurrenceType: 'weekly'
2025-08-09 11:24:01      },
2025-08-09 11:24:01      result: {
2025-08-09 11:24:01        success: true,
2025-08-09 11:24:01        code: 'ADD_COURSE_OK',
2025-08-09 11:24:01        message: '✅ 課程已安排成功！\n\n👦 學生：小明\n📚 課程：英文課\n🔄 重複：每週一 上午8:00\n📅 下次上課：2025-08-11',
2025-08-09 11:24:01        data: [Object],
2025-08-09 11:24:01        quickReply: [Array]
2025-08-09 11:24:01      }
2025-08-09 11:24:01    },
2025-08-09 11:24:01    timestamp: 1754738627861
2025-08-09 11:24:01  }
2025-08-09 11:24:01  ⚠️ 無待處理的意圖資料
2025-08-09 11:24:01  ⚠️ 無待處理的意圖資料
2025-08-09 11:24:01  ✅ 規則匹配成功: add_course
2025-08-09 11:24:01  🎯 識別意圖: add_course
2025-08-09 11:24:01  🔍 開始提取 slots - 意圖: add_course (用戶: U_test_user_qa)
2025-08-09 11:24:01  🕒 開始高級時間解析: 小明每天早上8點英文課
2025-08-09 11:24:01  ✅ 時間解析成功: {
2025-08-09 11:24:01    input: '小明每天早上8點英文課',
2025-08-09 11:24:01    output: '08:00',
2025-08-09 11:24:01    details: { hour: 8, minute: 0, matchType: 'arabic_period', periodInfo: '早上' }
2025-08-09 11:24:01  }
2025-08-09 11:24:01  📊 規則提取置信度: 0.50
2025-08-09 11:24:01  🤖 啟用 AI 輔助提取...
2025-08-09 11:24:04  ✅ 最終 slots: {
2025-08-09 11:24:04    studentName: '小明',
2025-08-09 11:24:04    courseName: '英文課',
2025-08-09 11:24:04    scheduleTime: '08:00',
2025-08-09 11:24:04    recurring: false
2025-08-09 11:24:04  }
2025-08-09 11:24:04  📋 提取結果: {
2025-08-09 11:24:04    studentName: '小明',
2025-08-09 11:24:04    courseName: '英文課',
2025-08-09 11:24:04    scheduleTime: '08:00',
2025-08-09 11:24:04    recurring: false
2025-08-09 11:24:04  }
2025-08-09 11:24:04  🎯 執行任務: add_course
2025-08-09 11:24:04  🎯 開始處理新增課程任務
2025-08-09 11:24:04  📋 接收參數: {
2025-08-09 11:24:04    studentName: '小明',
2025-08-09 11:24:04    courseName: '英文課',
2025-08-09 11:24:04    scheduleTime: '08:00',
2025-08-09 11:24:04    recurring: false
2025-08-09 11:24:04  }
2025-08-09 11:24:04  📊 任務執行結果: {
2025-08-09 11:24:04    success: false,
2025-08-09 11:24:04    code: 'MISSING_FIELDS',
2025-08-09 11:24:04    message: '❓ 請提供以下資訊：課程日期\n\n範例：「小明每週三下午3點數學課」',
2025-08-09 11:24:04    expectingInput: true,
2025-08-09 11:24:04    missingFields: [ '課程日期' ]
2025-08-09 11:24:04  }
2025-08-09 11:24:04  ✅ 任務結果: {
2025-08-09 11:24:04    success: false,
2025-08-09 11:24:04    code: 'MISSING_FIELDS',
2025-08-09 11:24:04    message: '❓ 請提供以下資訊：課程日期\n\n範例：「小明每週三下午3點數學課」',
2025-08-09 11:24:04    expectingInput: true,
2025-08-09 11:24:04    missingFields: [ '課程日期' ]
2025-08-09 11:24:04  }
2025-08-09 11:24:04  🔍 檢查 replyToken: test-reply-token-1754738641218
2025-08-09 11:24:04  🧪 檢測到測試 token，跳過真實 LINE API 調用
2025-08-09 11:24:04  📤 [測試模式] 實際業務回覆: ❓ 請提供以下資訊：課程日期
2025-08-09 11:24:04  
2025-08-09 11:24:04  範例：「小明每週三下午3點數學課」
2025-08-09 11:24:14  📨 收到 1 個事件
2025-08-09 11:24:14  📋 事件類型: message
2025-08-09 11:24:14  🔍 完整事件 JSON: {
2025-08-09 11:24:14    "type": "message",
2025-08-09 11:24:14  📨 收到 1 個事件
2025-08-09 11:24:14  📋 事件類型: message
2025-08-09 11:24:14  🔍 完整事件 JSON: {
2025-08-09 11:24:14    "type": "message",
2025-08-09 11:24:14    "message": {
2025-08-09 11:24:14      "type": "text",
2025-08-09 11:24:14      "text": "小明每天下午2點數學課"
2025-08-09 11:24:14    },
2025-08-09 11:24:14    "source": {
2025-08-09 11:24:14      "userId": "U_test_user_qa",
2025-08-09 11:24:14      "type": "user"
2025-08-09 11:24:14    },
2025-08-09 11:24:14    "replyToken": "test-reply-token-1754738654889",
2025-08-09 11:24:14    "timestamp": 1754738654889
2025-08-09 11:24:14  }
2025-08-09 11:24:14  📝 收到文字訊息: 小明每天下午2點數學課
2025-08-09 11:24:14  👤 用戶ID: U_test_user_qa
2025-08-09 11:24:14  🔍 用戶ID類型: string
2025-08-09 11:24:14  🔍 是否測試用戶: true
2025-08-09 11:24:14  🚀 生產用戶，使用真實 LINE Service
2025-08-09 11:24:14  🔥 選擇的服務類型: Object
2025-08-09 11:24:14  🎯 開始解析意圖: 小明每天下午2點數學課 (用戶: U_test_user_qa)
2025-08-09 11:24:15  🧠 檢測到期待輸入狀態: [ 'course_date_input' ]
2025-08-09 11:24:15  📋 待補充資料: {
2025-08-09 11:24:15    lastOperation: {
2025-08-09 11:24:15      intent: 'add_course',
2025-08-09 11:24:15      slots: {
2025-08-09 11:24:15        studentName: '小明',
2025-08-09 11:24:15        courseName: '英文課',
2025-08-09 11:24:15        scheduleTime: '08:00',
2025-08-09 11:24:15        dayOfWeek: 1,
2025-08-09 11:24:15        recurring: true,
2025-08-09 11:24:15        recurrenceType: 'weekly'
2025-08-09 11:24:15      },
2025-08-09 11:24:15      result: {
2025-08-09 11:24:15        success: true,
2025-08-09 11:24:15        code: 'ADD_COURSE_OK',
2025-08-09 11:24:15        message: '✅ 課程已安排成功！\n\n👦 學生：小明\n📚 課程：英文課\n🔄 重複：每週一 上午8:00\n📅 下次上課：2025-08-11',
2025-08-09 11:24:15        data: [Object],
2025-08-09 11:24:15        quickReply: [Array]
2025-08-09 11:24:15      }
2025-08-09 11:24:15    },
2025-08-09 11:24:15    timestamp: 1754738644595,
2025-08-09 11:24:15    slots: {
2025-08-09 11:24:15      intent: 'add_course',
2025-08-09 11:24:15      existingSlots: {
2025-08-09 11:24:15        studentName: '小明',
2025-08-09 11:24:15        courseName: '英文課',
2025-08-09 11:24:15        scheduleTime: '08:00',
2025-08-09 11:24:15        recurring: false
2025-08-09 11:24:15      },
2025-08-09 11:24:15      missingFields: [ '課程日期' ]
2025-08-09 11:24:15    }
2025-08-09 11:24:15  }
2025-08-09 11:24:15  🔄 嘗試在原意圖中完整解析: add_course
2025-08-09 11:24:15  📋 現有 slots: {
2025-08-09 11:24:15    studentName: '小明',
2025-08-09 11:24:15    courseName: '英文課',
2025-08-09 11:24:15    scheduleTime: '08:00',
2025-08-09 11:24:15    recurring: false
2025-08-09 11:24:15  }
2025-08-09 11:24:15  🔍 開始提取 slots - 意圖: add_course (用戶: U_test_user_qa)
2025-08-09 11:24:15  🕒 開始高級時間解析: 小明每天下午2點數學課
2025-08-09 11:24:15  ✅ 時間解析成功: {
2025-08-09 11:24:15    input: '小明每天下午2點數學課',
2025-08-09 11:24:15    output: '14:00',
2025-08-09 11:24:15    details: { hour: 14, minute: 0, matchType: 'arabic_period', periodInfo: '下午' }
2025-08-09 11:24:15  }
2025-08-09 11:24:15  📊 規則提取置信度: 0.50
2025-08-09 11:24:15  🤖 啟用 AI 輔助提取...
2025-08-09 11:24:16  ✅ 最終 slots: {
2025-08-09 11:24:16    studentName: '小明',
2025-08-09 11:24:16    courseName: '數學課',
2025-08-09 11:24:16    scheduleTime: '14:00',
2025-08-09 11:24:16    recurring: false
2025-08-09 11:24:16  }
2025-08-09 11:24:16  🔗 合併後的 slots: {
2025-08-09 11:24:16    studentName: '小明',
2025-08-09 11:24:16    courseName: '數學課',
2025-08-09 11:24:16    scheduleTime: '14:00',
2025-08-09 11:24:16    recurring: false
2025-08-09 11:24:16  }
2025-08-09 11:24:16  ✅ 資訊完整，可執行原意圖
2025-08-09 11:24:16  ✅ 上下文完整解析成功: add_course
2025-08-09 11:24:16  🎯 識別意圖: add_course
2025-08-09 11:24:16  🔍 開始提取 slots - 意圖: add_course (用戶: U_test_user_qa)
2025-08-09 11:24:16  🕒 開始高級時間解析: 小明每天下午2點數學課
2025-08-09 11:24:16  ✅ 時間解析成功: {
2025-08-09 11:24:16    input: '小明每天下午2點數學課',
2025-08-09 11:24:16    output: '14:00',
2025-08-09 11:24:16    details: { hour: 14, minute: 0, matchType: 'arabic_period', periodInfo: '下午' }
2025-08-09 11:24:16  }
2025-08-09 11:24:16  📊 規則提取置信度: 0.50
2025-08-09 11:24:16  🤖 啟用 AI 輔助提取...
2025-08-09 11:24:17  ✅ 最終 slots: {
2025-08-09 11:24:17    studentName: '小明',
2025-08-09 11:24:17    courseName: '數學課',
2025-08-09 11:24:17    scheduleTime: '14:00',
2025-08-09 11:24:17    recurring: false
2025-08-09 11:24:17  }
2025-08-09 11:24:17  ✅ 最終 slots: {
2025-08-09 11:24:17    studentName: '小明',
2025-08-09 11:24:17    courseName: '數學課',
2025-08-09 11:24:17    scheduleTime: '14:00',
2025-08-09 11:24:17    recurring: false
2025-08-09 11:24:17  }
2025-08-09 11:24:17  📋 提取結果: {
2025-08-09 11:24:17    studentName: '小明',
2025-08-09 11:24:17    courseName: '數學課',
2025-08-09 11:24:17    scheduleTime: '14:00',
2025-08-09 11:24:17    recurring: false
2025-08-09 11:24:17  }
2025-08-09 11:24:17  🎯 執行任務: add_course
2025-08-09 11:24:17  🎯 開始處理新增課程任務
2025-08-09 11:24:17  📋 接收參數: {
2025-08-09 11:24:17    studentName: '小明',
2025-08-09 11:24:17    courseName: '數學課',
2025-08-09 11:24:17    scheduleTime: '14:00',
2025-08-09 11:24:17    recurring: false
2025-08-09 11:24:17  }
2025-08-09 11:24:17  📊 任務執行結果: {
2025-08-09 11:24:17    success: false,
2025-08-09 11:24:17    code: 'MISSING_FIELDS',
2025-08-09 11:24:17    message: '❓ 請提供以下資訊：課程日期\n\n範例：「小明每週三下午3點數學課」',
2025-08-09 11:24:17    expectingInput: true,
2025-08-09 11:24:17    missingFields: [ '課程日期' ]
2025-08-09 11:24:17  }
2025-08-09 11:24:17  ✅ 任務結果: {
2025-08-09 11:24:17    success: false,
2025-08-09 11:24:17    code: 'MISSING_FIELDS',
2025-08-09 11:24:17    message: '❓ 請提供以下資訊：課程日期\n\n範例：「小明每週三下午3點數學課」',
2025-08-09 11:24:17    expectingInput: true,
2025-08-09 11:24:17    missingFields: [ '課程日期' ]
2025-08-09 11:24:17  }
2025-08-09 11:24:18  🔍 檢查 replyToken: test-reply-token-1754738654889
2025-08-09 11:24:18  🧪 檢測到測試 token，跳過真實 LINE API 調用
2025-08-09 11:24:18  📤 [測試模式] 實際業務回覆: ❓ 請提供以下資訊：課程日期
2025-08-09 11:24:18  
2025-08-09 11:24:18  範例：「小明每週三下午3點數學課」
2025-08-09 11:24:19  📨 收到 1 個事件
2025-08-09 11:24:19  📋 事件類型: message
2025-08-09 11:24:19  🔍 完整事件 JSON: {
2025-08-09 11:24:19    "type": "message",
2025-08-09 11:24:19    "message": {
2025-08-09 11:24:19      "type": "text",
2025-08-09 11:24:19      "text": "小明每天下午2點英文課"
2025-08-09 11:24:19    },
2025-08-09 11:24:19    "source": {
2025-08-09 11:24:19      "userId": "U_test_user_qa",
2025-08-09 11:24:19      "type": "user"
2025-08-09 11:24:19    },
2025-08-09 11:24:19    "replyToken": "test-reply-token-1754738659451",
2025-08-09 11:24:19    "timestamp": 1754738659451
2025-08-09 11:24:19  }
2025-08-09 11:24:19  📝 收到文字訊息: 小明每天下午2點英文課
2025-08-09 11:24:19  👤 用戶ID: U_test_user_qa
2025-08-09 11:24:19  🔍 用戶ID類型: string
2025-08-09 11:24:19  🔍 是否測試用戶: true
2025-08-09 11:24:19  🚀 生產用戶，使用真實 LINE Service
2025-08-09 11:24:19  🔥 選擇的服務類型: Object
2025-08-09 11:24:19  🎯 開始解析意圖: 小明每天下午2點英文課 (用戶: U_test_user_qa)
2025-08-09 11:24:19  🧠 檢測到期待輸入狀態: [ 'course_date_input' ]
2025-08-09 11:24:19  📋 待補充資料: {
2025-08-09 11:24:19    lastOperation: {
2025-08-09 11:24:19      intent: 'add_course',
2025-08-09 11:24:19      slots: {
2025-08-09 11:24:19        studentName: '小明',
2025-08-09 11:24:19        courseName: '英文課',
2025-08-09 11:24:19        scheduleTime: '08:00',
2025-08-09 11:24:19        dayOfWeek: 1,
2025-08-09 11:24:19        recurring: true,
2025-08-09 11:24:19        recurrenceType: 'weekly'
2025-08-09 11:24:19      },
2025-08-09 11:24:19      result: {
2025-08-09 11:24:19        success: true,
2025-08-09 11:24:19        code: 'ADD_COURSE_OK',
2025-08-09 11:24:19        message: '✅ 課程已安排成功！\n\n👦 學生：小明\n📚 課程：英文課\n🔄 重複：每週一 上午8:00\n📅 下次上課：2025-08-11',
2025-08-09 11:24:19        data: [Object],
2025-08-09 11:24:19        quickReply: [Array]
2025-08-09 11:24:19      }
2025-08-09 11:24:19    },
2025-08-09 11:24:19    timestamp: 1754738657747,
2025-08-09 11:24:19    slots: {
2025-08-09 11:24:19      intent: 'add_course',
2025-08-09 11:24:19      existingSlots: {
2025-08-09 11:24:19        studentName: '小明',
2025-08-09 11:24:19        courseName: '數學課',
2025-08-09 11:24:19        scheduleTime: '14:00',
2025-08-09 11:24:19        recurring: false
2025-08-09 11:24:19      },
2025-08-09 11:24:19      missingFields: [ '課程日期' ]
2025-08-09 11:24:19    }
2025-08-09 11:24:19  }
2025-08-09 11:24:19  🔄 嘗試在原意圖中完整解析: add_course
2025-08-09 11:24:19  📋 現有 slots: {
2025-08-09 11:24:19    studentName: '小明',
2025-08-09 11:24:19    courseName: '數學課',
2025-08-09 11:24:19    scheduleTime: '14:00',
2025-08-09 11:24:19    recurring: false
2025-08-09 11:24:19  }
2025-08-09 11:24:19  📨 收到 1 個事件
2025-08-09 11:24:19  📋 事件類型: message
2025-08-09 11:24:19  🔍 完整事件 JSON: {
2025-08-09 11:24:19    "type": "message",
2025-08-09 11:24:19    "message": {
2025-08-09 11:24:19      "type": "text",
2025-08-09 11:24:19      "text": "小明每天下午2點英文課"
2025-08-09 11:24:19    },
2025-08-09 11:24:19    "source": {
2025-08-09 11:24:19      "userId": "U_test_user_qa",
2025-08-09 11:24:19      "type": "user"
2025-08-09 11:24:19    },
2025-08-09 11:24:19    "replyToken": "test-reply-token-1754738659451",
2025-08-09 11:24:19    "timestamp": 1754738659451
2025-08-09 11:24:19  }
2025-08-09 11:24:19  📝 收到文字訊息: 小明每天下午2點英文課
2025-08-09 11:24:19  👤 用戶ID: U_test_user_qa
2025-08-09 11:24:19  🔍 用戶ID類型: string
2025-08-09 11:24:19  🔍 是否測試用戶: true
2025-08-09 11:24:19  🚀 生產用戶，使用真實 LINE Service
2025-08-09 11:24:19  🔥 選擇的服務類型: Object
2025-08-09 11:24:19  🎯 開始解析意圖: 小明每天下午2點英文課 (用戶: U_test_user_qa)
2025-08-09 11:24:19  🧠 檢測到期待輸入狀態: [ 'course_date_input' ]
2025-08-09 11:24:19  📋 待補充資料: {
2025-08-09 11:24:19    lastOperation: {
2025-08-09 11:24:19      intent: 'add_course',
2025-08-09 11:24:19      slots: {
2025-08-09 11:24:19        studentName: '小明',
2025-08-09 11:24:19        courseName: '英文課',
2025-08-09 11:24:19        scheduleTime: '08:00',
2025-08-09 11:24:19        dayOfWeek: 1,
2025-08-09 11:24:19        recurring: true,
2025-08-09 11:24:19        recurrenceType: 'weekly'
2025-08-09 11:24:19      },
2025-08-09 11:24:19      result: {
2025-08-09 11:24:19        success: true,
2025-08-09 11:24:19        code: 'ADD_COURSE_OK',
2025-08-09 11:24:19        message: '✅ 課程已安排成功！\n\n👦 學生：小明\n📚 課程：英文課\n🔄 重複：每週一 上午8:00\n📅 下次上課：2025-08-11',
2025-08-09 11:24:19        data: [Object],
2025-08-09 11:24:19        quickReply: [Array]
2025-08-09 11:24:19      }
2025-08-09 11:24:19    },
2025-08-09 11:24:19    timestamp: 1754738657747,
2025-08-09 11:24:19    slots: {
2025-08-09 11:24:19      intent: 'add_course',
2025-08-09 11:24:19      existingSlots: {
2025-08-09 11:24:19        studentName: '小明',
2025-08-09 11:24:19        courseName: '數學課',
2025-08-09 11:24:19        scheduleTime: '14:00',
2025-08-09 11:24:19        recurring: false
2025-08-09 11:24:19      },
2025-08-09 11:24:19      missingFields: [ '課程日期' ]
2025-08-09 11:24:19    }
2025-08-09 11:24:19  }
2025-08-09 11:24:19  🔄 嘗試在原意圖中完整解析: add_course
2025-08-09 11:24:19  📋 現有 slots: {
2025-08-09 11:24:19    studentName: '小明',
2025-08-09 11:24:19    courseName: '數學課',
2025-08-09 11:24:19    scheduleTime: '14:00',
2025-08-09 11:24:19    recurring: false
2025-08-09 11:24:19  }
2025-08-09 11:24:19  🔍 開始提取 slots - 意圖: add_course (用戶: U_test_user_qa)
2025-08-09 11:24:19  🕒 開始高級時間解析: 小明每天下午2點英文課
2025-08-09 11:24:19  ✅ 時間解析成功: {
2025-08-09 11:24:19    input: '小明每天下午2點英文課',
2025-08-09 11:24:19    output: '14:00',
2025-08-09 11:24:19    details: { hour: 14, minute: 0, matchType: 'arabic_period', periodInfo: '下午' }
2025-08-09 11:24:19  }
2025-08-09 11:24:19  📊 規則提取置信度: 0.50
2025-08-09 11:24:19  🤖 啟用 AI 輔助提取...
2025-08-09 11:24:20  ✅ 最終 slots: {
2025-08-09 11:24:20    studentName: '小明',
2025-08-09 11:24:20    courseName: '英文課',
2025-08-09 11:24:20    scheduleTime: '14:00',
2025-08-09 11:24:20    recurring: false
2025-08-09 11:24:20  }
2025-08-09 11:24:20  🔗 合併後的 slots: {
2025-08-09 11:24:20    studentName: '小明',
2025-08-09 11:24:20    courseName: '英文課',
2025-08-09 11:24:20    scheduleTime: '14:00',
2025-08-09 11:24:20    recurring: false
2025-08-09 11:24:20  }
2025-08-09 11:24:20  ✅ 資訊完整，可執行原意圖
2025-08-09 11:24:21  ✅ 上下文完整解析成功: add_course
2025-08-09 11:24:21  🎯 識別意圖: add_course
2025-08-09 11:24:21  🔍 開始提取 slots - 意圖: add_course (用戶: U_test_user_qa)
2025-08-09 11:24:21  🕒 開始高級時間解析: 小明每天下午2點英文課
2025-08-09 11:24:21  ✅ 時間解析成功: {
2025-08-09 11:24:21    input: '小明每天下午2點英文課',
2025-08-09 11:24:21    output: '14:00',
2025-08-09 11:24:21    details: { hour: 14, minute: 0, matchType: 'arabic_period', periodInfo: '下午' }
2025-08-09 11:24:21  }
2025-08-09 11:24:21  📊 規則提取置信度: 0.50
2025-08-09 11:24:21  🤖 啟用 AI 輔助提取...
2025-08-09 11:24:22  ✅ 最終 slots: {
2025-08-09 11:24:22    studentName: '小明',
2025-08-09 11:24:22    courseName: '英文課',
2025-08-09 11:24:22    scheduleTime: '14:00',
2025-08-09 11:24:22    recurring: false
2025-08-09 11:24:22  }
2025-08-09 11:24:22  ✅ 最終 slots: {
2025-08-09 11:24:22    studentName: '小明',
2025-08-09 11:24:22    courseName: '英文課',
2025-08-09 11:24:22    scheduleTime: '14:00',
2025-08-09 11:24:22    recurring: false
2025-08-09 11:24:22  }
2025-08-09 11:24:22  📋 提取結果: {
2025-08-09 11:24:22    studentName: '小明',
2025-08-09 11:24:22    courseName: '英文課',
2025-08-09 11:24:22    scheduleTime: '14:00',
2025-08-09 11:24:22    recurring: false
2025-08-09 11:24:22  }
2025-08-09 11:24:22  🎯 執行任務: add_course
2025-08-09 11:24:22  🎯 開始處理新增課程任務
2025-08-09 11:24:22  📋 接收參數: {
2025-08-09 11:24:22    studentName: '小明',
2025-08-09 11:24:22    courseName: '英文課',
2025-08-09 11:24:22    scheduleTime: '14:00',
2025-08-09 11:24:22    recurring: false
2025-08-09 11:24:22  }
2025-08-09 11:24:23  📊 任務執行結果: {
2025-08-09 11:24:23    success: false,
2025-08-09 11:24:23    code: 'MISSING_FIELDS',
2025-08-09 11:24:23    message: '❓ 請提供以下資訊：課程日期\n\n範例：「小明每週三下午3點數學課」',
2025-08-09 11:24:23    expectingInput: true,
2025-08-09 11:24:23    missingFields: [ '課程日期' ]
2025-08-09 11:24:23  }
2025-08-09 11:24:23  ✅ 任務結果: {
2025-08-09 11:24:23    success: false,
2025-08-09 11:24:23    code: 'MISSING_FIELDS',
2025-08-09 11:24:23    message: '❓ 請提供以下資訊：課程日期\n\n範例：「小明每週三下午3點數學課」',
2025-08-09 11:24:23    expectingInput: true,
2025-08-09 11:24:23    missingFields: [ '課程日期' ]
2025-08-09 11:24:23  }
2025-08-09 11:24:23  🔍 檢查 replyToken: test-reply-token-1754738659451
2025-08-09 11:24:23  🧪 檢測到測試 token，跳過真實 LINE API 調用
2025-08-09 11:24:23  📤 [測試模式] 實際業務回覆: ❓ 請提供以下資訊：課程日期
2025-08-09 11:24:23  
2025-08-09 11:24:23  範例：「小明每週三下午3點數學課」
2025-08-09 11:24:39  📨 收到 1 個事件
2025-08-09 11:24:39  📋 事件類型: message
2025-08-09 11:24:39  🔍 完整事件 JSON: {
2025-08-09 11:24:39    "type": "message",
2025-08-09 11:24:39    "message": {
2025-08-09 11:24:39      "type": "text",
2025-08-09 11:24:39      "text": "我想了解一下課程安排的情況"
2025-08-09 11:24:39    },
2025-08-09 11:24:39    "source": {
2025-08-09 11:24:39      "userId": "U_test_user_qa",
2025-08-09 11:24:39      "type": "user"
2025-08-09 11:24:39    },
2025-08-09 11:24:39    "replyToken": "test-reply-token-1754738679530",
2025-08-09 11:24:39    "timestamp": 1754738679530
2025-08-09 11:24:39  }
2025-08-09 11:24:39  📝 收到文字訊息: 我想了解一下課程安排的情況
2025-08-09 11:24:39  👤 用戶ID: U_test_user_qa
2025-08-09 11:24:39  🔍 用戶ID類型: string
2025-08-09 11:24:39  🔍 是否測試用戶: true
2025-08-09 11:24:39  🚀 生產用戶，使用真實 LINE Service
2025-08-09 11:24:39  🔥 選擇的服務類型: Object
2025-08-09 11:24:39  🎯 開始解析意圖: 我想了解一下課程安排的情況 (用戶: U_test_user_qa)
2025-08-09 11:24:39  🧠 檢測到期待輸入狀態: [ 'course_date_input' ]
2025-08-09 11:24:39  📋 待補充資料: {
2025-08-09 11:24:39    lastOperation: {
2025-08-09 11:24:39      intent: 'add_course',
2025-08-09 11:24:39      slots: {
2025-08-09 11:24:39        studentName: '小明',
2025-08-09 11:24:39        courseName: '英文課',
2025-08-09 11:24:39        scheduleTime: '08:00',
2025-08-09 11:24:39        dayOfWeek: 1,
2025-08-09 11:24:39        recurring: true,
2025-08-09 11:24:39        recurrenceType: 'weekly'
2025-08-09 11:24:39      },
2025-08-09 11:24:39      result: {
2025-08-09 11:24:39        success: true,
2025-08-09 11:24:39        code: 'ADD_COURSE_OK',
2025-08-09 11:24:39        message: '✅ 課程已安排成功！\n\n👦 學生：小明\n📚 課程：英文課\n🔄 重複：每週一 上午8:00\n📅 下次上課：2025-08-11',
2025-08-09 11:24:39        data: [Object],
2025-08-09 11:24:39        quickReply: [Array]
2025-08-09 11:24:39      }
2025-08-09 11:24:39    },
2025-08-09 11:24:39    timestamp: 1754738663002,
2025-08-09 11:24:39    slots: {
2025-08-09 11:24:39      intent: 'add_course',
2025-08-09 11:24:39      existingSlots: {
2025-08-09 11:24:39        studentName: '小明',
2025-08-09 11:24:39        courseName: '英文課',
2025-08-09 11:24:39        scheduleTime: '14:00',
2025-08-09 11:24:39        recurring: false
2025-08-09 11:24:39      },
2025-08-09 11:24:39      missingFields: [ '課程日期' ]
2025-08-09 11:24:39    }
2025-08-09 11:24:39  }
2025-08-09 11:24:39  🔄 嘗試在原意圖中完整解析: add_course
2025-08-09 11:24:39  📋 現有 slots: {
2025-08-09 11:24:39    studentName: '小明',
2025-08-09 11:24:39    courseName: '英文課',
2025-08-09 11:24:39    scheduleTime: '14:00',
2025-08-09 11:24:39    recurring: false
2025-08-09 11:24:39  }
2025-08-09 11:24:39  📨 收到 1 個事件
2025-08-09 11:24:39  📋 事件類型: message
2025-08-09 11:24:39  🔍 完整事件 JSON: {
2025-08-09 11:24:39    "type": "message",
2025-08-09 11:24:39    "message": {
2025-08-09 11:24:39      "type": "text",
2025-08-09 11:24:39      "text": "我想了解一下課程安排的情況"
2025-08-09 11:24:39    },
2025-08-09 11:24:39    "source": {
2025-08-09 11:24:39      "userId": "U_test_user_qa",
2025-08-09 11:24:39      "type": "user"
2025-08-09 11:24:39    },
2025-08-09 11:24:39    "replyToken": "test-reply-token-1754738679530",
2025-08-09 11:24:39    "timestamp": 1754738679530
2025-08-09 11:24:39  }
2025-08-09 11:24:39  📝 收到文字訊息: 我想了解一下課程安排的情況
2025-08-09 11:24:39  👤 用戶ID: U_test_user_qa
2025-08-09 11:24:39  🔍 用戶ID類型: string
2025-08-09 11:24:39  🔍 是否測試用戶: true
2025-08-09 11:24:39  🚀 生產用戶，使用真實 LINE Service
2025-08-09 11:24:39  🔥 選擇的服務類型: Object
2025-08-09 11:24:39  🎯 開始解析意圖: 我想了解一下課程安排的情況 (用戶: U_test_user_qa)
2025-08-09 11:24:39  🧠 檢測到期待輸入狀態: [ 'course_date_input' ]
2025-08-09 11:24:39  📋 待補充資料: {
2025-08-09 11:24:39    lastOperation: {
2025-08-09 11:24:39      intent: 'add_course',
2025-08-09 11:24:39      slots: {
2025-08-09 11:24:39        studentName: '小明',
2025-08-09 11:24:39        courseName: '英文課',
2025-08-09 11:24:39        scheduleTime: '08:00',
2025-08-09 11:24:39        dayOfWeek: 1,
2025-08-09 11:24:39        recurring: true,
2025-08-09 11:24:39        recurrenceType: 'weekly'
2025-08-09 11:24:39      },
2025-08-09 11:24:39      result: {
2025-08-09 11:24:39        success: true,
2025-08-09 11:24:39        code: 'ADD_COURSE_OK',
2025-08-09 11:24:39        message: '✅ 課程已安排成功！\n\n👦 學生：小明\n📚 課程：英文課\n🔄 重複：每週一 上午8:00\n📅 下次上課：2025-08-11',
2025-08-09 11:24:39        data: [Object],
2025-08-09 11:24:39        quickReply: [Array]
2025-08-09 11:24:39      }
2025-08-09 11:24:39    },
2025-08-09 11:24:39    timestamp: 1754738663002,
2025-08-09 11:24:39    slots: {
2025-08-09 11:24:39      intent: 'add_course',
2025-08-09 11:24:39      existingSlots: {
2025-08-09 11:24:39        studentName: '小明',
2025-08-09 11:24:39        courseName: '英文課',
2025-08-09 11:24:39        scheduleTime: '14:00',
2025-08-09 11:24:39        recurring: false
2025-08-09 11:24:39      },
2025-08-09 11:24:39      missingFields: [ '課程日期' ]
2025-08-09 11:24:39    }
2025-08-09 11:24:39  }
2025-08-09 11:24:39  🔄 嘗試在原意圖中完整解析: add_course
2025-08-09 11:24:39  📋 現有 slots: {
2025-08-09 11:24:39    studentName: '小明',
2025-08-09 11:24:39    courseName: '英文課',
2025-08-09 11:24:39    scheduleTime: '14:00',
2025-08-09 11:24:39    recurring: false
2025-08-09 11:24:39  }
2025-08-09 11:24:39  🔍 開始提取 slots - 意圖: add_course (用戶: U_test_user_qa)
2025-08-09 11:24:39  🕒 開始高級時間解析: 我想了解一下課程安排的情況
2025-08-09 11:24:39  ❌ 時間解析失敗: 我想了解一下課程安排的情況
2025-08-09 11:24:39  📊 規則提取置信度: 0.00
2025-08-09 11:24:39  🔄 規則提取信心度低，AI 輔助增強...
2025-08-09 11:24:41  ✅ 文檔已添加到 error_cases: lUVsKtmcOHFtHjCi03Xq
2025-08-09 11:24:41  📊 低置信度案例已記錄: lUVsKtmcOHFtHjCi03Xq
2025-08-09 11:24:41  ✅ 最終 slots: { studentName: '我', recurring: false, content: '課程安排的情況' }
2025-08-09 11:24:41  🔗 合併後的 slots: {
2025-08-09 11:24:41    studentName: '我',
2025-08-09 11:24:41    courseName: '英文課',
2025-08-09 11:24:41    scheduleTime: '14:00',
2025-08-09 11:24:41    recurring: false,
2025-08-09 11:24:41    content: '課程安排的情況'
2025-08-09 11:24:41  }
2025-08-09 11:24:41  ✅ 資訊完整，可執行原意圖
2025-08-09 11:24:41  ✅ 上下文完整解析成功: add_course
2025-08-09 11:24:41  🎯 識別意圖: add_course
2025-08-09 11:24:41  🔍 開始提取 slots - 意圖: add_course (用戶: U_test_user_qa)
2025-08-09 11:24:41  🕒 開始高級時間解析: 我想了解一下課程安排的情況
2025-08-09 11:24:41  ❌ 時間解析失敗: 我想了解一下課程安排的情況
2025-08-09 11:24:41  📊 規則提取置信度: 0.00
2025-08-09 11:24:41  🔄 規則提取信心度低，AI 輔助增強...
2025-08-09 11:24:46  ✅ 文檔已添加到 error_cases: k9rpXPchJgOXpBr8PDF2
2025-08-09 11:24:46  📊 低置信度案例已記錄: k9rpXPchJgOXpBr8PDF2
2025-08-09 11:24:46  ✅ 最終 slots: { studentName: '我', recurring: false, content: '課程安排的情況' }
2025-08-09 11:24:46  📋 提取結果: { studentName: '我', recurring: false, content: '課程安排的情況' }
2025-08-09 11:24:46  🎯 執行任務: add_course
2025-08-09 11:24:46  🎯 開始處理新增課程任務
2025-08-09 11:24:46  📋 接收參數: { studentName: '我', recurring: false, content: '課程安排的情況' }
2025-08-09 11:24:46  📊 任務執行結果: {
2025-08-09 11:24:46    success: false,
2025-08-09 11:24:46    code: 'MISSING_FIELDS',
2025-08-09 11:24:46    message: '❓ 請提供以下資訊：課程名稱、上課時間、課程日期\n\n範例：「小明每週三下午3點數學課」',
2025-08-09 11:24:46    expectingInput: true,
2025-08-09 11:24:46    missingFields: [ '課程名稱', '上課時間', '課程日期' ]
2025-08-09 11:24:46  }
2025-08-09 11:24:46  ✅ 任務結果: {
2025-08-09 11:24:46    success: false,
2025-08-09 11:24:46  ✅ 文檔已添加到 error_cases: k9rpXPchJgOXpBr8PDF2
2025-08-09 11:24:46  📊 低置信度案例已記錄: k9rpXPchJgOXpBr8PDF2
2025-08-09 11:24:46  ✅ 最終 slots: { studentName: '我', recurring: false, content: '課程安排的情況' }
2025-08-09 11:24:46  📋 提取結果: { studentName: '我', recurring: false, content: '課程安排的情況' }
2025-08-09 11:24:46  🎯 執行任務: add_course
2025-08-09 11:24:46  🎯 開始處理新增課程任務
2025-08-09 11:24:46  📋 接收參數: { studentName: '我', recurring: false, content: '課程安排的情況' }
2025-08-09 11:24:46  📊 任務執行結果: {
2025-08-09 11:24:46    success: false,
2025-08-09 11:24:46    code: 'MISSING_FIELDS',
2025-08-09 11:24:46    message: '❓ 請提供以下資訊：課程名稱、上課時間、課程日期\n\n範例：「小明每週三下午3點數學課」',
2025-08-09 11:24:46    expectingInput: true,
2025-08-09 11:24:46    missingFields: [ '課程名稱', '上課時間', '課程日期' ]
2025-08-09 11:24:46  }
2025-08-09 11:24:46  ✅ 任務結果: {
2025-08-09 11:24:46    success: false,
2025-08-09 11:24:46    code: 'MISSING_FIELDS',
2025-08-09 11:24:46    message: '❓ 請提供以下資訊：課程名稱、上課時間、課程日期\n\n範例：「小明每週三下午3點數學課」',
2025-08-09 11:24:46    expectingInput: true,
2025-08-09 11:24:46    missingFields: [ '課程名稱', '上課時間', '課程日期' ]
2025-08-09 11:24:46  }
2025-08-09 11:24:46  🔍 檢查 replyToken: test-reply-token-1754738679530
2025-08-09 11:24:46  🧪 檢測到測試 token，跳過真實 LINE API 調用
2025-08-09 11:24:46  📤 [測試模式] 實際業務回覆: ❓ 請提供以下資訊：課程名稱、上課時間、課程日期
2025-08-09 11:24:46  
2025-08-09 11:24:46  範例：「小明每週三下午3點數學課」
2025-08-09 11:24:55  📨 收到 1 個事件
2025-08-09 11:24:55  📋 事件類型: message
2025-08-09 11:24:55  🔍 完整事件 JSON: {
2025-08-09 11:24:55    "type": "message",
2025-08-09 11:24:55    "message": {
2025-08-09 11:24:55      "type": "text",
2025-08-09 11:24:55      "text": "幫我安排小明數學課，然後查詢一下他今天有什麼課"
2025-08-09 11:24:55    },
2025-08-09 11:24:55    "source": {
2025-08-09 11:24:55      "userId": "U_test_user_qa",
2025-08-09 11:24:55      "type": "user"
2025-08-09 11:24:55    },
2025-08-09 11:24:55    "replyToken": "test-reply-token-1754738695639",
2025-08-09 11:24:55    "timestamp": 1754738695639
2025-08-09 11:24:55  }
2025-08-09 11:24:55  📝 收到文字訊息: 幫我安排小明數學課，然後查詢一下他今天有什麼課
2025-08-09 11:24:55  👤 用戶ID: U_test_user_qa
2025-08-09 11:24:55  🔍 用戶ID類型: string
2025-08-09 11:24:55  🔍 是否測試用戶: true
2025-08-09 11:24:55  🚀 生產用戶，使用真實 LINE Service
2025-08-09 11:24:55  🔥 選擇的服務類型: Object
2025-08-09 11:24:55  🎯 開始解析意圖: 幫我安排小明數學課，然後查詢一下他今天有什麼課 (用戶: U_test_user_qa)
2025-08-09 11:24:55  🧠 檢測到期待輸入狀態: [ 'course_name_input', 'schedule_time_input', 'course_date_input' ]
2025-08-09 11:24:55  📋 待補充資料: {
2025-08-09 11:24:55    lastOperation: {
2025-08-09 11:24:55      intent: 'add_course',
2025-08-09 11:24:55      slots: {
2025-08-09 11:24:55        studentName: '小明',
2025-08-09 11:24:55        courseName: '英文課',
2025-08-09 11:24:55        scheduleTime: '08:00',
2025-08-09 11:24:55        dayOfWeek: 1,
2025-08-09 11:24:55        recurring: true,
2025-08-09 11:24:55        recurrenceType: 'weekly'
2025-08-09 11:24:55      },
2025-08-09 11:24:55      result: {
2025-08-09 11:24:55        success: true,
2025-08-09 11:24:55        code: 'ADD_COURSE_OK',
2025-08-09 11:24:55        message: '✅ 課程已安排成功！\n\n👦 學生：小明\n📚 課程：英文課\n🔄 重複：每週一 上午8:00\n📅 下次上課：2025-08-11',
2025-08-09 11:24:55        data: [Object],
2025-08-09 11:24:55        quickReply: [Array]
2025-08-09 11:24:55      }
2025-08-09 11:24:55    },
2025-08-09 11:24:55    timestamp: 1754738686235,
2025-08-09 11:24:55    slots: {
2025-08-09 11:24:55      intent: 'add_course',
2025-08-09 11:24:55      existingSlots: { studentName: '我', recurring: false, content: '課程安排的情況' },
2025-08-09 11:24:55      missingFields: [ '課程名稱', '上課時間', '課程日期' ]
2025-08-09 11:24:55    }
2025-08-09 11:24:55  }
2025-08-09 11:24:55  🔄 嘗試在原意圖中完整解析: add_course
2025-08-09 11:24:55  📋 現有 slots: { studentName: '我', recurring: false, content: '課程安排的情況' }
2025-08-09 11:24:55  🔍 開始提取 slots - 意圖: add_course (用戶: U_test_user_qa)
2025-08-09 11:24:55  🕒 開始高級時間解析: 幫我安排小明數學課，然後查詢一下他今天有什麼課
2025-08-09 11:24:55  ❌ 時間解析失敗: 幫我安排小明數學課，然後查詢一下他今天有什麼課
2025-08-09 11:24:55  📊 規則提取置信度: 0.00
2025-08-09 11:24:55  🔄 規則提取信心度低，AI 輔助增強...
2025-08-09 11:25:00  ✅ 最終 slots: {
2025-08-09 11:25:00    studentName: '小明',
2025-08-09 11:25:00    courseName: '數學課',
2025-08-09 11:25:00    recurring: false,
2025-08-09 11:25:00    timeReference: 'today'
2025-08-09 11:25:00  }
2025-08-09 11:25:00  🔗 合併後的 slots: {
2025-08-09 11:25:00    studentName: '小明',
2025-08-09 11:25:00    recurring: false,
2025-08-09 11:25:00    content: '課程安排的情況',
2025-08-09 11:25:00    courseName: '數學課',
2025-08-09 11:25:00    timeReference: 'today'
2025-08-09 11:25:00  }
2025-08-09 11:25:00  📝 資訊仍不完整，繼續等待補充
2025-08-09 11:25:00  🔄 檢測到明確意圖切換，清除期待狀態: 幫我安排小明數學課，然後查詢一下他今天有什麼課
2025-08-09 11:25:00  ✅ 規則匹配成功: query_schedule
2025-08-09 11:25:00  🎯 識別意圖: query_schedule
2025-08-09 11:25:00  🔍 開始提取 slots - 意圖: query_schedule (用戶: U_test_user_qa)
2025-08-09 11:25:00  ✅ 最終 slots: {
2025-08-09 11:25:00    studentName: '小明',
2025-08-09 11:25:00    courseName: '數學課',
2025-08-09 11:25:00    recurring: false,
2025-08-09 11:25:00    timeReference: 'today'
2025-08-09 11:25:00  }
2025-08-09 11:25:00  🔗 合併後的 slots: {
2025-08-09 11:25:00    studentName: '小明',
2025-08-09 11:25:00    recurring: false,
2025-08-09 11:25:00    content: '課程安排的情況',
2025-08-09 11:25:00    courseName: '數學課',
2025-08-09 11:25:00    timeReference: 'today'
2025-08-09 11:25:00  }
2025-08-09 11:25:00  📝 資訊仍不完整，繼續等待補充
2025-08-09 11:25:00  🔄 檢測到明確意圖切換，清除期待狀態: 幫我安排小明數學課，然後查詢一下他今天有什麼課
2025-08-09 11:25:00  ✅ 規則匹配成功: query_schedule
2025-08-09 11:25:00  🎯 識別意圖: query_schedule
2025-08-09 11:25:00  🔍 開始提取 slots - 意圖: query_schedule (用戶: U_test_user_qa)
2025-08-09 11:25:00  🧠 使用對話上下文增強 slots 提取
2025-08-09 11:25:00  📊 規則提取置信度: 0.50
2025-08-09 11:25:00  🤖 啟用 AI 輔助提取...
2025-08-09 11:25:01  ✅ 最終 slots: { studentName: '小明', timeReference: 'today', courseName: '數學課' }
2025-08-09 11:25:01  📋 提取結果: { studentName: '小明', timeReference: 'today', courseName: '數學課' }
2025-08-09 11:25:01  🎯 執行任務: query_schedule
2025-08-09 11:25:01  🎯 開始處理查詢課表任務
2025-08-09 11:25:01  📋 接收參數: { studentName: '小明', timeReference: 'today', courseName: '數學課' }
2025-08-09 11:25:01  📅 查詢時間範圍: { startDate: '2025-08-09', endDate: '2025-08-09', description: '今天' }
2025-08-09 11:25:02  📚 查詢到 0 筆課程資料
2025-08-09 11:25:02  📚 查詢到 0 筆課程
2025-08-09 11:25:02  📊 任務執行結果: {
2025-08-09 11:25:02    success: true,
2025-08-09 11:25:02    code: 'QUERY_OK_EMPTY',
2025-08-09 11:25:02    message: '📅 小明今天沒有安排課程\n' +
2025-08-09 11:25:02      '\n' +
2025-08-09 11:25:02      '💡 您可以：\n' +
2025-08-09 11:25:02      '• 新增課程：「小明明天上午10點英文課」\n' +
2025-08-09 11:25:02      '• 查詢其他時間：「小明下週的課表」\n' +
2025-08-09 11:25:02      '• 記錄課程內容：「記錄昨天數學課的內容」',
2025-08-09 11:25:02    data: {
2025-08-09 11:25:02      courseCount: 0,
2025-08-09 11:25:02      dateRange: {
2025-08-09 11:25:02        startDate: '2025-08-09',
2025-08-09 11:25:02        endDate: '2025-08-09',
2025-08-09 11:25:02        description: '今天'
2025-08-09 11:25:02      }
2025-08-09 11:25:02    }
2025-08-09 11:25:02  }
2025-08-09 11:25:02  ✅ 任務結果: {
2025-08-09 11:25:02    success: true,
2025-08-09 11:25:02    code: 'QUERY_OK_EMPTY',
2025-08-09 11:25:02    message: '📅 小明今天沒有安排課程\n' +
2025-08-09 11:25:02      '\n' +
2025-08-09 11:25:02      '💡 您可以：\n' +
2025-08-09 11:25:02      '• 新增課程：「小明明天上午10點英文課」\n' +
2025-08-09 11:25:02      '• 查詢其他時間：「小明下週的課表」\n' +
2025-08-09 11:25:02      '• 記錄課程內容：「記錄昨天數學課的內容」',
2025-08-09 11:25:02    data: {
2025-08-09 11:25:02      courseCount: 0,
2025-08-09 11:25:02      dateRange: {
2025-08-09 11:25:02        startDate: '2025-08-09',
2025-08-09 11:25:02        endDate: '2025-08-09',
2025-08-09 11:25:02        description: '今天'
2025-08-09 11:25:02      }
2025-08-09 11:25:02    }
2025-08-09 11:25:02  }
2025-08-09 11:25:02  🔍 檢查 replyToken: test-reply-token-1754738695639
2025-08-09 11:25:02  🧪 檢測到測試 token，跳過真實 LINE API 調用
2025-08-09 11:25:02  📤 [測試模式] 實際業務回覆: 📅 小明今天沒有安排課程
2025-08-09 11:25:02  
2025-08-09 11:25:02  💡 您可以：
2025-08-09 11:25:02  • 新增課程：「小明明天上午10點英文課」
2025-08-09 11:25:02  • 查詢其他時間：「小明下週的課表」
2025-08-09 11:25:02  • 記錄課程內容：「記錄昨天數學課的內容」
2025-08-09 11:25:11  📨 收到 1 個事件
2025-08-09 11:25:11  📋 事件類型: message
2025-08-09 11:25:11  🔍 完整事件 JSON: {
2025-08-09 11:25:11    "type": "message",
2025-08-09 11:25:11    "message": {
2025-08-09 11:25:11      "type": "text",
2025-08-09 11:25:11      "text": "（觸發系統錯誤的占位輸入）"
2025-08-09 11:25:11    },
2025-08-09 11:25:11    "source": {
2025-08-09 11:25:11      "userId": "U_test_user_qa",
2025-08-09 11:25:11      "type": "user"
2025-08-09 11:25:11    },
2025-08-09 11:25:11    "replyToken": "test-reply-token-1754738711255",
2025-08-09 11:25:11    "timestamp": 1754738711255
2025-08-09 11:25:11  }
2025-08-09 11:25:11  📝 收到文字訊息: （觸發系統錯誤的占位輸入）
2025-08-09 11:25:11  👤 用戶ID: U_test_user_qa
2025-08-09 11:25:11  🔍 用戶ID類型: string
2025-08-09 11:25:11  🔍 是否測試用戶: true
2025-08-09 11:25:11  🚀 生產用戶，使用真實 LINE Service
2025-08-09 11:25:11  🔥 選擇的服務類型: Object
2025-08-09 11:25:11  🎯 開始解析意圖: （觸發系統錯誤的占位輸入） (用戶: U_test_user_qa)
2025-08-09 11:25:11  🧠 檢測到期待輸入狀態: [ 'confirmation', 'modification' ]
2025-08-09 11:25:11  📋 待補充資料: {
2025-08-09 11:25:11    lastOperation: {
2025-08-09 11:25:11      intent: 'add_course',
2025-08-09 11:25:11      slots: {
2025-08-09 11:25:11  📨 收到 1 個事件
2025-08-09 11:25:11  📋 事件類型: message
2025-08-09 11:25:11  🔍 完整事件 JSON: {
2025-08-09 11:25:11    "type": "message",
2025-08-09 11:25:11    "message": {
2025-08-09 11:25:11      "type": "text",
2025-08-09 11:25:11      "text": "（觸發系統錯誤的占位輸入）"
2025-08-09 11:25:11    },
2025-08-09 11:25:11    "source": {
2025-08-09 11:25:11      "userId": "U_test_user_qa",
2025-08-09 11:25:11      "type": "user"
2025-08-09 11:25:11    },
2025-08-09 11:25:11    "replyToken": "test-reply-token-1754738711255",
2025-08-09 11:25:11    "timestamp": 1754738711255
2025-08-09 11:25:11  }
2025-08-09 11:25:11  📝 收到文字訊息: （觸發系統錯誤的占位輸入）
2025-08-09 11:25:11  👤 用戶ID: U_test_user_qa
2025-08-09 11:25:11  🔍 用戶ID類型: string
2025-08-09 11:25:11  🔍 是否測試用戶: true
2025-08-09 11:25:11  🚀 生產用戶，使用真實 LINE Service
2025-08-09 11:25:11  🔥 選擇的服務類型: Object
2025-08-09 11:25:11  🎯 開始解析意圖: （觸發系統錯誤的占位輸入） (用戶: U_test_user_qa)
2025-08-09 11:25:11  🧠 檢測到期待輸入狀態: [ 'confirmation', 'modification' ]
2025-08-09 11:25:11  📋 待補充資料: {
2025-08-09 11:25:11    lastOperation: {
2025-08-09 11:25:11      intent: 'add_course',
2025-08-09 11:25:11      slots: {
2025-08-09 11:25:11        studentName: '小明',
2025-08-09 11:25:11        courseName: '英文課',
2025-08-09 11:25:11        scheduleTime: '08:00',
2025-08-09 11:25:11        dayOfWeek: 1,
2025-08-09 11:25:11        recurring: true,
2025-08-09 11:25:11        recurrenceType: 'weekly'
2025-08-09 11:25:11      },
2025-08-09 11:25:11      result: {
2025-08-09 11:25:11        success: true,
2025-08-09 11:25:11        code: 'ADD_COURSE_OK',
2025-08-09 11:25:11        message: '✅ 課程已安排成功！\n\n👦 學生：小明\n📚 課程：英文課\n🔄 重複：每週一 上午8:00\n📅 下次上課：2025-08-11',
2025-08-09 11:25:11        data: [Object],
2025-08-09 11:25:11        quickReply: [Array]
2025-08-09 11:25:11      }
2025-08-09 11:25:11    },
2025-08-09 11:25:11    timestamp: 1754738686235,
2025-08-09 11:25:11    slots: {
2025-08-09 11:25:11      intent: 'add_course',
2025-08-09 11:25:11      existingSlots: { studentName: '我', recurring: false, content: '課程安排的情況' },
2025-08-09 11:25:11      missingFields: [ '課程名稱', '上課時間', '課程日期' ]
2025-08-09 11:25:11    }
2025-08-09 11:25:11  }
2025-08-09 11:25:11  🔄 嘗試在原意圖中完整解析: add_course
2025-08-09 11:25:11  📋 現有 slots: { studentName: '我', recurring: false, content: '課程安排的情況' }
2025-08-09 11:25:11  🔍 開始提取 slots - 意圖: add_course (用戶: U_test_user_qa)
2025-08-09 11:25:11  🕒 開始高級時間解析: （觸發系統錯誤的占位輸入）
2025-08-09 11:25:11  ❌ 時間解析失敗: （觸發系統錯誤的占位輸入）
2025-08-09 11:25:11  📊 規則提取置信度: 0.00
2025-08-09 11:25:11  🔄 規則提取信心度低，AI 輔助增強...
2025-08-09 11:25:13  ✅ 文檔已添加到 error_cases: e6mtWC6cjQkgyh8DHtCo
2025-08-09 11:25:13  📊 低置信度案例已記錄: e6mtWC6cjQkgyh8DHtCo
2025-08-09 11:25:13  ✅ 最終 slots: { recurring: false }
2025-08-09 11:25:13  🔗 合併後的 slots: { studentName: '我', recurring: false, content: '課程安排的情況' }
2025-08-09 11:25:13  📝 資訊仍不完整，繼續等待補充
2025-08-09 11:25:13  ⚠️ 無法識別為期待的補充資訊類型
2025-08-09 11:25:13  📋 對話上下文狀態: {
2025-08-09 11:25:13    currentFlow: null,
2025-08-09 11:25:13    expectingInput: [ 'confirmation', 'modification' ],
2025-08-09 11:25:13    lastActionsCount: 6
2025-08-09 11:25:13  }
2025-08-09 11:25:13  ✅ 上下文感知識別成功: correction_intent
2025-08-09 11:25:13  🎯 識別意圖: correction_intent
2025-08-09 11:25:13  🔍 開始提取 slots - 意圖: correction_intent (用戶: U_test_user_qa)
2025-08-09 11:25:13  ❓ 未知意圖，無法提取 slots: correction_intent
2025-08-09 11:25:13  🧠 使用對話上下文增強 slots 提取
2025-08-09 11:25:13  📊 規則提取置信度: 1.00
2025-08-09 11:25:13  ✅ 最終 slots: {}
2025-08-09 11:25:13  📋 提取結果: {}
2025-08-09 11:25:13  ⚠️ 找不到意圖 "correction_intent" 的任務處理器
2025-08-09 11:25:13  ✅ 任務結果: {
2025-08-09 11:25:13    success: false,
2025-08-09 11:25:13    code: 'NOT_IMPLEMENTED',
2025-08-09 11:25:13    message: '❌ 目前不支援「correction_intent」功能，請稍後再試'
2025-08-09 11:25:13  }
2025-08-09 11:25:13  🔍 檢查 replyToken: test-reply-token-1754738711255
2025-08-09 11:25:13  🧪 檢測到測試 token，跳過真實 LINE API 調用
2025-08-09 11:25:13  📤 [測試模式] 實際業務回覆: ❌ 目前不支援「correction_intent」功能，請稍後再試
2025-08-09 11:25:28  📨 收到 1 個事件
2025-08-09 11:25:28  📋 事件類型: message
2025-08-09 11:25:28  🔍 完整事件 JSON: {
2025-08-09 11:25:28    "type": "message",
2025-08-09 11:25:28    "message": {
2025-08-09 11:25:28      "type": "text",
2025-08-09 11:25:28      "text": "小明明天25點上課"
2025-08-09 11:25:28    },
2025-08-09 11:25:28    "source": {
2025-08-09 11:25:28      "userId": "U_test_user_qa",
2025-08-09 11:25:28      "type": "user"
2025-08-09 11:25:28    },
2025-08-09 11:25:28    "replyToken": "test-reply-token-1754738728607",
2025-08-09 11:25:28    "timestamp": 1754738728607
2025-08-09 11:25:28  }
2025-08-09 11:25:28  📝 收到文字訊息: 小明明天25點上課
2025-08-09 11:25:28  📨 收到 1 個事件
2025-08-09 11:25:28  📋 事件類型: message
2025-08-09 11:25:28  🔍 完整事件 JSON: {
2025-08-09 11:25:28    "type": "message",
2025-08-09 11:25:28    "message": {
2025-08-09 11:25:28      "type": "text",
2025-08-09 11:25:28      "text": "小明明天25點上課"
2025-08-09 11:25:28    },
2025-08-09 11:25:28    "source": {
2025-08-09 11:25:28      "userId": "U_test_user_qa",
2025-08-09 11:25:28      "type": "user"
2025-08-09 11:25:28    },
2025-08-09 11:25:28    "replyToken": "test-reply-token-1754738728607",
2025-08-09 11:25:28    "timestamp": 1754738728607
2025-08-09 11:25:28  }
2025-08-09 11:25:28  📝 收到文字訊息: 小明明天25點上課
2025-08-09 11:25:28  👤 用戶ID: U_test_user_qa
2025-08-09 11:25:28  🔍 用戶ID類型: string
2025-08-09 11:25:28  🔍 是否測試用戶: true
2025-08-09 11:25:28  🚀 生產用戶，使用真實 LINE Service
2025-08-09 11:25:28  🔥 選擇的服務類型: Object
2025-08-09 11:25:28  🎯 開始解析意圖: 小明明天25點上課 (用戶: U_test_user_qa)
2025-08-09 11:25:28  🧠 檢測到期待輸入狀態: [ 'confirmation', 'modification' ]
2025-08-09 11:25:28  📋 待補充資料: {
2025-08-09 11:25:28    lastOperation: {
2025-08-09 11:25:28      intent: 'add_course',
2025-08-09 11:25:28      slots: {
2025-08-09 11:25:28        studentName: '小明',
2025-08-09 11:25:28        courseName: '英文課',
2025-08-09 11:25:28        scheduleTime: '08:00',
2025-08-09 11:25:28        dayOfWeek: 1,
2025-08-09 11:25:28        recurring: true,
2025-08-09 11:25:28        recurrenceType: 'weekly'
2025-08-09 11:25:28      },
2025-08-09 11:25:28      result: {
2025-08-09 11:25:28        success: true,
2025-08-09 11:25:28        code: 'ADD_COURSE_OK',
2025-08-09 11:25:28        message: '✅ 課程已安排成功！\n\n👦 學生：小明\n📚 課程：英文課\n🔄 重複：每週一 上午8:00\n📅 下次上課：2025-08-11',
2025-08-09 11:25:28        data: [Object],
2025-08-09 11:25:28        quickReply: [Array]
2025-08-09 11:25:28      }
2025-08-09 11:25:28    },
2025-08-09 11:25:28    timestamp: 1754738686235,
2025-08-09 11:25:28    slots: {
2025-08-09 11:25:28      intent: 'add_course',
2025-08-09 11:25:28      existingSlots: { studentName: '我', recurring: false, content: '課程安排的情況' },
2025-08-09 11:25:28      missingFields: [ '課程名稱', '上課時間', '課程日期' ]
2025-08-09 11:25:28    }
2025-08-09 11:25:28  }
2025-08-09 11:25:28  🔄 嘗試在原意圖中完整解析: add_course
2025-08-09 11:25:28  📋 現有 slots: { studentName: '我', recurring: false, content: '課程安排的情況' }
2025-08-09 11:25:28  🔍 開始提取 slots - 意圖: add_course (用戶: U_test_user_qa)
2025-08-09 11:25:28  🕒 開始高級時間解析: 小明明天25點上課
2025-08-09 11:25:28  ❌ 時間解析失敗: 小明明天25點上課
2025-08-09 11:25:29  📊 規則提取置信度: 0.50
2025-08-09 11:25:29  🤖 啟用 AI 輔助提取...
2025-08-09 11:25:30  ✅ 最終 slots: {
2025-08-09 11:25:30    studentName: '小明',
2025-08-09 11:25:30    scheduleTime: '25:00',
2025-08-09 11:25:30    recurring: false,
2025-08-09 11:25:30    timeReference: 'tomorrow'
2025-08-09 11:25:30  }
2025-08-09 11:25:30  🔗 合併後的 slots: {
2025-08-09 11:25:30    studentName: '小明',
2025-08-09 11:25:30    recurring: false,
2025-08-09 11:25:30    content: '課程安排的情況',
2025-08-09 11:25:30    scheduleTime: '25:00',
2025-08-09 11:25:30    timeReference: 'tomorrow'
2025-08-09 11:25:30  }
2025-08-09 11:25:30  📝 資訊仍不完整，繼續等待補充
2025-08-09 11:25:30  ⚠️ 無法識別為期待的補充資訊類型
2025-08-09 11:25:30  ✅ 規則匹配成功: add_course
2025-08-09 11:25:30  🎯 識別意圖: add_course
2025-08-09 11:25:30  🔍 開始提取 slots - 意圖: add_course (用戶: U_test_user_qa)
2025-08-09 11:25:30  🕒 開始高級時間解析: 小明明天25點上課
2025-08-09 11:25:30  ❌ 時間解析失敗: 小明明天25點上課
2025-08-09 11:25:30  📊 規則提取置信度: 0.50
2025-08-09 11:25:30  🤖 啟用 AI 輔助提取...
2025-08-09 11:25:31  ✅ 最終 slots: {
2025-08-09 11:25:31    studentName: '小明',
2025-08-09 11:25:31    scheduleTime: '25:00',
2025-08-09 11:25:31    recurring: false,
2025-08-09 11:25:31    timeReference: 'tomorrow'
2025-08-09 11:25:31  }
2025-08-09 11:25:31  📋 提取結果: {
2025-08-09 11:25:31    studentName: '小明',
2025-08-09 11:25:31    scheduleTime: '25:00',
2025-08-09 11:25:31    recurring: false,
2025-08-09 11:25:31    timeReference: 'tomorrow'
2025-08-09 11:25:31  }
2025-08-09 11:25:31  🎯 執行任務: add_course
2025-08-09 11:25:31  🎯 開始處理新增課程任務
2025-08-09 11:25:31  📋 接收參數: {
2025-08-09 11:25:31    studentName: '小明',
2025-08-09 11:25:31    scheduleTime: '25:00',
2025-08-09 11:25:31    recurring: false,
2025-08-09 11:25:31    timeReference: 'tomorrow'
2025-08-09 11:25:31  }
2025-08-09 11:25:31  📊 任務執行結果: {
2025-08-09 11:25:31    success: false,
2025-08-09 11:25:31  ✅ 最終 slots: {
2025-08-09 11:25:31    studentName: '小明',
2025-08-09 11:25:31    scheduleTime: '25:00',
2025-08-09 11:25:31    recurring: false,
2025-08-09 11:25:31    timeReference: 'tomorrow'
2025-08-09 11:25:31  }
2025-08-09 11:25:31  📋 提取結果: {
2025-08-09 11:25:31    studentName: '小明',
2025-08-09 11:25:31    scheduleTime: '25:00',
2025-08-09 11:25:31    recurring: false,
2025-08-09 11:25:31    timeReference: 'tomorrow'
2025-08-09 11:25:31  }
2025-08-09 11:25:31  🎯 執行任務: add_course
2025-08-09 11:25:31  🎯 開始處理新增課程任務
2025-08-09 11:25:31  📋 接收參數: {
2025-08-09 11:25:31    studentName: '小明',
2025-08-09 11:25:31    scheduleTime: '25:00',
2025-08-09 11:25:31    recurring: false,
2025-08-09 11:25:31    timeReference: 'tomorrow'
2025-08-09 11:25:31  }
2025-08-09 11:25:31  📊 任務執行結果: {
2025-08-09 11:25:31    success: false,
2025-08-09 11:25:31    code: 'INVALID_TIME',
2025-08-09 11:25:31    message: '❌ 時間格式不正確，請重新輸入正確的時間（例如：下午2點 或 14:00）',
2025-08-09 11:25:31    expectingInput: true,
2025-08-09 11:25:31    missingFields: [ '上課時間' ]
2025-08-09 11:25:31  }
2025-08-09 11:25:31  ✅ 任務結果: {
2025-08-09 11:25:31    success: false,
2025-08-09 11:25:31    code: 'INVALID_TIME',
2025-08-09 11:25:31    message: '❌ 時間格式不正確，請重新輸入正確的時間（例如：下午2點 或 14:00）',
2025-08-09 11:25:31    expectingInput: true,
2025-08-09 11:25:31    missingFields: [ '上課時間' ]
2025-08-09 11:25:31  }
2025-08-09 11:25:32  🔍 檢查 replyToken: test-reply-token-1754738728607
2025-08-09 11:25:32  🧪 檢測到測試 token，跳過真實 LINE API 調用
2025-08-09 11:25:32  📤 [測試模式] 實際業務回覆: ❌ 時間格式不正確，請重新輸入正確的時間（例如：下午2點 或 14:00）
2025-08-09 11:25:33  📨 收到 1 個事件
2025-08-09 11:25:33  📋 事件類型: message
2025-08-09 11:25:33  🔍 完整事件 JSON: {
2025-08-09 11:25:33    "type": "message",
2025-08-09 11:25:33    "message": {
2025-08-09 11:25:33      "type": "text",
2025-08-09 11:25:33      "text": "下午2點"
2025-08-09 11:25:33    },
2025-08-09 11:25:33    "source": {
2025-08-09 11:25:33      "userId": "U_test_user_qa",
2025-08-09 11:25:33      "type": "user"
2025-08-09 11:25:33    },
2025-08-09 11:25:33    "replyToken": "test-reply-token-1754738733390",
2025-08-09 11:25:33    "timestamp": 1754738733390
2025-08-09 11:25:33  }
2025-08-09 11:25:33  📝 收到文字訊息: 下午2點
2025-08-09 11:25:33  👤 用戶ID: U_test_user_qa
2025-08-09 11:25:33  🔍 用戶ID類型: string
2025-08-09 11:25:33  🔍 是否測試用戶: true
2025-08-09 11:25:33  🚀 生產用戶，使用真實 LINE Service
2025-08-09 11:25:33  🔥 選擇的服務類型: Object
2025-08-09 11:25:33  🎯 開始解析意圖: 下午2點 (用戶: U_test_user_qa)
2025-08-09 11:25:33  🧠 檢測到期待輸入狀態: [ 'schedule_time_input' ]
2025-08-09 11:25:33  📋 待補充資料: {
2025-08-09 11:25:33    lastOperation: {
2025-08-09 11:25:33      intent: 'add_course',
2025-08-09 11:25:33      slots: {
2025-08-09 11:25:33        studentName: '小明',
2025-08-09 11:25:33        courseName: '英文課',
2025-08-09 11:25:33        scheduleTime: '08:00',
2025-08-09 11:25:33        dayOfWeek: 1,
2025-08-09 11:25:33        recurring: true,
2025-08-09 11:25:33        recurrenceType: 'weekly'
2025-08-09 11:25:33      },
2025-08-09 11:25:33      result: {
2025-08-09 11:25:33        success: true,
2025-08-09 11:25:33        code: 'ADD_COURSE_OK',
2025-08-09 11:25:33        message: '✅ 課程已安排成功！\n\n👦 學生：小明\n📚 課程：英文課\n🔄 重複：每週一 上午8:00\n📅 下次上課：2025-08-11',
2025-08-09 11:25:33        data: [Object],
2025-08-09 11:25:33        quickReply: [Array]
2025-08-09 11:25:33      }
2025-08-09 11:25:33    },
2025-08-09 11:25:33    timestamp: 1754738731740,
2025-08-09 11:25:33    slots: {
2025-08-09 11:25:33      intent: 'add_course',
2025-08-09 11:25:33      existingSlots: {
2025-08-09 11:25:33        studentName: '小明',
2025-08-09 11:25:33        scheduleTime: '25:00',
2025-08-09 11:25:33        recurring: false,
2025-08-09 11:25:33        timeReference: 'tomorrow'
2025-08-09 11:25:33      },
2025-08-09 11:25:33      missingFields: [ '上課時間' ]
2025-08-09 11:25:33    }
2025-08-09 11:25:33  }
2025-08-09 11:25:33  🔄 嘗試在原意圖中完整解析: add_course
2025-08-09 11:25:33  📋 現有 slots: {
2025-08-09 11:25:33    studentName: '小明',
2025-08-09 11:25:33    scheduleTime: '25:00',
2025-08-09 11:25:33    recurring: false,
2025-08-09 11:25:33    timeReference: 'tomorrow'
2025-08-09 11:25:33  }
2025-08-09 11:25:33  🔍 開始提取 slots - 意圖: add_course (用戶: U_test_user_qa)
2025-08-09 11:25:33  🕒 開始高級時間解析: 下午2點
2025-08-09 11:25:33  📨 收到 1 個事件
2025-08-09 11:25:33  📋 事件類型: message
2025-08-09 11:25:33  🔍 完整事件 JSON: {
2025-08-09 11:25:33    "type": "message",
2025-08-09 11:25:33    "message": {
2025-08-09 11:25:33      "type": "text",
2025-08-09 11:25:33      "text": "下午2點"
2025-08-09 11:25:33    },
2025-08-09 11:25:33    "source": {
2025-08-09 11:25:33      "userId": "U_test_user_qa",
2025-08-09 11:25:33      "type": "user"
2025-08-09 11:25:33    },
2025-08-09 11:25:33    "replyToken": "test-reply-token-1754738733390",
2025-08-09 11:25:33    "timestamp": 1754738733390
2025-08-09 11:25:33  }
2025-08-09 11:25:33  📝 收到文字訊息: 下午2點
2025-08-09 11:25:33  👤 用戶ID: U_test_user_qa
2025-08-09 11:25:33  🔍 用戶ID類型: string
2025-08-09 11:25:33  🔍 是否測試用戶: true
2025-08-09 11:25:33  🚀 生產用戶，使用真實 LINE Service
2025-08-09 11:25:33  🔥 選擇的服務類型: Object
2025-08-09 11:25:33  🎯 開始解析意圖: 下午2點 (用戶: U_test_user_qa)
2025-08-09 11:25:33  🧠 檢測到期待輸入狀態: [ 'schedule_time_input' ]
2025-08-09 11:25:33  📋 待補充資料: {
2025-08-09 11:25:33    lastOperation: {
2025-08-09 11:25:33      intent: 'add_course',
2025-08-09 11:25:33      slots: {
2025-08-09 11:25:33        studentName: '小明',
2025-08-09 11:25:33        courseName: '英文課',
2025-08-09 11:25:33        scheduleTime: '08:00',
2025-08-09 11:25:33        dayOfWeek: 1,
2025-08-09 11:25:33        recurring: true,
2025-08-09 11:25:33        recurrenceType: 'weekly'
2025-08-09 11:25:33      },
2025-08-09 11:25:33      result: {
2025-08-09 11:25:33        success: true,
2025-08-09 11:25:33        code: 'ADD_COURSE_OK',
2025-08-09 11:25:33        message: '✅ 課程已安排成功！\n\n👦 學生：小明\n📚 課程：英文課\n🔄 重複：每週一 上午8:00\n📅 下次上課：2025-08-11',
2025-08-09 11:25:33        data: [Object],
2025-08-09 11:25:33        quickReply: [Array]
2025-08-09 11:25:33      }
2025-08-09 11:25:33    },
2025-08-09 11:25:33    timestamp: 1754738731740,
2025-08-09 11:25:33    slots: {
2025-08-09 11:25:33      intent: 'add_course',
2025-08-09 11:25:33      existingSlots: {
2025-08-09 11:25:33        studentName: '小明',
2025-08-09 11:25:33        scheduleTime: '25:00',
2025-08-09 11:25:33        recurring: false,
2025-08-09 11:25:33        timeReference: 'tomorrow'
2025-08-09 11:25:33      },
2025-08-09 11:25:33      missingFields: [ '上課時間' ]
2025-08-09 11:25:33    }
2025-08-09 11:25:33  }
2025-08-09 11:25:33  🔄 嘗試在原意圖中完整解析: add_course
2025-08-09 11:25:33  📋 現有 slots: {
2025-08-09 11:25:33    studentName: '小明',
2025-08-09 11:25:33    scheduleTime: '25:00',
2025-08-09 11:25:33    recurring: false,
2025-08-09 11:25:33    timeReference: 'tomorrow'
2025-08-09 11:25:33  }
2025-08-09 11:25:33  🔍 開始提取 slots - 意圖: add_course (用戶: U_test_user_qa)
2025-08-09 11:25:33  🕒 開始高級時間解析: 下午2點
2025-08-09 11:25:33  ✅ 時間解析成功: {
2025-08-09 11:25:33    input: '下午2點',
2025-08-09 11:25:33    output: '14:00',
2025-08-09 11:25:33    details: { hour: 14, minute: 0, matchType: 'arabic_period', periodInfo: '下午' }
2025-08-09 11:25:33  }
2025-08-09 11:25:33  📊 規則提取置信度: 0.00
2025-08-09 11:25:33  🔄 規則提取信心度低，AI 輔助增強...
2025-08-09 11:25:34  ✅ 文檔已添加到 error_cases: M9CM6BzBCpihYFnMYMaS
2025-08-09 11:25:34  📊 低置信度案例已記錄: M9CM6BzBCpihYFnMYMaS
2025-08-09 11:25:34  ✅ 最終 slots: { scheduleTime: '14:00', recurring: false }
2025-08-09 11:25:34  🔗 合併後的 slots: {
2025-08-09 11:25:34    studentName: '小明',
2025-08-09 11:25:34    scheduleTime: '14:00',
2025-08-09 11:25:34    recurring: false,
2025-08-09 11:25:34    timeReference: 'tomorrow'
2025-08-09 11:25:34  }
2025-08-09 11:25:34  📝 資訊仍不完整，繼續等待補充
2025-08-09 11:25:34  ✅ 識別為上課時間補充: 下午2點
2025-08-09 11:25:34  ✅ 補充資訊識別成功: supplement_schedule_time
2025-08-09 11:25:34  🎯 識別意圖: supplement_schedule_time
2025-08-09 11:25:34  🔍 開始提取 slots - 意圖: supplement_schedule_time (用戶: U_test_user_qa)
2025-08-09 11:25:34  ❓ 未知意圖，無法提取 slots: supplement_schedule_time
2025-08-09 11:25:35  🧠 使用對話上下文增強 slots 提取
2025-08-09 11:25:35  📊 規則提取置信度: 1.00
2025-08-09 11:25:35  ✅ 最終 slots: {}
2025-08-09 11:25:35  📋 提取結果: {}
2025-08-09 11:25:35  🎯 執行任務: supplement_schedule_time
2025-08-09 11:25:35  🔧 處理 scheduleTime 補充: 下午2點
2025-08-09 11:25:35  📋 原始意圖: add_course
2025-08-09 11:25:35  📋 現有 slots: {
2025-08-09 11:25:35    studentName: '小明',
2025-08-09 11:25:35    scheduleTime: '25:00',
2025-08-09 11:25:35    recurring: false,
2025-08-09 11:25:35    timeReference: 'tomorrow'
2025-08-09 11:25:35  }
2025-08-09 11:25:35  🕒 開始高級時間解析: 下午2點
2025-08-09 11:25:35  ✅ 時間解析成功: {
2025-08-09 11:25:35  🧠 使用對話上下文增強 slots 提取
2025-08-09 11:25:35  📊 規則提取置信度: 1.00
2025-08-09 11:25:35  ✅ 最終 slots: {}
2025-08-09 11:25:35  📋 提取結果: {}
2025-08-09 11:25:35  🎯 執行任務: supplement_schedule_time
2025-08-09 11:25:35  🔧 處理 scheduleTime 補充: 下午2點
2025-08-09 11:25:35  📋 原始意圖: add_course
2025-08-09 11:25:35  📋 現有 slots: {
2025-08-09 11:25:35    studentName: '小明',
2025-08-09 11:25:35    scheduleTime: '25:00',
2025-08-09 11:25:35    recurring: false,
2025-08-09 11:25:35    timeReference: 'tomorrow'
2025-08-09 11:25:35  }
2025-08-09 11:25:35  🕒 開始高級時間解析: 下午2點
2025-08-09 11:25:35  ✅ 時間解析成功: {
2025-08-09 11:25:35    input: '下午2點',
2025-08-09 11:25:35    output: '14:00',
2025-08-09 11:25:35    details: { hour: 14, minute: 0, matchType: 'arabic_period', periodInfo: '下午' }
2025-08-09 11:25:35  }
2025-08-09 11:25:35  ✅ 更新後的 slots: {
2025-08-09 11:25:35    studentName: '小明',
2025-08-09 11:25:35    scheduleTime: '14:00',
2025-08-09 11:25:35    recurring: false,
2025-08-09 11:25:35    timeReference: 'tomorrow'
2025-08-09 11:25:35  }
2025-08-09 11:25:35  🔄 重新執行 add_course 任務
2025-08-09 11:25:35  🎯 開始處理新增課程任務
2025-08-09 11:25:35  📋 接收參數: {
2025-08-09 11:25:35    studentName: '小明',
2025-08-09 11:25:35    scheduleTime: '14:00',
2025-08-09 11:25:35    recurring: false,
2025-08-09 11:25:35    timeReference: 'tomorrow'
2025-08-09 11:25:35  }
2025-08-09 11:25:35  📊 任務執行結果: {
2025-08-09 11:25:35    success: false,
2025-08-09 11:25:35    message: '❓ 請提供以下資訊：課程名稱\n\n範例：「小明每週三下午3點數學課」',
2025-08-09 11:25:35    expectingInput: true
2025-08-09 11:25:35  }
2025-08-09 11:25:35  ✅ 任務結果: {
2025-08-09 11:25:35    success: false,
2025-08-09 11:25:35    message: '❓ 請提供以下資訊：課程名稱\n\n範例：「小明每週三下午3點數學課」',
2025-08-09 11:25:35    expectingInput: true
2025-08-09 11:25:35  }
2025-08-09 11:25:35  🔍 檢查 replyToken: test-reply-token-1754738733390
2025-08-09 11:25:35  🧪 檢測到測試 token，跳過真實 LINE API 調用
2025-08-09 11:25:35  📤 [測試模式] 實際業務回覆: ❓ 請提供以下資訊：課程名稱
2025-08-09 11:25:35  
2025-08-09 11:25:35  範例：「小明每週三下午3點數學課」
2025-08-09 11:26:41  📨 收到 1 個事件
2025-08-09 11:26:41  📋 事件類型: message
2025-08-09 11:26:41  🔍 完整事件 JSON: {
2025-08-09 11:26:41    "type": "message",
2025-08-09 11:26:41    "message": {
2025-08-09 11:26:41      "type": "text",
2025-08-09 11:26:41      "text": "小明明天下午2點要上數學課"
2025-08-09 11:26:41    },
2025-08-09 11:26:41    "source": {
2025-08-09 11:26:41      "userId": "U_test_user_qa",
2025-08-09 11:26:41      "type": "user"
2025-08-09 11:26:41    },
2025-08-09 11:26:41    "replyToken": "test-reply-token-1754738801195",
2025-08-09 11:26:41    "timestamp": 1754738801195
2025-08-09 11:26:41  }
2025-08-09 11:26:41  📝 收到文字訊息: 小明明天下午2點要上數學課
2025-08-09 11:26:41  👤 用戶ID: U_test_user_qa
2025-08-09 11:26:41  🔍 用戶ID類型: string
2025-08-09 11:26:41  🔍 是否測試用戶: true
2025-08-09 11:26:41  🚀 生產用戶，使用真實 LINE Service
2025-08-09 11:26:41  🔥 選擇的服務類型: Object
2025-08-09 11:26:41  🎯 開始解析意圖: 小明明天下午2點要上數學課 (用戶: U_test_user_qa)
2025-08-09 11:26:41  🧠 檢測到期待輸入狀態: [ 'course_name_input' ]
2025-08-09 11:26:41  📋 待補充資料: {
2025-08-09 11:26:41    lastOperation: {
2025-08-09 11:26:41      intent: 'add_course',
2025-08-09 11:26:41      slots: {
2025-08-09 11:26:41        studentName: '小明',
2025-08-09 11:26:41        courseName: '英文課',
2025-08-09 11:26:41        scheduleTime: '08:00',
2025-08-09 11:26:41        dayOfWeek: 1,
2025-08-09 11:26:41        recurring: true,
2025-08-09 11:26:41        recurrenceType: 'weekly'
2025-08-09 11:26:41      },
2025-08-09 11:26:41      result: {
2025-08-09 11:26:41        success: true,
2025-08-09 11:26:41        code: 'ADD_COURSE_OK',
2025-08-09 11:26:41        message: '✅ 課程已安排成功！\n\n👦 學生：小明\n📚 課程：英文課\n🔄 重複：每週一 上午8:00\n📅 下次上課：2025-08-11',
2025-08-09 11:26:41        data: [Object],
2025-08-09 11:26:41        quickReply: [Array]
2025-08-09 11:26:41      }
2025-08-09 11:26:41    },
2025-08-09 11:26:41    timestamp: 1754738735369,
2025-08-09 11:26:41    slots: {
2025-08-09 11:26:41      intent: 'add_course',
2025-08-09 11:26:41      existingSlots: {
2025-08-09 11:26:41        studentName: '小明',
2025-08-09 11:26:41        scheduleTime: '14:00',
2025-08-09 11:26:41        recurring: false,
2025-08-09 11:26:41        timeReference: 'tomorrow'
2025-08-09 11:26:41      },
2025-08-09 11:26:41      missingFields: [ '課程名稱' ]
2025-08-09 11:26:41  📨 收到 1 個事件
2025-08-09 11:26:41  📋 事件類型: message
2025-08-09 11:26:41  🔍 完整事件 JSON: {
2025-08-09 11:26:41    "type": "message",
2025-08-09 11:26:41    "message": {
2025-08-09 11:26:41      "type": "text",
2025-08-09 11:26:41      "text": "小明明天下午2點要上數學課"
2025-08-09 11:26:41    },
2025-08-09 11:26:41    "source": {
2025-08-09 11:26:41      "userId": "U_test_user_qa",
2025-08-09 11:26:41      "type": "user"
2025-08-09 11:26:41    },
2025-08-09 11:26:41    "replyToken": "test-reply-token-1754738801195",
2025-08-09 11:26:41    "timestamp": 1754738801195
2025-08-09 11:26:41  }
2025-08-09 11:26:41  📝 收到文字訊息: 小明明天下午2點要上數學課
2025-08-09 11:26:41  👤 用戶ID: U_test_user_qa
2025-08-09 11:26:41  🔍 用戶ID類型: string
2025-08-09 11:26:41  🔍 是否測試用戶: true
2025-08-09 11:26:41  🚀 生產用戶，使用真實 LINE Service
2025-08-09 11:26:41  🔥 選擇的服務類型: Object
2025-08-09 11:26:41  🎯 開始解析意圖: 小明明天下午2點要上數學課 (用戶: U_test_user_qa)
2025-08-09 11:26:41  🧠 檢測到期待輸入狀態: [ 'course_name_input' ]
2025-08-09 11:26:41  📋 待補充資料: {
2025-08-09 11:26:41    lastOperation: {
2025-08-09 11:26:41      intent: 'add_course',
2025-08-09 11:26:41      slots: {
2025-08-09 11:26:41        studentName: '小明',
2025-08-09 11:26:41        courseName: '英文課',
2025-08-09 11:26:41        scheduleTime: '08:00',
2025-08-09 11:26:41        dayOfWeek: 1,
2025-08-09 11:26:41        recurring: true,
2025-08-09 11:26:41        recurrenceType: 'weekly'
2025-08-09 11:26:41      },
2025-08-09 11:26:41      result: {
2025-08-09 11:26:41        success: true,
2025-08-09 11:26:41        code: 'ADD_COURSE_OK',
2025-08-09 11:26:41        message: '✅ 課程已安排成功！\n\n👦 學生：小明\n📚 課程：英文課\n🔄 重複：每週一 上午8:00\n📅 下次上課：2025-08-11',
2025-08-09 11:26:41        data: [Object],
2025-08-09 11:26:41        quickReply: [Array]
2025-08-09 11:26:41      }
2025-08-09 11:26:41    },
2025-08-09 11:26:41    timestamp: 1754738735369,
2025-08-09 11:26:41    slots: {
2025-08-09 11:26:41      intent: 'add_course',
2025-08-09 11:26:41      existingSlots: {
2025-08-09 11:26:41        studentName: '小明',
2025-08-09 11:26:41        scheduleTime: '14:00',
2025-08-09 11:26:41        recurring: false,
2025-08-09 11:26:41        timeReference: 'tomorrow'
2025-08-09 11:26:41      },
2025-08-09 11:26:41      missingFields: [ '課程名稱' ]
2025-08-09 11:26:41    }
2025-08-09 11:26:41  }
2025-08-09 11:26:41  🔄 嘗試在原意圖中完整解析: add_course
2025-08-09 11:26:41  📋 現有 slots: {
2025-08-09 11:26:41    studentName: '小明',
2025-08-09 11:26:41    scheduleTime: '14:00',
2025-08-09 11:26:41    recurring: false,
2025-08-09 11:26:41    timeReference: 'tomorrow'
2025-08-09 11:26:41  }
2025-08-09 11:26:41  🔍 開始提取 slots - 意圖: add_course (用戶: U_test_user_qa)
2025-08-09 11:26:41  🕒 開始高級時間解析: 小明明天下午2點要上數學課
2025-08-09 11:26:41  ✅ 時間解析成功: {
2025-08-09 11:26:41    input: '小明明天下午2點要上數學課',
2025-08-09 11:26:41    output: '14:00',
2025-08-09 11:26:41    details: { hour: 14, minute: 0, matchType: 'arabic_period', periodInfo: '下午' }
2025-08-09 11:26:41  }
2025-08-09 11:26:41  🧠 使用對話上下文增強 slots 提取
2025-08-09 11:26:41  📊 規則提取置信度: 1.00
2025-08-09 11:26:41  🤖 啟用 AI 輔助提取...
2025-08-09 11:26:43  ✅ 最終 slots: {
2025-08-09 11:26:43    studentName: '小明',
2025-08-09 11:26:43    courseName: '數學課',
2025-08-09 11:26:43    scheduleTime: '14:00',
2025-08-09 11:26:43    recurring: false,
2025-08-09 11:26:43    timeReference: 'tomorrow'
2025-08-09 11:26:43  }
2025-08-09 11:26:43  🔗 合併後的 slots: {
2025-08-09 11:26:43    studentName: '小明',
2025-08-09 11:26:43    scheduleTime: '14:00',
2025-08-09 11:26:43    recurring: false,
2025-08-09 11:26:43    timeReference: 'tomorrow',
2025-08-09 11:26:43    courseName: '數學課'
2025-08-09 11:26:43  }
2025-08-09 11:26:43  ✅ 資訊完整，可執行原意圖
2025-08-09 11:26:43  ✅ 上下文完整解析成功: add_course
2025-08-09 11:26:43  🎯 識別意圖: add_course
2025-08-09 11:26:43  🔍 開始提取 slots - 意圖: add_course (用戶: U_test_user_qa)
2025-08-09 11:26:43  🕒 開始高級時間解析: 小明明天下午2點要上數學課
2025-08-09 11:26:43  ✅ 時間解析成功: {
2025-08-09 11:26:43    input: '小明明天下午2點要上數學課',
2025-08-09 11:26:43    output: '14:00',
2025-08-09 11:26:43    details: { hour: 14, minute: 0, matchType: 'arabic_period', periodInfo: '下午' }
2025-08-09 11:26:43  }
2025-08-09 11:26:43  🧠 使用對話上下文增強 slots 提取
2025-08-09 11:26:43  📊 規則提取置信度: 1.00
2025-08-09 11:26:43  🤖 啟用 AI 輔助提取...
2025-08-09 11:26:44  ✅ 最終 slots: {
2025-08-09 11:26:44    studentName: '小明',
2025-08-09 11:26:44  ✅ 最終 slots: {
2025-08-09 11:26:44    studentName: '小明',
2025-08-09 11:26:44    courseName: '數學課',
2025-08-09 11:26:44    scheduleTime: '14:00',
2025-08-09 11:26:44    recurring: false,
2025-08-09 11:26:44    timeReference: 'tomorrow'
2025-08-09 11:26:44  }
2025-08-09 11:26:44  📋 提取結果: {
2025-08-09 11:26:44    studentName: '小明',
2025-08-09 11:26:44    courseName: '數學課',
2025-08-09 11:26:44    scheduleTime: '14:00',
2025-08-09 11:26:44    recurring: false,
2025-08-09 11:26:44    timeReference: 'tomorrow'
2025-08-09 11:26:44  }
2025-08-09 11:26:44  🎯 執行任務: add_course
2025-08-09 11:26:44  🎯 開始處理新增課程任務
2025-08-09 11:26:44  📋 接收參數: {
2025-08-09 11:26:44    studentName: '小明',
2025-08-09 11:26:44    courseName: '數學課',
2025-08-09 11:26:44    scheduleTime: '14:00',
2025-08-09 11:26:44    recurring: false,
2025-08-09 11:26:44    timeReference: 'tomorrow'
2025-08-09 11:26:44  }
2025-08-09 11:26:44  👤 學生日曆: b9bf786ee6f0002a0cbe843b8e27184082718a0ab1875873280de3be93e4a481@group.calendar.google.com
2025-08-09 11:26:44  ✅ 已創建課程事件: mock-event-1754738804878
2025-08-09 11:26:44  📅 Google Calendar 事件已創建: mock-event-1754738804878
2025-08-09 11:26:45  ✅ 課程資料已儲存: lZCQ5Dh9C0osxlDnzZzv
2025-08-09 11:26:45  💾 Firebase 課程資料已儲存: lZCQ5Dh9C0osxlDnzZzv
2025-08-09 11:26:45  📊 任務執行結果: {
2025-08-09 11:26:45    success: true,
2025-08-09 11:26:45    code: 'ADD_COURSE_OK',
2025-08-09 11:26:45    message: '✅ 課程已安排成功！\n\n👦 學生：小明\n📚 課程：數學課\n📅 日期：2025-08-10\n🕐 時間：下午2:00',
2025-08-09 11:26:45    data: {
2025-08-09 11:26:45      courseId: 'lZCQ5Dh9C0osxlDnzZzv',
2025-08-09 11:26:45      eventId: 'mock-event-1754738804878'
2025-08-09 11:26:45    },
2025-08-09 11:26:45    quickReply: [
2025-08-09 11:26:45      { label: '✅ 確認', text: '確認' },
2025-08-09 11:26:45      { label: '✏️ 修改', text: '修改' },
2025-08-09 11:26:45      { label: '❌ 取消操作', text: '取消操作' }
2025-08-09 11:26:45    ]
2025-08-09 11:26:45  }
2025-08-09 11:26:45  ✅ 任務結果: {
2025-08-09 11:26:45    success: true,
2025-08-09 11:26:45    code: 'ADD_COURSE_OK',
2025-08-09 11:26:45    message: '✅ 課程已安排成功！\n\n👦 學生：小明\n📚 課程：數學課\n📅 日期：2025-08-10\n🕐 時間：下午2:00',
2025-08-09 11:26:45    data: {
2025-08-09 11:26:45      courseId: 'lZCQ5Dh9C0osxlDnzZzv',
2025-08-09 11:26:45      eventId: 'mock-event-1754738804878'
2025-08-09 11:26:45    },
2025-08-09 11:26:45    quickReply: [
2025-08-09 11:26:45      { label: '✅ 確認', text: '確認' },
2025-08-09 11:26:45      { label: '✏️ 修改', text: '修改' },
2025-08-09 11:26:45      { label: '❌ 取消操作', text: '取消操作' }
2025-08-09 11:26:45    ]
2025-08-09 11:26:45  }
2025-08-09 11:26:45  🔍 檢查 replyToken: test-reply-token-1754738801195
2025-08-09 11:26:45  🧪 檢測到測試 token，跳過真實 LINE API 調用
2025-08-09 11:26:45  📤 [測試模式] 實際業務回覆: ✅ 課程已安排成功！
2025-08-09 11:26:45  
2025-08-09 11:26:45  👦 學生：小明
2025-08-09 11:26:45  📚 課程：數學課
2025-08-09 11:26:45  📅 日期：2025-08-10
2025-08-09 11:26:45  🕐 時間：下午2:00
2025-08-09 11:26:54  📨 收到 1 個事件
2025-08-09 11:26:54  📋 事件類型: message
2025-08-09 11:26:54  🔍 完整事件 JSON: {
2025-08-09 11:26:54    "type": "message",
2025-08-09 11:26:54    "message": {
2025-08-09 11:26:54      "type": "text",
2025-08-09 11:26:54      "text": "Lumi後天晚上八點半要上鋼琴課"
2025-08-09 11:26:54    },
2025-08-09 11:26:54    "source": {
2025-08-09 11:26:54      "userId": "U_test_user_qa",
2025-08-09 11:26:54      "type": "user"
2025-08-09 11:26:54    },
2025-08-09 11:26:54    "replyToken": "test-reply-token-1754738814442",
2025-08-09 11:26:54    "timestamp": 1754738814442
2025-08-09 11:26:54  }
2025-08-09 11:26:54  📝 收到文字訊息: Lumi後天晚上八點半要上鋼琴課
2025-08-09 11:26:54  👤 用戶ID: U_test_user_qa
2025-08-09 11:26:54  🔍 用戶ID類型: string
2025-08-09 11:26:54  🔍 是否測試用戶: true
2025-08-09 11:26:54  🚀 生產用戶，使用真實 LINE Service
2025-08-09 11:26:54  🔥 選擇的服務類型: Object
2025-08-09 11:26:54  🎯 開始解析意圖: Lumi後天晚上八點半要上鋼琴課 (用戶: U_test_user_qa)
2025-08-09 11:26:54  🧠 檢測到期待輸入狀態: [ 'confirmation', 'modification' ]
2025-08-09 11:26:54  📋 待補充資料: {
2025-08-09 11:26:54    lastOperation: {
2025-08-09 11:26:54      intent: 'add_course',
2025-08-09 11:26:54      slots: {
2025-08-09 11:26:54        studentName: '小明',
2025-08-09 11:26:54        courseName: '數學課',
2025-08-09 11:26:54        scheduleTime: '14:00',
2025-08-09 11:26:54        recurring: false,
2025-08-09 11:26:54        timeReference: 'tomorrow'
2025-08-09 11:26:54      },
2025-08-09 11:26:54      result: {
2025-08-09 11:26:54        success: true,
2025-08-09 11:26:54        code: 'ADD_COURSE_OK',
2025-08-09 11:26:54  📨 收到 1 個事件
2025-08-09 11:26:54  📋 事件類型: message
2025-08-09 11:26:54  🔍 完整事件 JSON: {
2025-08-09 11:26:54    "type": "message",
2025-08-09 11:26:54    "message": {
2025-08-09 11:26:54      "type": "text",
2025-08-09 11:26:54      "text": "Lumi後天晚上八點半要上鋼琴課"
2025-08-09 11:26:54    },
2025-08-09 11:26:54    "source": {
2025-08-09 11:26:54      "userId": "U_test_user_qa",
2025-08-09 11:26:54      "type": "user"
2025-08-09 11:26:54    },
2025-08-09 11:26:54    "replyToken": "test-reply-token-1754738814442",
2025-08-09 11:26:54    "timestamp": 1754738814442
2025-08-09 11:26:54  }
2025-08-09 11:26:54  📝 收到文字訊息: Lumi後天晚上八點半要上鋼琴課
2025-08-09 11:26:54  👤 用戶ID: U_test_user_qa
2025-08-09 11:26:54  🔍 用戶ID類型: string
2025-08-09 11:26:54  🔍 是否測試用戶: true
2025-08-09 11:26:54  🚀 生產用戶，使用真實 LINE Service
2025-08-09 11:26:54  🔥 選擇的服務類型: Object
2025-08-09 11:26:54  🎯 開始解析意圖: Lumi後天晚上八點半要上鋼琴課 (用戶: U_test_user_qa)
2025-08-09 11:26:54  🧠 檢測到期待輸入狀態: [ 'confirmation', 'modification' ]
2025-08-09 11:26:54  📋 待補充資料: {
2025-08-09 11:26:54    lastOperation: {
2025-08-09 11:26:54      intent: 'add_course',
2025-08-09 11:26:54      slots: {
2025-08-09 11:26:54        studentName: '小明',
2025-08-09 11:26:54        courseName: '數學課',
2025-08-09 11:26:54        scheduleTime: '14:00',
2025-08-09 11:26:54        recurring: false,
2025-08-09 11:26:54        timeReference: 'tomorrow'
2025-08-09 11:26:54      },
2025-08-09 11:26:54      result: {
2025-08-09 11:26:54        success: true,
2025-08-09 11:26:54        code: 'ADD_COURSE_OK',
2025-08-09 11:26:54        message: '✅ 課程已安排成功！\n\n👦 學生：小明\n📚 課程：數學課\n📅 日期：2025-08-10\n🕐 時間：下午2:00',
2025-08-09 11:26:54        data: [Object],
2025-08-09 11:26:54        quickReply: [Array]
2025-08-09 11:26:54      }
2025-08-09 11:26:54    },
2025-08-09 11:26:54    timestamp: 1754738805134
2025-08-09 11:26:54  }
2025-08-09 11:26:54  ⚠️ 無待處理的意圖資料
2025-08-09 11:26:54  ⚠️ 無待處理的意圖資料
2025-08-09 11:26:54  ✅ 規則匹配成功: add_course
2025-08-09 11:26:54  🎯 識別意圖: add_course
2025-08-09 11:26:54  🔍 開始提取 slots - 意圖: add_course (用戶: U_test_user_qa)
2025-08-09 11:26:54  🕒 開始高級時間解析: Lumi後天晚上八點半要上鋼琴課
2025-08-09 11:26:54  ✅ 時間解析成功: {
2025-08-09 11:26:54    input: 'Lumi後天晚上八點半要上鋼琴課',
2025-08-09 11:26:54    output: '20:30',
2025-08-09 11:26:54    details: {
2025-08-09 11:26:54      hour: 20,
2025-08-09 11:26:54      minute: 30,
2025-08-09 11:26:54      matchType: 'chinese_period',
2025-08-09 11:26:54      periodInfo: '晚上'
2025-08-09 11:26:54    }
2025-08-09 11:26:54  }
2025-08-09 11:26:55  📊 規則提取置信度: 0.30
2025-08-09 11:26:55  🔄 規則提取信心度低，AI 輔助增強...
2025-08-09 11:26:56  🔧 自動修正提取結果: [ '課程名稱包含動作詞: 半要上鋼琴課' ]
2025-08-09 11:26:56  ✅ 最終 slots: {
2025-08-09 11:26:56    studentName: 'Lumi',
2025-08-09 11:26:56    courseName: '鋼琴課',
2025-08-09 11:26:56    scheduleTime: '20:30',
2025-08-09 11:26:56    recurring: false,
2025-08-09 11:26:56    timeReference: 'day_after_tomorrow'
2025-08-09 11:26:56  }
2025-08-09 11:26:56  📋 提取結果: {
2025-08-09 11:26:56    studentName: 'Lumi',
2025-08-09 11:26:56    courseName: '鋼琴課',
2025-08-09 11:26:56    scheduleTime: '20:30',
2025-08-09 11:26:56    recurring: false,
2025-08-09 11:26:56    timeReference: 'day_after_tomorrow'
2025-08-09 11:26:56  }
2025-08-09 11:26:56  🎯 執行任務: add_course
2025-08-09 11:26:56  🎯 開始處理新增課程任務
2025-08-09 11:26:56  📋 接收參數: {
2025-08-09 11:26:56    studentName: 'Lumi',
2025-08-09 11:26:56    courseName: '鋼琴課',
2025-08-09 11:26:56    scheduleTime: '20:30',
2025-08-09 11:26:56    recurring: false,
2025-08-09 11:26:56    timeReference: 'day_after_tomorrow'
2025-08-09 11:26:56  }
2025-08-09 11:26:56  👤 學生日曆: 4a0f9e74ce6d657504bec55784c18348676fc1f35aa59f71a6cd2b9b5b2f2f4b@group.calendar.google.com
2025-08-09 11:26:56  ✅ 已創建課程事件: mock-event-1754738816762
2025-08-09 11:26:56  📅 Google Calendar 事件已創建: mock-event-1754738816762
2025-08-09 11:26:56  ✅ 課程資料已儲存: 9AYZ49ja1xCsFTkenu7j
2025-08-09 11:26:56  💾 Firebase 課程資料已儲存: 9AYZ49ja1xCsFTkenu7j
2025-08-09 11:26:57  📊 任務執行結果: {
2025-08-09 11:26:57    success: true,
2025-08-09 11:26:57    code: 'ADD_COURSE_OK',
2025-08-09 11:26:57    message: '✅ 課程已安排成功！\n\n👦 學生：Lumi\n📚 課程：鋼琴課\n📅 日期：2025-08-11\n🕐 時間：下午8:30',
2025-08-09 11:26:57    data: {
2025-08-09 11:26:57      courseId: '9AYZ49ja1xCsFTkenu7j',
2025-08-09 11:26:57      eventId: 'mock-event-1754738816762'
2025-08-09 11:26:57    },
2025-08-09 11:26:57    quickReply: [
2025-08-09 11:26:57      { label: '✅ 確認', text: '確認' },
2025-08-09 11:26:57  📊 任務執行結果: {
2025-08-09 11:26:57    success: true,
2025-08-09 11:26:57    code: 'ADD_COURSE_OK',
2025-08-09 11:26:57    message: '✅ 課程已安排成功！\n\n👦 學生：Lumi\n📚 課程：鋼琴課\n📅 日期：2025-08-11\n🕐 時間：下午8:30',
2025-08-09 11:26:57    data: {
2025-08-09 11:26:57      courseId: '9AYZ49ja1xCsFTkenu7j',
2025-08-09 11:26:57      eventId: 'mock-event-1754738816762'
2025-08-09 11:26:57    },
2025-08-09 11:26:57    quickReply: [
2025-08-09 11:26:57      { label: '✅ 確認', text: '確認' },
2025-08-09 11:26:57      { label: '✏️ 修改', text: '修改' },
2025-08-09 11:26:57      { label: '❌ 取消操作', text: '取消操作' }
2025-08-09 11:26:57    ]
2025-08-09 11:26:57  }
2025-08-09 11:26:57  ✅ 任務結果: {
2025-08-09 11:26:57    success: true,
2025-08-09 11:26:57    code: 'ADD_COURSE_OK',
2025-08-09 11:26:57    message: '✅ 課程已安排成功！\n\n👦 學生：Lumi\n📚 課程：鋼琴課\n📅 日期：2025-08-11\n🕐 時間：下午8:30',
2025-08-09 11:26:57    data: {
2025-08-09 11:26:57      courseId: '9AYZ49ja1xCsFTkenu7j',
2025-08-09 11:26:57      eventId: 'mock-event-1754738816762'
2025-08-09 11:26:57    },
2025-08-09 11:26:57    quickReply: [
2025-08-09 11:26:57      { label: '✅ 確認', text: '確認' },
2025-08-09 11:26:57      { label: '✏️ 修改', text: '修改' },
2025-08-09 11:26:57      { label: '❌ 取消操作', text: '取消操作' }
2025-08-09 11:26:57    ]
2025-08-09 11:26:57  }
2025-08-09 11:26:57  🔍 檢查 replyToken: test-reply-token-1754738814442
2025-08-09 11:26:57  🧪 檢測到測試 token，跳過真實 LINE API 調用
2025-08-09 11:26:57  📤 [測試模式] 實際業務回覆: ✅ 課程已安排成功！
2025-08-09 11:26:57  
2025-08-09 11:26:57  👦 學生：Lumi
2025-08-09 11:26:57  📚 課程：鋼琴課
2025-08-09 11:26:57  📅 日期：2025-08-11
2025-08-09 11:26:57  🕐 時間：下午8:30
2025-08-09 11:27:06  📨 收到 1 個事件
2025-08-09 11:27:06  📋 事件類型: message
2025-08-09 11:27:06  🔍 完整事件 JSON: {
2025-08-09 11:27:06    "type": "message",
2025-08-09 11:27:06    "message": {
2025-08-09 11:27:06      "type": "text",
2025-08-09 11:27:06      "text": "小光明天上午十點三十分英文課"
2025-08-09 11:27:06    },
2025-08-09 11:27:06    "source": {
2025-08-09 11:27:06      "userId": "U_test_user_qa",
2025-08-09 11:27:06      "type": "user"
2025-08-09 11:27:06    },
2025-08-09 11:27:06    "replyToken": "test-reply-token-1754738826303",
2025-08-09 11:27:06    "timestamp": 1754738826303
2025-08-09 11:27:06  }
2025-08-09 11:27:06  📝 收到文字訊息: 小光明天上午十點三十分英文課
2025-08-09 11:27:06  👤 用戶ID: U_test_user_qa
2025-08-09 11:27:06  🔍 用戶ID類型: string
2025-08-09 11:27:06  🔍 是否測試用戶: true
2025-08-09 11:27:06  🚀 生產用戶，使用真實 LINE Service
2025-08-09 11:27:06  🔥 選擇的服務類型: Object
2025-08-09 11:27:06  🎯 開始解析意圖: 小光明天上午十點三十分英文課 (用戶: U_test_user_qa)
2025-08-09 11:27:06  🧠 檢測到期待輸入狀態: [ 'confirmation', 'modification' ]
2025-08-09 11:27:06  📋 待補充資料: {
2025-08-09 11:27:06    lastOperation: {
2025-08-09 11:27:06      intent: 'add_course',
2025-08-09 11:27:06      slots: {
2025-08-09 11:27:06        studentName: 'Lumi',
2025-08-09 11:27:06        courseName: '鋼琴課',
2025-08-09 11:27:06        scheduleTime: '20:30',
2025-08-09 11:27:06        recurring: false,
2025-08-09 11:27:06        timeReference: 'day_after_tomorrow'
2025-08-09 11:27:06      },
2025-08-09 11:27:06      result: {
2025-08-09 11:27:06        success: true,
2025-08-09 11:27:06        code: 'ADD_COURSE_OK',
2025-08-09 11:27:06        message: '✅ 課程已安排成功！\n\n👦 學生：Lumi\n📚 課程：鋼琴課\n📅 日期：2025-08-11\n🕐 時間：下午8:30',
2025-08-09 11:27:06        data: [Object],
2025-08-09 11:27:06        quickReply: [Array]
2025-08-09 11:27:06      }
2025-08-09 11:27:06    },
2025-08-09 11:27:06    timestamp: 1754738817002
2025-08-09 11:27:06  }
2025-08-09 11:27:06  ⚠️ 無待處理的意圖資料
2025-08-09 11:27:06  ⚠️ 無待處理的意圖資料
2025-08-09 11:27:06  ✅ 規則匹配成功: add_course
2025-08-09 11:27:06  🎯 識別意圖: add_course
2025-08-09 11:27:06  🔍 開始提取 slots - 意圖: add_course (用戶: U_test_user_qa)
2025-08-09 11:27:06  🕒 開始高級時間解析: 小光明天上午十點三十分英文課
2025-08-09 11:27:06  ✅ 時間解析成功: {
2025-08-09 11:27:06    input: '小光明天上午十點三十分英文課',
2025-08-09 11:27:06    output: '10:30',
2025-08-09 11:27:06    details: {
2025-08-09 11:27:06      hour: 10,
2025-08-09 11:27:06      minute: 30,
2025-08-09 11:27:06      matchType: 'chinese_period',
2025-08-09 11:27:06      periodInfo: '上午'
2025-08-09 11:27:06    }
2025-08-09 11:27:06  }
2025-08-09 11:27:06  🧠 使用對話上下文增強 slots 提取
2025-08-09 11:27:06  📊 規則提取置信度: 1.00
2025-08-09 11:27:06  🤖 啟用 AI 輔助提取...
2025-08-09 11:27:08  ✅ 最終 slots: {
2025-08-09 11:27:08    studentName: '小光',
2025-08-09 11:27:08  ✅ 最終 slots: {
2025-08-09 11:27:08    studentName: '小光',
2025-08-09 11:27:08    courseName: '三十分英文課',
2025-08-09 11:27:08    scheduleTime: '10:30',
2025-08-09 11:27:08    recurring: false,
2025-08-09 11:27:08    timeReference: 'tomorrow'
2025-08-09 11:27:08  }
2025-08-09 11:27:08  📋 提取結果: {
2025-08-09 11:27:08    studentName: '小光',
2025-08-09 11:27:08    courseName: '三十分英文課',
2025-08-09 11:27:08    scheduleTime: '10:30',
2025-08-09 11:27:08    recurring: false,
2025-08-09 11:27:08    timeReference: 'tomorrow'
2025-08-09 11:27:08  }
2025-08-09 11:27:08  🎯 執行任務: add_course
2025-08-09 11:27:08  🎯 開始處理新增課程任務
2025-08-09 11:27:08  📋 接收參數: {
2025-08-09 11:27:08    studentName: '小光',
2025-08-09 11:27:08    courseName: '三十分英文課',
2025-08-09 11:27:08    scheduleTime: '10:30',
2025-08-09 11:27:08    recurring: false,
2025-08-09 11:27:08    timeReference: 'tomorrow'
2025-08-09 11:27:08  }
2025-08-09 11:27:08  👤 學生日曆: d041737f91146e26d2ed7a4ee6a0c36addd74c413112fc81d14790fbe9102fb0@group.calendar.google.com
2025-08-09 11:27:08  ✅ 已創建課程事件: mock-event-1754738828382
2025-08-09 11:27:08  📅 Google Calendar 事件已創建: mock-event-1754738828382
2025-08-09 11:27:08  ✅ 課程資料已儲存: 71DoC63QG0xGK7u0P83h
2025-08-09 11:27:08  💾 Firebase 課程資料已儲存: 71DoC63QG0xGK7u0P83h
2025-08-09 11:27:08  📊 任務執行結果: {
2025-08-09 11:27:08    success: true,
2025-08-09 11:27:08    code: 'ADD_COURSE_OK',
2025-08-09 11:27:08    message: '✅ 課程已安排成功！\n\n👦 學生：小光\n📚 課程：三十分英文課\n📅 日期：2025-08-10\n🕐 時間：上午10:30',
2025-08-09 11:27:08    data: {
2025-08-09 11:27:08      courseId: '71DoC63QG0xGK7u0P83h',
2025-08-09 11:27:08      eventId: 'mock-event-1754738828382'
2025-08-09 11:27:08    },
2025-08-09 11:27:08    quickReply: [
2025-08-09 11:27:08      { label: '✅ 確認', text: '確認' },
2025-08-09 11:27:08      { label: '✏️ 修改', text: '修改' },
2025-08-09 11:27:08      { label: '❌ 取消操作', text: '取消操作' }
2025-08-09 11:27:08    ]
2025-08-09 11:27:08  }
2025-08-09 11:27:08  ✅ 任務結果: {
2025-08-09 11:27:08    success: true,
2025-08-09 11:27:08    code: 'ADD_COURSE_OK',
2025-08-09 11:27:08    message: '✅ 課程已安排成功！\n\n👦 學生：小光\n📚 課程：三十分英文課\n📅 日期：2025-08-10\n🕐 時間：上午10:30',
2025-08-09 11:27:08    data: {
2025-08-09 11:27:08      courseId: '71DoC63QG0xGK7u0P83h',
2025-08-09 11:27:08      eventId: 'mock-event-1754738828382'
2025-08-09 11:27:08    },
2025-08-09 11:27:08    quickReply: [
2025-08-09 11:27:08      { label: '✅ 確認', text: '確認' },
2025-08-09 11:27:08      { label: '✏️ 修改', text: '修改' },
2025-08-09 11:27:08      { label: '❌ 取消操作', text: '取消操作' }
2025-08-09 11:27:08    ]
2025-08-09 11:27:08  }
2025-08-09 11:27:08  🔍 檢查 replyToken: test-reply-token-1754738826303
2025-08-09 11:27:08  🧪 檢測到測試 token，跳過真實 LINE API 調用
2025-08-09 11:27:08  📤 [測試模式] 實際業務回覆: ✅ 課程已安排成功！
2025-08-09 11:27:08  
2025-08-09 11:27:08  👦 學生：小光
2025-08-09 11:27:08  📚 課程：三十分英文課
2025-08-09 11:27:08  📅 日期：2025-08-10
2025-08-09 11:27:08  🕐 時間：上午10:30
2025-08-09 11:27:17  📨 收到 1 個事件
2025-08-09 11:27:17  📋 事件類型: message
2025-08-09 11:27:17  🔍 完整事件 JSON: {
2025-08-09 11:27:17    "type": "message",
2025-08-09 11:27:17    "message": {
2025-08-09 11:27:17      "type": "text",
2025-08-09 11:27:17      "text": "明天下午3點要上數學課"
2025-08-09 11:27:17    },
2025-08-09 11:27:17    "source": {
2025-08-09 11:27:17      "userId": "U_test_user_qa",
2025-08-09 11:27:17      "type": "user"
2025-08-09 11:27:17    },
2025-08-09 11:27:17    "replyToken": "test-reply-token-1754738837776",
2025-08-09 11:27:17    "timestamp": 1754738837776
2025-08-09 11:27:17  }
2025-08-09 11:27:17  📝 收到文字訊息: 明天下午3點要上數學課
2025-08-09 11:27:17  👤 用戶ID: U_test_user_qa
2025-08-09 11:27:17  🔍 用戶ID類型: string
2025-08-09 11:27:17  🔍 是否測試用戶: true
2025-08-09 11:27:17  🚀 生產用戶，使用真實 LINE Service
2025-08-09 11:27:17  🔥 選擇的服務類型: Object
2025-08-09 11:27:17  🎯 開始解析意圖: 明天下午3點要上數學課 (用戶: U_test_user_qa)
2025-08-09 11:27:17  🧠 檢測到期待輸入狀態: [ 'confirmation', 'modification' ]
2025-08-09 11:27:17  📋 待補充資料: {
2025-08-09 11:27:17    lastOperation: {
2025-08-09 11:27:17      intent: 'add_course',
2025-08-09 11:27:17      slots: {
2025-08-09 11:27:17        studentName: '小光',
2025-08-09 11:27:17        courseName: '三十分英文課',
2025-08-09 11:27:17        scheduleTime: '10:30',
2025-08-09 11:27:17        recurring: false,
2025-08-09 11:27:17        timeReference: 'tomorrow'
2025-08-09 11:27:17      },
2025-08-09 11:27:17      result: {
2025-08-09 11:27:17        success: true,
2025-08-09 11:27:17        code: 'ADD_COURSE_OK',
2025-08-09 11:27:17  📨 收到 1 個事件
2025-08-09 11:27:17  📋 事件類型: message
2025-08-09 11:27:17  🔍 完整事件 JSON: {
2025-08-09 11:27:17    "type": "message",
2025-08-09 11:27:17    "message": {
2025-08-09 11:27:17      "type": "text",
2025-08-09 11:27:17      "text": "明天下午3點要上數學課"
2025-08-09 11:27:17    },
2025-08-09 11:27:17    "source": {
2025-08-09 11:27:17      "userId": "U_test_user_qa",
2025-08-09 11:27:17      "type": "user"
2025-08-09 11:27:17    },
2025-08-09 11:27:17    "replyToken": "test-reply-token-1754738837776",
2025-08-09 11:27:17    "timestamp": 1754738837776
2025-08-09 11:27:17  }
2025-08-09 11:27:17  📝 收到文字訊息: 明天下午3點要上數學課
2025-08-09 11:27:17  👤 用戶ID: U_test_user_qa
2025-08-09 11:27:17  🔍 用戶ID類型: string
2025-08-09 11:27:17  🔍 是否測試用戶: true
2025-08-09 11:27:17  🚀 生產用戶，使用真實 LINE Service
2025-08-09 11:27:17  🔥 選擇的服務類型: Object
2025-08-09 11:27:17  🎯 開始解析意圖: 明天下午3點要上數學課 (用戶: U_test_user_qa)
2025-08-09 11:27:17  🧠 檢測到期待輸入狀態: [ 'confirmation', 'modification' ]
2025-08-09 11:27:17  📋 待補充資料: {
2025-08-09 11:27:17    lastOperation: {
2025-08-09 11:27:17      intent: 'add_course',
2025-08-09 11:27:17      slots: {
2025-08-09 11:27:17        studentName: '小光',
2025-08-09 11:27:17        courseName: '三十分英文課',
2025-08-09 11:27:17        scheduleTime: '10:30',
2025-08-09 11:27:17        recurring: false,
2025-08-09 11:27:17        timeReference: 'tomorrow'
2025-08-09 11:27:17      },
2025-08-09 11:27:17      result: {
2025-08-09 11:27:17        success: true,
2025-08-09 11:27:17        code: 'ADD_COURSE_OK',
2025-08-09 11:27:17        message: '✅ 課程已安排成功！\n\n👦 學生：小光\n📚 課程：三十分英文課\n📅 日期：2025-08-10\n🕐 時間：上午10:30',
2025-08-09 11:27:17        data: [Object],
2025-08-09 11:27:17        quickReply: [Array]
2025-08-09 11:27:17      }
2025-08-09 11:27:17    },
2025-08-09 11:27:17    timestamp: 1754738828609
2025-08-09 11:27:17  }
2025-08-09 11:27:17  ⚠️ 無待處理的意圖資料
2025-08-09 11:27:17  ⚠️ 無待處理的意圖資料
2025-08-09 11:27:18  ✅ 規則匹配成功: add_course
2025-08-09 11:27:18  🎯 識別意圖: add_course
2025-08-09 11:27:18  🔍 開始提取 slots - 意圖: add_course (用戶: U_test_user_qa)
2025-08-09 11:27:18  🕒 開始高級時間解析: 明天下午3點要上數學課
2025-08-09 11:27:18  ✅ 時間解析成功: {
2025-08-09 11:27:18    input: '明天下午3點要上數學課',
2025-08-09 11:27:18    output: '15:00',
2025-08-09 11:27:18    details: { hour: 15, minute: 0, matchType: 'arabic_period', periodInfo: '下午' }
2025-08-09 11:27:18  }
2025-08-09 11:27:18  📊 規則提取置信度: 0.50
2025-08-09 11:27:18  🤖 啟用 AI 輔助提取...
2025-08-09 11:27:19  ✅ 最終 slots: {
2025-08-09 11:27:19    courseName: '數學課',
2025-08-09 11:27:19    scheduleTime: '15:00',
2025-08-09 11:27:19    recurring: false,
2025-08-09 11:27:19    timeReference: 'tomorrow'
2025-08-09 11:27:19  }
2025-08-09 11:27:19  📋 提取結果: {
2025-08-09 11:27:19    courseName: '數學課',
2025-08-09 11:27:19    scheduleTime: '15:00',
2025-08-09 11:27:19    recurring: false,
2025-08-09 11:27:19    timeReference: 'tomorrow'
2025-08-09 11:27:19  }
2025-08-09 11:27:19  🎯 執行任務: add_course
2025-08-09 11:27:19  🎯 開始處理新增課程任務
2025-08-09 11:27:19  📋 接收參數: {
2025-08-09 11:27:19    courseName: '數學課',
2025-08-09 11:27:19    scheduleTime: '15:00',
2025-08-09 11:27:19    recurring: false,
2025-08-09 11:27:19    timeReference: 'tomorrow'
2025-08-09 11:27:19  }
2025-08-09 11:27:19  📊 任務執行結果: {
2025-08-09 11:27:19    success: false,
2025-08-09 11:27:19    code: 'MISSING_FIELDS',
2025-08-09 11:27:19    message: '❓ 請提供以下資訊：學生姓名\n\n範例：「小明每週三下午3點數學課」',
2025-08-09 11:27:19    expectingInput: true,
2025-08-09 11:27:19    missingFields: [ '學生姓名' ]
2025-08-09 11:27:19  }
2025-08-09 11:27:19  ✅ 任務結果: {
2025-08-09 11:27:19    success: false,
2025-08-09 11:27:19    code: 'MISSING_FIELDS',
2025-08-09 11:27:19    message: '❓ 請提供以下資訊：學生姓名\n\n範例：「小明每週三下午3點數學課」',
2025-08-09 11:27:19    expectingInput: true,
2025-08-09 11:27:19    missingFields: [ '學生姓名' ]
2025-08-09 11:27:19  }
2025-08-09 11:27:20  🔍 檢查 replyToken: test-reply-token-1754738837776
2025-08-09 11:27:20  🧪 檢測到測試 token，跳過真實 LINE API 調用
2025-08-09 11:27:20  📤 [測試模式] 實際業務回覆: ❓ 請提供以下資訊：學生姓名
2025-08-09 11:27:20  
2025-08-09 11:27:20  範例：「小明每週三下午3點數學課」
2025-08-09 11:27:29  📨 收到 1 個事件
2025-08-09 11:27:29  📋 事件類型: message
2025-08-09 11:27:29  🔍 完整事件 JSON: {
2025-08-09 11:27:29    "type": "message",
2025-08-09 11:27:29    "message": {
2025-08-09 11:27:29  📨 收到 1 個事件
2025-08-09 11:27:29  📋 事件類型: message
2025-08-09 11:27:29  🔍 完整事件 JSON: {
2025-08-09 11:27:29    "type": "message",
2025-08-09 11:27:29    "message": {
2025-08-09 11:27:29      "type": "text",
2025-08-09 11:27:29      "text": "小明要上數學課"
2025-08-09 11:27:29    },
2025-08-09 11:27:29    "source": {
2025-08-09 11:27:29      "userId": "U_test_user_qa",
2025-08-09 11:27:29      "type": "user"
2025-08-09 11:27:29    },
2025-08-09 11:27:29    "replyToken": "test-reply-token-1754738849042",
2025-08-09 11:27:29    "timestamp": 1754738849042
2025-08-09 11:27:29  }
2025-08-09 11:27:29  📝 收到文字訊息: 小明要上數學課
2025-08-09 11:27:29  👤 用戶ID: U_test_user_qa
2025-08-09 11:27:29  🔍 用戶ID類型: string
2025-08-09 11:27:29  🔍 是否測試用戶: true
2025-08-09 11:27:29  🚀 生產用戶，使用真實 LINE Service
2025-08-09 11:27:29  🔥 選擇的服務類型: Object
2025-08-09 11:27:29  🎯 開始解析意圖: 小明要上數學課 (用戶: U_test_user_qa)
2025-08-09 11:27:29  🧠 檢測到期待輸入狀態: [ 'student_name_input' ]
2025-08-09 11:27:29  📋 待補充資料: {
2025-08-09 11:27:29    lastOperation: {
2025-08-09 11:27:29      intent: 'add_course',
2025-08-09 11:27:29      slots: {
2025-08-09 11:27:29        studentName: '小光',
2025-08-09 11:27:29        courseName: '三十分英文課',
2025-08-09 11:27:29        scheduleTime: '10:30',
2025-08-09 11:27:29        recurring: false,
2025-08-09 11:27:29        timeReference: 'tomorrow'
2025-08-09 11:27:29      },
2025-08-09 11:27:29      result: {
2025-08-09 11:27:29        success: true,
2025-08-09 11:27:29        code: 'ADD_COURSE_OK',
2025-08-09 11:27:29        message: '✅ 課程已安排成功！\n\n👦 學生：小光\n📚 課程：三十分英文課\n📅 日期：2025-08-10\n🕐 時間：上午10:30',
2025-08-09 11:27:29        data: [Object],
2025-08-09 11:27:29        quickReply: [Array]
2025-08-09 11:27:29      }
2025-08-09 11:27:29    },
2025-08-09 11:27:29    timestamp: 1754738839820,
2025-08-09 11:27:29    slots: {
2025-08-09 11:27:29      intent: 'add_course',
2025-08-09 11:27:29      existingSlots: {
2025-08-09 11:27:29        courseName: '數學課',
2025-08-09 11:27:29        scheduleTime: '15:00',
2025-08-09 11:27:29        recurring: false,
2025-08-09 11:27:29        timeReference: 'tomorrow'
2025-08-09 11:27:29      },
2025-08-09 11:27:29      missingFields: [ '學生姓名' ]
2025-08-09 11:27:29    }
2025-08-09 11:27:29  }
2025-08-09 11:27:29  🔄 嘗試在原意圖中完整解析: add_course
2025-08-09 11:27:29  📋 現有 slots: {
2025-08-09 11:27:29    courseName: '數學課',
2025-08-09 11:27:29    scheduleTime: '15:00',
2025-08-09 11:27:29    recurring: false,
2025-08-09 11:27:29    timeReference: 'tomorrow'
2025-08-09 11:27:29  }
2025-08-09 11:27:29  🔍 開始提取 slots - 意圖: add_course (用戶: U_test_user_qa)
2025-08-09 11:27:29  🕒 開始高級時間解析: 小明要上數學課
2025-08-09 11:27:29  ❌ 時間解析失敗: 小明要上數學課
2025-08-09 11:27:29  📊 規則提取置信度: 0.50
2025-08-09 11:27:29  🤖 啟用 AI 輔助提取...
2025-08-09 11:27:30  ✅ 最終 slots: { studentName: '小明', courseName: '數學課', recurring: false }
2025-08-09 11:27:30  🔗 合併後的 slots: {
2025-08-09 11:27:30    courseName: '數學課',
2025-08-09 11:27:30    scheduleTime: '15:00',
2025-08-09 11:27:30    recurring: false,
2025-08-09 11:27:30    timeReference: 'tomorrow',
2025-08-09 11:27:30    studentName: '小明'
2025-08-09 11:27:30  }
2025-08-09 11:27:30  ✅ 資訊完整，可執行原意圖
2025-08-09 11:27:31  ✅ 上下文完整解析成功: add_course
2025-08-09 11:27:31  🎯 識別意圖: add_course
2025-08-09 11:27:31  🔍 開始提取 slots - 意圖: add_course (用戶: U_test_user_qa)
2025-08-09 11:27:31  🕒 開始高級時間解析: 小明要上數學課
2025-08-09 11:27:31  ❌ 時間解析失敗: 小明要上數學課
2025-08-09 11:27:31  📊 規則提取置信度: 0.50
2025-08-09 11:27:31  🤖 啟用 AI 輔助提取...
2025-08-09 11:27:32  ✅ 最終 slots: { studentName: '小明', courseName: '數學課', recurring: false }
2025-08-09 11:27:32  📋 提取結果: { studentName: '小明', courseName: '數學課', recurring: false }
2025-08-09 11:27:32  🎯 執行任務: add_course
2025-08-09 11:27:32  🎯 開始處理新增課程任務
2025-08-09 11:27:32  📋 接收參數: { studentName: '小明', courseName: '數學課', recurring: false }
2025-08-09 11:27:32  📊 任務執行結果: {
2025-08-09 11:27:32    success: false,
2025-08-09 11:27:32    code: 'MISSING_FIELDS',
2025-08-09 11:27:32    message: '❓ 請提供以下資訊：上課時間、課程日期\n\n範例：「小明每週三下午3點數學課」',
2025-08-09 11:27:32    expectingInput: true,
2025-08-09 11:27:32    missingFields: [ '上課時間', '課程日期' ]
2025-08-09 11:27:32  }
2025-08-09 11:27:32  ✅ 任務結果: {
2025-08-09 11:27:32    success: false,
2025-08-09 11:27:32    code: 'MISSING_FIELDS',
2025-08-09 11:27:32    message: '❓ 請提供以下資訊：上課時間、課程日期\n\n範例：「小明每週三下午3點數學課」',
2025-08-09 11:27:32    expectingInput: true,
2025-08-09 11:27:32    missingFields: [ '上課時間', '課程日期' ]
2025-08-09 11:27:32  }
2025-08-09 11:27:32  ✅ 最終 slots: { studentName: '小明', courseName: '數學課', recurring: false }
2025-08-09 11:27:32  📋 提取結果: { studentName: '小明', courseName: '數學課', recurring: false }
2025-08-09 11:27:32  🎯 執行任務: add_course
2025-08-09 11:27:32  🎯 開始處理新增課程任務
2025-08-09 11:27:32  📋 接收參數: { studentName: '小明', courseName: '數學課', recurring: false }
2025-08-09 11:27:32  📊 任務執行結果: {
2025-08-09 11:27:32    success: false,
2025-08-09 11:27:32    code: 'MISSING_FIELDS',
2025-08-09 11:27:32    message: '❓ 請提供以下資訊：上課時間、課程日期\n\n範例：「小明每週三下午3點數學課」',
2025-08-09 11:27:32    expectingInput: true,
2025-08-09 11:27:32    missingFields: [ '上課時間', '課程日期' ]
2025-08-09 11:27:32  }
2025-08-09 11:27:32  ✅ 任務結果: {
2025-08-09 11:27:32    success: false,
2025-08-09 11:27:32    code: 'MISSING_FIELDS',
2025-08-09 11:27:32    message: '❓ 請提供以下資訊：上課時間、課程日期\n\n範例：「小明每週三下午3點數學課」',
2025-08-09 11:27:32    expectingInput: true,
2025-08-09 11:27:32    missingFields: [ '上課時間', '課程日期' ]
2025-08-09 11:27:32  }
2025-08-09 11:27:32  🔍 檢查 replyToken: test-reply-token-1754738849042
2025-08-09 11:27:32  🧪 檢測到測試 token，跳過真實 LINE API 調用
2025-08-09 11:27:32  📤 [測試模式] 實際業務回覆: ❓ 請提供以下資訊：上課時間、課程日期
2025-08-09 11:27:32  
2025-08-09 11:27:32  範例：「小明每週三下午3點數學課」
2025-08-09 11:27:40  📨 收到 1 個事件
2025-08-09 11:27:40  📋 事件類型: message
2025-08-09 11:27:40  🔍 完整事件 JSON: {
2025-08-09 11:27:40    "type": "message",
2025-08-09 11:27:40    "message": {
2025-08-09 11:27:40      "type": "text",
2025-08-09 11:27:40      "text": "小明明天下午2點要上數學課"
2025-08-09 11:27:40    },
2025-08-09 11:27:40    "source": {
2025-08-09 11:27:40      "userId": "U_test_user_qa",
2025-08-09 11:27:40      "type": "user"
2025-08-09 11:27:40    },
2025-08-09 11:27:40    "replyToken": "test-reply-token-1754738860757",
2025-08-09 11:27:40    "timestamp": 1754738860757
2025-08-09 11:27:40  }
2025-08-09 11:27:40  📝 收到文字訊息: 小明明天下午2點要上數學課
2025-08-09 11:27:40  👤 用戶ID: U_test_user_qa
2025-08-09 11:27:40  🔍 用戶ID類型: string
2025-08-09 11:27:40  🔍 是否測試用戶: true
2025-08-09 11:27:40  🚀 生產用戶，使用真實 LINE Service
2025-08-09 11:27:40  🔥 選擇的服務類型: Object
2025-08-09 11:27:40  🎯 開始解析意圖: 小明明天下午2點要上數學課 (用戶: U_test_user_qa)
2025-08-09 11:27:40  🧠 檢測到期待輸入狀態: [ 'schedule_time_input', 'course_date_input' ]
2025-08-09 11:27:40  📋 待補充資料: {
2025-08-09 11:27:40    lastOperation: {
2025-08-09 11:27:40      intent: 'add_course',
2025-08-09 11:27:40      slots: {
2025-08-09 11:27:40        studentName: '小光',
2025-08-09 11:27:40        courseName: '三十分英文課',
2025-08-09 11:27:40        scheduleTime: '10:30',
2025-08-09 11:27:40        recurring: false,
2025-08-09 11:27:40        timeReference: 'tomorrow'
2025-08-09 11:27:40      },
2025-08-09 11:27:40      result: {
2025-08-09 11:27:40        success: true,
2025-08-09 11:27:40        code: 'ADD_COURSE_OK',
2025-08-09 11:27:40        message: '✅ 課程已安排成功！\n\n👦 學生：小光\n📚 課程：三十分英文課\n📅 日期：2025-08-10\n🕐 時間：上午10:30',
2025-08-09 11:27:40        data: [Object],
2025-08-09 11:27:40        quickReply: [Array]
2025-08-09 11:27:40      }
2025-08-09 11:27:40    },
2025-08-09 11:27:40    timestamp: 1754738852629,
2025-08-09 11:27:40    slots: {
2025-08-09 11:27:40      intent: 'add_course',
2025-08-09 11:27:40      existingSlots: { studentName: '小明', courseName: '數學課', recurring: false },
2025-08-09 11:27:40      missingFields: [ '上課時間', '課程日期' ]
2025-08-09 11:27:40    }
2025-08-09 11:27:40  }
2025-08-09 11:27:40  🔄 嘗試在原意圖中完整解析: add_course
2025-08-09 11:27:40  📋 現有 slots: { studentName: '小明', courseName: '數學課', recurring: false }
2025-08-09 11:27:40  🔍 開始提取 slots - 意圖: add_course (用戶: U_test_user_qa)
2025-08-09 11:27:40  🕒 開始高級時間解析: 小明明天下午2點要上數學課
2025-08-09 11:27:40  ✅ 時間解析成功: {
2025-08-09 11:27:40    input: '小明明天下午2點要上數學課',
2025-08-09 11:27:40    output: '14:00',
2025-08-09 11:27:40    details: { hour: 14, minute: 0, matchType: 'arabic_period', periodInfo: '下午' }
2025-08-09 11:27:40  }
2025-08-09 11:27:41  🧠 使用對話上下文增強 slots 提取
2025-08-09 11:27:41  📊 規則提取置信度: 1.00
2025-08-09 11:27:41  🤖 啟用 AI 輔助提取...
2025-08-09 11:27:42  ✅ 最終 slots: {
2025-08-09 11:27:42    studentName: '小明',
2025-08-09 11:27:42    courseName: '數學課',
2025-08-09 11:27:42    scheduleTime: '14:00',
2025-08-09 11:27:42    recurring: false,
2025-08-09 11:27:42    timeReference: 'tomorrow'
2025-08-09 11:27:42  }
2025-08-09 11:27:42  🔗 合併後的 slots: {
2025-08-09 11:27:42    studentName: '小明',
2025-08-09 11:27:42    courseName: '數學課',
2025-08-09 11:27:42    recurring: false,
2025-08-09 11:27:42    scheduleTime: '14:00',
2025-08-09 11:27:42    timeReference: 'tomorrow'
2025-08-09 11:27:42  }
2025-08-09 11:27:42  ✅ 資訊完整，可執行原意圖
2025-08-09 11:27:43  ✅ 上下文完整解析成功: add_course
2025-08-09 11:27:43  ✅ 上下文完整解析成功: add_course
2025-08-09 11:27:43  🎯 識別意圖: add_course
2025-08-09 11:27:43  🔍 開始提取 slots - 意圖: add_course (用戶: U_test_user_qa)
2025-08-09 11:27:43  🕒 開始高級時間解析: 小明明天下午2點要上數學課
2025-08-09 11:27:43  ✅ 時間解析成功: {
2025-08-09 11:27:43    input: '小明明天下午2點要上數學課',
2025-08-09 11:27:43    output: '14:00',
2025-08-09 11:27:43    details: { hour: 14, minute: 0, matchType: 'arabic_period', periodInfo: '下午' }
2025-08-09 11:27:43  }
2025-08-09 11:27:43  🧠 使用對話上下文增強 slots 提取
2025-08-09 11:27:43  📊 規則提取置信度: 1.00
2025-08-09 11:27:43  🤖 啟用 AI 輔助提取...
2025-08-09 11:27:44  ✅ 最終 slots: {
2025-08-09 11:27:44    studentName: '小明',
2025-08-09 11:27:44    courseName: '數學課',
2025-08-09 11:27:44    scheduleTime: '14:00',
2025-08-09 11:27:44    recurring: false,
2025-08-09 11:27:44    timeReference: 'tomorrow'
2025-08-09 11:27:44  }
2025-08-09 11:27:44  📋 提取結果: {
2025-08-09 11:27:44    studentName: '小明',
2025-08-09 11:27:44    courseName: '數學課',
2025-08-09 11:27:44    scheduleTime: '14:00',
2025-08-09 11:27:44    recurring: false,
2025-08-09 11:27:44    timeReference: 'tomorrow'
2025-08-09 11:27:44  }
2025-08-09 11:27:44  🎯 執行任務: add_course
2025-08-09 11:27:44  🎯 開始處理新增課程任務
2025-08-09 11:27:44  📋 接收參數: {
2025-08-09 11:27:44    studentName: '小明',
2025-08-09 11:27:44    courseName: '數學課',
2025-08-09 11:27:44    scheduleTime: '14:00',
2025-08-09 11:27:44    recurring: false,
2025-08-09 11:27:44    timeReference: 'tomorrow'
2025-08-09 11:27:44  }
2025-08-09 11:27:44  👤 學生日曆: b9bf786ee6f0002a0cbe843b8e27184082718a0ab1875873280de3be93e4a481@group.calendar.google.com
2025-08-09 11:27:44  ✅ 已創建課程事件: mock-event-1754738864509
2025-08-09 11:27:44  📅 Google Calendar 事件已創建: mock-event-1754738864509
2025-08-09 11:27:44  ✅ 課程資料已儲存: ios7YyAXlq9MMmE3KL1g
2025-08-09 11:27:44  💾 Firebase 課程資料已儲存: ios7YyAXlq9MMmE3KL1g
2025-08-09 11:27:44  📊 任務執行結果: {
2025-08-09 11:27:44    success: true,
2025-08-09 11:27:44    code: 'ADD_COURSE_OK',
2025-08-09 11:27:44    message: '✅ 課程已安排成功！\n\n👦 學生：小明\n📚 課程：數學課\n📅 日期：2025-08-10\n🕐 時間：下午2:00',
2025-08-09 11:27:44    data: {
2025-08-09 11:27:44      courseId: 'ios7YyAXlq9MMmE3KL1g',
2025-08-09 11:27:44      eventId: 'mock-event-1754738864509'
2025-08-09 11:27:44    },
2025-08-09 11:27:44    quickReply: [
2025-08-09 11:27:44      { label: '✅ 確認', text: '確認' },
2025-08-09 11:27:44      { label: '✏️ 修改', text: '修改' },
2025-08-09 11:27:44      { label: '❌ 取消操作', text: '取消操作' }
2025-08-09 11:27:44    ]
2025-08-09 11:27:44  }
2025-08-09 11:27:44  ✅ 任務結果: {
2025-08-09 11:27:44    success: true,
2025-08-09 11:27:44    code: 'ADD_COURSE_OK',
2025-08-09 11:27:44    message: '✅ 課程已安排成功！\n\n👦 學生：小明\n📚 課程：數學課\n📅 日期：2025-08-10\n🕐 時間：下午2:00',
2025-08-09 11:27:44    data: {
2025-08-09 11:27:44      courseId: 'ios7YyAXlq9MMmE3KL1g',
2025-08-09 11:27:44      eventId: 'mock-event-1754738864509'
2025-08-09 11:27:44    },
2025-08-09 11:27:44    quickReply: [
2025-08-09 11:27:44      { label: '✅ 確認', text: '確認' },
2025-08-09 11:27:44      { label: '✏️ 修改', text: '修改' },
2025-08-09 11:27:44      { label: '❌ 取消操作', text: '取消操作' }
2025-08-09 11:27:44    ]
2025-08-09 11:27:44  }
2025-08-09 11:27:45  🔍 檢查 replyToken: test-reply-token-1754738860757
2025-08-09 11:27:45  🧪 檢測到測試 token，跳過真實 LINE API 調用
2025-08-09 11:27:45  📤 [測試模式] 實際業務回覆: ✅ 課程已安排成功！
2025-08-09 11:27:45  
2025-08-09 11:27:45  👦 學生：小明
2025-08-09 11:27:45  📚 課程：數學課
2025-08-09 11:27:45  📅 日期：2025-08-10
2025-08-09 11:27:45  🕐 時間：下午2:00
2025-08-09 11:27:54  📨 收到 1 個事件
2025-08-09 11:27:54  📋 事件類型: message
2025-08-09 11:27:54  🔍 完整事件 JSON: {
2025-08-09 11:27:54    "type": "message",
2025-08-09 11:27:54    "message": {
2025-08-09 11:27:54      "type": "text",
2025-08-09 11:27:54      "text": "Lumi後天晚上八點半要上鋼琴課"
2025-08-09 11:27:54    },
2025-08-09 11:27:54    "source": {
2025-08-09 11:27:54      "userId": "U_test_user_qa",
2025-08-09 11:27:54      "type": "user"
2025-08-09 11:27:54    },
2025-08-09 11:27:54    "replyToken": "test-reply-token-1754738873952",
2025-08-09 11:27:54    "timestamp": 1754738873952
2025-08-09 11:27:54  }
2025-08-09 11:27:54  📝 收到文字訊息: Lumi後天晚上八點半要上鋼琴課
2025-08-09 11:27:54  👤 用戶ID: U_test_user_qa
2025-08-09 11:27:54  🔍 用戶ID類型: string
2025-08-09 11:27:54  🔍 是否測試用戶: true
2025-08-09 11:27:54  🚀 生產用戶，使用真實 LINE Service
2025-08-09 11:27:54  🔥 選擇的服務類型: Object
2025-08-09 11:27:54  🎯 開始解析意圖: Lumi後天晚上八點半要上鋼琴課 (用戶: U_test_user_qa)
2025-08-09 11:27:54  🧠 檢測到期待輸入狀態: [ 'confirmation', 'modification' ]
2025-08-09 11:27:54  📋 待補充資料: {
2025-08-09 11:27:54  📨 收到 1 個事件
2025-08-09 11:27:54  📋 事件類型: message
2025-08-09 11:27:54  🔍 完整事件 JSON: {
2025-08-09 11:27:54    "type": "message",
2025-08-09 11:27:54    "message": {
2025-08-09 11:27:54      "type": "text",
2025-08-09 11:27:54      "text": "Lumi後天晚上八點半要上鋼琴課"
2025-08-09 11:27:54    },
2025-08-09 11:27:54    "source": {
2025-08-09 11:27:54      "userId": "U_test_user_qa",
2025-08-09 11:27:54      "type": "user"
2025-08-09 11:27:54    },
2025-08-09 11:27:54    "replyToken": "test-reply-token-1754738873952",
2025-08-09 11:27:54    "timestamp": 1754738873952
2025-08-09 11:27:54  }
2025-08-09 11:27:54  📝 收到文字訊息: Lumi後天晚上八點半要上鋼琴課
2025-08-09 11:27:54  👤 用戶ID: U_test_user_qa
2025-08-09 11:27:54  🔍 用戶ID類型: string
2025-08-09 11:27:54  🔍 是否測試用戶: true
2025-08-09 11:27:54  🚀 生產用戶，使用真實 LINE Service
2025-08-09 11:27:54  🔥 選擇的服務類型: Object
2025-08-09 11:27:54  🎯 開始解析意圖: Lumi後天晚上八點半要上鋼琴課 (用戶: U_test_user_qa)
2025-08-09 11:27:54  🧠 檢測到期待輸入狀態: [ 'confirmation', 'modification' ]
2025-08-09 11:27:54  📋 待補充資料: {
2025-08-09 11:27:54    lastOperation: {
2025-08-09 11:27:54      intent: 'add_course',
2025-08-09 11:27:54      slots: {
2025-08-09 11:27:54        studentName: '小明',
2025-08-09 11:27:54        courseName: '數學課',
2025-08-09 11:27:54        scheduleTime: '14:00',
2025-08-09 11:27:54        recurring: false,
2025-08-09 11:27:54        timeReference: 'tomorrow'
2025-08-09 11:27:54      },
2025-08-09 11:27:54      result: {
2025-08-09 11:27:54        success: true,
2025-08-09 11:27:54        code: 'ADD_COURSE_OK',
2025-08-09 11:27:54        message: '✅ 課程已安排成功！\n\n👦 學生：小明\n📚 課程：數學課\n📅 日期：2025-08-10\n🕐 時間：下午2:00',
2025-08-09 11:27:54        data: [Object],
2025-08-09 11:27:54        quickReply: [Array]
2025-08-09 11:27:54      }
2025-08-09 11:27:54    },
2025-08-09 11:27:54    timestamp: 1754738864722
2025-08-09 11:27:54  }
2025-08-09 11:27:54  ⚠️ 無待處理的意圖資料
2025-08-09 11:27:54  ⚠️ 無待處理的意圖資料
2025-08-09 11:27:54  ✅ 規則匹配成功: add_course
2025-08-09 11:27:54  🎯 識別意圖: add_course
2025-08-09 11:27:54  🔍 開始提取 slots - 意圖: add_course (用戶: U_test_user_qa)
2025-08-09 11:27:54  🕒 開始高級時間解析: Lumi後天晚上八點半要上鋼琴課
2025-08-09 11:27:54  ✅ 時間解析成功: {
2025-08-09 11:27:54    input: 'Lumi後天晚上八點半要上鋼琴課',
2025-08-09 11:27:54    output: '20:30',
2025-08-09 11:27:54    details: {
2025-08-09 11:27:54      hour: 20,
2025-08-09 11:27:54      minute: 30,
2025-08-09 11:27:54      matchType: 'chinese_period',
2025-08-09 11:27:54      periodInfo: '晚上'
2025-08-09 11:27:54    }
2025-08-09 11:27:54  }
2025-08-09 11:27:54  📊 規則提取置信度: 0.30
2025-08-09 11:27:54  🔄 規則提取信心度低，AI 輔助增強...
2025-08-09 11:27:56  🔧 自動修正提取結果: [ '課程名稱包含動作詞: 半要上鋼琴課' ]
2025-08-09 11:27:56  ✅ 最終 slots: {
2025-08-09 11:27:56    studentName: 'Lumi',
2025-08-09 11:27:56    courseName: '鋼琴課',
2025-08-09 11:27:56    scheduleTime: '20:30',
2025-08-09 11:27:56    recurring: false,
2025-08-09 11:27:56    timeReference: 'day_after_tomorrow'
2025-08-09 11:27:56  }
2025-08-09 11:27:56  📋 提取結果: {
2025-08-09 11:27:56    studentName: 'Lumi',
2025-08-09 11:27:56    courseName: '鋼琴課',
2025-08-09 11:27:56    scheduleTime: '20:30',
2025-08-09 11:27:56    recurring: false,
2025-08-09 11:27:56    timeReference: 'day_after_tomorrow'
2025-08-09 11:27:56  }
2025-08-09 11:27:56  🎯 執行任務: add_course
2025-08-09 11:27:56  🎯 開始處理新增課程任務
2025-08-09 11:27:56  📋 接收參數: {
2025-08-09 11:27:56    studentName: 'Lumi',
2025-08-09 11:27:56    courseName: '鋼琴課',
2025-08-09 11:27:56    scheduleTime: '20:30',
2025-08-09 11:27:56    recurring: false,
2025-08-09 11:27:56    timeReference: 'day_after_tomorrow'
2025-08-09 11:27:56  }
2025-08-09 11:27:56  👤 學生日曆: 4a0f9e74ce6d657504bec55784c18348676fc1f35aa59f71a6cd2b9b5b2f2f4b@group.calendar.google.com
2025-08-09 11:27:56  ✅ 已創建課程事件: mock-event-1754738876266
2025-08-09 11:27:56  📅 Google Calendar 事件已創建: mock-event-1754738876266
2025-08-09 11:27:56  ✅ 課程資料已儲存: oq3zvv360Nxa3JMP13kg
2025-08-09 11:27:56  💾 Firebase 課程資料已儲存: oq3zvv360Nxa3JMP13kg
2025-08-09 11:27:56  📊 任務執行結果: {
2025-08-09 11:27:56    success: true,
2025-08-09 11:27:56    code: 'ADD_COURSE_OK',
2025-08-09 11:27:56    message: '✅ 課程已安排成功！\n\n👦 學生：Lumi\n📚 課程：鋼琴課\n📅 日期：2025-08-11\n🕐 時間：下午8:30',
2025-08-09 11:27:56    data: {
2025-08-09 11:27:56      courseId: 'oq3zvv360Nxa3JMP13kg',
2025-08-09 11:27:56      eventId: 'mock-event-1754738876266'
2025-08-09 11:27:56    },
2025-08-09 11:27:56    quickReply: [
2025-08-09 11:27:56      { label: '✅ 確認', text: '確認' },
2025-08-09 11:27:56  🔧 自動修正提取結果: [ '課程名稱包含動作詞: 半要上鋼琴課' ]
2025-08-09 11:27:56  ✅ 最終 slots: {
2025-08-09 11:27:56    studentName: 'Lumi',
2025-08-09 11:27:56    courseName: '鋼琴課',
2025-08-09 11:27:56    scheduleTime: '20:30',
2025-08-09 11:27:56    recurring: false,
2025-08-09 11:27:56    timeReference: 'day_after_tomorrow'
2025-08-09 11:27:56  }
2025-08-09 11:27:56  📋 提取結果: {
2025-08-09 11:27:56    studentName: 'Lumi',
2025-08-09 11:27:56    courseName: '鋼琴課',
2025-08-09 11:27:56    scheduleTime: '20:30',
2025-08-09 11:27:56    recurring: false,
2025-08-09 11:27:56    timeReference: 'day_after_tomorrow'
2025-08-09 11:27:56  }
2025-08-09 11:27:56  🎯 執行任務: add_course
2025-08-09 11:27:56  🎯 開始處理新增課程任務
2025-08-09 11:27:56  📋 接收參數: {
2025-08-09 11:27:56    studentName: 'Lumi',
2025-08-09 11:27:56    courseName: '鋼琴課',
2025-08-09 11:27:56    scheduleTime: '20:30',
2025-08-09 11:27:56    recurring: false,
2025-08-09 11:27:56    timeReference: 'day_after_tomorrow'
2025-08-09 11:27:56  }
2025-08-09 11:27:56  👤 學生日曆: 4a0f9e74ce6d657504bec55784c18348676fc1f35aa59f71a6cd2b9b5b2f2f4b@group.calendar.google.com
2025-08-09 11:27:56  ✅ 已創建課程事件: mock-event-1754738876266
2025-08-09 11:27:56  📅 Google Calendar 事件已創建: mock-event-1754738876266
2025-08-09 11:27:56  ✅ 課程資料已儲存: oq3zvv360Nxa3JMP13kg
2025-08-09 11:27:56  💾 Firebase 課程資料已儲存: oq3zvv360Nxa3JMP13kg
2025-08-09 11:27:56  📊 任務執行結果: {
2025-08-09 11:27:56    success: true,
2025-08-09 11:27:56    code: 'ADD_COURSE_OK',
2025-08-09 11:27:56    message: '✅ 課程已安排成功！\n\n👦 學生：Lumi\n📚 課程：鋼琴課\n📅 日期：2025-08-11\n🕐 時間：下午8:30',
2025-08-09 11:27:56    data: {
2025-08-09 11:27:56      courseId: 'oq3zvv360Nxa3JMP13kg',
2025-08-09 11:27:56      eventId: 'mock-event-1754738876266'
2025-08-09 11:27:56    },
2025-08-09 11:27:56    quickReply: [
2025-08-09 11:27:56      { label: '✅ 確認', text: '確認' },
2025-08-09 11:27:56      { label: '✏️ 修改', text: '修改' },
2025-08-09 11:27:56      { label: '❌ 取消操作', text: '取消操作' }
2025-08-09 11:27:56    ]
2025-08-09 11:27:56  }
2025-08-09 11:27:56  ✅ 任務結果: {
2025-08-09 11:27:56    success: true,
2025-08-09 11:27:56    code: 'ADD_COURSE_OK',
2025-08-09 11:27:56    message: '✅ 課程已安排成功！\n\n👦 學生：Lumi\n📚 課程：鋼琴課\n📅 日期：2025-08-11\n🕐 時間：下午8:30',
2025-08-09 11:27:56    data: {
2025-08-09 11:27:56      courseId: 'oq3zvv360Nxa3JMP13kg',
2025-08-09 11:27:56      eventId: 'mock-event-1754738876266'
2025-08-09 11:27:56    },
2025-08-09 11:27:56    quickReply: [
2025-08-09 11:27:56      { label: '✅ 確認', text: '確認' },
2025-08-09 11:27:56      { label: '✏️ 修改', text: '修改' },
2025-08-09 11:27:56      { label: '❌ 取消操作', text: '取消操作' }
2025-08-09 11:27:56    ]
2025-08-09 11:27:56  }
2025-08-09 11:27:56  🔍 檢查 replyToken: test-reply-token-1754738873952
2025-08-09 11:27:56  🧪 檢測到測試 token，跳過真實 LINE API 調用
2025-08-09 11:27:56  📤 [測試模式] 實際業務回覆: ✅ 課程已安排成功！
2025-08-09 11:27:56  
2025-08-09 11:27:56  👦 學生：Lumi
2025-08-09 11:27:56  📚 課程：鋼琴課
2025-08-09 11:27:56  📅 日期：2025-08-11
2025-08-09 11:27:56  🕐 時間：下午8:30
2025-08-09 11:28:05  📨 收到 1 個事件
2025-08-09 11:28:05  📋 事件類型: message
2025-08-09 11:28:05  🔍 完整事件 JSON: {
2025-08-09 11:28:05    "type": "message",
2025-08-09 11:28:05    "message": {
2025-08-09 11:28:05      "type": "text",
2025-08-09 11:28:05      "text": "小光明天上午十點三十分英文課"
2025-08-09 11:28:05    },
2025-08-09 11:28:05    "source": {
2025-08-09 11:28:05      "userId": "U_test_user_qa",
2025-08-09 11:28:05      "type": "user"
2025-08-09 11:28:05    },
2025-08-09 11:28:05    "replyToken": "test-reply-token-1754738885739",
2025-08-09 11:28:05    "timestamp": 1754738885739
2025-08-09 11:28:05  }
2025-08-09 11:28:05  📝 收到文字訊息: 小光明天上午十點三十分英文課
2025-08-09 11:28:05  👤 用戶ID: U_test_user_qa
2025-08-09 11:28:05  🔍 用戶ID類型: string
2025-08-09 11:28:05  🔍 是否測試用戶: true
2025-08-09 11:28:05  🚀 生產用戶，使用真實 LINE Service
2025-08-09 11:28:05  🔥 選擇的服務類型: Object
2025-08-09 11:28:05  🎯 開始解析意圖: 小光明天上午十點三十分英文課 (用戶: U_test_user_qa)
2025-08-09 11:28:05  🧠 檢測到期待輸入狀態: [ 'confirmation', 'modification' ]
2025-08-09 11:28:05  📋 待補充資料: {
2025-08-09 11:28:05    lastOperation: {
2025-08-09 11:28:05      intent: 'add_course',
2025-08-09 11:28:05      slots: {
2025-08-09 11:28:05        studentName: 'Lumi',
2025-08-09 11:28:05        courseName: '鋼琴課',
2025-08-09 11:28:05        scheduleTime: '20:30',
2025-08-09 11:28:05        recurring: false,
2025-08-09 11:28:05        timeReference: 'day_after_tomorrow'
2025-08-09 11:28:05      },
2025-08-09 11:28:05      result: {
2025-08-09 11:28:05        success: true,
