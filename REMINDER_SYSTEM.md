# æé†’åŸ·è¡Œå™¨ç³»çµ±

LINE èª²ç¨‹ç®¡ç†æ©Ÿå™¨äººçš„è‡ªå‹•æé†’ç³»çµ±ï¼Œè² è²¬åœ¨å°çš„æ™‚é–“è‡ªå‹•æ¨é€æé†’åˆ° LINEã€‚

## ğŸ“‹ ç³»çµ±æ¦‚è¿°

æœ¬ç³»çµ±æ¡ç”¨ã€Œè¦å‰‡å…ˆè¡Œã€AI è£œå¼·ã€çš„æ¶æ§‹è¨­è¨ˆï¼Œæä¾›å®Œæ•´çš„æé†’åŸ·è¡Œã€é‚Šç•Œè™•ç†ã€ç›£æ§èˆ‡è§€æ¸¬åŠŸèƒ½ã€‚

### æ ¸å¿ƒç‰¹æ€§

- âœ… **å¯é–‹é—œçš„æé†’åŸ·è¡Œå™¨** - é€éç’°å¢ƒè®Šæ•¸æ§åˆ¶
- âœ… **é‚Šç•Œè™•ç†** - å–æ¶ˆèª²ç¨‹ã€éæœŸçª—å£ã€å¤±æ•—é‡è©¦
- âœ… **åŸºç¤æ—¥èªŒèˆ‡çµ±è¨ˆ** - åŸ·è¡Œæ™‚é–“ã€è™•ç†æ•¸é‡ã€éŒ¯èª¤è¨˜éŒ„  
- âœ… **è§€æ¸¬èˆ‡ç›£æ§** - å¥åº·æª¢æŸ¥ã€å‘Šè­¦ã€æ€§èƒ½æŒ‡æ¨™
- âœ… **Firebase Functions æ•´åˆ** - å®šæ™‚ä»»å‹™èˆ‡ HTTP API

---

## ğŸš€ å¿«é€Ÿé–‹å§‹

### ç’°å¢ƒè®Šæ•¸è¨­å®š

```bash
# æé†’åŠŸèƒ½é–‹é—œ
REMINDER_EXECUTOR_ENABLED=true

# æ™‚é–“é…ç½®ï¼ˆåˆ†é˜ï¼‰
REMINDER_SCAN_INTERVAL=5      # æƒæé–“éš”
REMINDER_EXPIRE_WINDOW=60     # éæœŸçª—å£

# é‡è©¦é…ç½®
REMINDER_MAX_RETRY=3          # æœ€å¤§é‡è©¦æ¬¡æ•¸
REMINDER_RETRY_DELAY=5        # é‡è©¦å»¶é²ï¼ˆåˆ†é˜ï¼‰

# æ‰¹æ¬¡è™•ç†
REMINDER_BATCH_SIZE=50        # æ‰¹æ¬¡å¤§å°
```

### åŸºæœ¬ä½¿ç”¨

```javascript
const { reminderExecutor } = require('./src/services/reminderExecutorService');

// åŸ·è¡Œæé†’æª¢æŸ¥
const result = await reminderExecutor.execute();
console.log('åŸ·è¡Œçµæœ:', result.summary);

// æª¢æŸ¥ç‹€æ…‹
console.log('åŠŸèƒ½é–‹å•Ÿ:', reminderExecutor.isEnabled());
console.log('çµ±è¨ˆè³‡æ–™:', reminderExecutor.getStats());
```

---

## ğŸ—ï¸ ç³»çµ±æ¶æ§‹

### æ ¸å¿ƒå…ƒä»¶

```
ReminderExecutor (ä¸»åŸ·è¡Œå™¨)
â”œâ”€â”€ ExecutionStats (çµ±è¨ˆè¨˜éŒ„)
â”œâ”€â”€ ReminderHealthChecker (å¥åº·æª¢æŸ¥)
â”œâ”€â”€ ReminderLogger (æ—¥èªŒæ ¼å¼åŒ–)
â””â”€â”€ Firebase Functions (å®šæ™‚ä»»å‹™)
```

### è³‡æ–™æµç¨‹

```
å®šæ™‚è§¸ç™¼ â†’ æƒææé†’ â†’ é‚Šç•Œæª¢æŸ¥ â†’ æ‰¹æ¬¡ç™¼é€ â†’ çµ±è¨ˆè¨˜éŒ„ â†’ å¥åº·æª¢æŸ¥
```

---

## ğŸ“Š ç›£æ§èˆ‡è§€æ¸¬

### HTTP API ç«¯é»

| ç«¯é» | åŠŸèƒ½ | å›æ‡‰æ ¼å¼ |
|------|------|----------|
| `/triggerReminderCheck` | æ‰‹å‹•è§¸ç™¼æé†’æª¢æŸ¥ | `{ success, result }` |
| `/getReminderStats` | å–å¾—åŸ·è¡Œçµ±è¨ˆ | `{ success, stats, config }` |
| `/getReminderHealth` | å¥åº·æª¢æŸ¥ | `{ success, health, monitoring, metrics }` |

### çµ±è¨ˆæŒ‡æ¨™

- **è™•ç†é‡çµ±è¨ˆ**: æƒææ•¸ã€ç™¼é€æ•¸ã€æˆåŠŸç‡
- **å»¶é²æŒ‡æ¨™**: åŸ·è¡Œæ™‚é–“ã€å¹³å‡è™•ç†æ™‚é–“
- **éŒ¯èª¤çµ±è¨ˆ**: éŒ¯èª¤ç‡ã€æœ€è¿‘éŒ¯èª¤è¨˜éŒ„
- **åˆ†ä½ˆçµ±è¨ˆ**: ç™¼é€ã€å¤±æ•—ã€éæœŸã€å–æ¶ˆæ•¸é‡

### å¥åº·æª¢æŸ¥

```javascript
const health = await healthChecker.checkHealth();
// å›å‚³: { status: 'healthy|warning|critical', alerts: [], recommendations: [] }
```

---

## ğŸ›¡ï¸ é‚Šç•Œè™•ç†

### 1. éæœŸçª—å£è™•ç†

- æé†’è§¸ç™¼æ™‚é–“è¶…éè¨­å®šçª—å£æ™‚è‡ªå‹•æ¨™è¨˜ç‚ºéæœŸ
- é è¨­çª—å£ï¼š60åˆ†é˜
- éæœŸæé†’ä¸æœƒç™¼é€ï¼Œç›´æ¥æ¨™è¨˜ç‹€æ…‹

### 2. å–æ¶ˆèª²ç¨‹è™•ç†

- æª¢æŸ¥é—œè¯èª²ç¨‹æ˜¯å¦å·²å–æ¶ˆ
- è‡ªå‹•è·³éå·²å–æ¶ˆèª²ç¨‹çš„æé†’
- æ¨™è¨˜æé†’ç‹€æ…‹ç‚º `cancelled`

### 3. å¤±æ•—é‡è©¦æ©Ÿåˆ¶

- ç™¼é€å¤±æ•—æ™‚è‡ªå‹•å®‰æ’é‡è©¦
- æœ€å¤§é‡è©¦æ¬¡æ•¸ï¼š3æ¬¡
- é‡è©¦å»¶é²ï¼š5åˆ†é˜
- è¶…éé‡è©¦ä¸Šé™æ¨™è¨˜ç‚º `failed`

### 4. ä½µç™¼ä¿è­·

- é˜²æ­¢å¤šå€‹åŸ·è¡Œå™¨åŒæ™‚é‹è¡Œ
- é‹è¡Œä¸­çš„åŸ·è¡Œå™¨æœƒè·³éæ–°çš„è§¸ç™¼
- ç¢ºä¿ç³»çµ±è³‡æºç©©å®š

---

## ğŸ”§ æ¸¬è©¦èˆ‡é©—è­‰

### å–®å…ƒæ¸¬è©¦

```bash
# åŸºç¤åŠŸèƒ½æ¸¬è©¦
node test-reminder-executor.js

# å®Œæ•´ç³»çµ±æ¸¬è©¦
node test-reminder-system.js
```

### æ¸¬è©¦è¦†è“‹

- âœ… é…ç½®æª¢æŸ¥
- âœ… åŸ·è¡Œå™¨åŠŸèƒ½
- âœ… å¥åº·æª¢æŸ¥
- âœ… ç›£æ§åŠŸèƒ½
- âœ… é‚Šç•Œæƒ…æ³
- âœ… API ç«¯é»æ¨¡æ“¬

---

## ğŸ“ æ—¥èªŒæ ¼å¼

### åŸ·è¡Œæ—¥èªŒ

```
[INFO] æé†’åŸ·è¡Œå™¨å®Œæˆ:
  â±ï¸  åŸ·è¡Œæ™‚é–“: 336ms
  ğŸ“Š æƒæ: 5, ç™¼é€: 3, å¤±æ•—: 1
  âš ï¸  éæœŸ: 1, å–æ¶ˆ: 0, éŒ¯èª¤: 0
```

### å¥åº·æª¢æŸ¥æ—¥èªŒ

```
âœ… æé†’ç³»çµ±å¥åº·æª¢æŸ¥: HEALTHY
âš ï¸ æé†’ç³»çµ±å¥åº·æª¢æŸ¥: WARNING
  å‘Šè­¦ (1):
    1. éŒ¯èª¤ç‡åé«˜: 15.2%
  å»ºè­°:
    1. æª¢æŸ¥ Firebase é€£æ¥å’Œç´¢å¼•è¨­å®š
```

### æ€§èƒ½æŒ‡æ¨™æ—¥èªŒ

```
ğŸ“ˆ æé†’ç³»çµ±æ€§èƒ½æŒ‡æ¨™:
  è™•ç†é‡: 10 ç­†, æˆåŠŸç‡: 85.0%
  å»¶é²: 450ms (å¹³å‡ 45.0ms/ç­†)
  éŒ¯èª¤ç‡: 10.0%
```

---

## ğŸš¨ å‘Šè­¦æ©Ÿåˆ¶

### è­¦å‘Šé–¾å€¼

- éŒ¯èª¤ç‡ > 10%
- å¤±æ•—ç‡ > 20%  
- åŸ·è¡Œæ™‚é–“ > 30ç§’

### åš´é‡é–¾å€¼

- éŒ¯èª¤ç‡ > 30%
- å¤±æ•—ç‡ > 50%
- åŸ·è¡Œæ™‚é–“ > 60ç§’

### å¥åº·ç‹€æ…‹

- `healthy` - ç³»çµ±æ­£å¸¸é‹è¡Œ
- `warning` - éœ€è¦é—œæ³¨ï¼Œä½†ä»å¯é‹è¡Œ
- `critical` - åš´é‡å•é¡Œï¼Œéœ€è¦ç«‹å³è™•ç†
- `disabled` - åŠŸèƒ½å·²åœç”¨

---

## ğŸ“‹ éƒ¨ç½²æ¸…å–®

### å¿…è¦æ­¥é©Ÿ

1. **ç’°å¢ƒè®Šæ•¸è¨­å®š**
   - [ ] è¨­å®š `REMINDER_EXECUTOR_ENABLED=true`
   - [ ] é…ç½®æ™‚é–“å’Œé‡è©¦åƒæ•¸
   - [ ] ç¢ºèª Firebase é€£æ¥

2. **Firebase è¨­å®š**
   - [ ] å»ºç«‹ Firestore ç´¢å¼•ï¼ˆè¤‡åˆç´¢å¼•ï¼šexecuted + triggerTimeï¼‰
   - [ ] è¨­å®š Functions éƒ¨ç½²
   - [ ] é…ç½® LINE API token

3. **ç›£æ§è¨­å®š**
   - [ ] è¨­å®šå¥åº·æª¢æŸ¥ç«¯é»
   - [ ] é…ç½®å‘Šè­¦é€šçŸ¥
   - [ ] æ¸¬è©¦ API å›æ‡‰

### é©—è­‰æª¢æŸ¥

```bash
# æª¢æŸ¥é…ç½®
curl -X GET "https://your-function-url/getReminderStats"

# å¥åº·æª¢æŸ¥
curl -X GET "https://your-function-url/getReminderHealth"

# æ‰‹å‹•è§¸ç™¼
curl -X POST "https://your-function-url/triggerReminderCheck"
```

---

## ğŸ”® æœªä¾†æ“´å±•

- ğŸ“Š Grafana ç›£æ§å„€éŒ¶æ¿æ•´åˆ
- ğŸ”” Slack/Email å‘Šè­¦é€šçŸ¥
- ğŸ“ˆ æ›´ç´°ç²’åº¦çš„æ€§èƒ½åˆ†æ
- ğŸ¯ æ™ºèƒ½é‡è©¦ç­–ç•¥ï¼ˆæŒ‡æ•¸é€€é¿ï¼‰
- ğŸ”„ è—ç¶ éƒ¨ç½²æ”¯æ´

---

## ğŸ“ æ”¯æ´èˆ‡ç¶­è­·

- **æ—¥èªŒä½ç½®**: Firebase Functions æ—¥èªŒ
- **ç›£æ§ç«¯é»**: `/getReminderHealth`
- **æ‰‹å‹•è§¸ç™¼**: `/triggerReminderCheck`
- **ç·Šæ€¥åœç”¨**: è¨­å®š `REMINDER_EXECUTOR_ENABLED=false`