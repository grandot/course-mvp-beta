# 專案狀態報告

**最後更新**: 2025-08-10  
**版本**: 1.2.2  
**部署狀態**: 生產環境運行中

## 概覽（快速掃描）
- 意圖準確率（線上）約 75%，回應時間約 ~2秒
- 主要風險：圖片上傳 404（外部依賴）、Redis 延遲 150-250ms
- 最新完成：意圖誤判修復、一次補問、錯誤兜底、配置集中化（v1.2.2）

---

## 維護規則（持續適用）
- Done 區塊最多保留 5 筆；第 6 筆起移至 `doc/CHANGELOG.md`，保留完成日期。
- CHANGELOG 撰寫「聚焦重點、避免冗長細節」：
  - 每版以精煉小節描述「解決了什麼、帶來什麼效果」。
  - 避免長篇內部過程與實作細節，細節放原 PR 或內部設計文件。
- 標題與條目一律清楚標註類型與優先級（例：[P1][Bug]/[P1][Feature]/[P2][Perf]）。

---

## 工作板（永續分欄）

### Doing（最多 3 項）
- [P1][UX] Quick Reply 精簡方案（等待 PM 清單；開發端不動現有按鈕）

### Next（已就緒，待拉入）
- [P1][Feature] 修改課程功能（編輯已存在的課程資訊）
- [P1][Quality] 單元測試補齊（提升覆蓋率與回歸信心）

### Backlog（優先序由上而下）
- [P1][Feature] 批次操作（一次新增多個課程）
- [P2][Feature] 匯出 PDF 課程報表
- [P2][Feature] 搜尋特定課程/內容
- [P1][Ops] 監控告警（異常監控與即時告警）
- [P2][Perf] Redis 連接池與延遲優化
- [P2][Security] Rate limiting 與輸入驗證

### Blocked（阻塞與依賴）
- [P1][External] 圖片上傳 404（LINE API）— 需官方支援或替代流程決策

### Done（最近 5 筆，含完成日）
- 2025-08-10：修復 record_content 意圖誤判（內容記錄優先規則）
- 2025-08-10：一次補問補齊（學生/課程/時間）並自動回填再執行
- 2025-08-10：錯誤兜底（驗證失敗/外部服務超時/資訊不完整）
- 2025-08-10：配置集中化（`src/config/index.js`、`config/env.example`）

### 短期改進（本月）
1. 實作修改課程功能
2. 新增單元測試（提升覆蓋）

### 評估項目
1. 是否需要更換 Redis 服務商（降低延遲）
2. 是否升級 Firebase 方案（增加配額）
3. 是否需要自建 NLP 模型（提升準確率）
---

## ❌ 未完成功能（風險盤點）

### 核心缺失
1. **批次操作** - 無法一次新增多個課程
2. **修改功能** - 無法修改已存在的課程時間/內容
3. **匯出功能** - 無法匯出 PDF 課程報表
4. **搜尋功能** - 無法搜尋特定課程或內容

### 技術缺失
1. **錯誤恢復** - 系統錯誤後無法自動恢復狀態
2. **監控告警** - 缺少異常監控和即時告警
3. **效能優化** - Redis 連接池未實作
4. **安全防護** - 缺少 rate limiting 和輸入驗證

---

## 🐛 當前問題與挑戰（Root Cause 對齊）

### 嚴重問題
1. Quick Reply 過度曝光與設計不一致，導致決策負擔與誤觸
2. **意圖誤判** - 「今天小明的數學課學了分數」可能被誤判為新增課程
3. **實體提取錯誤** - 複雜句子中學生名稱提取不準確（如「提醒我小明明天的」）

### 技術債務（MVP 階段）
1. **圖片功能完全失效** - LINE Bot API 404 錯誤，已排查多項可能原因，需等待 LINE 官方支援（持續）
2. **測試覆蓋不足** - 單元測試覆蓋率低於 50%
3. **配置管理混亂** - 環境變數和設定檔不一致、缺少集中化載入與範本

### 性能瓶頸（量測基線）
1. **Redis 延遲** - Upstash 雲端服務延遲 150-250ms
2. **OpenAI 回應慢** - 備援機制觸發時需要 2-3 秒
3. **Firebase 配額** - 免費版配額可能不足

---

## ✅ 已完成功能

### 核心功能（5/5 完成）
1. **新增課程** - 支援單次/重複課程，自然語言輸入
2. **查詢課程** - 今天/明天/本週課表查詢
3. **記錄內容** - 文字記錄（圖片上傳功能失效）
4. **設定提醒** - 課前提醒推播
5. **取消課程** - 刪除單次/重複課程

### 系統功能
- LINE Bot webhook 接收與回應
- Google Calendar 時間邏輯處理
- Firebase 資料儲存（圖片上傳目前不可用）
- OpenAI 語意理解（備援機制）
- Redis 30分鐘對話狀態管理
- Quick Reply 按鈕交互

---

## 🚀 未來新增功能（Phase 2）

### 短期（1-2個月）
1. **修改課程** - 編輯已存在的課程資訊
2. **批次處理** - 一次新增多個課程
3. **週報生成** - 自動生成學習週報
4. **Rich Menu** - LINE 圖形化選單

### 中期（3-6個月）
1. **多學生管理** - 支援多個孩子的課程管理
2. **老師模式** - 老師可以發送課程通知
3. **語音輸入** - 支援語音訊息轉文字
4. **智能推薦** - 基於歷史資料推薦課程

---

## 📊 關鍵指標

| 指標 | 目標 | 實際 | 狀態 |
|------|------|------|------|
| 意圖識別準確率（線上） | 95% | 75% | ⚠️ |
| 自動化測試通過率（受控） | 100% | 100% | ✅ |
| 平均回應時間 | <1秒 | ~2秒 | ⚠️ |
| 系統可用率 | 99.9% | 99.5% | ⚠️ |
| 測試覆蓋率 | 80% | <50% | ❌ |

---

## 風險與決策

### 風險
- 外部依賴：LINE 圖片上傳 404 — 影響內容記錄的照片功能
- 效能：Redis 延遲 150-250ms — 影響多輪對話體驗
- 測試：覆蓋不足 <50% — 回歸風險偏高

### 決策（近期）
- Quick Reply 由 PM 先定清單，再動程式（避免來回浪費）
- 本機/測試用 Mock Calendar，降低外部依賴對驗證的阻塞

---

## 變更紀錄
- 詳細請見 `doc/CHANGELOG.md`（最新：v1.2.2 已記錄修復與調整）