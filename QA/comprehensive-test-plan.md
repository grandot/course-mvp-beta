# LINE 課程管理機器人 - 階段式 QA 測試規劃 (修訂版)

## 測試範圍與標準

### 測試目標
**正式發布前的全面功能驗證**，基於階段式架構確保每個功能在乾淨環境中獨立驗證。

### 核心修訂
1. **移除圖片測試** - 因圖片上傳功能完全失效（LINE Bot API 404錯誤）
2. **階段式測試架構** - 解決前置數據依賴問題
3. **標記已知問題** - "每天"重複課程功能未完全實現

### 測試範圍
- **Group A: 獨立功能**（23個用例）- 無需前置資料
- **Group B: 依賴功能**（14個用例）- 基於Group A建立的資料
- **Group C: 複雜操作**（8個用例）- 需完整數據環境

### 測試標準
- **Group A 通過率**：≥90%
- **Group B 通過率**：≥85%  
- **Group C 通過率**：≥80%
- **單個測試回應時間**：≤5秒

---

## Group A: 獨立功能測試（23個用例）

> **特點**：無需前置資料，測試系統基礎能力

### A1. 新增單次課程（9個用例）

#### A1.1 標準格式解析

##### A1.1-A 完整資訊輸入（測試目的：驗證標準格式解析）
- **測試輸入**：「小明明天下午2點要上數學課」
- **預期回覆**：「✅ 課程已安排成功！👦 學生：小明 📚 課程：數學課 📅 日期：YYYY-MM-DD 🕐 時間：下午2:00」
- **實際回覆**：（待填）
- **測試結果**：（待填）
- **問題分析**：（待填）

##### A1.1-B 時間格式多樣性（測試目的：驗證時間解析器覆蓋率）
- **測試輸入**：「Lumi後天晚上八點半要上鋼琴課」
- **預期回覆**：「✅ 課程已安排成功！👦 學生：Lumi 📚 課程：鋼琴課 📅 日期：YYYY-MM-DD 🕐 時間：晚上8:30」
- **實際回覆**：（待填）
- **測試結果**：（待填）
- **問題分析**：（待填）

##### A1.1-C 中文數字時間（測試目的：驗證中文數字解析）
- **測試輸入**：「小光明天上午十點三十分英文課」
- **預期回覆**：「✅ 課程已安排成功！👦 學生：小光 📚 課程：英文課 📅 日期：YYYY-MM-DD 🕐 時間：上午10:30」
- **實際回覆**：（待填）
- **測試結果**：（待填）
- **問題分析**：（待填）

#### A1.2 資訊補充流程測試

##### A1.2-A 缺少學生資訊（測試目的：驗證多輪對話補充）
- **測試輸入**：「明天下午3點要上數學課」
- **預期回覆**：「❓ 請提供以下資訊：學生姓名 範例：「小明每週三下午3點數學課」」
- **實際回覆**：（待填）
- **測試結果**：（待填）
- **問題分析**：（待填）

##### A1.2-B 缺少時間資訊（測試目的：驗證時間補充機制）
- **測試輸入**：「小明要上數學課」
- **預期回覆**：「❓ 請提供以下資訊：上課時間、課程日期 範例：「小明每週三下午3點數學課」」
- **實際回覆**：（待填）
- **測試結果**：（待填）
- **問題分析**：（待填）

##### A1.2-C 多輪對話完成流程（測試目的：驗證狀態持續性）
- **測試序列**：
  1. 輸入：「小明要上課」
  2. 預期：系統詢問課程和時間
  3. 輸入：「數學課」  
  4. 預期：系統詢問時間
  5. 輸入：「明天下午2點」
- **預期最終回覆**：「✅ 課程已安排成功！」
- **實際回覆**：（待填）
- **測試結果**：（待填）
- **問題分析**：（待填）

#### A1.3 錯誤處理測試

##### A1.3-A 無效時間格式（測試目的：驗證時間校驗）
- **測試輸入**：「小明明天25點上數學課」
- **預期回覆**：「抱歉，時間格式不正確，請重新輸入正確的時間（例如：下午2點）」
<!-- @expectedCode: INVALID_TIME -->
<!-- @expectedSuccess: false -->
- **實際回覆**：（待填）
- **測試結果**：（待填）
- **問題分析**：（待填）

##### A1.3-B 過去時間輸入（測試目的：驗證時間邏輯校驗）
- **測試輸入**：「小明昨天下午2點上數學課」
- **預期回覆**：「無法新增過去時間的課程，請確認時間後重新輸入」
<!-- @expectedCode: INVALID_PAST_TIME -->
<!-- @expectedSuccess: false -->
- **實際回覆**：（待填）
- **測試結果**：（待填）
- **問題分析**：（待填）

##### A1.3-C 模糊語句處理（測試目的：驗證意圖識別邊界）
- **測試輸入**：「我想要什麼時候上課來著」
- **預期回覆**：「抱歉，我沒有理解您的意思。請提供具體的課程資訊，例如：「小明明天下午2點上數學課」」
- **實際回覆**：（待填）
- **測試結果**：（待填）
- **問題分析**：（待填）

### A2. 新增重複課程（10個用例）

#### A2.1 標準重複模式

##### A2.1-A 每週重複課程（測試目的：驗證週循環功能）
- **測試輸入**：「Lumi每週三下午3點要上鋼琴課」
- **預期回覆**：「✅ 課程已安排成功！👦 學生：Lumi 📚 課程：鋼琴課 🔄 重複：每週三 下午3:00 📅 下次上課：YYYY-MM-DD」
- **實際回覆**：（待填）
- **測試結果**：（待填）
- **問題分析**：（待填）

##### A2.1-B 多天重複課程（測試目的：驗證複雜重複規則）
- **測試輸入**：「小光每週一三五上午10點英文課」
- **預期回覆**：「✅ 課程已安排成功！👦 學生：小光 📚 課程：英文課 🔄 重複：每週一、三、五 上午10:00」
- **實際回覆**：（待填）
- **測試結果**：（待填）
- **問題分析**：（待填）

##### A2.1-C 每天重複課程 ✅（測試目的：驗證每日循環功能）
- **測試輸入**：「小明每天早上8點晨練課」
- **預期回覆**：「✅ 課程已安排成功！👦 學生：小明 📚 課程：晨練課 🔄 重複：每天 早上8:00 📅 下次上課：YYYY-MM-DD（明天）」
- **功能狀態**：✅ 已實現（v1.3.4）
- **環境變數**：需要 ENABLE_DAILY_RECURRING=true
- **實際回覆**：（待填）
- **測試結果**：（待填）
- **問題分析**：（待填）

##### A2.1-D 每日重複變體測試（測試目的：驗證每日關鍵詞識別）
- **測試輸入**：「安排Lumi每日下午5點瑜伽課」
- **預期回覆**：「✅ 課程已安排成功！👦 學生：Lumi 📚 課程：瑜伽課 🔄 重複：每天 下午17:00」
- **功能狀態**：✅ 已實現（v1.3.4）
- **實際回覆**：（待填）
- **測試結果**：（待填）
- **問題分析**：（待填）

##### A2.1-E 每月重複課程 ✅（測試目的：驗證每月循環功能）
- **測試輸入**：「小光每月第一個週一上午10點評鑑」
- **預期回覆**：「✅ 課程已安排成功！👦 學生：小光 📚 課程：評鑑 🔄 重複：每月第一個週一 上午10:00」
- **功能狀態**：✅ 已實現（每月重複基礎功能完整）
<!-- @expectedCode: ADD_COURSE_OK -->
<!-- @expectedSuccess: true -->
- **實際回覆**：（待填）
- **測試結果**：（待填）
- **問題分析**：（待填）

#### A2.2 重複規則邊界測試

##### A2.2-A 重複關鍵詞識別（測試目的：驗證意圖分類準確性）
- **測試輸入**：「安排小明定期游泳課每週二晚上7點」
- **預期回覆**：「✅ 課程已安排成功！（重複課程格式）」
- **實際回覆**：（待填）
- **測試結果**：（待填）
- **問題分析**：（待填）

##### A2.2-B 模糊重複表達（測試目的：驗證自然語言理解）
- **測試輸入**：「Lumi固定每個星期四下午兩點鋼琴課」
- **預期回覆**：「✅ 課程已安排成功！👦 學生：Lumi 📚 課程：鋼琴課 🔄 重複：每週四 下午14:00」
<!-- @expectedSuccess: true -->
- **實際回覆**：（待填）
- **測試結果**：（待填）
- **問題分析**：（待填）

##### A2.2-C 重複類型區分測試（測試目的：驗證 recurrenceType 識別準確性）
- **測試序列**：
  1. 輸入：「小明每天早上8點英文課」→ 預期 daily
  2. 輸入：「小明每週一早上8點英文課」→ 預期 weekly  
  3. 輸入：「小明每月1號早上8點英文課」→ 預期 monthly
- **預期回覆**：每個都應正確識別重複類型並生成對應的 Google Calendar 規則
- **實際回覆**：（待填）
- **測試結果**：（待填）
- **問題分析**：（待填）

##### A2.2-D 功能開關測試（測試目的：驗證每日重複功能開關）
- **測試序列**：
  1. 輸入：「小明每天早上8點英文課」
- **預期結果**：
  1. 功能關閉時：優雅降級到非重複模式
  2. 功能開啟時：正確處理每日重複
- **實際回覆**：（待填）
- **測試結果**：（待填）
- **問題分析**：（待填）

##### A2.2-E 重複課程時間衝突處理（測試目的：驗證重複課程的衝突檢測）
- **測試序列**：
  1. 輸入：「小明每天下午2點數學課」
  2. 輸入：「小明每天下午2點英文課」
- **預期回覆**：「⚠️ 時間衝突：小明 每天 下午14:00 已有數學課，是否要覆蓋？」
<!-- @expectedCode: TIME_CONFLICT -->
<!-- @expectedSuccess: false -->
- **實際回覆**：（待填）
- **測試結果**：（待填）
- **問題分析**：（待填）

### A3. 系統基礎功能（4個用例）

#### A3.1 意圖識別準確性

##### A3.1-A 意圖邊界測試（測試目的：驗證意圖分類不混淆）
- **測試輸入**：「我想了解一下課程安排的情況」
- **預期回覆**：「請問您想查詢課程表，還是要新增課程呢？」或顯示查詢導引（UNKNOWN_HELP）
<!-- @expectedSuccess: true -->
- **實際回覆**：（待填）
- **測試結果**：（待填）
- **問題分析**：（待填）

##### A3.1-B 複合意圖處理（測試目的：驗證複雜語句解析）
- **測試輸入**：「幫我安排小明數學課，然後查詢一下他今天有什麼課」
- **預期回覆**：「我一次只能處理一個請求，請先告訴我數學課的具體時間」或優先回應其中一項請求（以目前規則多數會優先 query）
<!-- @expectedSuccess: true -->
- **實際回覆**：（待填）
- **測試結果**：（待填）
- **問題分析**：（待填）

#### A3.2 錯誤恢復機制

##### A3.2-A 系統錯誤恢復（測試目的：驗證服務故障處理）
- **測試輸入**：「（觸發系統錯誤的占位輸入）」
- **預期回覆**：在未實際觸發錯誤的情況下，提供導引（UNKNOWN_HELP）即可
<!-- @expectedCode: UNKNOWN_HELP -->
<!-- @expectedSuccess: true -->
- **實際回覆**：（待填）
- **測試結果**：（待填）
- **問題分析**：（待填）

##### A3.2-B 輸入修正流程（測試目的：驗證錯誤輸入處理）
- **測試序列**：
  1. 輸入：「小明明天25點上課」
  2. 預期：系統提示時間格式錯誤
  3. 輸入：「下午2點」
- **預期最終回覆**：第一步回覆 INVALID_TIME 指引，後續接受正確時間後進入補充流程（非成功完成）
<!-- @expectedSuccess: false -->
- **實際回覆**：（待填）
- **測試結果**：（待填）
- **問題分析**：（待填）

---

## Group B: 依賴功能測試（14個用例）

> **前置條件**：依賴Group A建立的測試課程資料

### B1. 查詢課程功能（5個用例）

#### B1.1 時間範圍查詢

##### B1.1-A 今日課程查詢（測試目的：驗證當日課程顯示）
- **前置條件**：Group A 已建立今日課程
- **測試輸入**：「小明今天有什麼課？」
- **預期回覆**：「小明 今天（X/X）的課程如下：📍 下午02:00 數學課」
<!-- @expectedCode: QUERY_OK_EMPTY -->
<!-- @expectedSuccess: true -->
- **實際回覆**：（待填）
- **測試結果**：（待填）
- **問題分析**：（待填）

##### B1.1-B 明天課程查詢（測試目的：驗證次日課程顯示）
- **前置條件**：Group A 已建立明日課程
- **測試輸入**：「查詢Lumi明天的課表」
- **預期回覆**：「Lumi 明天（X/X）的課程如下：📍 下午15:30 鋼琴課」
<!-- @expectedCode: QUERY_OK_EMPTY -->
<!-- @expectedSuccess: true -->
- **實際回覆**：（待填）
- **測試結果**：（待填）
- **問題分析**：（待填）

##### B1.1-C 本週課程查詢（測試目的：驗證週期性課程顯示）
- **前置條件**：Group A 已建立重複課程
- **測試輸入**：「看一下小光這週的安排」
- **預期回覆**：顯示本週重複課程安排
- **實際回覆**：（待填）
- **測試結果**：（待填）
- **問題分析**：（待填）

#### B1.2 空結果與異常處理

##### B1.2-A 無課程日查詢（測試目的：驗證空結果處理）
- **測試輸入**：「小王今天有什麼課？」
- **預期回覆**：「📅 小王今天沒有安排課程」
<!-- @expectedCode: QUERY_OK_EMPTY -->
<!-- @expectedSuccess: true -->
- **實際回覆**：（待填）
- **測試結果**：（待填）
- **問題分析**：（待填）

#### B1.3 複雜查詢場景

##### B1.3-A 特定課程查詢（測試目的：驗證課程篩選功能）
- **前置條件**：Group A 已建立多門課程
- **測試輸入**：「小明的數學課什麼時候上？」
- **預期回覆**：顯示數學課的具體時間安排
- **實際回覆**：（待填）
- **測試結果**：（待填）
- **問題分析**：（待填）

##### B1.3-B 每日重複課程查詢（測試目的：驗證每日重複課程顯示）
- **前置條件**：Group A 已建立每日重複課程
- **測試輸入**：「小明的晨練課每天幾點？」
- **預期回覆**：若已建立對應課程則顯示安排；否則返回空查詢或補充提示
<!-- @expectedSuccess: true -->
- **實際回覆**：（待填）
- **測試結果**：（待填）
- **問題分析**：（待填）

##### B1.3-C 重複課程類型識別查詢（測試目的：驗證重複課程類型顯示）
- **前置條件**：Group A 已建立不同類型重複課程
- **測試輸入**：「查詢Lumi的重複課程」
- **預期回覆**：若存在相應重複課程則列出；否則返回空查詢
<!-- @expectedSuccess: true -->
- **實際回覆**：（待填）
- **測試結果**：（待填）
- **問題分析**：（待填）

### B2. 記錄內容功能（4個用例）

#### B2.1 標準記錄場景

##### B2.1-A 當日課程記錄（測試目的：驗證內容記錄功能）
- **前置條件**：Group A 已建立今日課程
- **測試輸入**：「今天小明的數學課學了分數加減法」
- **預期回覆**：「好的，已記錄小明今天（X/X）數學課的內容：📝 分數加減法 ✅」
- **實際回覆**：（待填）
- **測試結果**：（待填）
- **問題分析**：（待填）

##### B2.1-B 昨日課程補記錄（測試目的：驗證歷史記錄功能）
- **前置條件**：需要昨日的課程存在
- **測試輸入**：「補記一下昨天Lumi鋼琴課的內容，練習了小星星」
- **預期回覆**：「好的，已記錄Lumi昨天（X/X）鋼琴課的內容：📝 練習小星星 ✅」
<!-- @expectedCode: MISSING_FIELDS -->
<!-- @expectedSuccess: false -->
- **實際回覆**：（待填）
- **測試結果**：（待填）
- **問題分析**：（待填）

#### B2.2 記錄內容查詢

##### B2.2-A 查詢課程記錄（測試目的：驗證內容查詢功能）
- **前置條件**：B2.1 已記錄課程內容
- **測試輸入**：「小明昨天數學課學了什麼？」
- **預期回覆**：顯示已記錄的課程內容
<!-- @expectedCode: NOT_FOUND -->
<!-- @expectedSuccess: false -->
- **實際回覆**：（待填）
- **測試結果**：（待填）
- **問題分析**：（待填）

#### B2.3 記錄異常處理

##### B2.3-A 不存在課程記錄（測試目的：驗證數據校驗）
- **測試輸入**：「記錄小明今天化學課的內容」
- **預期回覆**：「找不到小明今天的化學課記錄，請確認課程資訊或先新增課程」
<!-- @expectedCode: NOT_FOUND -->
<!-- @expectedSuccess: false -->
- **實際回覆**：（待填）
- **測試結果**：（待填）
- **問題分析**：（待填）

### B3. 設定提醒功能（5個用例）

#### B3.1 基本提醒設定

##### B3.1-A 標準課前提醒（測試目的：驗證提醒設定功能）
- **前置條件**：Group A 已建立課程
- **測試輸入**：「提醒我小明的數學課」
- **預期回覆**：「好的，將在小明數學課開始前30分鐘提醒您 ✅」
- **實際回覆**：（待填）
- **測試結果**：（待填）
- **問題分析**：（待填）

##### B3.1-B 自訂提醒時間（測試目的：驗證提醒時間自訂）
- **前置條件**：Group A 已建立課程
- **測試輸入**：「Lumi鋼琴課前1小時提醒我」
- **預期回覆**：「好的，將在Lumi鋼琴課開始前60分鐘提醒您 ✅」
<!-- @expectedCode: MISSING_STUDENT -->
<!-- @expectedSuccess: false -->
- **實際回覆**：（待填）
- **測試結果**：（待填）
- **問題分析**：（待填）

#### B3.2 提醒異常處理

##### B3.2-A 不存在課程提醒（測試目的：驗證提醒設定校驗）
- **測試輸入**：「提醒我小明的物理課」
- **預期回覆**：「找不到小明的物理課，請確認課程資訊或先新增課程」
<!-- @expectedCode: NOT_FOUND -->
<!-- @expectedSuccess: false -->
- **實際回覆**：（待填）
- **測試結果**：（待填）
- **問題分析**：（待填）

---

## Group C: 複雜操作測試（8個用例）

> **前置條件**：需要Group A + Group B的完整數據環境

### C1. 修改課程功能（3個用例）

#### C1.1 基本修改場景

##### C1.1-A 修改課程時間（測試目的：驗證時間修改功能）
- **前置條件**：Group A 已建立課程
- **測試輸入**：「小明的數學課改到下午4點」
- **預期回覆**：「✅ 已將小明的數學課時間修改為下午4:00」
<!-- @expectedSuccess: false -->
- **實際回覆**：（待填）
- **測試結果**：（待填）
- **問題分析**：（待填）

##### C1.1-B 修改每日重複課程時間（測試目的：驗證每日重複課程修改）
- **前置條件**：Group A 已建立每日重複課程
- **測試輸入**：「小明每天的晨練課改到早上7點」
- **預期回覆**：「請問是要修改所有每天的晨練課時間，還是只修改今天？🔘 修改所有重複課程 🔘 只修改今天」
<!-- @expectedSuccess: false -->
<!-- @expectedCode: NOT_MODIFIABLE_NO_CONTEXT -->
- **實際回覆**：（待填）
- **測試結果**：（待填）
- **問題分析**：（待填）

##### C1.1-C 修改重複課程類型（測試目的：驗證重複規則修改）
- **前置條件**：Group A 已建立每週重複課程
- **測試輸入**：「Lumi的鋼琴課改成每天下午3點」
- **預期回覆**：「✅ 已將Lumi的鋼琴課修改為：🔄 每天 下午15:00」
- **實際回覆**：（待填）
- **測試結果**：（待填）
- **問題分析**：（待填）

### C2. 取消課程功能（4個用例）

#### C2.1 標準取消場景

##### C2.1-A 取消單次課程（測試目的：驗證單次課程刪除）
- **前置條件**：Group A 已建立單次課程
- **測試輸入**：「取消小明明天的數學課」
- **預期回覆**：若資料不存在則回 NOT_FOUND；存在則給出確認或直接刪除成功提示（依現行UX）
<!-- @expectedSuccess: false -->
- **實際回覆**：（待填）
- **測試結果**：（待填）
- **問題分析**：（待填）

##### C2.1-B 取消每日重複課程（測試目的：驗證每日重複課程取消選項）
- **前置條件**：Group A 已建立每日重複課程
- **測試輸入**：「取消小明的晨練課」
- **預期回覆**：「請問是要取消哪個範圍？🔘 只取消今天 🔘 取消明天起所有課程 🔘 刪除整個重複課程」
<!-- @expectedCode: RECURRING_CANCEL_OPTIONS -->
<!-- @expectedSuccess: false -->
- **實際回覆**：（待填）
- **測試結果**：（待填）
- **問題分析**：（待填）

##### C2.1-C 取消部分每日重複課程（測試目的：驗證部分時間範圍取消）
- **前置條件**：Group A 已建立每日重複課程
- **測試輸入**：「取消小明下週的晨練課」
- **預期回覆**：「已取消小明下週（YYYY/MM/DD - YYYY/MM/DD）的晨練課，其他時間的課程保持不變 ✅」
<!-- @expectedCode: RECURRING_CANCEL_OPTIONS -->
<!-- @expectedSuccess: false -->
- **實際回覆**：（待填）
- **測試結果**：（待填）
- **問題分析**：（待填）

##### C2.1-D 重複課程類型區分取消（測試目的：驗證不同重複類型的取消處理）
- **前置條件**：Group A 已建立不同重複類型課程
- **測試序列**：
  1. 輸入：「取消小明每天的晨練課」
  2. 輸入：「取消Lumi每週三的鋼琴課」
- **預期回覆**：每種重複類型都應提供適當的取消選項
<!-- @expectedCode: RECURRING_CANCEL_OPTIONS -->
<!-- @expectedSuccess: false -->
- **實際回覆**：（待填）
- **測試結果**：（待填）
- **問題分析**：（待填）

### C3. 系統級測試（1個用例）

#### C3.1 併發處理測試

##### C3.1-A 併發用戶操作（測試目的：驗證併發處理能力）
- **測試方法**：同時發送3個不同測試用戶的課程查詢請求
- **預期結果**：所有請求正確處理，無數據混淆
- **實際結果**：（待填）
- **測試結果**：（待填）
- **問題分析**：（待填）

---

## 執行計畫與數據管理

### 階段執行順序
```
準備階段 → Group A → Group B → Group C → 清理階段
```

### 數據準備腳本
- **setup-test-environment.js** - 環境初始化
- **cleanup-test-data.js** - 測試數據清理
- **verify-prerequisites.js** - 前置條件檢查

### 測試數據標準
- 測試用戶ID：`U_test_user_qa`
- 學生名稱前綴：`測試*`
- 課程名稱前綴：`測試*`

### 執行時程
- **Group A**：預計1小時（23個用例）
- **Group B**：預計0.75小時（14個用例，包含數據驗證）
- **Group C**：預計0.4小時（8個用例）
- **總計**：2.15小時

### 品質指標
- **Group A 通過率目標**：≥90%
- **Group B 通過率目標**：≥85%
- **Group C 通過率目標**：≥80%
- **整體功能覆蓋率**：≥95%

---

## 已知問題與限制

### 🚨 已知功能缺陷
1. **圖片上傳功能** - LINE Bot API 404錯誤，功能完全失效

### ✅ 已修復功能
1. **每日重複課程** - calculateNextCourseDate() 已實現每日循環邏輯
2. **每月重複課程** - 每月重複基礎功能已完整實現並可用

### ⚠️ 測試限制
1. **API限制** - 測試間隔2-3秒避免服務端過載
2. **數據隔離** - 測試數據使用特定前綴，避免污染生產資料
3. **環境依賴** - 需要Firebase、Google Calendar、Redis等服務正常運行

**總計測試用例：45個** (實際統計修正)
**重點更新**：
- ✅ 每日重複課程功能已實現 (v1.3.4)
- 🔧 功能開關測試 (ENABLE_DAILY_RECURRING)
- 📊 重複課程類型區分測試 (daily/weekly/monthly)
- 🔄 重複課程查詢、修改、取消完整測試

**預計執行時間：2.2小時**
**核心改進：階段式架構 + 數據管理 + 重複課程功能擴展**