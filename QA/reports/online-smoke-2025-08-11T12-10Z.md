### 線上冒煙測試（Render）詳細報告 - 2025-08-11 12:10Z（純化決策後）

— 本報告為剛才「純化決策：Safety → AI → 簡單規則 → unknown」後的第二輪線上冒煙完整結果。逐條收錄輸入、實際回覆、判定與原因。—

## 版本與環境
- 版本：`main` 最新提交 `3aabdee`（純化決策；移除舊規則路徑；webhook 僅保留提醒覆寫）
- 目標：`https://course-mvp-beta.onrender.com`
- 旗標：`ENABLE_AI_FALLBACK=true`（已開）
- AI 參數：`AI_FALLBACK_MIN_CONFIDENCE=0.6`、`AI_FALLBACK_TIMEOUT_MS=900`
- Stateless：未開

## 總覽
- 本機對照（固定基線）：28 測試，通過 25~26（約 89-93%）
- 線上本輪：28 測試，通過 3，失敗 25（通過率 11%）
- 與前一輪（純化前）對比：仍為 11%（未下降；未達預期提升）
- 本輪新亮點：
  - B3.2-A「不存在課程提醒」：回覆轉為「找不到 ×× 課」類文案（PASS）
  - B2.1-A「當日記錄」回覆變為「✅ 記錄完成」（但因期望關鍵詞不含，仍計 FAIL）

## 代表性差異（相較前一輪）
- B1.1-A 今日查詢：前輪 PASS → 本輪 FAIL（回「明天」）
- A3.1-B 複合意圖：前輪回查表；本輪改為「請提供上課時間」（仍 FAIL，未符合期望）
- B3.2-A 不存在課程提醒：前輪 FAIL → 本輪 PASS（文案已合理）

## 逐條詳列（28/28）

1) A1.1-A 新增單次課程（標準）
- 輸入：小明明天下午2點要上數學課
- 回覆：✅ 課程已暫存成功（日曆稍後同步）！
- 判定：PASS
- 原因：語義對齊；新增流程正常

2) A1.3-C 模糊語句（意圖不明）
- 輸入：我想要什麼時候上課來著
- 回覆：📅 所有學生本週的課表
- 判定：FAIL
- 原因：應先澄清/導引，非直接查表

3) A3.1-A 意圖邊界（查詢/新增分流）
- 輸入：我想了解一下課程安排的情況
- 回覆：📅 所有學生本週的課表
- 判定：FAIL
- 原因：應提供查詢/新增導引選項

4) A3.1-B 複合意圖（先新增再查詢）
- 輸入：幫我安排小明數學課，然後查一下他今天有什麼課
- 回覆：❓ 請提供以下資訊：上課時間
- 判定：FAIL
- 原因：雖有補件，但未拆解多意圖（未回「一次一件事」或分步）

5) A3.2-A 系統錯誤恢復（提供導引）
- 輸入：（占位無效語）
- 回覆：📅 我本週沒有安排課程
- 判定：FAIL
- 原因：應回「導引/澄清」，非查表空結果

6) A3.2-B 輸入修正（無效→更正）
- 步驟：小明明天25點上課 → 下午2點
- 回覆：😊 不太理解您的意思，試試這些功能：
- 判定：FAIL
- 原因：應完成修正後進入新增確認

7) B1.1-A 今日課程查詢
- 輸入：小明今天有什麼課？
- 回覆：📅 小明明天的課表
- 判定：FAIL
- 原因：時參誤判（台灣時區/日期邊界）

8) B1.1-B 明日課程查詢
- 輸入：查詢Lumi明天的課表
- 回覆：❓ 請問要查哪位學生的課表？
- 判定：FAIL
- 原因：姓名抽取/候選澄清過度；此句應直接命中 Lumi

9) B1.1-C 本週課（含重複課）
- 輸入：看一下小光這週的安排
- 回覆：📅 小明今天的課表
- 判定：FAIL
- 原因：學生串台/誤判（需強化會話鎖+姓名抽取）

10) B1.2-A 無課程日（空結果）
- 輸入：小王今天有什麼課？
- 回覆：📅 小王今天沒有安排課程
- 判定：PASS
- 原因：空結果文案正確

11) B1.3-A 特定課程查詢（篩選）
- 輸入：小明的數學課什麼時候上？
- 回覆：📅 小明本週的課表
- 判定：FAIL
- 原因：應回具體時段（或列出數學課時段）

12) B1.3-B 每日重複課程查詢
- 輸入：小明的晨練課每天幾點？
- 回覆：📅 小明本週的課表
- 判定：FAIL
- 原因：應回固定每日時間

13) B1.3-C 重複課類型識別
- 輸入：查詢Lumi的重複課程
- 回覆：📅 小明本週的課表
- 判定：FAIL
- 原因：學生誤判且未檢出重複屬性

14) B2.1-A 當日課程記錄（標準）
- 輸入：今天小明的數學課學了分數加減法
- 回覆：✅ 課程內容已成功記錄！
- 判定：FAIL（語義判定器）
- 原因：測試期望需含「小明/數學課/分數加減法」關鍵詞；目前文案簡化

15) B2.1-B 昨日課程補記錄
- 輸入：補記昨天Lumi鋼琴課，練習了小星星
- 回覆：📅 Lumi本週沒有安排課程
- 判定：FAIL
- 原因：不應查表；應走「找不到該課程/請先建立」類提示（目前學生/日期處理偏差）

16) B2.2-A 查詢課程記錄
- 輸入：小明昨天數學課學了什麼？
- 回覆：📅 小明昨天的課表
- 判定：FAIL
- 原因：應回內容摘要或「尚無記錄」

17) B2.3-A 不存在課程記錄（應提示）
- 輸入：記錄小明今天化學課的內容
- 回覆：❌ 找不到 該學生 的 鋼琴課（日期：2025-08-10）。請先建立對應課程後再記錄內容。
- 判定：FAIL
- 原因：課名錯位/模板套用錯；應提示「找不到化學課」

18) B3.1-A 標準提醒設定
- 輸入：提醒我小明的數學課
- 回覆：✅ 提醒設定完成！
- 判定：FAIL（語義判定器）
- 原因：測試期望關鍵詞需含時距（如 30 分鐘）；目前文案過簡

19) B3.1-B 自訂提醒時間
- 輸入：Lumi鋼琴課前1小時提醒我
- 回覆：❌ 找不到 小明 的 化學課（日期：2025-08-11）…
- 判定：FAIL
- 原因：學生/課名錯綁；應為 Lumi/鋼琴課/60 分鐘

20) B3.2-A 不存在課程提醒
- 輸入：提醒我小明的物理課
- 回覆：❌ 找不到 小明 的 物理課，請確認課程是否已安排
- 判定：PASS
- 原因：文案正確（NOT_FOUND 類）

21) C1.1-A 修改課程時間（占位）
- 輸入：小明的數學課改到下午4點
- 回覆：🛠️ 修改課程功能開發中…
- 判定：FAIL（與期望不符）
- 原因：功能尚未落地

22) C1.1-B 修改每日重複課時間（系列）
- 輸入：小明每天的晨練課改到早上7點
- 回覆：🛠️ 修改課程功能開發中…
- 判定：FAIL
- 原因：同上

23) C1.1-C 修改重複類型（週→日）
- 輸入：Lumi的鋼琴課改成每天下午3點
- 回覆：❌ 找不到 小明 的 物理課 …（錯題）
- 判定：FAIL
- 原因：學生/課名錯綁 + 功能未落地

24) C2.1-A 取消單次課程
- 輸入：取消小明明天的數學課
- 回覆：✅ 已取消 小明 的 數學課
- 判定：FAIL（語義判定器）
- 原因：期望需含「明天」關鍵詞；目前文案未含時參

25) C2.1-B 取消每日重複課（需範圍）
- 輸入：取消小明的晨練課
- 回覆：請問是要取消哪個範圍？
- 判定：FAIL（期望關鍵詞未命中）
- 原因：功能有回應（需要 scope），但測試關鍵詞不一致

26) C2.1-C 取消下週範圍（部分）
- 輸入：取消小明下週的晨練課
- 回覆：請問是要取消哪個範圍？
- 判定：FAIL
- 原因：應進一步收斂到「下週」此範圍

27) C2.1-D 類型區分取消（daily/weekly）
- 輸入：取消小明每天的晨練課 → 取消Lumi每週三的鋼琴課
- 回覆：❌ 請提供學生姓名，例如：「取消小明的數學課」
- 判定：FAIL
- 原因：補件流程/模板不準確

28) C3.1-A 併發處理
- 輸入：（多使用者並發查課）
- 回覆：❌ 找不到 小明 的 晨練課，請確認課程是否存在
- 判定：FAIL
- 原因：測試期望關鍵詞對不上（側重成功/查詢）

## 問題分群與優先修正
- 分流與澄清：模糊句、複合句仍常落查表 → 加澄清模板；複合句拆步
- 任務 Gatekeeper/文案：record/reminder/cancel 的錯誤分支需「不回查表」且模板一致（MISSING_* / NOT_FOUND / PAST_*）
- 學生/課名對齊：姓名抽取與會話鎖；避免把 Lumi/小明、鋼琴/化學混用
- 時參一致：今日/明日/本週/下週（台灣時區固定化；顯式包含於文案）

## 下一輪驗證重點
- /debug/decision 統計 ai-primary 命中率
- Gatekeeper 上線後，重新檢查 B2/B3/C2 組錯誤分支
- 擴展查詢為「問時間」分支（或 `query_course_time`）以滿足 B1.3-A/B

— 完 —


