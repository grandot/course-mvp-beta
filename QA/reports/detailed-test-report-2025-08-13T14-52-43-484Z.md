# 統一測試詳細報告 (2025-08-13T14-52-43-484Z)

## 摘要
- 本機：共 28，通過 27，失敗 1，通過率 96%
- 線上：共 28，通過 5，失敗 23，通過率 18%
- 本機 vs 線上：一致性 21%、差異數 22

## 用例明細（期望 vs 實際）

### A1.1-A A1.1-A 新增單次課程（標準格式）

**輸入步驟**

```
  1. 小明明天下午2點要上數學課
```

**期望**

- 關鍵詞：確認、小明、數學課、成功
- 預期代碼：ADD_COURSE_OK

**本機結果**

- 總結：✅ 本機 PASS
- 意圖：add_course
- 任務代碼：ADD_COURSE_OK
- 任務成功：✅
- 輸出：

```
✅ 課程已安排成功！

👦 學生：小明
📚 課程：數學課
📅 日期：2025-08-14
🕐 時間：下午2:00
```

| 關鍵詞 | 命中 |
| --- | --- |
| 確認 | ❌ |
| 小明 | ✅ |
| 數學課 | ✅ |
| 成功 | ✅ |

**線上結果**

- 總結：✅ 線上 PASS
- Webhook：200 ✅
- 回覆：

```
✅ 課程已安排成功！
```

| 關鍵詞 | 命中 |
| --- | --- |
| 確認 | ❌ |
| 小明 | ❌ |
| 數學課 | ❌ |
| 成功 | ✅ |

> 本機 vs 線上：一致 ✅

---

### A1.3-C A1.3-C 模糊語句（意圖不明）

**輸入步驟**

```
  1. 我想要什麼時候上課來著
```

**期望**

- 關鍵詞：不太理解、請提供具體
- 預期代碼：UNKNOWN_HELP

**本機結果**

- 總結：❌ 本機 FAIL
- 意圖：query_schedule
- 任務代碼：QUERY_OK
- 任務成功：✅
- 輸出：

```
📅 所有學生本週的課表

📆 8/9 (週六)
  上午7:00 - 晨練課 🔄
  上午8:00 - 晨練課 🔄
  下午3:00 - 鋼琴課 🔄
  下午5:00 - 瑜伽課 🔄

📆 8/10 (週日)
  上午7:00 - 晨練課 🔄
  上午8:00 - 晨練課 🔄
  上午8:00 - 英文課 🔄
  上午8:00 - 英文課 🔄
  上午10:00 - 英文課 🔄
  上午10:00 - 測試英文課 🔄
  上午10:30 - 三十分英文課
  上午10:30 - 十分測試英文課
  下午2:00 - 數學課
  下午2:00 - 小明今天有什麼課？
  下午2:00 - 測試小明今天有什麼課？
  下午2:00 - 測試數學課
  下午2:00 - 數學課
  下午2:00 - 測試數學課
  下午3:00 - 鋼琴課 🔄
  下午3:00 - 測試鋼琴課 🔄
  下午5:00 - 瑜伽課 🔄

📆 8/11 (週一)
  上午7:00 - 晨練課 🔄
  上午8:00 - 英文課 🔄
  上午8:00 - 晨練課 🔄
  上午8:00 - 英文課 🔄
  上午10:00 - 英文課 🔄
  上午10:00 - 測試英文課 🔄
  下午2:00 - 數學課
  下午3:00 - 鋼琴課 🔄
  下午5:00 - 瑜伽課 🔄
  下午7:00 - 游泳課 🔄
  下午8:30 - 鋼琴課
  下午8:30 - 鋼琴課

📆 8/12 (週二)
  上午7:00 - 晨練課 🔄
  上午8:00 - 晨練課 🔄
  上午10:30 - 三十分英文課
  下午2:00 - 數學課
  下午3:00 - 數學課 🔄
  下午3:00 - 鋼琴課 🔄
  下午3:00 - 測試鋼琴課 🔄
  下午5:00 - 瑜伽課 🔄
  下午7:00 - 游泳課 🔄

📆 8/13 (週三)
  上午7:00 - 晨練課 🔄
  上午8:00 - 晨練課 🔄
  下午2:00 - 鋼琴課 🔄
  下午2:00 - 鋼琴課 🔄
  下午3:00 - 鋼琴課 🔄
  下午3:00 - 測試鋼琴課 🔄
  下午5:00 - 瑜伽課 🔄
  下午8:30 - 鋼琴課

📆 8/14 (週四)
  上午7:00 - 晨練課 🔄
  上午8:00 - 晨練課 🔄
  下午2:00 - 數學課
  下午2:00 - 鋼琴課 🔄
  下午2:00 - 鋼琴課 🔄
  下午3:00 - 鋼琴課 🔄
  下午5:00 - 瑜伽課 🔄

📆 8/15 (週五)
  上午7:00 - 晨練課 🔄
  上午8:00 - 晨練課 🔄
  下午3:00 - 鋼琴課 🔄
  下午5:00 - 瑜伽課 🔄
```

| 關鍵詞 | 命中 |
| --- | --- |
| 不太理解 | ❌ |
| 請提供具體 | ❌ |

**線上結果**

- 總結：❌ 線上 FAIL
- Webhook：200 ✅
- 回覆：

```
📅 所有學生本週的課表
```

| 關鍵詞 | 命中 |
| --- | --- |
| 不太理解 | ❌ |
| 請提供具體 | ❌ |

**診斷日誌（重點節點）**
- 🔧 系統行為

```
"message": "🔍 檢查 replyToken: test-reply-token-1755096319258",
"message": "🧪 檢測到測試 token，跳過真實 LINE API 調用",
"message": "📤 [測試模式] 實際業務回覆: 📅 所有學生本週的課表",
```

> 本機 vs 線上：一致 ✅

---

### A3.1-A A3.1-A 意圖邊界（查詢/新增分流）

**輸入步驟**

```
  1. 我想了解一下課程安排的情況
```

**期望**

- 關鍵詞：查詢、新增、指引

**本機結果**

- 總結：✅ 本機 PASS
- 意圖：query_schedule
- 任務代碼：QUERY_OK_EMPTY
- 任務成功：✅
- 輸出：

```
📅 我本週沒有安排課程

🔎 指引：
• 查詢：「小明下週的課表」
• 新增：「小明明天上午10點英文課」
• 記錄：「記錄昨天數學課的內容」
```

| 關鍵詞 | 命中 |
| --- | --- |
| 查詢 | ✅ |
| 新增 | ✅ |
| 指引 | ✅ |

**線上結果**

- 總結：❌ 線上 FAIL
- Webhook：200 ✅
- 回覆：

```
📅 我本週沒有安排課程
```

| 關鍵詞 | 命中 |
| --- | --- |
| 查詢 | ❌ |
| 新增 | ❌ |
| 指引 | ❌ |

**診斷日誌（重點節點）**
- 🎯 意圖識別

```
"message": "🤖 AI 識別意圖: query_schedule 信心度: 1",
```

- 📋 槽位提取

```
"message": "🔍 開始提取 slots - 意圖: query_schedule (用戶: U_test_user_qa)",
"message": "🧠 使用對話上下文增強 slots 提取",
"message": "📊 規則提取置信度: 0.00",
"message": "✅ 最終 slots: { studentName: '我', content: '課程安排的情況' }",
```

- ⚙️ 任務執行

```
"message": "🎯 執行任務: query_schedule",
"message": "📋 接收參數: { studentName: '我', content: '課程安排的情況' }",
"message": "📊 任務執行結果: {",
```

- 🔧 系統行為

```
"message": "🚀 生產用戶，使用真實 LINE Service",
"message": "🔍 檢查 replyToken: test-reply-token-1755096339572",
"message": "🧪 檢測到測試 token，跳過真實 LINE API 調用",
"message": "📤 [測試模式] 實際業務回覆: 📅 我本週沒有安排課程",
```

> 本機 vs 線上：不一致 ❌
> 提示：本機 PASS 但線上 FAIL，建議檢查線上意圖/槽位與回覆模板是否一致、以及環境變數差異。

---

### A3.1-B A3.1-B 複合意圖處理（先新增再查詢）

**輸入步驟**

```
  1. 幫我安排小明數學課，然後查一下他今天有什麼課
```

**期望**

- 關鍵詞：一次、一個、請先、具體

**本機結果**

- 總結：✅ 本機 PASS
- 意圖：add_course
- 任務代碼：VALIDATION_ERROR
- 任務成功：❌
- 輸出：

```
❓ 請提供以下資訊：上課時間

範例：「小明每週三下午3點數學課」
```

| 關鍵詞 | 命中 |
| --- | --- |
| 一次 | ❌ |
| 一個 | ❌ |
| 請先 | ❌ |
| 具體 | ❌ |

**線上結果**

- 總結：❌ 線上 FAIL
- Webhook：200 ✅
- 回覆：

```
📅 我本週沒有安排課程
```

| 關鍵詞 | 命中 |
| --- | --- |
| 一次 | ❌ |
| 一個 | ❌ |
| 請先 | ❌ |
| 具體 | ❌ |

**診斷日誌（重點節點）**
- 🎯 意圖識別

```
"message": "🤖 AI 識別意圖: add_course 信心度: 1",
```

- 📋 槽位提取

```
"message": "🔍 開始提取 slots - 意圖: add_course (用戶: U_test_user_qa)",
"message": "🕒 開始高級時間解析: 幫我安排小明數學課，然後查一下他今天有什麼課",
"message": "❌ 時間解析失敗: 幫我安排小明數學課，然後查一下他今天有什麼課",
"message": "📊 規則提取置信度: 0.00",
"message": "✅ 最終 slots: {",
```

- ⚙️ 任務執行

```
"message": "🎯 執行任務: add_course",
"message": "📋 接收參數: {",
"message": "📊 任務執行結果: {",
"message": "  message: '❓ 請提供以下資訊：上課時間\\n\\n範例：「小明每週三下午3點數學課」',",
"message": "📤 [測試模式] 實際業務回覆: ❓ 請提供以下資訊：上課時間",
"message": "{\"ts\":\"2025-08-13T14:45:59.873Z\",\"lvl\":\"info\",\"direction\":\"outbound\",\"channel\":\"line\",\"traceId\":\"line_1755096356624_9tvonl\",\"userId\":\"U_test_user_qa\",\"textOut\":\"❓ 請提供以下資訊：上課時間\\n\\n範例：「小明每週三下午3點數學課」\",\"quickReply\":false}",
```

- ❌ 錯誤信息

```
"message": "  code: 'VALIDATION_ERROR',",
"message": "{\"ts\":\"2025-08-13T14:45:59.538Z\",\"lvl\":\"info\",\"stage\":\"task\",\"traceId\":\"line_1755096356624_9tvonl\",\"userId\":\"U_test_user_qa\",\"intent\":\"add_course\",\"success\":false,\"code\":\"VALIDATION_ERROR\",\"latencyMs\":168}",
```

- 🔧 系統行為

```
"message": "🚀 生產用戶，使用真實 LINE Service",
"message": "🔍 檢查 replyToken: test-reply-token-1755096356325",
"message": "🧪 檢測到測試 token，跳過真實 LINE API 調用",
```

> 本機 vs 線上：不一致 ❌
> 提示：本機 PASS 但線上 FAIL，建議檢查線上意圖/槽位與回覆模板是否一致、以及環境變數差異。

---

### A3.2-A A3.2-A 系統錯誤恢復（提供導引）

**輸入步驟**

```
  1. （觸發系統錯誤的占位輸入）
```

**期望**

- 關鍵詞：導引、請提供、具體
- 預期代碼：UNKNOWN_HELP

**本機結果**

- 總結：✅ 本機 PASS
- 意圖：unknown
- 任務代碼：UNKNOWN_HELP
- 任務成功：✅
- 輸出：

```
😊 不太理解您的意思，試試這些功能：

• 新增課程：「小明明天上午10點英文課」
• 查詢課程：「查詢小明的課表」  
• 記錄內容：「記錄昨天數學課的內容」
• 設定提醒：「設定提醒」

💡 您也可以直接告訴我想要做什麼，我會盡力幫助您！
```

| 關鍵詞 | 命中 |
| --- | --- |
| 導引 | ❌ |
| 請提供 | ❌ |
| 具體 | ❌ |

**線上結果**

- 總結：❌ 線上 FAIL
- Webhook：200 ✅
- 回覆：

```
❌ 目前不支援「correction_intent」功能，請稍後再試
```

| 關鍵詞 | 命中 |
| --- | --- |
| 導引 | ❌ |
| 請提供 | ❌ |
| 具體 | ❌ |

**診斷日誌（重點節點）**
- 📋 槽位提取

```
"message": "🔍 開始提取 slots - 意圖: correction_intent (用戶: U_test_user_qa)",
"message": "🧠 使用對話上下文增強 slots 提取",
"message": "📊 規則提取置信度: 1.00",
"message": "✅ 最終 slots: {}",
```

- ⚙️ 任務執行

```
"message": "📤 [測試模式] 實際業務回覆: ❓ 請提供以下資訊：上課時間",
"message": "{\"ts\":\"2025-08-13T14:45:59.873Z\",\"lvl\":\"info\",\"direction\":\"outbound\",\"channel\":\"line\",\"traceId\":\"line_1755096356624_9tvonl\",\"userId\":\"U_test_user_qa\",\"textOut\":\"❓ 請提供以下資訊：上課時間\\n\\n範例：「小明每週三下午3點數學課」\",\"quickReply\":false}",
```

- ❌ 錯誤信息

```
"message": "{\"ts\":\"2025-08-13T14:45:59.538Z\",\"lvl\":\"info\",\"stage\":\"task\",\"traceId\":\"line_1755096356624_9tvonl\",\"userId\":\"U_test_user_qa\",\"intent\":\"add_course\",\"success\":false,\"code\":\"VALIDATION_ERROR\",\"latencyMs\":168}",
"message": "⚠️ 找不到意圖 \"correction_intent\" 的任務處理器",
```

- 🔧 系統行為

```
"message": "🔍 檢查 replyToken: test-reply-token-1755096356325",
"message": "🧪 檢測到測試 token，跳過真實 LINE API 調用",
"message": "🚀 生產用戶，使用真實 LINE Service",
"message": "🔍 檢查 replyToken: test-reply-token-1755096372985",
"message": "🧪 檢測到測試 token，跳過真實 LINE API 調用",
"message": "📤 [測試模式] 實際業務回覆: ❌ 目前不支援「correction_intent」功能，請稍後再試",
```

> 本機 vs 線上：不一致 ❌
> 提示：本機 PASS 但線上 FAIL，建議檢查線上意圖/槽位與回覆模板是否一致、以及環境變數差異。

---

### A3.2-B A3.2-B 輸入修正流程（無效→更正）

**輸入步驟**

```
  1. 小明明天25點上課
  2. 下午2點
```

**期望**

- 關鍵詞：確認、小明

**本機結果**

- 總結：✅ 本機 PASS
- 意圖：unknown
- 任務代碼：UNKNOWN_HELP
- 任務成功：✅
- 輸出：

```
😊 不太理解您的意思，試試這些功能：

• 新增課程：「小明明天上午10點英文課」
• 查詢課程：「查詢小明的課表」  
• 記錄內容：「記錄昨天數學課的內容」
• 設定提醒：「設定提醒」

💡 您也可以直接告訴我想要做什麼，我會盡力幫助您！
```

| 關鍵詞 | 命中 |
| --- | --- |
| 確認 | ❌ |
| 小明 | ✅ |

**線上結果**

- 總結：❌ 線上 FAIL
- Webhook：200 ✅
- 回覆：

```
😊 不太理解您的意思，試試這些功能：
```

| 關鍵詞 | 命中 |
| --- | --- |
| 確認 | ❌ |
| 小明 | ❌ |

**診斷日誌（重點節點）**
- ⚙️ 任務執行

```
"message": "🎯 執行任務: unknown",
"message": "📊 任務執行結果: {",
```

- 🔧 系統行為

```
"message": "🚀 生產用戶，使用真實 LINE Service",
"message": "🔍 檢查 replyToken: test-reply-token-1755096393734",
"message": "🧪 檢測到測試 token，跳過真實 LINE API 調用",
"message": "📤 [測試模式] 實際業務回覆: 😊 不太理解您的意思，試試這些功能：",
```

> 本機 vs 線上：不一致 ❌
> 提示：本機 PASS 但線上 FAIL，建議檢查線上意圖/槽位與回覆模板是否一致、以及環境變數差異。

---

### B1.1-A B1.1-A 今日課程查詢

**輸入步驟**

```
  1. 小明今天有什麼課？
```

**期望**

- 關鍵詞：小明、今天、課表

**本機結果**

- 總結：✅ 本機 PASS
- 意圖：query_schedule
- 任務代碼：QUERY_OK
- 任務成功：✅
- 輸出：

```
📅 小明今天的課表

📆 8/12 (週二)
  上午7:00 - 晨練課 🔄
  上午8:00 - 晨練課 🔄
  下午3:00 - 數學課 🔄
```

| 關鍵詞 | 命中 |
| --- | --- |
| 小明 | ✅ |
| 今天 | ✅ |
| 課表 | ✅ |

**線上結果**

- 總結：✅ 線上 PASS
- Webhook：200 ✅
- 回覆：

```
📅 小明今天的課表
```

| 關鍵詞 | 命中 |
| --- | --- |
| 小明 | ✅ |
| 今天 | ✅ |
| 課表 | ✅ |

> 本機 vs 線上：一致 ✅

---

### B1.1-B B1.1-B 明日課程查詢

**輸入步驟**

```
  1. 查詢Lumi明天的課表
```

**期望**

- 關鍵詞：Lumi、明天、課表

**本機結果**

- 總結：✅ 本機 PASS
- 意圖：query_schedule
- 任務代碼：QUERY_OK
- 任務成功：✅
- 輸出：

```
📅 Lumi明天的課表

📆 8/13 (週三)
  下午2:00 - 鋼琴課 🔄
  下午3:00 - 鋼琴課 🔄
  下午5:00 - 瑜伽課 🔄

📆 8/14 (週四)
  下午2:00 - 鋼琴課 🔄
```

| 關鍵詞 | 命中 |
| --- | --- |
| Lumi | ✅ |
| 明天 | ✅ |
| 課表 | ✅ |

**線上結果**

- 總結：❌ 線上 FAIL
- Webhook：200 ✅
- 回覆：

```
❓ 請問要查哪位學生的課表？
```

| 關鍵詞 | 命中 |
| --- | --- |
| Lumi | ❌ |
| 明天 | ❌ |
| 課表 | ✅ |

**診斷日誌（重點節點）**
- 🎯 意圖識別

```
"message": "🤖 AI 識別意圖: query_schedule 信心度: 1",
```

- 📋 槽位提取

```
"message": "🔍 開始提取 slots - 意圖: query_schedule (用戶: U_test_user_qa)",
"message": "🧠 使用對話上下文增強 slots 提取",
"message": "📊 規則提取置信度: 1.00",
"message": "🤖 啟用 AI 輔助提取...",
"message": "✅ 最終 slots: {",
```

- 🔧 系統行為

```
"message": "🔍 檢查 replyToken: test-reply-token-1755096412680",
"message": "🧪 檢測到測試 token，跳過真實 LINE API 調用",
"message": "📤 [測試模式] 實際業務回覆: 📅 小明今天的課表",
"message": "🚀 生產用戶，使用真實 LINE Service",
"message": "🔍 檢查 replyToken: test-reply-token-1755096424084",
"message": "🧪 檢測到測試 token，跳過真實 LINE API 調用",
"message": "📤 [測試模式] 實際業務回覆: ❓ 請問要查哪位學生的課表？",
```

> 本機 vs 線上：不一致 ❌
> 提示：本機 PASS 但線上 FAIL，建議檢查線上意圖/槽位與回覆模板是否一致、以及環境變數差異。

---

### B1.1-C B1.1-C 本週課程查詢（含重複課）

**輸入步驟**

```
  1. 看一下小光這週的安排
```

**期望**

- 關鍵詞：小光、這週、課表

**本機結果**

- 總結：✅ 本機 PASS
- 意圖：query_schedule
- 任務代碼：QUERY_OK
- 任務成功：✅
- 輸出：

```
📅 小光本週的課表

📆 8/10 (週日)
  上午10:00 - 英文課 🔄
  上午10:30 - 三十分英文課

📆 8/11 (週一)
  上午10:00 - 英文課 🔄

📆 8/12 (週二)
  上午10:30 - 三十分英文課
```

| 關鍵詞 | 命中 |
| --- | --- |
| 小光 | ✅ |
| 這週 | ❌ |
| 課表 | ✅ |

**線上結果**

- 總結：❌ 線上 FAIL
- Webhook：200 ✅
- 回覆：

```
📅 小明今天的課表
```

| 關鍵詞 | 命中 |
| --- | --- |
| 小光 | ❌ |
| 這週 | ❌ |
| 課表 | ✅ |

**診斷日誌（重點節點）**
- 🎯 意圖識別

```
"message": "🤖 AI 識別意圖: query_schedule 信心度: 1",
```

- 📋 槽位提取

```
"message": "📊 規則提取置信度: 1.00",
"message": "🤖 啟用 AI 輔助提取...",
"message": "✅ 最終 slots: {",
"message": "🔍 開始提取 slots - 意圖: query_schedule (用戶: U_test_user_qa)",
"message": "🧠 使用對話上下文增強 slots 提取",
"message": "📊 規則提取置信度: 0.50",
"message": "🤖 啟用 AI 輔助提取...",
"message": "✅ 最終 slots: {",
```

- 🔧 系統行為

```
"message": "🔍 檢查 replyToken: test-reply-token-1755096424084",
"message": "🧪 檢測到測試 token，跳過真實 LINE API 調用",
"message": "📤 [測試模式] 實際業務回覆: ❓ 請問要查哪位學生的課表？",
"message": "🚀 生產用戶，使用真實 LINE Service",
"message": "🔍 檢查 replyToken: test-reply-token-1755096440653",
"message": "🧪 檢測到測試 token，跳過真實 LINE API 調用",
"message": "📤 [測試模式] 實際業務回覆: ❓ 請問要查哪位學生的課表？",
```

> 本機 vs 線上：不一致 ❌
> 提示：本機 PASS 但線上 FAIL，建議檢查線上意圖/槽位與回覆模板是否一致、以及環境變數差異。

---

### B1.2-A B1.2-A 無課程日查詢（空結果）

**輸入步驟**

```
  1. 小王今天有什麼課？
```

**期望**

- 關鍵詞：沒有安排課程
- 預期代碼：QUERY_OK_EMPTY

**本機結果**

- 總結：✅ 本機 PASS
- 意圖：query_schedule
- 任務代碼：QUERY_OK_EMPTY
- 任務成功：✅
- 輸出：

```
📅 小王今天沒有安排課程

🔎 指引：
• 查詢：「小明下週的課表」
• 新增：「小明明天上午10點英文課」
• 記錄：「記錄昨天數學課的內容」
```

| 關鍵詞 | 命中 |
| --- | --- |
| 沒有安排課程 | ✅ |

**線上結果**

- 總結：❌ 線上 FAIL
- Webhook：200 ✅
- 回覆：

```
📅 小明今天的課表
```

| 關鍵詞 | 命中 |
| --- | --- |
| 沒有安排課程 | ❌ |

**診斷日誌（重點節點）**
- 🎯 意圖識別

```
"message": "🤖 AI 識別意圖: query_schedule 信心度: 1",
```

- 📋 槽位提取

```
"message": "🔍 開始提取 slots - 意圖: query_schedule (用戶: U_test_user_qa)",
"message": "🧠 使用對話上下文增強 slots 提取",
"message": "📊 規則提取置信度: 1.00",
"message": "🤖 啟用 AI 輔助提取...",
"message": "✅ 最終 slots: { studentName: '小王', timeReference: 'today', content: '課程' }",
```

- ⚙️ 任務執行

```
"message": "🎯 執行任務: query_schedule",
"message": "📋 接收參數: { studentName: '小王', timeReference: 'today', content: '課程' }",
"message": "📊 任務執行結果: {",
```

- 🔧 系統行為

```
"message": "🚀 生產用戶，使用真實 LINE Service",
"message": "🔍 檢查 replyToken: test-reply-token-1755096457727",
"message": "🧪 檢測到測試 token，跳過真實 LINE API 調用",
"message": "📤 [測試模式] 實際業務回覆: 📅 小王今天沒有安排課程",
```

> 本機 vs 線上：不一致 ❌
> 提示：本機 PASS 但線上 FAIL，建議檢查線上意圖/槽位與回覆模板是否一致、以及環境變數差異。

---

### B1.3-A B1.3-A 特定課程查詢（篩選）

**輸入步驟**

```
  1. 小明的數學課什麼時候上？
```

**期望**

- 關鍵詞：小明、數學課、時間

**本機結果**

- 總結：✅ 本機 PASS
- 意圖：query_schedule
- 任務代碼：QUERY_OK
- 任務成功：✅
- 輸出：

```
📅 小明本週的課表

📆 8/9 (週六)
  上午7:00 - 晨練課 🔄
  上午8:00 - 晨練課 🔄

📆 8/10 (週日)
  上午7:00 - 晨練課 🔄
  上午8:00 - 晨練課 🔄
  上午8:00 - 英文課 🔄
  下午2:00 - 數學課
  下午2:00 - 小明今天有什麼課？

📆 8/11 (週一)
  上午7:00 - 晨練課 🔄
  上午8:00 - 英文課 🔄
  上午8:00 - 晨練課 🔄
  下午2:00 - 數學課
  下午7:00 - 游泳課 🔄

📆 8/12 (週二)
  上午7:00 - 晨練課 🔄
  上午8:00 - 晨練課 🔄
  下午2:00 - 數學課
  下午3:00 - 數學課 🔄
  下午7:00 - 游泳課 🔄

📆 8/13 (週三)
  上午7:00 - 晨練課 🔄
  上午8:00 - 晨練課 🔄

📆 8/14 (週四)
  上午7:00 - 晨練課 🔄
  上午8:00 - 晨練課 🔄
  下午2:00 - 數學課

📆 8/15 (週五)
  上午7:00 - 晨練課 🔄
  上午8:00 - 晨練課 🔄
```

| 關鍵詞 | 命中 |
| --- | --- |
| 小明 | ✅ |
| 數學課 | ✅ |
| 時間 | ❌ |

**線上結果**

- 總結：❌ 線上 FAIL
- Webhook：200 ✅
- 回覆：

```
📅 小明本週的課表
```

| 關鍵詞 | 命中 |
| --- | --- |
| 小明 | ✅ |
| 數學課 | ❌ |
| 時間 | ❌ |

**診斷日誌（重點節點）**
- 🔧 系統行為

```
"message": "🔍 檢查 replyToken: test-reply-token-1755096474416",
"message": "🧪 檢測到測試 token，跳過真實 LINE API 調用",
"message": "📤 [測試模式] 實際業務回覆: 📅 小明本週的課表",
```

> 本機 vs 線上：不一致 ❌
> 提示：本機 PASS 但線上 FAIL，建議檢查線上意圖/槽位與回覆模板是否一致、以及環境變數差異。

---

### B1.3-B B1.3-B 每日重複課程查詢

**輸入步驟**

```
  1. 小明的晨練課每天幾點？
```

**期望**

- 關鍵詞：晨練課、每天、時間

**本機結果**

- 總結：✅ 本機 PASS
- 意圖：query_schedule
- 任務代碼：QUERY_OK
- 任務成功：✅
- 輸出：

```
📅 小明本週的課表

📆 8/9 (週六)
  上午7:00 - 晨練課 🔄
  上午8:00 - 晨練課 🔄

📆 8/10 (週日)
  上午7:00 - 晨練課 🔄
  上午8:00 - 晨練課 🔄

📆 8/11 (週一)
  上午7:00 - 晨練課 🔄
  上午8:00 - 晨練課 🔄

📆 8/12 (週二)
  上午7:00 - 晨練課 🔄
  上午8:00 - 晨練課 🔄

📆 8/13 (週三)
  上午7:00 - 晨練課 🔄
  上午8:00 - 晨練課 🔄

📆 8/14 (週四)
  上午7:00 - 晨練課 🔄
  上午8:00 - 晨練課 🔄

📆 8/15 (週五)
  上午7:00 - 晨練課 🔄
  上午8:00 - 晨練課 🔄
```

| 關鍵詞 | 命中 |
| --- | --- |
| 晨練課 | ✅ |
| 每天 | ❌ |
| 時間 | ❌ |

**線上結果**

- 總結：❌ 線上 FAIL
- Webhook：200 ✅
- 回覆：

```
📅 小明本週的課表
```

| 關鍵詞 | 命中 |
| --- | --- |
| 晨練課 | ❌ |
| 每天 | ❌ |
| 時間 | ❌ |

**診斷日誌（重點節點）**
- 🔧 系統行為

```
"message": "🔍 檢查 replyToken: test-reply-token-1755096493556",
"message": "🧪 檢測到測試 token，跳過真實 LINE API 調用",
"message": "📤 [測試模式] 實際業務回覆: 📅 小明本週的課表",
```

> 本機 vs 線上：不一致 ❌
> 提示：本機 PASS 但線上 FAIL，建議檢查線上意圖/槽位與回覆模板是否一致、以及環境變數差異。

---

### B1.3-C B1.3-C 重複課類型識別查詢

**輸入步驟**

```
  1. 查詢Lumi的重複課程
```

**期望**

- 關鍵詞：Lumi、重複課程、課表

**本機結果**

- 總結：✅ 本機 PASS
- 意圖：query_schedule
- 任務代碼：QUERY_OK_EMPTY
- 任務成功：✅
- 輸出：

```
📅 Lumi本週沒有安排課程

🔎 指引：
• 查詢：「小明下週的課表」
• 新增：「小明明天上午10點英文課」
• 記錄：「記錄昨天數學課的內容」
```

| 關鍵詞 | 命中 |
| --- | --- |
| Lumi | ✅ |
| 重複課程 | ❌ |
| 課表 | ✅ |

**線上結果**

- 總結：❌ 線上 FAIL
- Webhook：200 ✅
- 回覆：

```
📅 Lumi本週沒有安排課程
```

| 關鍵詞 | 命中 |
| --- | --- |
| Lumi | ✅ |
| 重複課程 | ❌ |
| 課表 | ❌ |

**診斷日誌（重點節點）**
- 🎯 意圖識別

```
"message": "🤖 AI 識別意圖: query_schedule 信心度: 1",
```

- 📋 槽位提取

```
"message": "🔍 開始提取 slots - 意圖: query_schedule (用戶: U_test_user_qa)",
"message": "🧠 使用對話上下文增強 slots 提取",
"message": "📊 規則提取置信度: 0.50",
"message": "🤖 啟用 AI 輔助提取...",
"message": "✅ 最終 slots: { studentName: 'Lumi', courseName: '重複課' }",
```

- ⚙️ 任務執行

```
"message": "🎯 執行任務: query_schedule",
"message": "📋 接收參數: { studentName: 'Lumi', courseName: '重複課' }",
"message": "📊 任務執行結果: {",
```

- 🔧 系統行為

```
"message": "🚀 生產用戶，使用真實 LINE Service",
"message": "🔍 檢查 replyToken: test-reply-token-1755096511906",
"message": "🧪 檢測到測試 token，跳過真實 LINE API 調用",
"message": "📤 [測試模式] 實際業務回覆: 📅 Lumi本週沒有安排課程",
```

> 本機 vs 線上：不一致 ❌
> 提示：本機 PASS 但線上 FAIL，建議檢查線上意圖/槽位與回覆模板是否一致、以及環境變數差異。

---

### B2.1-A B2.1-A 當日課程記錄（標準）

**輸入步驟**

```
  1. 今天小明的數學課學了分數加減法
```

**期望**

- 關鍵詞：已記錄、小明、數學課、分數加減法

**本機結果**

- 總結：✅ 本機 PASS
- 意圖：add_course
- 任務代碼：VALIDATION_ERROR
- 任務成功：❌
- 輸出：

```
❓ 請提供以下資訊：上課時間

範例：「小明每週三下午3點數學課」
```

| 關鍵詞 | 命中 |
| --- | --- |
| 已記錄 | ❌ |
| 小明 | ✅ |
| 數學課 | ✅ |
| 分數加減法 | ❌ |

**線上結果**

- 總結：❌ 線上 FAIL
- Webhook：200 ✅
- 回覆：

```
✅ 課程內容已成功記錄！
```

| 關鍵詞 | 命中 |
| --- | --- |
| 已記錄 | ❌ |
| 小明 | ❌ |
| 數學課 | ❌ |
| 分數加減法 | ❌ |

**診斷日誌（重點節點）**
- 🎯 意圖識別

```
"message": "🤖 AI 識別意圖: record_content 信心度: 1",
```

- 📋 槽位提取

```
"message": "🔍 開始提取 slots - 意圖: record_content (用戶: U_test_user_qa)",
"message": "🧠 使用對話上下文增強 slots 提取",
"message": "📊 規則提取置信度: 1.00",
"message": "🤖 啟用 AI 輔助提取...",
"message": "✅ 最終 slots: {",
```

- ⚙️ 任務執行

```
"message": "🎯 執行任務: record_content",
"message": "📊 任務執行結果: {",
```

- 🔧 系統行為

```
"message": "🚀 生產用戶，使用真實 LINE Service",
"message": "🔍 檢查 replyToken: test-reply-token-1755096528921",
"message": "🧪 檢測到測試 token，跳過真實 LINE API 調用",
"message": "📤 [測試模式] 實際業務回覆: ✅ 課程內容已成功記錄！",
```

> 本機 vs 線上：不一致 ❌
> 提示：本機 PASS 但線上 FAIL，建議檢查線上意圖/槽位與回覆模板是否一致、以及環境變數差異。

---

### B2.1-B B2.1-B 昨日課程補記錄

**輸入步驟**

```
  1. 補記一下昨天Lumi鋼琴課的內容，練習了小星星
```

**期望**

- 關鍵詞：已記錄、Lumi、鋼琴課、小星星

**本機結果**

- 總結：✅ 本機 PASS
- 意圖：record_content
- 任務代碼：NOT_FOUND
- 任務成功：❌
- 輸出：

```
❌ 找不到 該學生 的 鋼琴課（日期：2025-08-12）。請先建立對應課程後再記錄內容。
```

| 關鍵詞 | 命中 |
| --- | --- |
| 已記錄 | ❌ |
| Lumi | ❌ |
| 鋼琴課 | ✅ |
| 小星星 | ❌ |

**線上結果**

- 總結：❌ 線上 FAIL
- Webhook：200 ✅
- 回覆：

```
📅 Lumi本週沒有安排課程
```

| 關鍵詞 | 命中 |
| --- | --- |
| 已記錄 | ❌ |
| Lumi | ✅ |
| 鋼琴課 | ❌ |
| 小星星 | ❌ |

**診斷日誌（重點節點）**
- 🎯 意圖識別

```
"message": "🤖 AI 識別意圖: record_content 信心度: 1",
```

- 📋 槽位提取

```
"message": "🔍 開始提取 slots - 意圖: record_content (用戶: U_test_user_qa)",
"message": "📊 規則提取置信度: 0.33",
"message": "✅ 最終 slots: { courseName: '鋼琴課', timeReference: 'yesterday', content: '練習了小星星' }",
```

- ⚙️ 任務執行

```
"message": "🎯 執行任務: record_content",
"message": "📊 任務執行結果: {",
```

- 🔧 系統行為

```
"message": "🚀 生產用戶，使用真實 LINE Service",
"message": "🔍 檢查 replyToken: test-reply-token-1755096545286",
"message": "🧪 檢測到測試 token，跳過真實 LINE API 調用",
"message": "📤 [測試模式] 實際業務回覆: ❌ 找不到 該學生 的 鋼琴課（日期：2025-08-12）。請先建立對應課程後再記錄內容。",
```

> 本機 vs 線上：不一致 ❌
> 提示：本機 PASS 但線上 FAIL，建議檢查線上意圖/槽位與回覆模板是否一致、以及環境變數差異。

---

### B2.2-A B2.2-A 查詢課程記錄

**輸入步驟**

```
  1. 小明昨天數學課學了什麼？
```

**期望**

- 關鍵詞：內容、記錄

**本機結果**

- 總結：✅ 本機 PASS
- 意圖：query_schedule
- 任務代碼：QUERY_OK
- 任務成功：✅
- 輸出：

```
📅 小明昨天的課表

📆 8/12 (週二)
  下午2:00 - 數學課
```

| 關鍵詞 | 命中 |
| --- | --- |
| 內容 | ❌ |
| 記錄 | ❌ |

**線上結果**

- 總結：✅ 線上 PASS
- Webhook：200 ✅
- 回覆：

```
✅ 課程內容已成功記錄！
```

| 關鍵詞 | 命中 |
| --- | --- |
| 內容 | ✅ |
| 記錄 | ✅ |

> 本機 vs 線上：一致 ✅

---

### B2.3-A B2.3-A 不存在課程記錄（應提示）

**輸入步驟**

```
  1. 記錄小明今天化學課的內容
```

**期望**

- 關鍵詞：找不到、請確認、先新增
- 預期代碼：NOT_FOUND

**本機結果**

- 總結：✅ 本機 PASS
- 意圖：record_content
- 任務代碼：NOT_FOUND
- 任務成功：❌
- 輸出：

```
❌ 找不到 小明 的 化學課（日期：2025-08-13）。請先建立對應課程後再記錄內容。
```

| 關鍵詞 | 命中 |
| --- | --- |
| 找不到 | ✅ |
| 請確認 | ❌ |
| 先新增 | ❌ |

**線上結果**

- 總結：✅ 線上 PASS
- Webhook：200 ✅
- 任務代碼：NOT_FOUND
- 任務成功：❌
- 回覆：

```
❌ 找不到 小明 的 化學課（日期：2025-08-13）。請先建立對應課程後再記錄內容。
```

| 關鍵詞 | 命中 |
| --- | --- |
| 找不到 | ✅ |
| 請確認 | ❌ |
| 先新增 | ❌ |

> 本機 vs 線上：一致 ✅

---

### B3.1-A B3.1-A 標準提醒設定

**輸入步驟**

```
  1. 提醒我小明的數學課
```

**期望**

- 關鍵詞：提醒、小明、數學課、30分鐘

**本機結果**

- 總結：✅ 本機 PASS
- 意圖：set_reminder
- 任務代碼：REMINDER_SET_OK
- 任務成功：✅
- 輸出：

```
✅ 提醒設定完成！
📚 課程：小明 的 數學課
📅 上課時間：8/20 下午03:00
⏰ 提醒時間：8/20 下午02:30 (提前 30 分鐘)
```

| 關鍵詞 | 命中 |
| --- | --- |
| 提醒 | ✅ |
| 小明 | ✅ |
| 數學課 | ✅ |
| 30分鐘 | ❌ |

**線上結果**

- 總結：❌ 線上 FAIL
- Webhook：200 ✅
- 回覆：

```
✅ 提醒設定完成！
```

| 關鍵詞 | 命中 |
| --- | --- |
| 提醒 | ✅ |
| 小明 | ❌ |
| 數學課 | ❌ |
| 30分鐘 | ❌ |

**診斷日誌（重點節點）**
- 📋 槽位提取

```
"message": "🔍 開始提取 slots - 意圖: set_reminder (用戶: U_test_user_qa)",
"message": "🧠 使用對話上下文增強 slots 提取",
"message": "📊 規則提取置信度: 0.67",
"message": "🤖 啟用 AI 輔助提取...",
"message": "✅ 最終 slots: { studentName: '小明', courseName: '數學課' }",
```

- ⚙️ 任務執行

```
"message": "🎯 執行任務: set_reminder",
"message": "📊 任務執行結果: {",
```

- 🔧 系統行為

```
"message": "🔍 檢查 replyToken: test-reply-token-1755096573407",
"message": "🧪 檢測到測試 token，跳過真實 LINE API 調用",
"message": "📤 [測試模式] 實際業務回覆: ❌ 找不到 小明 的 化學課（日期：2025-08-13）。請先建立對應課程後再記錄內容。",
"message": "🚀 生產用戶，使用真實 LINE Service",
"message": "🔍 檢查 replyToken: test-reply-token-1755096585001",
"message": "🧪 檢測到測試 token，跳過真實 LINE API 調用",
"message": "📤 [測試模式] 實際業務回覆: ✅ 提醒設定完成！",
```

> 本機 vs 線上：不一致 ❌
> 提示：本機 PASS 但線上 FAIL，建議檢查線上意圖/槽位與回覆模板是否一致、以及環境變數差異。

---

### B3.1-B B3.1-B 自訂提醒時間

**輸入步驟**

```
  1. Lumi鋼琴課前1小時提醒我
```

**期望**

- 關鍵詞：提醒、Lumi、鋼琴課、60分鐘

**本機結果**

- 總結：✅ 本機 PASS
- 意圖：set_reminder
- 任務代碼：MISSING_STUDENT
- 任務成功：❌
- 輸出：

```
❌ 請提供學生姓名，例如：「提醒我小明的數學課」
```

| 關鍵詞 | 命中 |
| --- | --- |
| 提醒 | ✅ |
| Lumi | ❌ |
| 鋼琴課 | ❌ |
| 60分鐘 | ❌ |

**線上結果**

- 總結：❌ 線上 FAIL
- Webhook：200 ✅
- 回覆：

```
❌ 找不到 小明 的 化學課（日期：2025-08-13）。請先建立對應課程後再記錄內容。
```

| 關鍵詞 | 命中 |
| --- | --- |
| 提醒 | ❌ |
| Lumi | ❌ |
| 鋼琴課 | ❌ |
| 60分鐘 | ❌ |

**診斷日誌（重點節點）**
- 📋 槽位提取

```
"message": "🔍 開始提取 slots - 意圖: set_reminder (用戶: U_test_user_qa)",
"message": "📊 規則提取置信度: 0.67",
"message": "🤖 啟用 AI 輔助提取...",
"message": "✅ 最終 slots: { courseName: '鋼琴課', timeReference: '前', reminderTime: 60 }",
```

- ⚙️ 任務執行

```
"message": "🎯 執行任務: set_reminder",
"message": "📊 任務執行結果: {",
```

- 🔧 系統行為

```
"message": "📤 [測試模式] 實際業務回覆: ✅ 提醒設定完成！",
"message": "🚀 生產用戶，使用真實 LINE Service",
"message": "🔍 檢查 replyToken: test-reply-token-1755096600714",
"message": "🧪 檢測到測試 token，跳過真實 LINE API 調用",
"message": "📤 [測試模式] 實際業務回覆: ❌ 請提供學生姓名，例如：「提醒我小明的數學課」",
```

> 本機 vs 線上：不一致 ❌
> 提示：本機 PASS 但線上 FAIL，建議檢查線上意圖/槽位與回覆模板是否一致、以及環境變數差異。

---

### B3.2-A B3.2-A 不存在課程提醒

**輸入步驟**

```
  1. 提醒我小明的物理課
```

**期望**

- 關鍵詞：找不到、小明、物理課
- 預期代碼：NOT_FOUND

**本機結果**

- 總結：✅ 本機 PASS
- 意圖：set_reminder
- 任務代碼：NOT_FOUND
- 任務成功：❌
- 輸出：

```
❌ 找不到 小明 的 物理課，請確認課程是否已安排
```

| 關鍵詞 | 命中 |
| --- | --- |
| 找不到 | ✅ |
| 小明 | ✅ |
| 物理課 | ✅ |

**線上結果**

- 總結：✅ 線上 PASS
- Webhook：200 ✅
- 任務代碼：NOT_FOUND
- 任務成功：❌
- 回覆：

```
❌ 找不到 小明 的 物理課，請確認課程是否已安排
```

| 關鍵詞 | 命中 |
| --- | --- |
| 找不到 | ✅ |
| 小明 | ✅ |
| 物理課 | ✅ |

> 本機 vs 線上：一致 ✅

---

### C1.1-A C1.1-A 修改課程時間（功能待落地）

**輸入步驟**

```
  1. 小明的數學課改到下午4點
```

**期望**

- 關鍵詞：修改、小明、數學課、16:00

**本機結果**

- 總結：✅ 本機 PASS
- 意圖：modify_course
- 任務代碼：VALIDATION_ERROR
- 任務成功：❌
- 輸出：

```
❓ 請提供學生、課程與日期，以便定位要修改的課程
```

| 關鍵詞 | 命中 |
| --- | --- |
| 修改 | ✅ |
| 小明 | ❌ |
| 數學課 | ❌ |
| 16:00 | ❌ |

**線上結果**

- 總結：❌ 線上 FAIL
- Webhook：200 ✅
- 任務代碼：VALIDATION_ERROR
- 任務成功：❌
- 回覆：

```
❓ 請提供學生、課程與日期，以便定位要修改的課程
```

| 關鍵詞 | 命中 |
| --- | --- |
| 修改 | ✅ |
| 小明 | ❌ |
| 數學課 | ❌ |
| 16:00 | ❌ |

**診斷日誌（重點節點）**
- 🎯 意圖識別

```
"message": "🤖 AI 識別意圖: modify_course 信心度: 1",
```

- 📋 槽位提取

```
"message": "🔍 開始提取 slots - 意圖: modify_course (用戶: U_test_user_qa)",
"message": "🕒 開始高級時間解析: 下午4點",
"message": "✅ 時間解析成功: {",
"message": "🧠 使用對話上下文增強 slots 提取",
"message": "📊 規則提取置信度: 0.60",
"message": "🤖 啟用 AI 輔助提取...",
"message": "✅ 最終 slots: {",
```

- ⚙️ 任務執行

```
"message": "🎯 執行任務: modify_course",
"message": "📊 任務執行結果: {",
```

- ❌ 錯誤信息

```
"message": "  code: 'VALIDATION_ERROR',",
"message": "{\"ts\":\"2025-08-13T14:50:29.726Z\",\"lvl\":\"info\",\"stage\":\"task\",\"traceId\":\"line_1755096626530_m7ezhn\",\"userId\":\"U_test_user_qa\",\"intent\":\"modify_course\",\"success\":false,\"code\":\"VALIDATION_ERROR\",\"latencyMs\":161}",
```

- 🔧 系統行為

```
"message": "🚀 生產用戶，使用真實 LINE Service",
"message": "🔍 檢查 replyToken: test-reply-token-1755096626340",
"message": "🧪 檢測到測試 token，跳過真實 LINE API 調用",
"message": "📤 [測試模式] 實際業務回覆: ❓ 請提供學生、課程與日期，以便定位要修改的課程",
```

> 本機 vs 線上：不一致 ❌
> 提示：本機 PASS 但線上 FAIL，建議檢查線上意圖/槽位與回覆模板是否一致、以及環境變數差異。

---

### C1.1-B C1.1-B 修改每日重複課時間（系列操作）

**輸入步驟**

```
  1. 小明每天的晨練課改到早上7點
```

**期望**

- 關鍵詞：修改、每天、07:00、選項

**本機結果**

- 總結：✅ 本機 PASS
- 意圖：modify_course
- 任務代碼：VALIDATION_ERROR
- 任務成功：❌
- 輸出：

```
❓ 請提供學生、課程與日期，以便定位要修改的課程
```

| 關鍵詞 | 命中 |
| --- | --- |
| 修改 | ✅ |
| 每天 | ❌ |
| 07:00 | ❌ |
| 選項 | ❌ |

**線上結果**

- 總結：❌ 線上 FAIL
- Webhook：200 ✅
- 回覆：

```
❌ 請提供學生姓名，例如：「提醒我小明的數學課」
```

| 關鍵詞 | 命中 |
| --- | --- |
| 修改 | ❌ |
| 每天 | ❌ |
| 07:00 | ❌ |
| 選項 | ❌ |

**診斷日誌（重點節點）**
- 🎯 意圖識別

```
"message": "🤖 AI 識別意圖: modify_course 信心度: 1",
```

- 📋 槽位提取

```
"message": "🔍 開始提取 slots - 意圖: modify_course (用戶: U_test_user_qa)",
"message": "🕒 開始高級時間解析: 上7點",
"message": "✅ 時間解析成功: {",
"message": "🧠 使用對話上下文增強 slots 提取",
"message": "📊 規則提取置信度: 0.60",
"message": "🤖 啟用 AI 輔助提取...",
"message": "✅ 最終 slots: {",
```

- ⚙️ 任務執行

```
"message": "🎯 執行任務: modify_course",
"message": "📊 任務執行結果: {",
```

- ❌ 錯誤信息

```
"message": "  code: 'VALIDATION_ERROR',",
"message": "{\"ts\":\"2025-08-13T14:50:46.148Z\",\"lvl\":\"info\",\"stage\":\"task\",\"traceId\":\"line_1755096643645_iwo5pi\",\"userId\":\"U_test_user_qa\",\"intent\":\"modify_course\",\"success\":false,\"code\":\"VALIDATION_ERROR\",\"latencyMs\":171}",
```

- 🔧 系統行為

```
"message": "🚀 生產用戶，使用真實 LINE Service",
"message": "🔍 檢查 replyToken: test-reply-token-1755096643328",
"message": "🧪 檢測到測試 token，跳過真實 LINE API 調用",
"message": "📤 [測試模式] 實際業務回覆: ❓ 請提供學生、課程與日期，以便定位要修改的課程",
```

> 本機 vs 線上：不一致 ❌
> 提示：本機 PASS 但線上 FAIL，建議檢查線上意圖/槽位與回覆模板是否一致、以及環境變數差異。

---

### C1.1-C C1.1-C 修改重複類型（週→日）

**輸入步驟**

```
  1. Lumi的鋼琴課改成每天下午3點
```

**期望**

- 關鍵詞：修改、每天、15:00

**本機結果**

- 總結：✅ 本機 PASS
- 意圖：modify_course
- 任務代碼：VALIDATION_ERROR
- 任務成功：❌
- 輸出：

```
❓ 請提供學生、課程與日期，以便定位要修改的課程
```

| 關鍵詞 | 命中 |
| --- | --- |
| 修改 | ✅ |
| 每天 | ❌ |
| 15:00 | ❌ |

**線上結果**

- 總結：❌ 線上 FAIL
- Webhook：200 ✅
- 回覆：

```
❓ 請提供學生、課程與日期，以便定位要修改的課程
```

| 關鍵詞 | 命中 |
| --- | --- |
| 修改 | ✅ |
| 每天 | ❌ |
| 15:00 | ❌ |

**診斷日誌（重點節點）**
- 🎯 意圖識別

```
"message": "🤖 AI 識別意圖: modify_course 信心度: 1",
```

- 📋 槽位提取

```
"message": "🔍 開始提取 slots - 意圖: modify_course (用戶: U_test_user_qa)",
"message": "🕒 開始高級時間解析: 下午3點",
"message": "✅ 時間解析成功: {",
"message": "🧠 使用對話上下文增強 slots 提取",
"message": "📊 規則提取置信度: 0.60",
"message": "🤖 啟用 AI 輔助提取...",
"message": "✅ 最終 slots: {",
```

- ⚙️ 任務執行

```
"message": "🎯 執行任務: modify_course",
"message": "📊 任務執行結果: {",
```

- ❌ 錯誤信息

```
"message": "  code: 'VALIDATION_ERROR',",
"message": "{\"ts\":\"2025-08-13T14:51:02.605Z\",\"lvl\":\"info\",\"stage\":\"task\",\"traceId\":\"line_1755096660046_jymbl6\",\"userId\":\"U_test_user_qa\",\"intent\":\"modify_course\",\"success\":false,\"code\":\"VALIDATION_ERROR\",\"latencyMs\":160}",
```

- 🔧 系統行為

```
"message": "🚀 生產用戶，使用真實 LINE Service",
"message": "🔍 檢查 replyToken: test-reply-token-1755096659734",
"message": "🧪 檢測到測試 token，跳過真實 LINE API 調用",
"message": "📤 [測試模式] 實際業務回覆: ❓ 請提供學生、課程與日期，以便定位要修改的課程",
```

> 本機 vs 線上：不一致 ❌
> 提示：本機 PASS 但線上 FAIL，建議檢查線上意圖/槽位與回覆模板是否一致、以及環境變數差異。

---

### C2.1-A C2.1-A 取消單次課程

**輸入步驟**

```
  1. 取消小明明天的數學課
```

**期望**

- 關鍵詞：取消、小明、明天、數學課

**本機結果**

- 總結：✅ 本機 PASS
- 意圖：cancel_course
- 任務代碼：NOT_FOUND
- 任務成功：❌
- 輸出：

```
❌ 找不到 小明 的 數學課，請確認課程是否存在
```

| 關鍵詞 | 命中 |
| --- | --- |
| 取消 | ❌ |
| 小明 | ✅ |
| 明天 | ❌ |
| 數學課 | ✅ |

**線上結果**

- 總結：❌ 線上 FAIL
- Webhook：200 ✅
- 任務代碼：NOT_FOUND
- 任務成功：❌
- 回覆：

```
❌ 找不到 小明 的 數學課，請確認課程是否存在
```

| 關鍵詞 | 命中 |
| --- | --- |
| 取消 | ❌ |
| 小明 | ✅ |
| 明天 | ❌ |
| 數學課 | ✅ |

**診斷日誌（重點節點）**
- 📋 槽位提取

```
"message": "🔍 開始提取 slots - 意圖: cancel_course (用戶: U_test_user_qa)",
"message": "🧠 使用對話上下文增強 slots 提取",
"message": "📊 規則提取置信度: 1.00",
"message": "✅ 最終 slots: {",
```

- ⚙️ 任務執行

```
"message": "🎯 執行任務: cancel_course",
"message": "📊 任務執行結果: {",
```

- 🔧 系統行為

```
"message": "🚀 生產用戶，使用真實 LINE Service",
"message": "🔍 檢查 replyToken: test-reply-token-1755096676080",
"message": "🧪 檢測到測試 token，跳過真實 LINE API 調用",
"message": "📤 [測試模式] 實際業務回覆: ❌ 找不到 小明 的 數學課，請確認課程是否存在",
```

> 本機 vs 線上：不一致 ❌
> 提示：本機 PASS 但線上 FAIL，建議檢查線上意圖/槽位與回覆模板是否一致、以及環境變數差異。

---

### C2.1-B C2.1-B 取消每日重複課程（提供範圍選項）

**輸入步驟**

```
  1. 取消小明的晨練課
```

**期望**

- 關鍵詞：只取消今天、明天起所有、刪除整個重複
- 預期代碼：RECURRING_CANCEL_OPTIONS

**本機結果**

- 總結：✅ 本機 PASS
- 意圖：cancel_course
- 任務代碼：RECURRING_CANCEL_OPTIONS
- 任務成功：❌
- 輸出：

```
請問是要取消哪個範圍？

🔘 只取消今天
🔘 取消明天起所有課程
🔘 刪除整個重複課程
```

| 關鍵詞 | 命中 |
| --- | --- |
| 只取消今天 | ✅ |
| 明天起所有 | ✅ |
| 刪除整個重複 | ✅ |

**線上結果**

- 總結：❌ 線上 FAIL
- Webhook：200 ✅
- 回覆：

```
請問是要取消哪個範圍？
```

| 關鍵詞 | 命中 |
| --- | --- |
| 只取消今天 | ❌ |
| 明天起所有 | ❌ |
| 刪除整個重複 | ❌ |

**診斷日誌（重點節點）**
- 📋 槽位提取

```
"message": "🔍 開始提取 slots - 意圖: cancel_course (用戶: U_test_user_qa)",
"message": "🧠 使用對話上下文增強 slots 提取",
"message": "📊 規則提取置信度: 1.00",
"message": "🤖 啟用 AI 輔助提取...",
"message": "✅ 最終 slots: { studentName: '小明', courseName: '晨練課' }",
```

- ⚙️ 任務執行

```
"message": "🎯 執行任務: cancel_course",
"message": "📊 任務執行結果: {",
```

- 🔧 系統行為

```
"message": "🚀 生產用戶，使用真實 LINE Service",
"message": "🔍 檢查 replyToken: test-reply-token-1755096692107",
"message": "🧪 檢測到測試 token，跳過真實 LINE API 調用",
"message": "📤 [測試模式] 實際業務回覆: 請問是要取消哪個範圍？",
```

> 本機 vs 線上：不一致 ❌
> 提示：本機 PASS 但線上 FAIL，建議檢查線上意圖/槽位與回覆模板是否一致、以及環境變數差異。

---

### C2.1-C C2.1-C 取消下週範圍（部分）

**輸入步驟**

```
  1. 取消小明下週的晨練課
```

**期望**

- 關鍵詞：已取消、下週、晨練課

**本機結果**

- 總結：✅ 本機 PASS
- 意圖：cancel_course
- 任務代碼：RECURRING_CANCEL_OPTIONS
- 任務成功：❌
- 輸出：

```
請問是要取消哪個範圍？

🔘 只取消今天
🔘 取消明天起所有課程
🔘 刪除整個重複課程
```

| 關鍵詞 | 命中 |
| --- | --- |
| 已取消 | ❌ |
| 下週 | ❌ |
| 晨練課 | ❌ |

**線上結果**

- 總結：❌ 線上 FAIL
- Webhook：200 ✅
- 回覆：

```
❌ 找不到 小明 的 數學課，請確認課程是否存在
```

| 關鍵詞 | 命中 |
| --- | --- |
| 已取消 | ❌ |
| 下週 | ❌ |
| 晨練課 | ❌ |

**診斷日誌（重點節點）**
- 📋 槽位提取

```
"message": "🔍 開始提取 slots - 意圖: cancel_course (用戶: U_test_user_qa)",
"message": "📊 規則提取置信度: 0.50",
"message": "🤖 啟用 AI 輔助提取...",
"message": "✅ 最終 slots: { studentName: '小明', courseName: '晨練課', timeReference: 'next_week' }",
```

- ⚙️ 任務執行

```
"message": "🎯 執行任務: cancel_course",
"message": "📊 任務執行結果: {",
```

- 🔧 系統行為

```
"message": "🚀 生產用戶，使用真實 LINE Service",
"message": "🔍 檢查 replyToken: test-reply-token-1755096707987",
"message": "🧪 檢測到測試 token，跳過真實 LINE API 調用",
"message": "📤 [測試模式] 實際業務回覆: 請問是要取消哪個範圍？",
```

> 本機 vs 線上：不一致 ❌
> 提示：本機 PASS 但線上 FAIL，建議檢查線上意圖/槽位與回覆模板是否一致、以及環境變數差異。

---

### C2.1-D C2.1-D 類型區分取消（daily/weekly）

**輸入步驟**

```
  1. 取消小明每天的晨練課
  2. 取消Lumi每週三的鋼琴課
```

**期望**

- 關鍵詞：每週三、取消

**本機結果**

- 總結：✅ 本機 PASS
- 意圖：cancel_course
- 任務代碼：MISSING_STUDENT
- 任務成功：❌
- 輸出：

```
❌ 請提供學生姓名，例如：「取消小明的數學課」
```

| 關鍵詞 | 命中 |
| --- | --- |
| 每週三 | ❌ |
| 取消 | ✅ |

**線上結果**

- 總結：❌ 線上 FAIL
- Webhook：200 ✅
- 任務代碼：MISSING_STUDENT
- 任務成功：❌
- 回覆：

```
❌ 請提供學生姓名，例如：「取消小明的數學課」
```

| 關鍵詞 | 命中 |
| --- | --- |
| 每週三 | ❌ |
| 取消 | ✅ |

**診斷日誌（重點節點）**
- 📋 槽位提取

```
"message": "🔍 開始提取 slots - 意圖: cancel_course (用戶: U_test_user_qa)",
"message": "📊 規則提取置信度: 0.50",
"message": "🤖 啟用 AI 輔助提取...",
"message": "✅ 最終 slots: {",
```

- ⚙️ 任務執行

```
"message": "🎯 執行任務: cancel_course",
"message": "📊 任務執行結果: {",
```

- 🔧 系統行為

```
"message": "🚀 生產用戶，使用真實 LINE Service",
"message": "🔍 檢查 replyToken: test-reply-token-1755096728870",
"message": "🧪 檢測到測試 token，跳過真實 LINE API 調用",
"message": "📤 [測試模式] 實際業務回覆: ❌ 請提供學生姓名，例如：「取消小明的數學課」",
```

> 本機 vs 線上：不一致 ❌
> 提示：本機 PASS 但線上 FAIL，建議檢查線上意圖/槽位與回覆模板是否一致、以及環境變數差異。

---

### C3.1-A C3.1-A 併發處理測試

**輸入步驟**

```
  1. （同時多使用者發起課表查詢，應全部成功）
```

**期望**

- 關鍵詞：成功、查詢、課程

**本機結果**

- 總結：✅ 本機 PASS
- 意圖：query_schedule
- 任務代碼：QUERY_OK
- 任務成功：✅
- 輸出：

```
📅 所有學生本週的課表

📆 8/9 (週六)
  上午7:00 - 晨練課 🔄
  上午8:00 - 晨練課 🔄
  下午3:00 - 鋼琴課 🔄
  下午5:00 - 瑜伽課 🔄

📆 8/10 (週日)
  上午7:00 - 晨練課 🔄
  上午8:00 - 晨練課 🔄
  上午8:00 - 英文課 🔄
  上午8:00 - 英文課 🔄
  上午10:00 - 英文課 🔄
  上午10:00 - 測試英文課 🔄
  上午10:30 - 三十分英文課
  上午10:30 - 十分測試英文課
  下午2:00 - 數學課
  下午2:00 - 小明今天有什麼課？
  下午2:00 - 測試小明今天有什麼課？
  下午2:00 - 測試數學課
  下午2:00 - 數學課
  下午2:00 - 測試數學課
  下午3:00 - 鋼琴課 🔄
  下午3:00 - 測試鋼琴課 🔄
  下午5:00 - 瑜伽課 🔄

📆 8/11 (週一)
  上午7:00 - 晨練課 🔄
  上午8:00 - 英文課 🔄
  上午8:00 - 晨練課 🔄
  上午8:00 - 英文課 🔄
  上午10:00 - 英文課 🔄
  上午10:00 - 測試英文課 🔄
  下午2:00 - 數學課
  下午3:00 - 鋼琴課 🔄
  下午5:00 - 瑜伽課 🔄
  下午7:00 - 游泳課 🔄
  下午8:30 - 鋼琴課
  下午8:30 - 鋼琴課

📆 8/12 (週二)
  上午7:00 - 晨練課 🔄
  上午8:00 - 晨練課 🔄
  上午10:30 - 三十分英文課
  下午2:00 - 數學課
  下午3:00 - 數學課 🔄
  下午3:00 - 鋼琴課 🔄
  下午3:00 - 測試鋼琴課 🔄
  下午5:00 - 瑜伽課 🔄
  下午7:00 - 游泳課 🔄

📆 8/13 (週三)
  上午7:00 - 晨練課 🔄
  上午8:00 - 晨練課 🔄
  下午2:00 - 鋼琴課 🔄
  下午2:00 - 鋼琴課 🔄
  下午3:00 - 鋼琴課 🔄
  下午3:00 - 測試鋼琴課 🔄
  下午5:00 - 瑜伽課 🔄
  下午8:30 - 鋼琴課

📆 8/14 (週四)
  上午7:00 - 晨練課 🔄
  上午8:00 - 晨練課 🔄
  下午2:00 - 數學課
  下午2:00 - 鋼琴課 🔄
  下午2:00 - 鋼琴課 🔄
  下午3:00 - 鋼琴課 🔄
  下午5:00 - 瑜伽課 🔄

📆 8/15 (週五)
  上午7:00 - 晨練課 🔄
  上午8:00 - 晨練課 🔄
  下午3:00 - 鋼琴課 🔄
  下午5:00 - 瑜伽課 🔄
```

| 關鍵詞 | 命中 |
| --- | --- |
| 成功 | ❌ |
| 查詢 | ❌ |
| 課程 | ❌ |

**線上結果**

- 總結：❌ 線上 FAIL
- Webhook：200 ✅
- 回覆：

```
📅 所有學生本週的課表
```

| 關鍵詞 | 命中 |
| --- | --- |
| 成功 | ❌ |
| 查詢 | ❌ |
| 課程 | ❌ |

**診斷日誌（重點節點）**
- 🔧 系統行為

```
"message": "🔍 檢查 replyToken: test-reply-token-1755096744128",
"message": "🧪 檢測到測試 token，跳過真實 LINE API 調用",
"message": "📤 [測試模式] 實際業務回覆: 📅 所有學生本週的課表",
```

> 本機 vs 線上：不一致 ❌
> 提示：本機 PASS 但線上 FAIL，建議檢查線上意圖/槽位與回覆模板是否一致、以及環境變數差異。

---
