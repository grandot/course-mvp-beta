[dotenv@17.2.1] injecting env (37) from .env -- tip: 📡 observe env with Radar: https://dotenvx.com/radar
🚀 Render 部署環境測試開始
🎯 測試目標: https://course-mvp-beta.onrender.com
============================================================
\n📍 測試 1/4: 服務健康狀況
🏥 測試 Render 服務健康狀況...
✅ 健康檢查通過
   狀態碼: 200
   回應時間: 171ms
   回應內容: {"status":"ok","timestamp":"2025-08-13T07:44:58.199Z","version":"1.0.0"}
\n📍 測試 2/4: 冷啟動性能
🧊 測試冷啟動情況...
   (如果服務已經閒置超過15分鐘，第一次請求會比較慢)
❌ 冷啟動測試失敗: Request failed with status code 400
\n📍 測試 3/4: Redis 連接與上下文
🔴 測試 Redis 連接...
❌ Redis 連接測試失敗: Request failed with status code 400
\n📍 測試 4/4: 併發處理能力
🔄 測試併發處理...
✅ 併發測試完成
   總請求數: 5
   成功: 0
   失敗: 5
   總時間: 282ms
   平均時間: 56ms
\n📊 測試總結:
============================================================
總測試數: 4
通過: 2
失敗: 2
通過率: 50.0%
\n💡 建議:
\n📄 詳細報告已保存: ./test-results/render-deployment-test.json
[dotenv@17.2.1] injecting env (37) from .env -- tip: ⚙️  load multiple .env files with { path: ['.env.local', '.env'] }
[dotenv@17.2.1] injecting env (0) from .env -- tip: ⚙️  write to custom object with { processEnv: myObject }
✅ 環境變數檢查通過
🧪 開始執行測試 (模式: both)
📊 測試案例數量: 28

🏠 執行本機邏輯測試...
✅ Redis 連接成功

💬 輸入: "小明明天下午2點要上數學課"
🎯 開始解析意圖: 小明明天下午2點要上數學課 (用戶: U_test_user_qa)
🤖 AI調用參數: { message: '小明明天下午2點要上數學課', timeoutMs: 5000, minConfidence: 0.7 }
[dotenv@17.2.1] injecting env (0) from .env -- tip: 🔐 prevent committing .env to code: https://dotenvx.com/precommit
✅ OpenAI 服務初始化完成
🤖 AI原始結果: { intent: 'add_course', confidence: 0.85 }
✅ AI結果採用: add_course 0.85
🎯 識別意圖: add_course
🔍 開始提取 slots - 意圖: add_course (用戶: U_test_user_qa)
🕒 開始高級時間解析: 小明明天下午2點要上數學課
✅ 時間解析成功: {
  input: '小明明天下午2點要上數學課',
  output: '14:00',
  details: { hour: 14, minute: 0, matchType: 'arabic_period', periodInfo: '下午' }
}
🧠 使用對話上下文增強 slots 提取
📊 規則提取置信度: 1.00
🤖 啟用 AI 輔助提取...
✅ 最終 slots: {
  studentName: '小明',
  courseName: '數學課',
  scheduleTime: '14:00',
  recurring: false,
  timeReference: 'tomorrow'
}
📋 提取實體: {"studentName":"小明","courseName":"數學課","scheduleTime":"14:00","recurring":false,"timeReference":"tomorrow"}
🎯 執行任務: add_course
🎯 開始處理新增課程任務
📋 接收參數: {
  studentName: '小明',
  courseName: '數學課',
  scheduleTime: '14:00',
  recurring: false,
  timeReference: 'tomorrow'
}
[dotenv@17.2.1] injecting env (0) from .env -- tip: 📡 version env with Radar: https://dotenvx.com/radar
✅ Firebase 服務初始化完成
[dotenv@17.2.1] injecting env (0) from .env -- tip: ⚙️  specify custom .env file path with { path: '/custom/path/.env' }
🔐 已使用 Service Account 模式初始化 Google Calendar
✅ Google Calendar 服務初始化完成（模式：service_account）
📝 準備建立日曆: {"summary":"小明的課程 (U_test_user_qa)","description":"由 LINE 課程管理機器人自動創建的學生課程日曆","timeZone":"Asia/Taipei"}
✅ 已創建新日曆: 4e1bdb0b9c4537d3c965b53d0bc5b72a5c50127a33c2c90579646355b9328332@group.calendar.google.com
✅ 已更新 calendarId: 小明 4e1bdb0b9c4537d3c965b53d0bc5b72a5c50127a33c2c90579646355b9328332@group.calendar.google.com
👤 學生日曆: 4e1bdb0b9c4537d3c965b53d0bc5b72a5c50127a33c2c90579646355b9328332@group.calendar.google.com
📝 準備建立事件: calendarId= 4e1bdb0b9c4537d3c965b53d0bc5b72a5c50127a33c2c90579646355b9328332@group.calendar.google.com  resource= {"summary":"[U_test_user_qa] 小明 - 數學課","description":"小明的課程\n由 LINE 課程管理機器人自動創建","start":{"dateTime":"2025-08-14T14:00:00+08:00","timeZone":"Asia/Taipei"},"end":{"dateTime":"2025-08-14T15:00:00+08:00","timeZone":"Asia/Taipei"},"recurrence":[],"extendedProperties":{"private":{"userId":"U_test_user_qa","studentName":"小明","courseId":""}},"reminders":{"useDefault":false,"overrides":[]}}
✅ 已創建課程事件: mj70v6nbt21mfqgup7ih52s844
📅 Google Calendar 事件已創建: mj70v6nbt21mfqgup7ih52s844
✅ 課程資料已儲存: voKV80b54Oxncodc1aj1
💾 Firebase 課程資料已儲存: voKV80b54Oxncodc1aj1
📊 任務執行結果: {
  success: true,
  code: 'ADD_COURSE_OK',
  message: '✅ 課程已安排成功！\n\n👦 學生：小明\n📚 課程：數學課\n📅 日期：2025-08-14\n🕐 時間：下午2:00',
  data: {
    courseId: 'voKV80b54Oxncodc1aj1',
    eventId: 'mj70v6nbt21mfqgup7ih52s844'
  },
  quickReply: [ { label: '✅ 確認', text: '確認' }, { label: '❌ 取消操作', text: '取消操作' } ]
}
📤 機器人回覆: "✅ 課程已安排成功！

👦 學生：小明
📚 課程：數學課
📅 日期：2025-08-14
🕐 時間：下午2:00"

💬 輸入: "我想要什麼時候上課來著"
🎯 開始解析意圖: 我想要什麼時候上課來著 (用戶: U_test_user_qa)
🤖 AI調用參數: { message: '我想要什麼時候上課來著', timeoutMs: 5000, minConfidence: 0.7 }
🤖 AI原始結果: { intent: 'query_schedule', confidence: 0.8 }
✅ AI結果採用: query_schedule 0.8
🎯 識別意圖: query_schedule
🔍 開始提取 slots - 意圖: query_schedule (用戶: U_test_user_qa)
🧠 使用對話上下文增強 slots 提取
📊 規則提取置信度: 0.00
🔄 規則提取信心度低，AI 輔助增強...
✅ 文檔已添加到 error_cases: QgvV1q412aEJVHWYoRnL
📊 低置信度案例已記錄: QgvV1q412aEJVHWYoRnL
✅ 最終 slots: { courseName: '課來著' }
📋 提取實體: {"courseName":"課來著"}
🎯 執行任務: query_schedule
🎯 開始處理查詢課表任務
📋 接收參數: { courseName: '課來著' }
📅 查詢時間範圍: { startDate: '2025-08-10', endDate: '2025-08-16', description: '本週' }
📚 查詢到 392 筆課程資料
📚 查詢到 366 筆課程資料
📚 查詢到 233 筆課程資料
📚 查詢到 3 筆課程資料
📚 查詢到 1 筆課程資料
📚 查詢到 2 筆課程資料
